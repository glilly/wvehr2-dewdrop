XTV ROUTINE CHANGES
ZWR
^XTV(8991,0)="XTV ROUTINE CHANGES^8991^63^63"
^XTV(8991,1,0)="RTP4"
^XTV(8991,1,1,0)="^8991.01^1^1"
^XTV(8991,1,1,1,0)="2960715.1802"
^XTV(8991,1,1,1,1,0)="^8991.11^61^61"
^XTV(8991,1,1,1,1,1,0)="RTP4 ;MJK/TROY ISC;Charge Out Pull List; ;7/15/96  18:02"
^XTV(8991,1,1,1,1,2,0)=" ;;v 2.0;Record Tracking;**3**;10/22/91 "
^XTV(8991,1,1,1,1,3,0)="6 ;Charge Out Pull List"
^XTV(8991,1,1,1,1,4,0)=" S RTRD(1)=""Yes^designate requests as 'not fillable'"",RTRD(2)=""No^not designate any requests as 'not fillable'"",RTRD(""B"")=2,RTRD(0)=""S"",RTRD(""A"")=""Do you wish to first designate some requests as 'not fillable'? """
^XTV(8991,1,1,1,1,5,0)=" D SET^RTRD K RTRD Q:$E(X)=""^""  I $E(X)=""Y"" D 5^RTP1"
^XTV(8991,1,1,1,1,6,0)=" D DIV G Q:'$D(RTDV) S RTMES=""CHARGED OUT"" D PULL^RTP6 K RTMES G Q:'$D(RTPULL)"
^XTV(8991,1,1,1,1,7,0)=" ;ask holding area"
^XTV(8991,1,1,1,1,8,0)=" K RTB D BOR^RTP40 G Q:$D(RTESC) I $D(RTB) S RTHOLD="""""
^XTV(8991,1,1,1,1,9,0)=" ;ask for perpetual records if RR"
^XTV(8991,1,1,1,1,10,0)=" S (RTYES,RTACCN)="""""
^XTV(8991,1,1,1,1,11,0)=" I $D(RTHOLD)!('$D(RTIRE))"
^XTV(8991,1,1,1,1,12,0)=" E  D BOR^RTP41 K DIC G Q:$S('$D(RTB):1,RTYES[""^"":1,RTACCN[""^"":1,1:0)"
^XTV(8991,1,1,1,1,13,0)=" ;"
^XTV(8991,1,1,1,1,14,0)=" I RTPULL=""ALL"" W !!?5,""*** Printing an 'UPDATE' listing maybe a good idea ***"",!?5,""*** before charging out these records.             ***"""
^XTV(8991,1,1,1,1,15,0)=" S RTRD(1)=""Yes^continue charge out process"",RTRD(2)=""No^stop charge out process"",RTRD(""A"")=""Are you sure you want to 'CHARGE OUT' these records? "",RTRD(""B"")=2,RTRD(0)=""S"" D SET^RTRD K RTRD G Q:$E(X)'=""Y"""
^XTV(8991,1,1,1,1,16,0)=" ;"
^XTV(8991,1,1,1,1,17,0)=" D NOW^%DTC S RTQUEDT=%,RTVAR=""RTACCN^RTFR^RTYES^RTAPL^RTQUEDT^RTDT^RTDV^RTPULL""_$S($D(RTB):""^RTB"",1:"""")_$S($D(RTIRE):""^RTIRE"",1:"""")_$S($D(RTHOLD):""^RTHOLD"",1:""""),RTDESC=""Charge Out Pull List"",RTPGM=""START^RTP4"" D ZIS^RTUTL G Q:POP"
^XTV(8991,1,1,1,1,18,0)=" ;"
^XTV(8991,1,1,1,1,19,0)="START U IO K ^TMP($J),RTP0 S RTBKGRD="""",RTALL=+RTPULL,RTBEG=RTDT-.0001,RTEND=$S(RTDT[""."":RTDT,1:RTDT_"".2359"") I $D(RTB),$D(RTHOLD) D ^RTP40 G Q"
^XTV(8991,1,1,1,1,20,0)=" I $D(RTB),$D(RTIRE) S ^TMP($J,""RTREQUESTS"",""RTB"")=RTB K RTB"
^XTV(8991,1,1,1,1,21,0)=" S RTAG=""SCAN"" D CHK W @IOF F RTLIST=""RTCANCEL"",""RTMISS"" I $D(^TMP($J,RTLIST)) D LIST^RTP41"
^XTV(8991,1,1,1,1,22,0)=" W @IOF,!,""PULL LIST CHARGE-OUT LOG"" D NOW^%DTC S Y=$E(%,1,12) D D^DIQ W ?51,""RUN DATE: "",Y D LINE^RTUTL3 W ! S RTAG=""FILL"" D CHK"
^XTV(8991,1,1,1,1,23,0)=" ;now go and make perpetual records"
^XTV(8991,1,1,1,1,24,0)=" I RTYES,$D(RTIRE),'$D(RTHOLD) D PERP^RTQ41"
^XTV(8991,1,1,1,1,25,0)=" ;"
^XTV(8991,1,1,1,1,26,0)="Q K RTACCN,RTYES,RTHOLD,DIC,RTAG,DR,RTESC,RTBKGRD,RTPGM,RTPLTY,RTVAR,RTLIST,RTN,RTSSN,RTSTAT,SAVX,RTB,RTC,RTBEG,RTEND,RTDESC,RTALL,RTQUEDT,RTPULL,RTPULL0,RTDV,RTDT,RTDEV"
^XTV(8991,1,1,1,1,27,0)=" K ^TMP($J)"
^XTV(8991,1,1,1,1,28,0)=" D CLOSE^RTUTL K %DT,DA,D0,DIE,N,A"
^XTV(8991,1,1,1,1,29,0)=" K Y,RT,J,RTE,X1,P Q"
^XTV(8991,1,1,1,1,30,0)=" ;rtp0,""^"",10 is pull list type"
^XTV(8991,1,1,1,1,31,0)="CHK I 'RTALL F RTPDT=RTBEG:0 S RTPDT=$O(^RTV(194.2,""C"",RTPDT)) Q:'RTPDT!(RTPDT>RTEND)  F RTPULL=0:0 S RTPULL=$O(^RTV(194.2,""C"",RTPDT,RTPULL)) Q:'RTPULL  I $D(^RTV(194.2,RTPULL,0)) S RTP0=^(0) I ""13""[$E($P(RTP0,""^"",10)_""0"") D CHKPULL D:Y @RTAG"
^XTV(8991,1,1,1,1,32,0)=" I $D(^RTV(194.2,+RTALL,0)) S RTPULL=+RTALL,RTP0=^(0) D CHKPULL D:Y @RTAG"
^XTV(8991,1,1,1,1,33,0)=" K RTPULL,RTP0,RTPDT Q"
^XTV(8991,1,1,1,1,34,0)=" ;^6 canceled, apl, div"
^XTV(8991,1,1,1,1,35,0)="CHKPULL S Y=0,X=RTP0 Q:$S($P(X,""^"",6)=""x"":1,$P(X,""^"",15)'=+RTAPL:1,$P(X,""^"",12)'=RTDV:1,1:0)  S RTPLTY=$P(X,""^"",10)"
^XTV(8991,1,1,1,1,36,0)=" I '$D(RTIRE),RTPLTY'=3 S Y=1 Q"
^XTV(8991,1,1,1,1,37,0)=" I $D(RTIRE),RTPLTY=3 S Y=1 Q"
^XTV(8991,1,1,1,1,38,0)=" Q"
^XTV(8991,1,1,1,1,39,0)="SCAN F RTN=0:0 K RT S RTN=$O(^RTV(190.1,""AP"",RTPULL,RTN)) Q:'RTN  I $D(^RTV(190.1,RTN,0)) S RTQ=RTN,RTQ0=^(0),RT=+RTQ0 D SET"
^XTV(8991,1,1,1,1,40,0)=" Q"
^XTV(8991,1,1,1,1,41,0)=" ;"
^XTV(8991,1,1,1,1,42,0)="SET I $P(RTQ0,""^"",6)=""x"" S ^TMP($J,""RTCANCEL"",$P(RTP0,""^""),RTQ)=RTQ0 Q"
^XTV(8991,1,1,1,1,43,0)=" I $D(^RTV(190.2,""AM"",""m"",RT))!($D(^RTV(190.2,""AM"",""s"",RT))) S ^TMP($J,""RTMISS"",$P(RTP0,""^""),RTQ)=RTQ0 Q"
^XTV(8991,1,1,1,1,44,0)=" S X=+$P(RTQ0,""^"",4) Q:'X  S:'$D(^TMP($J,""RTREQUESTS"",RT)) ^(RT)=X_""^""_RTQ S:X<^(RT) ^(RT)=X_""^""_RTQ ;;;Q"
^XTV(8991,1,1,1,1,45,0)=" ;rte=^(0)^1"
^XTV(8991,1,1,1,1,46,0)=" I RTYES,$D(RTIRE),$D(RTPLTY),RTPLTY=3,$D(^RT(RT,0)) S X=$P(^(0),""^"") I X]"""",'$D(^TMP($J,""RTE"",X)) S ^(X)="""" Q"
^XTV(8991,1,1,1,1,47,0)=" Q"
^XTV(8991,1,1,1,1,48,0)=" ;"
^XTV(8991,1,1,1,1,49,0)="DIV ;Entry point to determine if pull function is allowed"
^XTV(8991,1,1,1,1,50,0)=" ;   with RTAPL and RTDIV defined"
^XTV(8991,1,1,1,1,51,0)=" K RTDV,RTDEV I $S('$D(RTDIV):1,'$D(RTFR):1,'$D(^DIC(4,+RTDIV,0)):1,'$D(^DIC(195.1,+RTAPL,""INST"",+RTDIV)):1,1:0) D MES Q"
^XTV(8991,1,1,1,1,52,0)=" W !!,""Institution: "",$P(^DIC(4,+RTDIV,0),""^"") S RTDV=RTDIV,RTDEV=$P(RTFR,""^"",6) Q"
^XTV(8991,1,1,1,1,53,0)=" ;"
^XTV(8991,1,1,1,1,54,0)="MES W !!?3,*7,""This function requires the user to be signed onto the"",!?3,""system with INSTITUTION parameters defined."" Q"
^XTV(8991,1,1,1,1,55,0)=" ;"
^XTV(8991,1,1,1,1,56,0)="FILL S RTCOMR=""Pull List: ""_$P(RTP0,""^"") F RTQ=0:0 S RTQ=$O(^RTV(190.1,""AP"",RTPULL,RTQ)) Q:'RTQ  I $D(^RTV(190.1,RTQ,0)),$P(^(0),""^"",6)=""r"" S RTQ0=^(0) D FILL1"
^XTV(8991,1,1,1,1,57,0)=" K RTQ,RTQ0,RTCOMR S RTSTAT=""c"" D STAT^RTP W !?3,""...'"",$P(RTP0,""^""),""' pull list has been charged out."" Q"
^XTV(8991,1,1,1,1,58,0)=" ;"
^XTV(8991,1,1,1,1,59,0)="FILL1 Q:$S('$D(^RT(+RTQ0,""CL"")):1,+$P(^(""CL""),""^"",6)>RTQUEDT:1,$P(RTQ0,""^"",6)'=""r"":1,1:0)  I $P(RTP0,""^"",16),$P(^(""CL""),""^"",5)'=$P(RTP0,""^"",16) Q"
^XTV(8991,1,1,1,1,60,0)=" S RT=+RTQ0 I $D(^TMP($J,""RTREQUESTS"",RT)),$P(^(RT),""^"",2)=RTQ D:RTPLTY'=3 FILL^RTQ4 D:RTPLTY=3 FILL^RTQ41"
^XTV(8991,1,1,1,1,61,0)=" K RT Q"
^XTV(8991,1,1,"B",2960715.1802,1)=""
^XTV(8991,2,0)="GMREPRE"
^XTV(8991,2,1,0)="^8991.01^1^1"
^XTV(8991,2,1,1,0)="2960722.1645"
^XTV(8991,2,1,1,1,0)="^8991.11^94^94"
^XTV(8991,2,1,1,1,1,0)="GMRDALRT ; SLC/JER - Notify Author and Attending. ;7/22/96  16:45"
^XTV(8991,2,1,1,1,2,0)=" ;;1.0;Discharge Summary;**6**;Nov 02, 1993"
^XTV(8991,2,1,1,1,3,0)="SEND(DA) ; Generate ""available for signature"" alert"
^XTV(8991,2,1,1,1,4,0)=" N ACT,GMRDAUTH,NODE,GMRDPNM,GMRDRDOC,GMRDSIG,GMRDCOSG"
^XTV(8991,2,1,1,1,5,0)=" N GMRDADM,GMRDSSN,GMRD,XQA,XQAKILL,XQAMSG,XQAROU,XQAID,XQAFLG"
^XTV(8991,2,1,1,1,6,0)=" I '$D(GMRDPRM0)!'$D(GMRDPRM1) D SETPARM^GMRDLIBE"
^XTV(8991,2,1,1,1,7,0)=" D ALERTDEL(DA)"
^XTV(8991,2,1,1,1,8,0)=" S NODE=$G(^GMR(128,+DA,0)),ACT=$G(^(""ACT""))"
^XTV(8991,2,1,1,1,9,0)=" ; Quit if notifications not enabled"
^XTV(8991,2,1,1,1,10,0)=" I '+$P(GMRDPRM1,U,7)!(+$P(ACT,U,6)<+$P(GMRDPRM1,U,7)) Q"
^XTV(8991,2,1,1,1,11,0)=" I +$P(GMRDPRM1,U,3),'+$P(ACT,U,19) Q  ; Don't send when not released"
^XTV(8991,2,1,1,1,12,0)=" I +$P(GMRDPRM1,U,2),'+$P(ACT,U,8) Q  ; Don't send when unverified"
^XTV(8991,2,1,1,1,13,0)=" S GMRDPNM=$E($P($G(^DPT(+$P(NODE,U,2),0)),U),1,9)"
^XTV(8991,2,1,1,1,14,0)=" S GMRDADM=$$DATE^GMRDLIBS($P(NODE,U,7))"
^XTV(8991,2,1,1,1,15,0)=" S GMRDAUTH=$P(ACT,U),GMRDSIG=$P(ACT,U,4)"
^XTV(8991,2,1,1,1,16,0)=" S GMRDRDOC=$P(ACT,U,9),GMRDCOSG=$P(ACT,U,11)"
^XTV(8991,2,1,1,1,17,0)=" D PATVADPT^GMRDLIBA(.GMRD,+$P(NODE,U,2)) ;Used to get SSN. Date not important."
^XTV(8991,2,1,1,1,18,0)=" S GMRDSSN=$E(GMRDPNM,1)_$P($G(GMRD(""SSN"")),""-"",3)"
^XTV(8991,2,1,1,1,19,0)=" I +$P(GMRDPRM0,U,19),$S($D(^XUSEC(""PROVIDER"",+GMRDAUTH))!($D(^XUSEC(""GMRD AUTHOR"",+GMRDAUTH))):1,1:0),$D(^VA(200,+GMRDAUTH,0)),'+GMRDSIG S XQA(GMRDAUTH)="""" ; Set AUTHOR as recipient"
^XTV(8991,2,1,1,1,20,0)=" I $D(^VA(200,+GMRDRDOC,0)),'+GMRDCOSG S XQA(GMRDRDOC)="""" ; Set Attending as recipient"
^XTV(8991,2,1,1,1,21,0)=" Q:$D(XQA)'>9"
^XTV(8991,2,1,1,1,22,0)=" S XQAID=""GMRD""_+DA"
^XTV(8991,2,1,1,1,23,0)=" S XQAMSG=GMRDPNM_"" (""_GMRDSSN_""): Adm ""_GMRDADM_"", ""_$S($P(NODE,U,9)=""P"":""STAT "",1:"""")_$S(+$P(NODE,U,6):""Addendum"",1:""Dis Sum"")"
^XTV(8991,2,1,1,1,24,0)=" I $$OVERDUE^GMRDLIBC(DA) S XQAMSG=XQAMSG_"" OVERDUE for signature."" G ENDMSG"
^XTV(8991,2,1,1,1,25,0)=" I +$P(GMRDPRM0,U,19),$S($D(^XUSEC(""PROVIDER"",+GMRDAUTH))!($D(^XUSEC(""GMRD AUTHOR"",+GMRDAUTH))):1,1:0),GMRDAUTH'=GMRDRDOC D  G ENDMSG"
^XTV(8991,2,1,1,1,26,0)=" . I '+GMRDSIG,'+GMRDCOSG S XQAMSG=XQAMSG_"" unsigned & uncosigned."" Q"
^XTV(8991,2,1,1,1,27,0)=" . I +GMRDSIG,'+GMRDCOSG S XQAMSG=XQAMSG_"" signed & uncosigned."" Q"
^XTV(8991,2,1,1,1,28,0)=" S XQAMSG=XQAMSG_"" available for signature."""
^XTV(8991,2,1,1,1,29,0)="ENDMSG ;"
^XTV(8991,2,1,1,1,30,0)=" S XQAROU=""ACT^GMRDALRT"",XQADATA=+DA_U"
^XTV(8991,2,1,1,1,31,0)=" D SETUP^XQALERT"
^XTV(8991,2,1,1,1,32,0)=" Q"
^XTV(8991,2,1,1,1,33,0)="ACT ; Act on alerts"
^XTV(8991,2,1,1,1,34,0)=" N GMRDQUIK,GMRDA,GMRDPRM0,GMRDPRM1,GMRDPRM3 S GMRDQUIK=1 K XQAKILL"
^XTV(8991,2,1,1,1,35,0)=" S GMRDA=$P(XQADATA,U)"
^XTV(8991,2,1,1,1,36,0)=" D:'$D(GMRDPRM0)!'$D(GMRDPRM1) SETPARM^GMRDLIBE"
^XTV(8991,2,1,1,1,37,0)=" D EN^VALM(""GMRD BROWSE FOR CLINICIAN"")"
^XTV(8991,2,1,1,1,38,0)=" Q"
^XTV(8991,2,1,1,1,39,0)="SENDTRAN(DA) ; Generate ""Send back to transcription"" alert"
^XTV(8991,2,1,1,1,40,0)=" N GMRDADM,NODE,GMRDPNM,GMRDSSN,GMRDTRAN,GMRD,XQA,XQAMSG,GMRDMSG"
^XTV(8991,2,1,1,1,41,0)=" N GMRDAUTH,ACT"
^XTV(8991,2,1,1,1,42,0)=" I '$D(GMRDPRM0)!'$D(GMRDPRM1) D SETPARM^GMRDLIBE"
^XTV(8991,2,1,1,1,43,0)=" D ALERTDEL(DA)"
^XTV(8991,2,1,1,1,44,0)=" ; Don't send if notifications not enabled"
^XTV(8991,2,1,1,1,45,0)=" I '+$P(GMRDPRM1,U,7) Q"
^XTV(8991,2,1,1,1,46,0)=" S NODE=$G(^GMR(128,+DA,0)),ACT=$G(^(""ACT""))"
^XTV(8991,2,1,1,1,47,0)=" S GMRDPNM=$E($P($G(^DPT(+$P(NODE,U,2),0)),U),1,9)"
^XTV(8991,2,1,1,1,48,0)=" S GMRDADM=$$DATE^GMRDLIBS($P(NODE,U,7))"
^XTV(8991,2,1,1,1,49,0)=" S GMRDTRAN=$P(ACT,U,5),GMRDAUTH=$P(ACT,U)"
^XTV(8991,2,1,1,1,50,0)=" D PATVADPT^GMRDLIBA(.GMRD,+$P(NODE,U,2)) ;Used to get SSN. Date not important."
^XTV(8991,2,1,1,1,51,0)=" S GMRDSSN=$E(GMRDPNM,1)_$P($G(GMRD(""SSN"")),""-"",3)"
^XTV(8991,2,1,1,1,52,0)=" I $D(^VA(200,+GMRDTRAN,0)) S XQA(GMRDTRAN)="""""
^XTV(8991,2,1,1,1,53,0)=" Q:$D(XQA)'>9"
^XTV(8991,2,1,1,1,54,0)=" S GMRDMSG=$S(GMRDTRAN=GMRDAUTH:"" needs editing"",1:"" needs retranscription."")"
^XTV(8991,2,1,1,1,55,0)=" S XQAID=""GMRD""_+DA"
^XTV(8991,2,1,1,1,56,0)=" S XQAMSG=GMRDPNM_"" (""_GMRDSSN_""): Adm ""_GMRDADM_"", ""_$S($P(NODE,U,6):""Addendum"",1:""Dis Sum"")_GMRDMSG"
^XTV(8991,2,1,1,1,57,0)=" D SETUP^XQALERT"
^XTV(8991,2,1,1,1,58,0)=" Q"
^XTV(8991,2,1,1,1,59,0)="SENDADD(DA) ; Generates ""Addendum added"" alert"
^XTV(8991,2,1,1,1,60,0)=" N ACT,GMRDADM,NODE,GMRDPNM,GMRDSSN,GMRDTRAN,GMRD,XQA,XQAMSG,XQAFLG"
^XTV(8991,2,1,1,1,61,0)=" N XQADATA,XQAROU,GMRDAUTH,GMRDATE,GMRDAAUT"
^XTV(8991,2,1,1,1,62,0)=" I '$D(GMRDPRM0)!'$D(GMRDPRM1) D SETPARM^GMRDLIBE"
^XTV(8991,2,1,1,1,63,0)=" D ADDENDEL(DA)"
^XTV(8991,2,1,1,1,64,0)=" ; Don't send if notifications not enabled"
^XTV(8991,2,1,1,1,65,0)=" I '+$P(GMRDPRM1,U,7) Q"
^XTV(8991,2,1,1,1,66,0)=" S NODE=$G(^GMR(128,+DA,0)),ACT=$G(^(""ACT""))"
^XTV(8991,2,1,1,1,67,0)=" S GMRDPNM=$E($P($G(^DPT(+$P(NODE,U,2),0)),U),1,9)"
^XTV(8991,2,1,1,1,68,0)=" S GMRDAAUT=+$P(ACT,U)"
^XTV(8991,2,1,1,1,69,0)=" S GMRDADM=$S(+$P(NODE,U,7):$P(NODE,U,7),+$G(GMRD(""ADDT"")):+$G(GMRD(""ADDT"")),1:"""")"
^XTV(8991,2,1,1,1,70,0)=" S:$L(GMRDADM) GMRDADM="" Adm ""_$$DATE^GMRDLIBS(GMRDADM)_"","""
^XTV(8991,2,1,1,1,71,0)=" S GMRDATE=$S(+$P(ACT,U,3):$P(ACT,U,3),1:$G(DT))"
^XTV(8991,2,1,1,1,72,0)=" S GMRDATE=$$DATE^GMRDLIBS(GMRDATE)"
^XTV(8991,2,1,1,1,73,0)=" D PATVADPT^GMRDLIBA(.GMRD,+$P(NODE,U,2)) ;Used to get SSN. Date not important."
^XTV(8991,2,1,1,1,74,0)=" S GMRDSSN=$E(GMRDPNM,1)_$P($G(GMRD(""SSN"")),""-"",3)"
^XTV(8991,2,1,1,1,75,0)=" S GMRDTRAN=$P(ACT,U,5)"
^XTV(8991,2,1,1,1,76,0)=" ;Attending and Author of original discharge summary"
^XTV(8991,2,1,1,1,77,0)=" S GMRDRDOC=$P($G(^GMR(128,$P(NODE,U,6),""ACT"")),U,9),GMRDAUTH=$P($G(^(""ACT"")),U)"
^XTV(8991,2,1,1,1,78,0)=" I GMRDAUTH'=GMRDTRAN,$D(^VA(200,+GMRDAUTH,0)) S XQA(GMRDAUTH)="""" ; Set AUTHOR as recipient"
^XTV(8991,2,1,1,1,79,0)=" I GMRDRDOC'=GMRDTRAN,$D(^VA(200,+GMRDRDOC,0)) S XQA(GMRDRDOC)="""" ; Set Attending as recipient"
^XTV(8991,2,1,1,1,80,0)=" S GMRDMGR=0 F  S GMRDMGR=$O(^XUSEC(""GMRD MANAGER"",GMRDMGR)) Q:GMRDMGR'>0  D"
^XTV(8991,2,1,1,1,81,0)=" . S XQA(GMRDMGR)="""" ; Set GMRD MANAGER as recipient"
^XTV(8991,2,1,1,1,82,0)=" Q:$D(XQA)'>9"
^XTV(8991,2,1,1,1,83,0)=" S XQAID=""GMRDADD""_+DA"
^XTV(8991,2,1,1,1,84,0)=" S XQAMSG=GMRDPNM_"" (""_GMRDSSN_""):""_GMRDADM_"" Addendum added ""_GMRDATE_"" by ""_$P($G(^VA(200,+GMRDAAUT,0)),U)"
^XTV(8991,2,1,1,1,85,0)=" D SETUP^XQALERT"
^XTV(8991,2,1,1,1,86,0)=" Q"
^XTV(8991,2,1,1,1,87,0)="ALERTDEL(DA) ; Delete alerts associated with a given Dis Sum record"
^XTV(8991,2,1,1,1,88,0)=" N XQA,XQAID,XQAKILL S XQAID=""GMRD""_DA"
^XTV(8991,2,1,1,1,89,0)=" D DELETEA^XQALERT"
^XTV(8991,2,1,1,1,90,0)=" Q"
^XTV(8991,2,1,1,1,91,0)="ADDENDEL(DA) ; Delete alert associated with a Addendum added"
^XTV(8991,2,1,1,1,92,0)=" N XQA,XQAID,XQAKILL S XQAID=""GMRDADD""_DA"
^XTV(8991,2,1,1,1,93,0)=" D DELETEA^XQALERT"
^XTV(8991,2,1,1,1,94,0)=" Q"
^XTV(8991,2,1,"B",2960722.1645,1)=""
^XTV(8991,3,0)="RGWBSVR"
^XTV(8991,3,1,0)="^8991.01^1^1"
^XTV(8991,3,1,1,0)="2961018.1737"
^XTV(8991,3,1,1,1,0)="^8991.11^152^152"
^XTV(8991,3,1,1,1,1,0)="RGWBSVR ; CAIRO/DKM/PLS/MRC - WWW Server Software ;10/18/96  17:37"
^XTV(8991,3,1,1,1,2,0)=" ;;1.0;WEBMAN;;30-Aug-96 10:09 [DKM]"
^XTV(8991,3,1,1,1,3,0)=" ;================================================================="
^XTV(8991,3,1,1,1,4,0)=" ; Startup web server"
^XTV(8991,3,1,1,1,5,0)="START(RGREALM,RGTRACE) "
^XTV(8991,3,1,1,1,6,0)=" N RGZ"
^XTV(8991,3,1,1,1,7,0)=" S RGREALM=$$REALM(RGREALM)"
^XTV(8991,3,1,1,1,8,0)=" I RGREALM D"
^XTV(8991,3,1,1,1,9,0)=" .S U=""^"",RGZ=$$^RGMSCDIC(999.2,RGREALM_""|<;.9///NO"")"
^XTV(8991,3,1,1,1,10,0)=" .D ENTRY(0,RGREALM,.RGTRACE)"
^XTV(8991,3,1,1,1,11,0)=" Q"
^XTV(8991,3,1,1,1,12,0)=" ; Startup web server from TaskMan"
^XTV(8991,3,1,1,1,13,0)="TASK(RGREALM) "
^XTV(8991,3,1,1,1,14,0)=" N RGZ"
^XTV(8991,3,1,1,1,15,0)=" S:$G(RGREALM)="""" RGREALM=$$SELRLM(0,5)"
^XTV(8991,3,1,1,1,16,0)=" S RGREALM=$$REALM(RGREALM)"
^XTV(8991,3,1,1,1,17,0)=" Q:RGREALM<1"
^XTV(8991,3,1,1,1,18,0)=" S RGZ=$$QUEUE^RGMSCTSK(""START^RGWBSVR(RGREALM)"",""Webman server for realm ""_$P(^RGWEB(999.2,RGREALM,0),U),$H,""RGREALM"")"
^XTV(8991,3,1,1,1,19,0)=" I RGZ<1 W !!,""Failed to start server."",!!"
^XTV(8991,3,1,1,1,20,0)=" E  W !!,""Server started as task #""_RGZ_""."",!!"
^XTV(8991,3,1,1,1,21,0)=" Q"
^XTV(8991,3,1,1,1,22,0)=" ; Select a realm"
^XTV(8991,3,1,1,1,23,0)="SELRLM(RGX,RGY) "
^XTV(8991,3,1,1,1,24,0)=" Q $$ENTRY^RGMSCLKP(999.2,""CU3X"",""Select a realm: "",""B"",""*"","""","""",.RGX,.RGY)"
^XTV(8991,3,1,1,1,25,0)=" ; Get IEN of realm"
^XTV(8991,3,1,1,1,26,0)="REALM(RGREALM) "
^XTV(8991,3,1,1,1,27,0)=" Q $S(RGREALM=+RGREALM:RGREALM,1:+$O(^RGWEB(999.2,""B"",RGREALM,0)))"
^XTV(8991,3,1,1,1,28,0)=" ; Common entry point for servers"
^XTV(8991,3,1,1,1,29,0)="ENTRY(RGPORT,RGREALM,RGTRACE) "
^XTV(8991,3,1,1,1,30,0)=" N RGHOME,RGPID,RGZ,RGMETH,RGURL,RGCRLF,RGVER,RGSIZE,RGIP,RGDT"
^XTV(8991,3,1,1,1,31,0)=" N RGTMOUT,RGQUIT,RGAUTH,DUZ"
^XTV(8991,3,1,1,1,32,0)=" I $$ETRAP^RGZOSF N $ET S $ET="""""
^XTV(8991,3,1,1,1,33,0)=" S U=""^"",RGDT=$$%DTNOW^RGUT"
^XTV(8991,3,1,1,1,34,0)=" S RGCRLF=$C(13,10),RGVER=""HTTP/1.0"",RGSIZE=0,RGAUTH=0"
^XTV(8991,3,1,1,1,35,0)=" S RGPID=$J_"":""_RGPORT,RGZ=^RGWEB(999.2,RGREALM,0),RGHOME=$G(^(.5))"
^XTV(8991,3,1,1,1,36,0)=" S RGPORT(0)=$P(RGZ,U,2),RGPORT(1)=$P(RGZ,U,3),RGPORT(2)=$P(RGZ,U,4)+RGPORT(1)-1,RGPORT(3)=RGPORT(1)"
^XTV(8991,3,1,1,1,37,0)=" S RGREALM(0)=$P(RGZ,U),RGTMOUT=$P(RGZ,U,5),RGTMOUT(0)=$P(RGZ,U,6),RGIP=$P(RGZ,U,7)"
^XTV(8991,3,1,1,1,38,0)=" S:'RGPORT RGPORT=RGPORT(0),RGTMOUT=10"
^XTV(8991,3,1,1,1,39,0)=" K ^RGWB(RGPID)"
^XTV(8991,3,1,1,1,40,0)=" ZT:'$$ALLOC(RGPORT) ""PORT BUSY"""
^XTV(8991,3,1,1,1,41,0)=" F  Q:$$QUIT  D IDLE,FLUSH"
^XTV(8991,3,1,1,1,42,0)=" ; Cleanup and exit"
^XTV(8991,3,1,1,1,43,0)=" D DEALLOC(RGPORT)"
^XTV(8991,3,1,1,1,44,0)=" K ^RGWB(RGPID)"
^XTV(8991,3,1,1,1,45,0)=" Q"
^XTV(8991,3,1,1,1,46,0)=" ; Idle loop waits for input from port"
^XTV(8991,3,1,1,1,47,0)="IDLE S $ZT=""FATAL^RGWBSVR1"",RGSIZE=0"
^XTV(8991,3,1,1,1,48,0)=" U 56"
^XTV(8991,3,1,1,1,49,0)=" K ^RGWB(RGPID,""ENV"")"
^XTV(8991,3,1,1,1,50,0)=" S $ZT=""ERROR^RGWBSVR1"""
^XTV(8991,3,1,1,1,51,0)=" I '$$READ(RGPORT,RGTMOUT) D:RGPORT'=RGPORT(0) TIMEOUT Q"
^XTV(8991,3,1,1,1,52,0)=" D PARSERAW^RGWBSVR1"
^XTV(8991,3,1,1,1,53,0)=" S RGMETH=$$ENV^RGWBCGI(""Method""),RGURL=$$ENV^RGWBCGI(""URL"")"
^XTV(8991,3,1,1,1,54,0)=" I RGPORT=RGPORT(0),RGPORT(1) D ASSGN Q"
^XTV(8991,3,1,1,1,55,0)=" D MSG^RGWBSVR1()"
^XTV(8991,3,1,1,1,56,0)=" I $$AUTHEN D"
^XTV(8991,3,1,1,1,57,0)=" .I RGMETH=""GET""!(RGMETH=""POST"") D URL^RGWBSVR1(RGURL) Q"
^XTV(8991,3,1,1,1,58,0)=" .D MSG^RGWBSVR1(""Unknown"",400),BODY^RGWBSVR1(""Unknown or unsupported method: ""_RGMETH)"
^XTV(8991,3,1,1,1,59,0)=" Q"
^XTV(8991,3,1,1,1,60,0)=" ; Flush message buffer to port"
^XTV(8991,3,1,1,1,61,0)="FLUSH N RGZ,RGZ1,RGDATA"
^XTV(8991,3,1,1,1,62,0)=" D TRACE(""Flushing buffer"")"
^XTV(8991,3,1,1,1,63,0)=" S $ZT=""FLUSHX^RGWBSVR"""
^XTV(8991,3,1,1,1,64,0)=" D:$D(^RGWB(RGPID)) HDR^RGWBSVR1(""Content-Length: ""_RGSIZE),SAVE^RGWBSVR1(""BRK"",RGCRLF)"
^XTV(8991,3,1,1,1,65,0)=" U 56"
^XTV(8991,3,1,1,1,66,0)=" F RGZ=""MSG"",""HDR"",""BRK"",""BODY"" D"
^XTV(8991,3,1,1,1,67,0)=" .F RGZ1=0:0 S RGZ1=$O(^RGWB(RGPID,RGZ,RGZ1)) Q:'RGZ1  D"
^XTV(8991,3,1,1,1,68,0)=" ..S RGDATA=^(RGZ1)"
^XTV(8991,3,1,1,1,69,0)=" ..Q:RGDATA="""""
^XTV(8991,3,1,1,1,70,0)=" ..W RGDATA,!"
^XTV(8991,3,1,1,1,71,0)="FLUSHX K ^RGWB(RGPID)"
^XTV(8991,3,1,1,1,72,0)=" U 56"
^XTV(8991,3,1,1,1,73,0)=" Q"
^XTV(8991,3,1,1,1,74,0)=" ; Process timeout waiting for client response"
^XTV(8991,3,1,1,1,75,0)="TIMEOUT Q:$$QUIT"
^XTV(8991,3,1,1,1,76,0)=" D TRACE(""Primary timeout"")"
^XTV(8991,3,1,1,1,77,0)=" D:$$READ(RGPORT,RGTMOUT(0)) MSG^RGWBSVR1(""Timeout"",400),URL^RGWBSVR1(""TPL/TIMEOUT"")"
^XTV(8991,3,1,1,1,78,0)=" D TRACE(""Secondary timeout"")"
^XTV(8991,3,1,1,1,79,0)=" S RGQUIT=1"
^XTV(8991,3,1,1,1,80,0)=" Q"
^XTV(8991,3,1,1,1,81,0)=" ; Allocate and open a port"
^XTV(8991,3,1,1,1,82,0)="ALLOC(RGPORT) "
^XTV(8991,3,1,1,1,83,0)=" S $ZT=""ALLOCX^RGWBSVR"""
^XTV(8991,3,1,1,1,84,0)=" D TRACE(""Opening port"")"
^XTV(8991,3,1,1,1,85,0)=" L +^RGWB(""PORT"",RGPORT):0"
^XTV(8991,3,1,1,1,86,0)=" E  Q 0"
^XTV(8991,3,1,1,1,87,0)=" O 56::30 I '$T W !,""Not open"" Q 0"
^XTV(8991,3,1,1,1,88,0)=" U 56::""TCP"" W /SOCKET("""",RGPORT) I $KEY="""" C 56 Q 0"
^XTV(8991,3,1,1,1,89,0)=" Q 1"
^XTV(8991,3,1,1,1,90,0)="ALLOCX L -^RGWB(""PORT"",RGPORT)"
^XTV(8991,3,1,1,1,91,0)=" Q 0"
^XTV(8991,3,1,1,1,92,0)=" ; Close and deallocate a port"
^XTV(8991,3,1,1,1,93,0)="DEALLOC(RGPORT) "
^XTV(8991,3,1,1,1,94,0)=" D TRACE(""Closing port"")"
^XTV(8991,3,1,1,1,95,0)=" C 56"
^XTV(8991,3,1,1,1,96,0)=" L -^RGWB(""PORT"",RGPORT)"
^XTV(8991,3,1,1,1,97,0)=" Q"
^XTV(8991,3,1,1,1,98,0)=" ; Assign a free port from pool"
^XTV(8991,3,1,1,1,99,0)="ASSGN N RGPORTN,RGTRY"
^XTV(8991,3,1,1,1,100,0)=" S RGTRY=3"
^XTV(8991,3,1,1,1,101,0)=" F RGPORTN=RGPORT(3)+1:1 D  Q:'RGTRY  Q:$$ALLOC(RGPORTN)"
^XTV(8991,3,1,1,1,102,0)=" .S:RGPORTN>RGPORT(2) RGPORTN=RGPORT(1)"
^XTV(8991,3,1,1,1,103,0)=" .I RGPORTN=RGPORT(3) S RGTRY=RGTRY-1 H:RGTRY 2"
^XTV(8991,3,1,1,1,104,0)=" I 'RGTRY D TRACE(""No free ports available."") Q"
^XTV(8991,3,1,1,1,105,0)=" S RGPORT(3)=RGPORTN"
^XTV(8991,3,1,1,1,106,0)=" D DEALLOC(RGPORTN)"
^XTV(8991,3,1,1,1,107,0)=" D MSG^RGWBSVR1(""Redirect"",302),HDR^RGWBSVR1(""Location: http://""_RGIP_"":""_RGPORTN_RGURL)"
^XTV(8991,3,1,1,1,108,0)=" D:$D(RGTRACE) FLUSH,ENTRY(RGPORTN,RGREALM,RGTRACE)"
^XTV(8991,3,1,1,1,109,0)=" J:'$D(RGTRACE) ENTRY^RGWBSVR(RGPORTN,RGREALM)"
^XTV(8991,3,1,1,1,110,0)=" Q"
^XTV(8991,3,1,1,1,111,0)=" ; Force authentication"
^XTV(8991,3,1,1,1,112,0)="AUTHEN() N RGUU"
^XTV(8991,3,1,1,1,113,0)=" S RGAUTH=$G(^RGWEB(999.2,RGREALM,4))="""""
^XTV(8991,3,1,1,1,114,0)=" I 'RGAUTH D"
^XTV(8991,3,1,1,1,115,0)=" .S RGUU=$P($$ENV^RGWBCGI(""Authorization""),""Basic "",2)"
^XTV(8991,3,1,1,1,116,0)=" .Q:RGUU="""""
^XTV(8991,3,1,1,1,117,0)=" .I RGPORT'=RGPORT(0),$D(RGAUTH(0)),RGUU'=RGAUTH(0) Q"
^XTV(8991,3,1,1,1,118,0)=" .N RGUSER,RGPASS"
^XTV(8991,3,1,1,1,119,0)=" .S RGPASS=$$DECODE^RGCVTUU(RGUU),RGUSER=$P(RGPASS,"":""),RGPASS=$P(RGPASS,"":"",2,999)"
^XTV(8991,3,1,1,1,120,0)=" .X ^RGWEB(999.2,RGREALM,4)"
^XTV(8991,3,1,1,1,121,0)=" .I  S RGAUTH=1,RGAUTH(0)=RGUU"
^XTV(8991,3,1,1,1,122,0)=" I 'RGAUTH D"
^XTV(8991,3,1,1,1,123,0)=" .D MSG^RGWBSVR1(""Basic"",401)"
^XTV(8991,3,1,1,1,124,0)=" .D HDR^RGWBSVR1(""WWW-Authenticate: Basic Realm=""""""_RGREALM(0)_""""""""),HDR^RGWBSVR1(""Content-type: text/html"")"
^XTV(8991,3,1,1,1,125,0)=" .D BODY^RGWBSVR1(""<H3><CENTER>A valid user identification and password are required to access this server.</H3></CENTER>"")"
^XTV(8991,3,1,1,1,126,0)=" .D BODY^RGWBSVR1(""<CENTER><FORM ACTION=/TPL/LOGIN METHOD=GET><INPUT TYPE=SUBMIT VALUE=Start></CENTER>"")"
^XTV(8991,3,1,1,1,127,0)=" Q RGAUTH"
^XTV(8991,3,1,1,1,128,0)=" ; Read data from port with optional timeout"
^XTV(8991,3,1,1,1,129,0)="READ(RGPORT,RGDT) "
^XTV(8991,3,1,1,1,130,0)=" N RGDATA,RGZ,RGT,RGX"
^XTV(8991,3,1,1,1,131,0)=" D TRACE(""Listening"")"
^XTV(8991,3,1,1,1,132,0)=" S RGDT=+$G(RGDT),RGT=5,$ZT=""READX^RGWBSVR"""
^XTV(8991,3,1,1,1,133,0)=" U 56"
^XTV(8991,3,1,1,1,134,0)=" D SAVE^RGWBSVR1(""RAW"")"
^XTV(8991,3,1,1,1,135,0)=" F RGDT=RGDT:-5:0 D  Q:$$QUIT"
^XTV(8991,3,1,1,1,136,0)=" .R RGDATA:RGT"
^XTV(8991,3,1,1,1,137,0)=" .E  Q"
^XTV(8991,3,1,1,1,138,0)=" .S RGDT=RGT,RGT=1"
^XTV(8991,3,1,1,1,139,0)=" .D TRACE(""Reading""),TRACE(RGDATA)"
^XTV(8991,3,1,1,1,140,0)=" .F RGZ=1:250:$L(RGDATA) D SAVE^RGWBSVR1(""RAW"",$E(RGDATA,RGZ,RGZ+249))"
^XTV(8991,3,1,1,1,141,0)="READX Q $D(^RGWB(RGPID,""RAW""))"
^XTV(8991,3,1,1,1,142,0)=" ; Check for exit condition"
^XTV(8991,3,1,1,1,143,0)="QUIT() Q $S($D(RGQUIT):1,1:+$G(^RGWEB(999.2,RGREALM,.9)))"
^XTV(8991,3,1,1,1,144,0)=" ; Output trace message if enabled"
^XTV(8991,3,1,1,1,145,0)="TRACE(RGMSG) "
^XTV(8991,3,1,1,1,146,0)=" I $D(RGTRACE) D"
^XTV(8991,3,1,1,1,147,0)=" .N RGIO"
^XTV(8991,3,1,1,1,148,0)=" .S RGIO=$IO"
^XTV(8991,3,1,1,1,149,0)=" .U RGTRACE"
^XTV(8991,3,1,1,1,150,0)=" .W $G(RGPORT)_"": ""_RGMSG,!"
^XTV(8991,3,1,1,1,151,0)=" .U RGIO"
^XTV(8991,3,1,1,1,152,0)=" Q"
^XTV(8991,3,1,"B",2961018.1737,1)=""
^XTV(8991,4,0)="CJS"
^XTV(8991,4,1,0)="^8991.01^15^15"
^XTV(8991,4,1,1,0)="2961210.1023"
^XTV(8991,4,1,1,1,0)="^8991.11^5^5"
^XTV(8991,4,1,1,1,1,0)=""
^XTV(8991,4,1,1,1,1,"DEL")="CJS ; ;12/10/96  10:23"
^XTV(8991,4,1,1,1,2,"INS",0)="^8991.12^53^53"
^XTV(8991,4,1,1,1,2,"INS",1,0)="DIO2 ;SFISC/GFT,TKW-PRINT ;12/10/96  11:04"
^XTV(8991,4,1,1,1,2,"INS",2,0)=" ;;21.0;VA FileMan;;Dec 28, 1994"
^XTV(8991,4,1,1,1,2,"INS",3,0)=" ;Per VHA Directive 10-93-142, this routine should not be modified."
^XTV(8991,4,1,1,1,2,"INS",4,0)=" S (DISTP,DILCT)=0"
^XTV(8991,4,1,1,1,2,"INS",5,0)="XDY I $D(DIBTPGM) D @(""EN""_DIBTPGM),ENRLS^DIOZ(+$P(DIBTPGM,""^DISZ"",2)) Q"
^XTV(8991,4,1,1,1,2,"INS",6,0)=" X DY(DN) G XDY:DN"
^XTV(8991,4,1,1,1,2,"INS",7,0)=" Q"
^XTV(8991,4,1,1,1,2,"INS",8,0)=" ;"
^XTV(8991,4,1,1,1,2,"INS",9,0)="SEARCH S DIO=1"
^XTV(8991,4,1,1,1,2,"INS",10,0)="SCR S DIO(""SCR"")=1,DE=0 I '$D(DIS(0)) G OR"
^XTV(8991,4,1,1,1,2,"INS",11,0)=" X DIS(0) Q:'$T  G PASS:'$D(DIS(1))"
^XTV(8991,4,1,1,1,2,"INS",12,0)="OR S DE=DE+1 I '$D(DIS(DE)) Q"
^XTV(8991,4,1,1,1,2,"INS",13,0)=" X DIS(DE) E  G OR"
^XTV(8991,4,1,1,1,2,"INS",14,0)="PASS S:'$D(DPQ) DIPASS=1"
^XTV(8991,4,1,1,1,2,"INS",15,0)="O F DLP=0:1:DX Q:'DN  X $S($D(DPQ):DX(DLP),1:^UTILITY($J,99,DLP))"
^XTV(8991,4,1,1,1,2,"INS",16,0)=" Q"
^XTV(8991,4,1,1,1,2,"INS",17,0)=" ;"
^XTV(8991,4,1,1,1,2,"INS",18,0)="N W !"
^XTV(8991,4,1,1,1,2,"INS",19,0)="T I $X,IOT'=""MT"" W !"
^XTV(8991,4,1,1,1,2,"INS",20,0)=" I '$D(DIOT(2)),DN,$D(IOSL),$S('$D(DIWF):1,$P(DIWF,""B"",2):$P(DIWF,""B"",2),1:1)+$Y'<IOSL,$D(^UTILITY($J,1))#2,^(1)?1U1P1E.E X ^(1)"
^XTV(8991,4,1,1,1,2,"INS",21,0)=" S DISTP=DISTP+1,DILCT=DILCT+1 D:'(DISTP#100) CSTP"
^XTV(8991,4,1,1,1,2,"INS",22,0)=" Q"
^XTV(8991,4,1,1,1,2,"INS",23,0)=" ;"
^XTV(8991,4,1,1,1,2,"INS",24,0)="CSTP I $G(IOT)=""SPL""!($G(IOT)=""HFS"") I '$D(DPQ),$$ROUEXIST^DILIBF(""XUPARAM""),DILCT>$$KSP^XUPARAM(""SPOOL LINES"") D  Q"
^XTV(8991,4,1,1,1,2,"INS",25,0)=" . S DIFMSTOP=1,DN=0 S:$D(ZTQUEUED) ZTSTOP=1"
^XTV(8991,4,1,1,1,2,"INS",26,0)=" . W !,""*** JOB STOPPED BECAUSE MAXIMUM SPOOL LINES HAS BEEN EXCEEDED ***"",!! Q"
^XTV(8991,4,1,1,1,2,"INS",27,0)=" I '$D(ZTQUEUED) K DISTOP Q"
^XTV(8991,4,1,1,1,2,"INS",28,0)=" Q:$G(DISTOP)=0  S:$G(DISTOP)="""" DISTOP=1"
^XTV(8991,4,1,1,1,2,"INS",29,0)=" I DISTOP'=1 X DISTOP K:'$T DISTOP S DISTOP=$T Q:'$T"
^XTV(8991,4,1,1,1,2,"INS",30,0)=" Q:'$$S^%ZTLOAD"
^XTV(8991,4,1,1,1,2,"INS",31,0)=" W:$G(IO)]"""" !,""*** TASK ""_ZTSK_"" STOPPED BY USER - DURING ""_$S($D(DPQ):""SORT"",1:""PRINT"")_"" EXECUTION ***"",!! S ZTSTOP=1,DN=0 Q"
^XTV(8991,4,1,1,1,2,"INS",32,0)=" ;"
^XTV(8991,4,1,1,1,2,"INS",33,0)="DT I $G(DDXPDATE) D DT^DDXP4 W DDXPY K DDXPY Q"
^XTV(8991,4,1,1,1,2,"INS",34,0)=" I $G(DUZ(""LANG""))>1,Y W $$OUT^DIALOGU(Y,""DD"") Q"
^XTV(8991,4,1,1,1,2,"INS",35,0)=" I Y W $P(""JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC"",U,$E(Y,4,5))_"" "" W:Y#100 $J(Y#100\1,2)_"","" W Y\10000+1700 W:Y#1 ""  ""_$E(Y_0,9,10)_"":""_$E(Y_""000"",11,12) Q"
^XTV(8991,4,1,1,1,2,"INS",36,0)=" W Y Q"
^XTV(8991,4,1,1,1,2,"INS",37,0)=" ;"
^XTV(8991,4,1,1,1,2,"INS",38,0)="C S DQ(C)=Y"
^XTV(8991,4,1,1,1,2,"INS",39,0)="S S Q(C)=Y*Y+Q(C) S:L(C)>Y L(C)=Y S:H(C)<Y H(C)=Y"
^XTV(8991,4,1,1,1,2,"INS",40,0)="P S N(C)=N(C)+1"
^XTV(8991,4,1,1,1,2,"INS",41,0)="A S S(C)=S(C)+Y Q"
^XTV(8991,4,1,1,1,2,"INS",42,0)="D I Y=DITTO(C) S Y="""" Q"
^XTV(8991,4,1,1,1,2,"INS",43,0)=" S DITTO(C)=Y Q"
^XTV(8991,4,1,1,1,2,"INS",44,0)=" ;"
^XTV(8991,4,1,1,1,2,"INS",45,0)="CP S C="""" F  S C=$O(CP(C)) Q:C=""""  G DQ:'$D(DQ(C))"
^XTV(8991,4,1,1,1,2,"INS",46,0)=" S CP=CP+1 F  S C=$O(CP(C)),A="""" Q:C=""""  F  S A=$O(CP(A)) S CP(C,A)=DQ(C)*DQ(A)+CP(C,A) Q:A=C"
^XTV(8991,4,1,1,1,2,"INS",47,0)="DQ K DQ Q"
^XTV(8991,4,1,1,1,2,"INS",48,0)=" ;"
^XTV(8991,4,1,1,1,2,"INS",49,0)="H F DI=DI:1:DN I $D(^UTILITY($J,""H"",DI)) X ^UTILITY($J,""H"",DI) W:$X&($G(DIAR)'=4)&($G(DIAR)'=6) !"
^XTV(8991,4,1,1,1,2,"INS",50,0)=" Q"
^XTV(8991,4,1,1,1,2,"INS",51,0)=" ;"
^XTV(8991,4,1,1,1,2,"INS",52,0)="M X $S($D(DPQ):DX(DIXX),1:^UTILITY($J,99,DIXX))"
^XTV(8991,4,1,1,1,2,"INS",53,0)="CJS ;"
^XTV(8991,4,1,1,1,4,0)=""
^XTV(8991,4,1,1,1,4,"DEL")=" . . I '$D(^DIC(I,0)) W !,I,"" "",N,""  NOT DEFINED"""
^XTV(8991,4,1,1,1,5,0)=""
^XTV(8991,4,1,1,1,5,"DEL")=" . . S Y=$P($G(^DIC(I,0)),""^"") I Y'=N W !,I,?9,Y,?40,N"
^XTV(8991,4,1,1,1,6,"INS",0)="^8991.12^1^1"
^XTV(8991,4,1,1,1,6,"INS",1,0)=" . . S Y=$P($G(^DIC(I,0)),""^"") I Y'=N K ^DIC(""B"",N,I)"
^XTV(8991,4,1,2,0)="2961210.1104"
^XTV(8991,4,1,2,1,0)="^8991.11^56^56"
^XTV(8991,4,1,2,1,1,0)=""
^XTV(8991,4,1,2,1,1,"DEL")="DIO2 ;SFISC/GFT,TKW-PRINT ;12/10/96  11:04"
^XTV(8991,4,1,2,1,2,0)=""
^XTV(8991,4,1,2,1,2,"DEL")=" ;;21.0;VA FileMan;;Dec 28, 1994"
^XTV(8991,4,1,2,1,3,0)=""
^XTV(8991,4,1,2,1,3,"DEL")=" ;Per VHA Directive 10-93-142, this routine should not be modified."
^XTV(8991,4,1,2,1,4,0)=""
^XTV(8991,4,1,2,1,4,"DEL")=" S (DISTP,DILCT)=0"
^XTV(8991,4,1,2,1,5,0)=""
^XTV(8991,4,1,2,1,5,"DEL")="XDY I $D(DIBTPGM) D @(""EN""_DIBTPGM),ENRLS^DIOZ(+$P(DIBTPGM,""^DISZ"",2)) Q"
^XTV(8991,4,1,2,1,6,0)=""
^XTV(8991,4,1,2,1,6,"DEL")=" X DY(DN) G XDY:DN"
^XTV(8991,4,1,2,1,7,0)=""
^XTV(8991,4,1,2,1,7,"DEL")=" Q"
^XTV(8991,4,1,2,1,8,0)=""
^XTV(8991,4,1,2,1,8,"DEL")=" ;"
^XTV(8991,4,1,2,1,9,0)=""
^XTV(8991,4,1,2,1,9,"DEL")="SEARCH S DIO=1"
^XTV(8991,4,1,2,1,10,0)=""
^XTV(8991,4,1,2,1,10,"DEL")="SCR S DIO(""SCR"")=1,DE=0 I '$D(DIS(0)) G OR"
^XTV(8991,4,1,2,1,11,0)=""
^XTV(8991,4,1,2,1,11,"DEL")=" X DIS(0) Q:'$T  G PASS:'$D(DIS(1))"
^XTV(8991,4,1,2,1,12,0)=""
^XTV(8991,4,1,2,1,12,"DEL")="OR S DE=DE+1 I '$D(DIS(DE)) Q"
^XTV(8991,4,1,2,1,13,0)=""
^XTV(8991,4,1,2,1,13,"DEL")=" X DIS(DE) E  G OR"
^XTV(8991,4,1,2,1,14,0)=""
^XTV(8991,4,1,2,1,14,"DEL")="PASS S:'$D(DPQ) DIPASS=1"
^XTV(8991,4,1,2,1,15,0)=""
^XTV(8991,4,1,2,1,15,"DEL")="O F DLP=0:1:DX Q:'DN  X $S($D(DPQ):DX(DLP),1:^UTILITY($J,99,DLP))"
^XTV(8991,4,1,2,1,16,0)=""
^XTV(8991,4,1,2,1,16,"DEL")=" Q"
^XTV(8991,4,1,2,1,17,0)=""
^XTV(8991,4,1,2,1,17,"DEL")=" ;"
^XTV(8991,4,1,2,1,18,0)=""
^XTV(8991,4,1,2,1,18,"DEL")="N W !"
^XTV(8991,4,1,2,1,19,0)=""
^XTV(8991,4,1,2,1,19,"DEL")="T I $X,IOT'=""MT"" W !"
^XTV(8991,4,1,2,1,20,0)=""
^XTV(8991,4,1,2,1,20,"DEL")=" I '$D(DIOT(2)),DN,$D(IOSL),$S('$D(DIWF):1,$P(DIWF,""B"",2):$P(DIWF,""B"",2),1:1)+$Y'<IOSL,$D(^UTILITY($J,1))#2,^(1)?1U1P1E.E X ^(1)"
^XTV(8991,4,1,2,1,21,0)=""
^XTV(8991,4,1,2,1,21,"DEL")=" S DISTP=DISTP+1,DILCT=DILCT+1 D:'(DISTP#100) CSTP"
^XTV(8991,4,1,2,1,22,0)=""
^XTV(8991,4,1,2,1,22,"DEL")=" Q"
^XTV(8991,4,1,2,1,23,0)=""
^XTV(8991,4,1,2,1,23,"DEL")=" ;"
^XTV(8991,4,1,2,1,24,0)=""
^XTV(8991,4,1,2,1,24,"DEL")="CSTP I $G(IOT)=""SPL""!($G(IOT)=""HFS"") I '$D(DPQ),$$ROUEXIST^DILIBF(""XUPARAM""),DILCT>$$KSP^XUPARAM(""SPOOL LINES"") D  Q"
^XTV(8991,4,1,2,1,25,0)=""
^XTV(8991,4,1,2,1,25,"DEL")=" . S DIFMSTOP=1,DN=0 S:$D(ZTQUEUED) ZTSTOP=1"
^XTV(8991,4,1,2,1,26,0)=""
^XTV(8991,4,1,2,1,26,"DEL")=" . W !,""*** JOB STOPPED BECAUSE MAXIMUM SPOOL LINES HAS BEEN EXCEEDED ***"",!! Q"
^XTV(8991,4,1,2,1,27,0)=""
^XTV(8991,4,1,2,1,27,"DEL")=" I '$D(ZTQUEUED) K DISTOP Q"
^XTV(8991,4,1,2,1,28,0)=""
^XTV(8991,4,1,2,1,28,"DEL")=" Q:$G(DISTOP)=0  S:$G(DISTOP)="""" DISTOP=1"
^XTV(8991,4,1,2,1,29,0)=""
^XTV(8991,4,1,2,1,29,"DEL")=" I DISTOP'=1 X DISTOP K:'$T DISTOP S DISTOP=$T Q:'$T"
^XTV(8991,4,1,2,1,30,0)=""
^XTV(8991,4,1,2,1,30,"DEL")=" Q:'$$S^%ZTLOAD"
^XTV(8991,4,1,2,1,31,0)=""
^XTV(8991,4,1,2,1,31,"DEL")=" W:$G(IO)]"""" !,""*** TASK ""_ZTSK_"" STOPPED BY USER - DURING ""_$S($D(DPQ):""SORT"",1:""PRINT"")_"" EXECUTION ***"",!! S ZTSTOP=1,DN=0 Q"
^XTV(8991,4,1,2,1,32,0)=""
^XTV(8991,4,1,2,1,32,"DEL")=" ;"
^XTV(8991,4,1,2,1,33,0)=""
^XTV(8991,4,1,2,1,33,"DEL")="DT I $G(DDXPDATE) D DT^DDXP4 W DDXPY K DDXPY Q"
^XTV(8991,4,1,2,1,34,0)=""
^XTV(8991,4,1,2,1,34,"DEL")=" I $G(DUZ(""LANG""))>1,Y W $$OUT^DIALOGU(Y,""DD"") Q"
^XTV(8991,4,1,2,1,35,0)=""
^XTV(8991,4,1,2,1,35,"DEL")=" I Y W $P(""JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC"",U,$E(Y,4,5))_"" "" W:Y#100 $J(Y#100\1,2)_"","" W Y\10000+1700 W:Y#1 ""  ""_$E(Y_0,9,10)_"":""_$E(Y_""000"",11,12) Q"
^XTV(8991,4,1,2,1,36,0)=""
^XTV(8991,4,1,2,1,36,"DEL")=" W Y Q"
^XTV(8991,4,1,2,1,37,0)=""
^XTV(8991,4,1,2,1,37,"DEL")=" ;"
^XTV(8991,4,1,2,1,38,0)=""
^XTV(8991,4,1,2,1,38,"DEL")="C S DQ(C)=Y"
^XTV(8991,4,1,2,1,39,0)=""
^XTV(8991,4,1,2,1,39,"DEL")="S S Q(C)=Y*Y+Q(C) S:L(C)>Y L(C)=Y S:H(C)<Y H(C)=Y"
^XTV(8991,4,1,2,1,40,0)=""
^XTV(8991,4,1,2,1,40,"DEL")="P S N(C)=N(C)+1"
^XTV(8991,4,1,2,1,41,0)=""
^XTV(8991,4,1,2,1,41,"DEL")="A S S(C)=S(C)+Y Q"
^XTV(8991,4,1,2,1,42,0)=""
^XTV(8991,4,1,2,1,42,"DEL")="D I Y=DITTO(C) S Y="""" Q"
^XTV(8991,4,1,2,1,43,0)=""
^XTV(8991,4,1,2,1,43,"DEL")=" S DITTO(C)=Y Q"
^XTV(8991,4,1,2,1,44,0)=""
^XTV(8991,4,1,2,1,44,"DEL")=" ;"
^XTV(8991,4,1,2,1,45,0)=""
^XTV(8991,4,1,2,1,45,"DEL")="CP S C="""" F  S C=$O(CP(C)) Q:C=""""  G DQ:'$D(DQ(C))"
^XTV(8991,4,1,2,1,46,0)=""
^XTV(8991,4,1,2,1,46,"DEL")=" S CP=CP+1 F  S C=$O(CP(C)),A="""" Q:C=""""  F  S A=$O(CP(A)) S CP(C,A)=DQ(C)*DQ(A)+CP(C,A) Q:A=C"
^XTV(8991,4,1,2,1,47,0)=""
^XTV(8991,4,1,2,1,47,"DEL")="DQ K DQ Q"
^XTV(8991,4,1,2,1,48,0)=""
^XTV(8991,4,1,2,1,48,"DEL")=" ;"
^XTV(8991,4,1,2,1,49,0)=""
^XTV(8991,4,1,2,1,49,"DEL")="H F DI=DI:1:DN I $D(^UTILITY($J,""H"",DI)) X ^UTILITY($J,""H"",DI) W:$X&($G(DIAR)'=4)&($G(DIAR)'=6) !"
^XTV(8991,4,1,2,1,50,0)=""
^XTV(8991,4,1,2,1,50,"DEL")=" Q"
^XTV(8991,4,1,2,1,51,0)=""
^XTV(8991,4,1,2,1,51,"DEL")=" ;"
^XTV(8991,4,1,2,1,52,0)=""
^XTV(8991,4,1,2,1,52,"DEL")="M X $S($D(DPQ):DX(DIXX),1:^UTILITY($J,99,DIXX))"
^XTV(8991,4,1,2,1,53,0)=""
^XTV(8991,4,1,2,1,53,"DEL")="CJS ;"
^XTV(8991,4,1,2,1,54,"INS",0)="^8991.12^1^1"
^XTV(8991,4,1,2,1,54,"INS",1,0)="CJS ; ;12/10/96  11:17"
^XTV(8991,4,1,3,0)="2961210.1117"
^XTV(8991,4,1,3,1,0)="^8991.11^5^5"
^XTV(8991,4,1,3,1,1,0)=""
^XTV(8991,4,1,3,1,1,"DEL")="CJS ; ;12/10/96  11:17"
^XTV(8991,4,1,3,1,2,0)=""
^XTV(8991,4,1,3,1,2,"DEL")=" S N="""" F  S N=$O(^DIC(""B"",N)) Q:N=""""  D"
^XTV(8991,4,1,3,1,3,0)=""
^XTV(8991,4,1,3,1,3,"DEL")=" . S I="""" F  S I=$O(^DIC(""B"",N,I)) Q:I'>0  D"
^XTV(8991,4,1,3,1,4,0)=""
^XTV(8991,4,1,3,1,4,"DEL")=" . . S Y=$P($G(^DIC(I,0)),""^"") I Y'=N K ^DIC(""B"",N,I)"
^XTV(8991,4,1,3,1,5,"INS",0)="^8991.12^4^4"
^XTV(8991,4,1,3,1,5,"INS",1,0)="CJS ; ;2/10/97  14:18"
^XTV(8991,4,1,3,1,5,"INS",2,0)=" D OPEN^%ZISH(""FILE1"",""D:\MSM\SCRATCH\"",""PERCLASS.TXT,""W"")"
^XTV(8991,4,1,3,1,5,"INS",3,0)=" S I=0 F  S I=$O(^USC(8932.1,I)) Q:I'>0  W I,$C(9),$P(^(I,0),""^""),$C(9),$P(^(0),""^"",2),$C(9),$P(^(0),""^"",3),$C(9),$P(^(0),""^"",6),!"
^XTV(8991,4,1,3,1,5,"INS",4,0)=" D CLOSE^%ZISH(""FILE1"") Q"
^XTV(8991,4,1,4,0)="2970210.1418"
^XTV(8991,4,1,4,1,0)="^8991.11^4^4"
^XTV(8991,4,1,4,1,1,0)=""
^XTV(8991,4,1,4,1,1,"DEL")="CJS ; ;2/10/97  14:18"
^XTV(8991,4,1,4,1,2,0)=""
^XTV(8991,4,1,4,1,2,"DEL")=" D OPEN^%ZISH(""FILE1"",""D:\MSM\SCRATCH\"",""PERCLASS.TXT,""W"")"
^XTV(8991,4,1,4,1,3,"INS",0)="^8991.12^2^2"
^XTV(8991,4,1,4,1,3,"INS",1,0)="CJS ; ;2/10/97  14:19"
^XTV(8991,4,1,4,1,3,"INS",2,0)=" D OPEN^%ZISH(""FILE1"",""D:\MSM\SCRATCH\"",""PERCLASS.TXT"",""W"")"
^XTV(8991,4,1,5,0)="2970210.1419"
^XTV(8991,4,1,5,1,0)="^8991.11^4^4"
^XTV(8991,4,1,5,1,1,0)=""
^XTV(8991,4,1,5,1,1,"DEL")="CJS ; ;2/10/97  14:19"
^XTV(8991,4,1,5,1,2,0)=""
^XTV(8991,4,1,5,1,2,"DEL")=" D OPEN^%ZISH(""FILE1"",""D:\MSM\SCRATCH\"",""PERCLASS.TXT"",""W"")"
^XTV(8991,4,1,5,1,3,0)=""
^XTV(8991,4,1,5,1,3,"DEL")=" S I=0 F  S I=$O(^USC(8932.1,I)) Q:I'>0  W I,$C(9),$P(^(I,0),""^""),$C(9),$P(^(0),""^"",2),$C(9),$P(^(0),""^"",3),$C(9),$P(^(0),""^"",6),!"
^XTV(8991,4,1,5,1,4,"INS",0)="^8991.12^3^3"
^XTV(8991,4,1,5,1,4,"INS",1,0)="CJS ; ;2/10/97  14:26"
^XTV(8991,4,1,5,1,4,"INS",2,0)=" D OPEN^%ZISH(""FILE1"",""D:\MSM\SCRATCH\"",""RACE.TXT"",""W"")"
^XTV(8991,4,1,5,1,4,"INS",3,0)=" S I=0 F  S I=$O(^DIC(10,I)) Q:I'>0  W I,$C(9),$P(^(I,0),""^""),!"
^XTV(8991,4,1,6,0)="2970210.1426"
^XTV(8991,4,1,6,1,0)="^8991.11^4^4"
^XTV(8991,4,1,6,1,1,0)=""
^XTV(8991,4,1,6,1,1,"DEL")="CJS ; ;2/10/97  14:26"
^XTV(8991,4,1,6,1,2,0)=""
^XTV(8991,4,1,6,1,2,"DEL")=" D OPEN^%ZISH(""FILE1"",""D:\MSM\SCRATCH\"",""RACE.TXT"",""W"")"
^XTV(8991,4,1,6,1,3,0)=""
^XTV(8991,4,1,6,1,3,"DEL")=" S I=0 F  S I=$O(^DIC(10,I)) Q:I'>0  W I,$C(9),$P(^(I,0),""^""),!"
^XTV(8991,4,1,6,1,4,"INS",0)="^8991.12^3^3"
^XTV(8991,4,1,6,1,4,"INS",1,0)="CJS ; ;2/10/97  14:43"
^XTV(8991,4,1,6,1,4,"INS",2,0)=" D OPEN^%ZISH(""FILE1"",""D:\MSM\SCRATCH\"",""Discharg.txt"",""W"")"
^XTV(8991,4,1,6,1,4,"INS",3,0)=" S I=0 F  S I=$O(^DG(405.2,I)) Q:I'>0  W I,$C(9),$P(^(I,0),""^""),!"
^XTV(8991,4,1,7,0)="2970210.1443"
^XTV(8991,4,1,7,1,0)="^8991.11^4^4"
^XTV(8991,4,1,7,1,1,0)=""
^XTV(8991,4,1,7,1,1,"DEL")="CJS ; ;2/10/97  14:43"
^XTV(8991,4,1,7,1,2,0)=""
^XTV(8991,4,1,7,1,2,"DEL")=" D OPEN^%ZISH(""FILE1"",""D:\MSM\SCRATCH\"",""Discharg.txt"",""W"")"
^XTV(8991,4,1,7,1,3,0)=""
^XTV(8991,4,1,7,1,3,"DEL")=" S I=0 F  S I=$O(^DG(405.2,I)) Q:I'>0  W I,$C(9),$P(^(I,0),""^""),!"
^XTV(8991,4,1,7,1,4,"INS",0)="^8991.12^3^3"
^XTV(8991,4,1,7,1,4,"INS",1,0)="CJS ; ;2/10/97  14:48"
^XTV(8991,4,1,7,1,4,"INS",2,0)=" D OPEN^%ZISH(""FILE1"",""D:\MSM\SCRATCH\"",""DRG.txt"",""W"")"
^XTV(8991,4,1,7,1,4,"INS",3,0)=" S I=0 F  S I=$O(^ICD(I)) Q:I'>0  W I,$C(9),$P(^(I,0),""^""),!"
^XTV(8991,4,1,8,0)="2970210.1448"
^XTV(8991,4,1,8,1,0)="^8991.11^4^4"
^XTV(8991,4,1,8,1,1,0)=""
^XTV(8991,4,1,8,1,1,"DEL")="CJS ; ;2/10/97  14:48"
^XTV(8991,4,1,8,1,2,0)=""
^XTV(8991,4,1,8,1,2,"DEL")=" D OPEN^%ZISH(""FILE1"",""D:\MSM\SCRATCH\"",""DRG.txt"",""W"")"
^XTV(8991,4,1,8,1,3,0)=""
^XTV(8991,4,1,8,1,3,"DEL")=" S I=0 F  S I=$O(^ICD(I)) Q:I'>0  W I,$C(9),$P(^(I,0),""^""),!"
^XTV(8991,4,1,8,1,4,"INS",0)="^8991.12^3^3"
^XTV(8991,4,1,8,1,4,"INS",1,0)="CJS ; ;2/10/97  14:54"
^XTV(8991,4,1,8,1,4,"INS",2,0)=" D OPEN^%ZISH(""FILE1"",""D:\MSM\SCRATCH\"",""Marital.txt"",""W"")"
^XTV(8991,4,1,8,1,4,"INS",3,0)=" S I=0 F  S I=$O(^DIC(11,I)) Q:I'>0  W I,$C(9),$P(^(I,0),""^""),!"
^XTV(8991,4,1,9,0)="2970210.1454"
^XTV(8991,4,1,9,1,0)="^8991.11^4^4"
^XTV(8991,4,1,9,1,1,0)=""
^XTV(8991,4,1,9,1,1,"DEL")="CJS ; ;2/10/97  14:54"
^XTV(8991,4,1,9,1,2,0)=""
^XTV(8991,4,1,9,1,2,"DEL")=" D OPEN^%ZISH(""FILE1"",""D:\MSM\SCRATCH\"",""Marital.txt"",""W"")"
^XTV(8991,4,1,9,1,3,0)=""
^XTV(8991,4,1,9,1,3,"DEL")=" S I=0 F  S I=$O(^DIC(11,I)) Q:I'>0  W I,$C(9),$P(^(I,0),""^""),!"
^XTV(8991,4,1,9,1,4,"INS",0)="^8991.12^3^3"
^XTV(8991,4,1,9,1,4,"INS",1,0)="CJS ; ;2/10/97  16:08"
^XTV(8991,4,1,9,1,4,"INS",2,0)=" D OPEN^%ZISH(""FILE1"",""D:\MSM\SCRATCH\"",""County.txt"",""W"")"
^XTV(8991,4,1,9,1,4,"INS",3,0)=" S I=0 F  S I=$O(^DIC(5,I)) Q:I'>0  S J=0 F  S J=$O(^DIC(5,I,1,J)) Q:J'>0  W I,$C(9),$P(^DIC(5,I,0),""^""),$C(9),J,$C(9),$P(^DIC(5,I,1,J,0),""^"",3),$C(9),$P(^(0),""^""),!"
^XTV(8991,4,1,10,0)="2970210.1608"
^XTV(8991,4,1,10,1,0)="^8991.11^4^4"
^XTV(8991,4,1,10,1,1,0)=""
^XTV(8991,4,1,10,1,1,"DEL")="CJS ; ;2/10/97  16:08"
^XTV(8991,4,1,10,1,2,"INS",0)="^8991.12^1^1"
^XTV(8991,4,1,10,1,2,"INS",1,0)="CJS ; ;2/10/97  16:12"
^XTV(8991,4,1,10,1,3,0)=""
^XTV(8991,4,1,10,1,3,"DEL")=" S I=0 F  S I=$O(^DIC(5,I)) Q:I'>0  S J=0 F  S J=$O(^DIC(5,I,1,J)) Q:J'>0  W I,$C(9),$P(^DIC(5,I,0),""^""),$C(9),J,$C(9),$P(^DIC(5,I,1,J,0),""^"",3),$C(9),$P(^(0),""^""),!"
^XTV(8991,4,1,10,1,4,"INS",0)="^8991.12^1^1"
^XTV(8991,4,1,10,1,4,"INS",1,0)=" S I=0 F  S I=$O(^DIC(5,I)) Q:I'>0  S J=0 F  S J=$O(^DIC(5,I,1,J)) Q:J'>0  W I,$C(9),$P(^DIC(5,I,0),""^""),$C(9),$P(^DIC(5,I,1,J,0),""^"",3),$C(9),$P(^(0),""^""),!"
^XTV(8991,4,1,11,0)="2970210.1612"
^XTV(8991,4,1,11,1,0)="^8991.11^4^4"
^XTV(8991,4,1,11,1,1,0)=""
^XTV(8991,4,1,11,1,1,"DEL")="CJS ; ;2/10/97  16:12"
^XTV(8991,4,1,11,1,2,0)=""
^XTV(8991,4,1,11,1,2,"DEL")=" D OPEN^%ZISH(""FILE1"",""D:\MSM\SCRATCH\"",""County.txt"",""W"")"
^XTV(8991,4,1,11,1,3,0)=""
^XTV(8991,4,1,11,1,3,"DEL")=" S I=0 F  S I=$O(^DIC(5,I)) Q:I'>0  S J=0 F  S J=$O(^DIC(5,I,1,J)) Q:J'>0  W I,$C(9),$P(^DIC(5,I,0),""^""),$C(9),$P(^DIC(5,I,1,J,0),""^"",3),$C(9),$P(^(0),""^""),!"
^XTV(8991,4,1,11,1,4,"INS",0)="^8991.12^3^3"
^XTV(8991,4,1,11,1,4,"INS",1,0)="CJS ; ;2/10/97  16:30"
^XTV(8991,4,1,11,1,4,"INS",2,0)=" D OPEN^%ZISH(""FILE1"",""D:\MSM\SCRATCH\"",""CPT.txt"",""W"")"
^XTV(8991,4,1,11,1,4,"INS",3,0)=" S I="""" F  S I=$O(^ICPT(""BA"",I)) Q:I=""""  S J=0 F  S J=$O(^ICPT(""BA"",I,J)) Q:J'>0  W I,$C(9),$P(^ICPT(J,0),""^"",2),!"
^XTV(8991,4,1,12,0)="2970210.163"
^XTV(8991,4,1,12,1,0)="^8991.11^4^4"
^XTV(8991,4,1,12,1,1,0)=""
^XTV(8991,4,1,12,1,1,"DEL")="CJS ; ;2/10/97  16:30"
^XTV(8991,4,1,12,1,2,0)=""
^XTV(8991,4,1,12,1,2,"DEL")=" D OPEN^%ZISH(""FILE1"",""D:\MSM\SCRATCH\"",""CPT.txt"",""W"")"
^XTV(8991,4,1,12,1,3,0)=""
^XTV(8991,4,1,12,1,3,"DEL")=" S I="""" F  S I=$O(^ICPT(""BA"",I)) Q:I=""""  S J=0 F  S J=$O(^ICPT(""BA"",I,J)) Q:J'>0  W I,$C(9),$P(^ICPT(J,0),""^"",2),!"
^XTV(8991,4,1,12,1,4,0)=""
^XTV(8991,4,1,12,1,4,"DEL")=" D CLOSE^%ZISH(""FILE1"") Q"
^XTV(8991,4,1,12,1,5,"INS",0)="^8991.12^8^8"
^XTV(8991,4,1,12,1,5,"INS",1,0)="CJS ; FIX EMPTY LINKS ;10/6/97  19:23"
^XTV(8991,4,1,12,1,5,"INS",2,0)=" S B=0 F  S B=$O(^XPD(9.6,B)) Q:B'>0  D"
^XTV(8991,4,1,12,1,5,"INS",3,0)=" . S Z=^XPD(9.6,B,0),L=$P(Z,""^"",2) Q:$L(L)"
^XTV(8991,4,1,12,1,5,"INS",4,0)=" . S P=$P(Z,""*"") Q:'$L(P)"
^XTV(8991,4,1,12,1,5,"INS",5,0)=" . S PA=$O(^DIC(9.4,""C"",P,"""")) I PA="""" W !,Z Q"
^XTV(8991,4,1,12,1,5,"INS",6,0)=" . S $P(^XPD(9.6,B,0),""^"",2)=PA"
^XTV(8991,4,1,12,1,5,"INS",7,0)=" . Q"
^XTV(8991,4,1,12,1,5,"INS",8,0)=" Q"
^XTV(8991,4,1,13,0)="2971006.1923"
^XTV(8991,4,1,13,1,0)="^8991.11^8^8"
^XTV(8991,4,1,13,1,1,0)=""
^XTV(8991,4,1,13,1,1,"DEL")="CJS ; FIX EMPTY LINKS ;10/6/97  19:23"
^XTV(8991,4,1,13,1,2,0)=""
^XTV(8991,4,1,13,1,2,"DEL")=" S B=0 F  S B=$O(^XPD(9.6,B)) Q:B'>0  D"
^XTV(8991,4,1,13,1,3,"INS",0)="^8991.12^2^2"
^XTV(8991,4,1,13,1,3,"INS",1,0)="CJS ; FIX EMPTY LINKS ;10/6/97  19:26"
^XTV(8991,4,1,13,1,3,"INS",2,0)=" S B=423 D  Q  ; S B=0 F  S B=$O(^XPD(9.6,B)) Q:B'>0  D"
^XTV(8991,4,1,14,0)="2971006.1926"
^XTV(8991,4,1,14,1,0)="^8991.11^8^8"
^XTV(8991,4,1,14,1,1,0)=""
^XTV(8991,4,1,14,1,1,"DEL")="CJS ; FIX EMPTY LINKS ;10/6/97  19:26"
^XTV(8991,4,1,14,1,2,0)=""
^XTV(8991,4,1,14,1,2,"DEL")=" S B=423 D  Q  ; S B=0 F  S B=$O(^XPD(9.6,B)) Q:B'>0  D"
^XTV(8991,4,1,14,1,3,"INS",0)="^8991.12^2^2"
^XTV(8991,4,1,14,1,3,"INS",1,0)="CJS ; FIX EMPTY LINKS ;10/6/97  19:27"
^XTV(8991,4,1,14,1,3,"INS",2,0)=" S B=0 F  S B=$O(^XPD(9.6,B)) Q:B'>0  D"
^XTV(8991,4,1,15,0)="2971006.1927"
^XTV(8991,4,1,15,1,0)="^8991.11^8^8"
^XTV(8991,4,1,15,1,1,0)="CJS ; FIX EMPTY LINKS ;10/6/97  19:27"
^XTV(8991,4,1,15,1,2,0)=" S B=0 F  S B=$O(^XPD(9.6,B)) Q:B'>0  D"
^XTV(8991,4,1,15,1,3,0)=" . S Z=^XPD(9.6,B,0),L=$P(Z,""^"",2) Q:$L(L)"
^XTV(8991,4,1,15,1,4,0)=" . S P=$P(Z,""*"") Q:'$L(P)"
^XTV(8991,4,1,15,1,5,0)=" . S PA=$O(^DIC(9.4,""C"",P,"""")) I PA="""" W !,Z Q"
^XTV(8991,4,1,15,1,6,0)=" . S $P(^XPD(9.6,B,0),""^"",2)=PA"
^XTV(8991,4,1,15,1,7,0)=" . Q"
^XTV(8991,4,1,15,1,8,0)=" Q"
^XTV(8991,4,1,"B",2961210.1023,1)=""
^XTV(8991,4,1,"B",2961210.1104,2)=""
^XTV(8991,4,1,"B",2961210.1117,3)=""
^XTV(8991,4,1,"B",2970210.1418,4)=""
^XTV(8991,4,1,"B",2970210.1419,5)=""
^XTV(8991,4,1,"B",2970210.1426,6)=""
^XTV(8991,4,1,"B",2970210.1443,7)=""
^XTV(8991,4,1,"B",2970210.1448,8)=""
^XTV(8991,4,1,"B",2970210.1454,9)=""
^XTV(8991,4,1,"B",2970210.1608,10)=""
^XTV(8991,4,1,"B",2970210.1612,11)=""
^XTV(8991,4,1,"B",2970210.163,12)=""
^XTV(8991,4,1,"B",2971006.1923,13)=""
^XTV(8991,4,1,"B",2971006.1926,14)=""
^XTV(8991,4,1,"B",2971006.1927,15)=""
^XTV(8991,5,0)="IBDY303"
^XTV(8991,5,1,0)="^8991.01^1^1"
^XTV(8991,5,1,1,0)="2980129.1534"
^XTV(8991,5,1,1,1,0)="^8991.11^29^29"
^XTV(8991,5,1,1,1,1,0)="IBDY303 ;ALB/TMP - POST INSTALL FOR PATCH IBD*3*3 ;1/29/98  15:34"
^XTV(8991,5,1,1,1,2,0)=" ;;3.0;AUTOMATED INFO COLLECTION SYS;**3**;APR 24, 1997"
^XTV(8991,5,1,1,1,3,0)=" ;"
^XTV(8991,5,1,1,1,4,0)="EN ; Recompile all forms in file 359.2"
^XTV(8991,5,1,1,1,5,0)=" N C,X,COUNT,CNT,COLWIDTH,IBDFSA,IBFORMID,IBBDT,IBEDT,IBDAY,LBEGIN,LEND,NODE10,POP,PRIORPG,QUIT"
^XTV(8991,5,1,1,1,6,0)=" ;"
^XTV(8991,5,1,1,1,7,0)=" S IBBDT=$H"
^XTV(8991,5,1,1,1,8,0)=" S COUNT=$P(^IBD(359.2,0),""^"",4)"
^XTV(8991,5,1,1,1,9,0)=" ;"
^XTV(8991,5,1,1,1,10,0)=" D MES^XPDUTL("">>> I am going to recompile all ""_COUNT_"" entries in your FORM SPECS file (359.2)"")"
^XTV(8991,5,1,1,1,11,0)=" D MES^XPDUTL("">>> Recompilation Started at ""_$$HTE^XLFDT(IBBDT))"
^XTV(8991,5,1,1,1,12,0)=" D MES^XPDUTL("">>> This may take awhile..."")"
^XTV(8991,5,1,1,1,13,0)=" ;"
^XTV(8991,5,1,1,1,14,0)=" S CNT=0"
^XTV(8991,5,1,1,1,15,0)=" S IBFORMID=0 F  S IBFORMID=$O(^IBD(359.2,IBFORMID)) Q:'IBFORMID  D"
^XTV(8991,5,1,1,1,16,0)=" .D SCAN^IBDFBKS(IBFORMID)"
^XTV(8991,5,1,1,1,17,0)=" .S CNT=CNT+1"
^XTV(8991,5,1,1,1,18,0)=" .I '$D(ZTQUEUED),'(CNT#10) D MES^XPDUTL(""    ""_CNT_"" done, ""_(COUNT-CNT)_"" to go."")"
^XTV(8991,5,1,1,1,19,0)=" ;"
^XTV(8991,5,1,1,1,20,0)=" S IBEDT=$H"
^XTV(8991,5,1,1,1,21,0)=" D MES^XPDUTL("""")"
^XTV(8991,5,1,1,1,22,0)=" D MES^XPDUTL("">>> Recompilation Complete at ""_$$HTE^XLFDT(IBEDT))"
^XTV(8991,5,1,1,1,23,0)=" I $D(IBBDT) D"
^XTV(8991,5,1,1,1,24,0)=" .S IBDAY=+IBEDT-(+IBBDT)*86400 ;additional seconds of over midnight"
^XTV(8991,5,1,1,1,25,0)=" .S X=IBDAY+$P(IBEDT,"","",2)-$P(IBBDT,"","",2)"
^XTV(8991,5,1,1,1,26,0)=" .D MES^XPDUTL("">>> Elapse time for recompilation was: ""_(X\3600)_"" Hours,  ""_(X\60-(X\3600*60))_"" Minutes,  ""_(X#60)_"" Seconds"")"
^XTV(8991,5,1,1,1,27,0)=" .S:COUNT>0 X=(X/COUNT)"
^XTV(8991,5,1,1,1,28,0)=" .D MES^XPDUTL("">>> Average Time per Entry was: ""_(X\60-(X\3600*60))_"" Minutes,  ""_(X#60)_"" Seconds"")"
^XTV(8991,5,1,1,1,29,0)=" Q"
^XTV(8991,5,1,"B",2980129.1534,1)=""
^XTV(8991,6,0)="ZTMB"
^XTV(8991,6,1,0)="^8991.01^1^1"
^XTV(8991,6,1,1,0)="2980424.2121"
^XTV(8991,6,1,1,1,0)="^8991.11^75^75"
^XTV(8991,6,1,1,1,1,0)="ZTMB ;SEA/RDS-Taskman: Manager, Boot/ Option, ZTMRESTART ;4/24/98  21:21"
^XTV(8991,6,1,1,1,2,0)=" ;;8.0;KERNEL;;Jul 10, 1995"
^XTV(8991,6,1,1,1,3,0)=" ;"
^XTV(8991,6,1,1,1,4,0)=" ;NOTE:  On DataTree systems:"
^XTV(8991,6,1,1,1,5,0)=" ;For automatic startup of TaskMan at boot, save as %ustart in SYS."
^XTV(8991,6,1,1,1,6,0)=" ;In %ustart, remove ';' from the next two lines:"
^XTV(8991,6,1,1,1,7,0)=" ;I $P($ZVER,""/"",2)>4.0,$P($ZVER,""/"",2)<4.3 VIEW 1:296:$C(2) ;increase name table allocation"
^XTV(8991,6,1,1,1,8,0)=" ;I  ZZSWITCH 256 ;display current namespace"
^XTV(8991,6,1,1,1,9,0)=" ;"
^XTV(8991,6,1,1,1,10,0)="START ;Start Taskmanager"
^XTV(8991,6,1,1,1,11,0)=" D INIT S ZTMB=""START"""
^XTV(8991,6,1,1,1,12,0)=" I ZTOS[""M/SQL-PDP""!(ZTOS[""OpenM"") J START^%ZTM0:ZTUCI Q"
^XTV(8991,6,1,1,1,13,0)=" I ZTOS[""DTM"" G DTM"
^XTV(8991,6,1,1,1,14,0)=" I ZTOS[""DSM"",ZTOS'[""VAX DSM"" J START^%ZTM0[ZTUCI] Q"
^XTV(8991,6,1,1,1,15,0)=" I ZTOS[""VAX DSM"" G VXD"
^XTV(8991,6,1,1,1,16,0)=" W !,""TASKMAN NOT STARTED"" Q"
^XTV(8991,6,1,1,1,17,0)="VXD X ""S %=($ZC(%GETJPI,$J,""""CURPRIV"""")[""""SHARE"""")"" I % W !,""Don't start TaskMan with the SHARE privilege"" Q"
^XTV(8991,6,1,1,1,18,0)=" S Z=0,%=$O(^%ZIS(14.7,""B"",ZTPAIR,0)),ZTMODE=$P($G(^%ZIS(14.7,+%,0)),U,10)"
^XTV(8991,6,1,1,1,19,0)="VXD2 I Z,$$EC^%ZOSV[""access not authorized""!($$EC^%ZOSV[""no privilege"") W !!,""You lack the system privilege to start TaskMan."" H 2 Q"
^XTV(8991,6,1,1,1,20,0)=" I Z,$$EC^%ZOSV'[""duplicate name"" W !!,""The following error has prevented TaskMan from starting:"",!,$$EC^%ZOSV H 2 Q"
^XTV(8991,6,1,1,1,21,0)=" S X=""VXD2"",@^%ZOSF(""TRAP""),Z=Z+1"
^XTV(8991,6,1,1,1,22,0)=" I ZTMODE="""" S %=ZTMB_""^%ZTM0:(OPTION=""""/UCI=""""_ZTUCI,NAME=""""TaskMan """"_$E(^%ZOSF(""""VOL""""),1,3)_"""" """"_Z)"" J @% Q"
^XTV(8991,6,1,1,1,23,0)=" ;Remove the '/NOLOG' if you want a log file for trouble shouting"
^XTV(8991,6,1,1,1,24,0)=" I ZTMODE]"""" S %SPAWN=""SUBMIT/NOPRINT/NOLOG/USER=TASKMAN/QUEUE=TM$""_ZTNODE_"" DHCP$TASKMAN:ZTMWDCL/PARAM=(""_ZTMODE_"",""_(ZTMB[""RE"")_"")"" D ^%SPAWN"
^XTV(8991,6,1,1,1,25,0)=" Q"
^XTV(8991,6,1,1,1,26,0)=" ;"
^XTV(8991,6,1,1,1,27,0)="DTM I ZTMB=""START"" D NULLDEV F DEV=10:1:19 O DEV:(""W"":NULLDEV):0 C DEV"
^XTV(8991,6,1,1,1,28,0)=" S Z=0"
^XTV(8991,6,1,1,1,29,0)="DTM2 S X=""DTM2"",@^%ZOSF(""TRAP""),Z=Z+1,%=ZTMB_""^%ZTM0:(NSPACE=""""""_ZTUCI_"""""":STRSTK=8000:LVMEM=12000:NAME=""""TaskMan ""_$E(^%ZOSF(""VOL""),1,3)_"" ""_Z_"""""")"" J @% Q"
^XTV(8991,6,1,1,1,30,0)=" ;"
^XTV(8991,6,1,1,1,31,0)="RESTART ;Restart Taskmanager"
^XTV(8991,6,1,1,1,32,0)=" D INIT"
^XTV(8991,6,1,1,1,33,0)=" I $D(^%ZOSF(""SIGNOFF"")) X ^(""SIGNOFF"") I  W *7,!,""NOTE THAT THE SYSTEM IS IN A 'SIGNOFF' STATE,"",!?4,""WHICH PROBABLY EXPLAINS WHY TASKS ARE NOT RUNNING!!"",!"
^XTV(8991,6,1,1,1,34,0)=" S ZTMULT=0 I $S($D(^%ZTSCH(""RUN""))[0:0,^(""RUN"")-$H:0,1:$P($H,"","",2)-150'>$P(^(""RUN""),"","",2)) W !,""TASKMAN IS ALREADY RUNNING"" S ZTMULT=1"
^XTV(8991,6,1,1,1,35,0)=" I ZTOS[""VAX DSM"" I $ZC(%GETJPI,$J,""CURPRIV"")[""SHARE"" W !,""Don't start TaskMan with the SHARE privilege"" Q"
^XTV(8991,6,1,1,1,36,0)=" F %ZTI=0:0 W !,""ARE YOU SURE YOU WANT TO RESTART "",$S(ZTMULT:""ANOTHER "",1:""""),""TASKMAN? NO//"" R %Y:$S($D(DTIME)#2:DTIME,1:60) S:'$T %Y=""^"" W:'$T ""*TIMEOUT*"" Q:""YESyes^NOno""[%Y  W:%Y'[""?"" *7 D HELP1:%Y'[""??"",HELP2:%Y[""??"""
^XTV(8991,6,1,1,1,37,0)=" I %Y=""""!(""YESyes""'[%Y) W ""  (NO)"",!,*7,""<NO ACTION TAKEN>"",! Q"
^XTV(8991,6,1,1,1,38,0)=" W ""  (YES)"",!,""Restarting..."""
^XTV(8991,6,1,1,1,39,0)=" S ZTMB=""RESTART"""
^XTV(8991,6,1,1,1,40,0)=" I ZTOS[""M/SQL-PDP""!(ZTOS[""OpenM"") J RESTART^%ZTM0:ZTUCI D DONE Q"
^XTV(8991,6,1,1,1,41,0)=" I ZTOS[""DTM"" G DTM"
^XTV(8991,6,1,1,1,42,0)=" I ZTOS'[""VAX DSM"" J RESTART^%ZTM0[ZTUCI] D DONE Q"
^XTV(8991,6,1,1,1,43,0)=" I ZTOS[""VAX DSM"" G VXD"
^XTV(8991,6,1,1,1,44,0)=" W !,""TASKMAN NOT RESTARTED"""
^XTV(8991,6,1,1,1,45,0)=" Q"
^XTV(8991,6,1,1,1,46,0)="INIT S U=""^"",ZTOS=^%ZOSF(""OS""),ZTUCI=$P(^%ZOSF(""MGR""),"","")"
^XTV(8991,6,1,1,1,47,0)=" D GETENV^%ZOSV S ZTVOL=$P(Y,U,2),ZTNODE=$P(Y,U,3),ZTPAIR=$P(Y,U,4)"
^XTV(8991,6,1,1,1,48,0)=" Q"
^XTV(8991,6,1,1,1,49,0)=" ;"
^XTV(8991,6,1,1,1,50,0)="NULLDEV ;SELECT NULL DEVICE (DTM OS Dependent)"
^XTV(8991,6,1,1,1,51,0)=" D HWTYPE S NULLDEV=""NUL"" I %HW'=""PC"" S NULLDEV=""[NUL]"""
^XTV(8991,6,1,1,1,52,0)=" K %HW,%HW Q"
^XTV(8991,6,1,1,1,53,0)=" ;"
^XTV(8991,6,1,1,1,54,0)="HWTYPE ;HARDWARE TYPE(DTM OS Dependent)"
^XTV(8991,6,1,1,1,55,0)=" K %HW S %H=$S($P($ZVER,""/"",2)<4:$V(4,3,-1),1:$V(1,3,-1)) ;get hardware type number"
^XTV(8991,6,1,1,1,56,0)=" S %HW=$S(%H<10:""WS"",%H<20:""MF"",%H<64:""?"",%H<129:""PC"",1:""?"")"
^XTV(8991,6,1,1,1,57,0)=" Q"
^XTV(8991,6,1,1,1,58,0)=" ;"
^XTV(8991,6,1,1,1,59,0)="HELP1 ;RESTART--improved help for the confirmation prompt."
^XTV(8991,6,1,1,1,60,0)=" W !!?5,""Answer must be YES or NO."""
^XTV(8991,6,1,1,1,61,0)=" W !?5,""Answer YES to restart "",$S(ZTMULT:""another "",1:""""),""TaskMan."",!"
^XTV(8991,6,1,1,1,62,0)=" Q"
^XTV(8991,6,1,1,1,63,0)=" ;"
^XTV(8991,6,1,1,1,64,0)="HELP2 ;RESTART--??-help for confirmation prompt"
^XTV(8991,6,1,1,1,65,0)=" W !!?5,""TaskMan must be running in each library uci on the system for tasks to run."""
^XTV(8991,6,1,1,1,66,0)=" W !?5,""One TaskMan per library uci should be enough for all but the busiest sites."""
^XTV(8991,6,1,1,1,67,0)=" W !?5,""The System Status option and the Monitor TaskMan option can help determine"""
^XTV(8991,6,1,1,1,68,0)=" W !?5,""whether a TaskMan is running on this volume set."""
^XTV(8991,6,1,1,1,69,0)=" W !!?5,""If you are still uncertain how to respond, answer NO and consult your"""
^XTV(8991,6,1,1,1,70,0)=" W !?5,""documentation or your support ISC."",!"
^XTV(8991,6,1,1,1,71,0)=" Q"
^XTV(8991,6,1,1,1,72,0)=" ;"
^XTV(8991,6,1,1,1,73,0)="DONE ;RESTART--feedback after restarting TaskMan"
^XTV(8991,6,1,1,1,74,0)=" W ""TaskMan restarted!"",! Q"
^XTV(8991,6,1,1,1,75,0)=" ;"
^XTV(8991,6,1,"B",2980424.2121,1)=""
^XTV(8991,7,0)="CJS2"
^XTV(8991,7,1,0)="^8991.01^2^2"
^XTV(8991,7,1,1,0)="2980527.1645"
^XTV(8991,7,1,1,1,0)="^8991.11^31^31"
^XTV(8991,7,1,1,1,1,0)=""
^XTV(8991,7,1,1,1,1,"DEL")="CJS2 ; Save patches to HFS files in respective folders ;5/27/98  16:45"
^XTV(8991,7,1,1,1,2,"INS",0)="^8991.12^1^1"
^XTV(8991,7,1,1,1,2,"INS",1,0)="CJS2 ; Save patches to HFS files in respective folders ;12/14/98  10:56"
^XTV(8991,7,1,1,1,10,0)=""
^XTV(8991,7,1,1,1,10,"DEL")=" . S SUBJECT=$P($G(^XMB(3.9,MESSAGE,0)),U) S NAME=$P($P(SUBJECT,""*""),"" "",2) Q:'$L(NAME)  Q:'$O(^DIC(9.4,""C"",NAME,""""))"
^XTV(8991,7,1,1,1,11,"INS",0)="^8991.12^1^1"
^XTV(8991,7,1,1,1,11,"INS",1,0)=" . S SUBJECT=$P($G(^XMB(3.9,MESSAGE,0)),U) S NAME=$P($P(SUBJECT,""*""),"" "",$S(SUBJECT[""EMERGENCY"":3,1:2)) Q:'$L(NAME)  Q:'$O(^DIC(9.4,""C"",NAME,""""))"
^XTV(8991,7,1,1,1,19,0)=""
^XTV(8991,7,1,1,1,19,"DEL")=" . Q:TEXT'[""$KID""  I (NAME_""*""_$S(VER[""."":VER,1:VER_"".0"")_""*""_NUM)'=$P(TEXT,"" "",2) W !,SUBJECT Q"
^XTV(8991,7,1,1,1,20,"INS",0)="^8991.12^1^1"
^XTV(8991,7,1,1,1,20,"INS",1,0)=" . Q:TEXT'[""$KID""  I (NAME_""*""_$S(VER[""."":$S(VER<1:""0""_VER,1:VER),1:VER_"".0"")_""*""_NUM)'=$P(TEXT,"" "",2) W !,SUBJECT Q"
^XTV(8991,7,1,1,1,23,0)=""
^XTV(8991,7,1,1,1,23,"DEL")=" . W SUBJECT,!,""Extracted from mail message"",!,""**KIDS**:""_NAME_""*""_VER_""*""_NUM_U,!!"
^XTV(8991,7,1,1,1,24,"INS",0)="^8991.12^1^1"
^XTV(8991,7,1,1,1,24,"INS",1,0)=" . W SUBJECT,!,""Extracted from mail message"",!,""**KIDS**:""_NAME_""*""_$S(VER[""."":$S(VER<1:""0""_VER,1:VER),1:VER_"".0"")_""*""_NUM_U,!!"
^XTV(8991,7,1,2,0)="2981214.1056"
^XTV(8991,7,1,2,1,0)="^8991.11^31^31"
^XTV(8991,7,1,2,1,1,0)="CJS2 ; Save patches to HFS files in respective folders ;12/14/98  10:56"
^XTV(8991,7,1,2,1,2,0)=" ; Get Mail Basket"
^XTV(8991,7,1,2,1,3,0)=" ; Order through all messages"
^XTV(8991,7,1,2,1,4,0)=" ; Parse on subject for patche's namespace\version"
^XTV(8991,7,1,2,1,5,0)=" ; Save each under <patch>.txt for instructions and <patch>.kid for build"
^XTV(8991,7,1,2,1,6,0)=" I '$D(DUZ) D ^XUP"
^XTV(8991,7,1,2,1,7,0)=" S DIC=""^XMB(3.7,DUZ,2,"",DIC(0)=""AEMQZ"",DIC(""A"")=""Select Basket: "" D ^DIC G:Y<0 EXIT S BASKET=+Y"
^XTV(8991,7,1,2,1,8,0)=" S DIR(0)=""F^2:60"",DIR(""A"")=""Full path, up to but not including patch names"" D ^DIR G:Y=""^"" EXIT S ROOT=Y"
^XTV(8991,7,1,2,1,9,0)=" S MESSAGE=0 F  S MESSAGE=$O(^XMB(3.7,DUZ,2,BASKET,1,MESSAGE)) Q:MESSAGE'>0  D  I $D(POP) G:POP ERROR"
^XTV(8991,7,1,2,1,10,0)=" . S SUBJECT=$P($G(^XMB(3.9,MESSAGE,0)),U) S NAME=$P($P(SUBJECT,""*""),"" "",$S(SUBJECT[""EMERGENCY"":3,1:2)) Q:'$L(NAME)  Q:'$O(^DIC(9.4,""C"",NAME,""""))"
^XTV(8991,7,1,2,1,11,0)=" . S VER=$P(SUBJECT,""*"",2),NUM=$P($P(SUBJECT,""*"",3),"" ""),SEQ=$P(SUBJECT,""SEQ #"",2)"
^XTV(8991,7,1,2,1,12,0)=" . S PATCH=NAME_""-""_$TR(VER,""."",""p"")_""_SEQ-""_SEQ_""_PAT-""_NUM"
^XTV(8991,7,1,2,1,13,0)=" . D OPEN^%ZISH(""OUTFILE"",ROOT,PATCH_"".txt"",""W"")"
^XTV(8991,7,1,2,1,14,0)=" . Q:POP"
^XTV(8991,7,1,2,1,15,0)=" . U IO"
^XTV(8991,7,1,2,1,16,0)=" . S LINE=.99 F  S LINE=$O(^XMB(3.9,MESSAGE,2,LINE)) Q:LINE'>0  S TEXT=^(LINE,0)  W TEXT,! Q:TEXT[""$END TXT"""
^XTV(8991,7,1,2,1,17,0)=" . D CLOSE^%ZISH(""OUTFILE"")"
^XTV(8991,7,1,2,1,18,0)=" . F  S LINE=$O(^XMB(3.9,MESSAGE,2,LINE)) Q:LINE'>0  S TEXT=^(LINE,0) Q:TEXT[""$KID"""
^XTV(8991,7,1,2,1,19,0)=" . Q:TEXT'[""$KID""  I (NAME_""*""_$S(VER[""."":$S(VER<1:""0""_VER,1:VER),1:VER_"".0"")_""*""_NUM)'=$P(TEXT,"" "",2) W !,SUBJECT Q"
^XTV(8991,7,1,2,1,20,0)=" . D OPEN^%ZISH(""OUTFILE"",ROOT,PATCH_"".kid"",""W"")"
^XTV(8991,7,1,2,1,21,0)=" . Q:POP"
^XTV(8991,7,1,2,1,22,0)=" . U IO"
^XTV(8991,7,1,2,1,23,0)=" . W SUBJECT,!,""Extracted from mail message"",!,""**KIDS**:""_NAME_""*""_$S(VER[""."":$S(VER<1:""0""_VER,1:VER),1:VER_"".0"")_""*""_NUM_U,!!"
^XTV(8991,7,1,2,1,24,0)=" . F  S LINE=$O(^XMB(3.9,MESSAGE,2,LINE)) Q:LINE'>0  S TEXT=^(LINE,0) Q:TEXT[""$END KID""  W TEXT,!"
^XTV(8991,7,1,2,1,25,0)=" . W ""**END**"",!,""**END**"",!"
^XTV(8991,7,1,2,1,26,0)=" . D CLOSE^%ZISH(""OUTFILE"")"
^XTV(8991,7,1,2,1,27,0)=" W !,""Done"""
^XTV(8991,7,1,2,1,28,0)="EXIT K BASKET,NAME,DIC,Y,DIR,ROOT,SUBJECT,PATCH,VER,POP,LINE,MESSAGE,TEXT"
^XTV(8991,7,1,2,1,29,0)=" Q"
^XTV(8991,7,1,2,1,30,0)="ERROR W !,""ERROR ON OPEN"""
^XTV(8991,7,1,2,1,31,0)=" G EXIT"
^XTV(8991,7,1,"B",2980527.1645,1)=""
^XTV(8991,7,1,"B",2981214.1056,2)=""
^XTV(8991,8,0)="XMRONT"
^XTV(8991,8,1,0)="^8991.01^1^1"
^XTV(8991,8,1,1,0)="2990803.1203"
^XTV(8991,8,1,1,1,0)="^8991.11^24^24"
^XTV(8991,8,1,1,1,1,0)="XMRONT ;(SF-ISC)/RWF - OpenM-NT TCP/IP INETD AND FRONT END ;8/3/99  12:03"
^XTV(8991,8,1,1,1,2,0)=" ;;7.1;MailMan;**61,50**;Jun 02, 1994"
^XTV(8991,8,1,1,1,3,0)=" ; Entry points used by MailMan options (not covered by DBIA):"
^XTV(8991,8,1,1,1,4,0)=" ; ^XMRONT   XMRONT"
^XTV(8991,8,1,1,1,5,0)=" ;This routine starts a listener for TCP mail Connects."
^XTV(8991,8,1,1,1,6,0)=" ; It takes the place of the INETD Unix process"
^XTV(8991,8,1,1,1,7,0)=" ;"
^XTV(8991,8,1,1,1,8,0)="GO ;Open port 25 in Accept mode."
^XTV(8991,8,1,1,1,9,0)=" S XMRSOCK=10001"
^XTV(8991,8,1,1,1,10,0)=" D LISTEN^%ZISTCPS(XMRSOCK,""SOC25^XMRONT"")"
^XTV(8991,8,1,1,1,11,0)=" HALT"
^XTV(8991,8,1,1,1,12,0)=" ;"
^XTV(8991,8,1,1,1,13,0)="SOC25 ;This entry point is started as a new process by %ZISTCPS."
^XTV(8991,8,1,1,1,14,0)=" S (XMRPORT,IO,IO(0))=$IO,IOT=""TCP"""
^XTV(8991,8,1,1,1,15,0)=" I $$NEWERR^%ZTER N $ETRAP,$ESTACK S $ETRAP=""D TRP^XMCTRAP"""
^XTV(8991,8,1,1,1,16,0)=" E  S X=""TRP^XMCTRAP"",@^%ZOSF(""TRAP"")"
^XTV(8991,8,1,1,1,17,0)=" S DIQUIET=1 D DT^DICRW,DUZ^XUP(.5)"
^XTV(8991,8,1,1,1,18,0)=" S ER=0,XMCHAN=""TCP/IP-MAILMAN"",XMNO220="""""
^XTV(8991,8,1,1,1,19,0)=" U IO"
^XTV(8991,8,1,1,1,20,0)=" D ENT^XMR"
^XTV(8991,8,1,1,1,21,0)="HALT ;Unlock all locks, close the connection and quit"
^XTV(8991,8,1,1,1,22,0)=" L   ;C IO  The close caused a problem under OpenM 52e, so it was removed"
^XTV(8991,8,1,1,1,23,0)=" Q"
^XTV(8991,8,1,1,1,24,0)="  "
^XTV(8991,8,1,"B",2990803.1203,1)=""
^XTV(8991,9,0)="XYZ"
^XTV(8991,9,1,0)="^8991.01^1^1"
^XTV(8991,9,1,1,0)="3020510.133"
^XTV(8991,9,1,1,1,0)="^8991.11^9^9"
^XTV(8991,9,1,1,1,1,0)="XYZ ;LIST ;5/10/02  13:30"
^XTV(8991,9,1,1,1,2,0)=" S I=0 F  S I=$O(^DD(I)) Q:I'>0  D"
^XTV(8991,9,1,1,1,3,0)=" . S J=0 F  S J=$O(^DD(I,J)) Q:J'>0  D"
^XTV(8991,9,1,1,1,4,0)=" . . W !!,I,?15,"" "",J,!,""  "",$P($G(^DD(I,J,0)),""^"")"
^XTV(8991,9,1,1,1,5,0)=" . . S K=0 F  S K=$O(^DD(I,J,21,K)) Q:K'>0  D"
^XTV(8991,9,1,1,1,6,0)=" . . . W !,$G(^DD(I,J,21,K,0)) Q"
^XTV(8991,9,1,1,1,7,0)=" . . Q"
^XTV(8991,9,1,1,1,8,0)=" . Q"
^XTV(8991,9,1,1,1,9,0)=" Q"
^XTV(8991,9,1,"B",3020510.133,1)=""
^XTV(8991,10,0)="ZZ"
^XTV(8991,10,1,0)="^8991.01^1^1"
^XTV(8991,10,1,1,0)="3040414.0956"
^XTV(8991,10,1,1,1,0)="^8991.11^9^9"
^XTV(8991,10,1,1,1,1,0)="ZZ ; ;4/14/04  09:56"
^XTV(8991,10,1,1,1,2,0)=" K ^TMP($J)"
^XTV(8991,10,1,1,1,3,0)=" S B=""COMPARE"" F  S B=$O(^XPD(9.6,""B"",B)) Q:B'[""COMPARE""  D"
^XTV(8991,10,1,1,1,4,0)=" . S E=$O(^XPD(9.6,""B"",B,0)),BN=$P(B,""COMPARE "",2),^TMP($J,BN)=0"
^XTV(8991,10,1,1,1,5,0)=" . S F=0 F  S F=$O(^XPD(9.6,E,4,F)) Q:F'>0  D"
^XTV(8991,10,1,1,1,6,0)=" . . S ^TMP($J,BN)=^TMP($J,BN)+1"
^XTV(8991,10,1,1,1,7,0)=" . . Q"
^XTV(8991,10,1,1,1,8,0)=" . Q"
^XTV(8991,10,1,1,1,9,0)=" Q"
^XTV(8991,10,1,"B",3040414.0956,1)=""
^XTV(8991,11,0)="PSOORNEW"
^XTV(8991,11,1,0)="^8991.01^1^1"
^XTV(8991,11,1,1,0)="3051210.2014"
^XTV(8991,11,1,1,1,0)="^8991.11^154^154"
^XTV(8991,11,1,1,1,1,0)="PSOORNEW ;BIR/SAB-display orders from oerr ;12/10/05  20:13"
^XTV(8991,11,1,1,1,2,0)=" ;;7.0;OUTPATIENT PHARMACY;**11,23,27,32,55,46,71,90,94,106,131,133**;DEC 1997"
^XTV(8991,11,1,1,1,3,0)=" ;^PS(50.7 -2223"
^XTV(8991,11,1,1,1,4,0)=" ;^PSDRUG -221"
^XTV(8991,11,1,1,1,5,0)=" ;^PS(50.606 -2174"
^XTV(8991,11,1,1,1,6,0)=" ;^PS(55 -2228"
^XTV(8991,11,1,1,1,7,0)="DSPL I $G(PSODSPL) S VALMBCK=""Q"" K PSODSPL,PSOANSQD Q"
^XTV(8991,11,1,1,1,8,0)=" Q:'$D(PSOLMC)  K ^TMP(""PSOPO"",$J) S PSOLMC=PSOLMC+1"
^XTV(8991,11,1,1,1,9,0)=" I $D(CLOZPAT) S PSONEW(""DAYS SUPPLY"")=$S($G(PSONEW(""DAYS SUPPLY"")):PSONEW(""DAYS SUPPLY""),1:7) G OI"
^XTV(8991,11,1,1,1,10,0)=" S PSONEW(""DAYS SUPPLY"")=$S($G(PSONEW(""DAYS SUPPLY"")):PSONEW(""DAYS SUPPLY""),+$G(^PS(55,PSODFN,""PS""))&($P(^PS(53,+$G(^PS(55,PSODFN,""PS"")),0),""^"",3))&('$G(PSONEW(""DAYS SUPPLY""))):$P(^PS(53,+$G(^PS(55,PSODFN,""PS"")),0),""^"",3),1:30)"
^XTV(8991,11,1,1,1,11,0)="OI I '$G(PSODRUG(""OI"")) D"
^XTV(8991,11,1,1,1,12,0)=" .S (OI,PSODRUG(""OI""))=$P(OR0,""^"",8),PSODRUG(""OIN"")=$P(^PS(50.7,$P(OR0,""^"",8),0),""^""),OID=$P(OR0,""^"",9)"
^XTV(8991,11,1,1,1,13,0)=" .I $P($G(OR0),""^"",9) S POERR=1,DREN=$P(OR0,""^"",9) D DRG^PSOORDRG K POERR"
^XTV(8991,11,1,1,1,14,0)=" I '$D(CLOZPAT) I $G(PSODRUG(""DEA""))[""A"",$G(PSODRUG(""DEA""))'[""B""!($G(PSODRUG(""DEA""))[""F"") S PSONEW(""# OF REFILLS"")=0"
^XTV(8991,11,1,1,1,15,0)=" I $D(CLOZPAT) S PSONEW(""# OF REFILLS"")=$S($D(PSONEW(""# OF REFILLS"")):PSONEW(""# OF REFILLS""),$G(CLOZPAT)=1&($P(OR0,""^"",11)<1):0,1:1)"
^XTV(8991,11,1,1,1,16,0)=" S IEN=0 D OBX^PSOORFI1,DIN^PSONFI(PSODRUG(""OI""),$S($G(PSODRUG(""IEN"")):PSODRUG(""IEN""),1:""""))"
^XTV(8991,11,1,1,1,17,0)=" S IEN=IEN+1,^TMP(""PSOPO"",$J,IEN,0)=""*(1) Orderable Item: ""_$P(^PS(50.7,PSODRUG(""OI""),0),""^"")_"" ""_$P(^PS(50.606,$P(^(0),""^"",2),0),""^"")_NFIO"
^XTV(8991,11,1,1,1,18,0)=" S:NFIO[""<DIN>"" NFIO=IEN_"",""_($L(^TMP(""PSOPO"",$J,IEN,0))-4)"
^XTV(8991,11,1,1,1,19,0)=" K LST I $G(PSODRUG(""NAME""))]"""" D  G PT"
^XTV(8991,11,1,1,1,20,0)=" .S IEN=IEN+1,^TMP(""PSOPO"",$J,IEN,0)="" (2)""_$S($D(^PSDRUG(""AQ"",PSODRUG(""IEN""))):""      CMOP "",1:""           "")_""Drug: ""_PSODRUG(""NAME"")_NFID"
^XTV(8991,11,1,1,1,21,0)=" .S:NFID[""<DIN>"" NFID=IEN_"",""_($L(^TMP(""PSOPO"",$J,IEN,0))-4)"
^XTV(8991,11,1,1,1,22,0)=" .I $P($G(^PSDRUG(PSODRUG(""IEN""),0)),""^"",10)]"""" S IEN=IEN+1,^TMP(""PSOPO"",$J,IEN,0)=""       Drug Message:"" D DRGMSG"
^XTV(8991,11,1,1,1,23,0)=" S IEN=IEN+1,^TMP(""PSOPO"",$J,IEN,0)="" (2)           Drug: No Dispense Drug Selected"""
^XTV(8991,11,1,1,1,24,0)="PT D DOSE2^PSOORFI4"
^XTV(8991,11,1,1,1,25,0)=" S IEN=IEN+1,^TMP(""PSOPO"",$J,IEN,0)="" (4)   Pat Instruct:"" D:$O(PSONEW(""SIG"",0)) INST^PSOORFI4"
^XTV(8991,11,1,1,1,26,0)=" S IEN=IEN+1,^TMP(""PSOPO"",$J,IEN,0)=""  Provider Comments:"" S TY=3 D INST^PSOORFI1"
^XTV(8991,11,1,1,1,27,0)=" S IEN=IEN+1,^TMP(""PSOPO"",$J,IEN,0)=""       Instructions:"" S TY=2 D INST^PSOORFI1"
^XTV(8991,11,1,1,1,28,0)=" K PSOELSE S IEN=IEN+1,^TMP(""PSOPO"",$J,IEN,0)=""                SIG:"""
^XTV(8991,11,1,1,1,29,0)=" F I=0:0 S I=$O(SIG(I)) Q:'I  S SIG=SIG(I) D"
^XTV(8991,11,1,1,1,30,0)=" .F SG=1:1:$L(SIG) S:$L(^TMP(""PSOPO"",$J,IEN,0)_"" ""_$P(SIG,"" "",SG))>80 IEN=IEN+1,$P(^TMP(""PSOPO"",$J,IEN,0),"" "",20)="" "" S:$P(SIG,"" "",SG)'="""" ^TMP(""PSOPO"",$J,IEN,0)=$G(^TMP(""PSOPO"",$J,IEN,0))_"" ""_$P(SIG,"" "",SG)"
^XTV(8991,11,1,1,1,31,0)=" S IEN=IEN+1,^TMP(""PSOPO"",$J,IEN,0)="" (5) Patient Status: ""_$P($G(^PS(53,+PSONEW(""PATIENT STATUS""),0)),""^"")"
^XTV(8991,11,1,1,1,32,0)=" K PSOELSE I $G(PSONEW(""ISSUE DATE""))']"""" S PSOELSE=1 S IEN=IEN+1,(PSOID,Y)=$E($P(OR0,""^"",6),1,7) X ^DD(""DD"") S PSONEW(""ISSUE DATE"")=Y,^TMP(""PSOPO"",$J,IEN,0)="" (4)     Issue Date: ""_Y"
^XTV(8991,11,1,1,1,33,0)=" I '$G(PSOELSE) S IEN=IEN+1,^TMP(""PSOPO"",$J,IEN,0)="" (6)     Issue Date: ""_PSONEW(""ISSUE DATE"")"
^XTV(8991,11,1,1,1,34,0)=" K PSOELSE I $G(PSORX(""FILL DATE""))']"""" S PSOELSE=1 D"
^XTV(8991,11,1,1,1,35,0)=" .S (Y,PSORX(""FILL DATE""))=$S($E($P(OR0,""^"",6),1,7)<DT:DT,1:$E($P(OR0,""^"",6),1,7)) X ^DD(""DD"") S PSONEW(""FILL DATE"")=Y,^TMP(""PSOPO"",$J,IEN,0)=^TMP(""PSOPO"",$J,IEN,0)_""                  (5) Fill Date: ""_Y"
^XTV(8991,11,1,1,1,36,0)=" I '$G(PSOELSE) S Y=PSORX(""FILL DATE"") X ^DD(""DD"") S PSORX(""FILL DATE"")=Y,^TMP(""PSOPO"",$J,IEN,0)=^TMP(""PSOPO"",$J,IEN,0)_""       (7) Fill Date: ""_PSORX(""FILL DATE"")"
^XTV(8991,11,1,1,1,37,0)=" I $P(OR0,""^"",18) S IEN=IEN+1,Y=$P(OR0,""^"",18) X ^DD(""DD"") S $P(^TMP(""PSOPO"",$J,IEN,0),"" "",39)=""Effective Date: ""_Y"
^XTV(8991,11,1,1,1,38,0)=" I $G(CLOZPAT)=1 D ELIG^PSOORFI2"
^XTV(8991,11,1,1,1,39,0)=" S IEN=IEN+1,^TMP(""PSOPO"",$J,IEN,0)="" (8)    Days Supply: ""_PSONEW(""DAYS SUPPLY"")"
^XTV(8991,11,1,1,1,40,0)=" S ^TMP(""PSOPO"",$J,IEN,0)=^TMP(""PSOPO"",$J,IEN,0)_""               (9)   QTY""_$S($P($G(^PSDRUG(+$G(PSODRUG(""IEN"")),660)),""^"",8)]"""":"" (""_$P($G(^PSDRUG(+PSODRUG(""IEN""),660)),""^"",8)_"")"",1:"" (  )"")"
^XTV(8991,11,1,1,1,41,0)=" S ^TMP(""PSOPO"",$J,IEN,0)=^TMP(""PSOPO"",$J,IEN,0)_"": ""_$S($G(PSONEW(""QTY"")):PSONEW(""QTY""),1:$P(OR0,""^"",10))"
^XTV(8991,11,1,1,1,42,0)=" I $P($G(^PSDRUG(+$G(PSODRUG(""IEN"")),5)),""^"")]"""" D"
^XTV(8991,11,1,1,1,43,0)=" .S $P(RN,"" "",79)="" "",IEN=IEN+1"
^XTV(8991,11,1,1,1,44,0)=" .S ^TMP(""PSOPO"",$J,IEN,0)=$E(RN,$L(""QTY DSP MSG: ""_$P(^PSDRUG(PSODRUG(""IEN""),5),""^""))+1,79)_""QTY DSP MSG: ""_$P(^PSDRUG(PSODRUG(""IEN""),5),""^"") K RN"
^XTV(8991,11,1,1,1,45,0)=" S IEN=IEN+1,^TMP(""PSOPO"",$J,IEN,0)=""       Provider ordered ""_+$P(OR0,""^"",11)_"" refills"""
^XTV(8991,11,1,1,1,46,0)=" S IEN=IEN+1,^TMP(""PSOPO"",$J,IEN,0)=""(10)   # of Refills: ""_$S($G(PSONEW(""# OF REFILLS""))]"""":PSONEW(""# OF REFILLS""),1:$P(OR0,""^"",11))_""               (11)   Routing: ""_$S($G(PSONEW(""MAIL/WINDOW""))=""M"":""MAIL"",1:""WINDOW"")"
^XTV(8991,11,1,1,1,47,0)=" S IEN=IEN+1,^TMP(""PSOPO"",$J,IEN,0)=""(12)         Clinic: ""_PSORX(""CLINIC"")"
^XTV(8991,11,1,1,1,48,0)=" S IEN=IEN+1,^TMP(""PSOPO"",$J,IEN,0)=""(13)       Provider: ""_PSONEW(""PROVIDER NAME"")"
^XTV(8991,11,1,1,1,49,0)=" I $P($G(^VA(200,$S($G(PSONEW(""PROVIDER"")):PSONEW(""PROVIDER""),1:$P(OR0,""^"",5)),""PS"")),""^"",7)&($P($G(^(""PS"")),""^"",8)) D"
^XTV(8991,11,1,1,1,50,0)=" .S IEN=IEN+1,PSONEW(""COSIGNING PROVIDER"")=$S($G(PSONEW(""COSIGNING PROVIDER"")):PSONEW(""COSIGNING PROVIDER""),1:$P(^(""PS""),""^"",8))"
^XTV(8991,11,1,1,1,51,0)=" .S ^TMP(""PSOPO"",$J,IEN,0)=""       Cos-Provider: ""_$P(^VA(200,PSONEW(""COSIGNING PROVIDER""),0),""^"")"
^XTV(8991,11,1,1,1,52,0)=" S IEN=IEN+1,^TMP(""PSOPO"",$J,IEN,0)=""(14)         Copies: ""_$S($G(PSONEW(""COPIES"")):PSONEW(""COPIES""),1:1)"
^XTV(8991,11,1,1,1,53,0)=" S PSONEW(""REMARKS"")=$S($G(PSONEW(""REMARKS""))]"""":PSONEW(""REMARKS""),$P(OR0,""^"",17)=""C"":""Administered in Clinic."",1:"""")"
^XTV(8991,11,1,1,1,54,0)=" S IEN=IEN+1,^TMP(""PSOPO"",$J,IEN,0)=""(15)        Remarks:"""
^XTV(8991,11,1,1,1,55,0)=" I $G(PSONEW(""REMARKS""))]"""" D"
^XTV(8991,11,1,1,1,56,0)=" .F SG=1:1:$L(PSONEW(""REMARKS"")) S:$L(^TMP(""PSOPO"",$J,IEN,0)_"" ""_$P(PSONEW(""REMARKS""),"" "",SG))>80 IEN=IEN+1,$P(^TMP(""PSOPO"",$J,IEN,0),"" "",20)="" "" D"
^XTV(8991,11,1,1,1,57,0)=" ..S:$P(PSONEW(""REMARKS""),"" "",SG)'="""" ^TMP(""PSOPO"",$J,IEN,0)=$G(^TMP(""PSOPO"",$J,IEN,0))_"" ""_$P(PSONEW(""REMARKS""),"" "",SG)"
^XTV(8991,11,1,1,1,58,0)=" I $G(PSOSIGFL)!(PSODRUG(""OI"")'=$P(OR0,""^"",8)) S PSONEW(""CLERK CODE"")=DUZ,PSORX(""CLERK CODE"")=$P(^VA(200,DUZ,0),""^""),VALMSG=""This change will create a new prescription!"""
^XTV(8991,11,1,1,1,59,0)=" S $P(RN,"" "",35)="" "",IEN=IEN+1,^TMP(""PSOPO"",$J,IEN,0)=""   Entry By: ""_$P(^VA(200,PSONEW(""CLERK CODE""),0),""^"")_$E(RN,$L($P(^VA(200,PSONEW(""CLERK CODE""),0),""^""))+1,35)"
^XTV(8991,11,1,1,1,60,0)=" S Y=$P(OR0,""^"",12) X ^DD(""DD"") S ^TMP(""PSOPO"",$J,IEN,0)=^TMP(""PSOPO"",$J,IEN,0)_""Entry Date: ""_$E($P(OR0,""^"",12),4,5)_""/""_$E($P(OR0,""^"",12),6,7)_""/""_$E($P(OR0,""^"",12),2,3)_"" ""_$P(Y,""@"",2) K RN"
^XTV(8991,11,1,1,1,61,0)=" I PSOLMC<2 D ^PSOLMPO1 S VALMBCK=""Q"",PSOLMC=0"
^XTV(8991,11,1,1,1,62,0)=" S:PSOLMC>1 VALMBCK=""R"""
^XTV(8991,11,1,1,1,63,0)=" Q"
^XTV(8991,11,1,1,1,64,0)="ORCHK D PROVCOM^PSOORFI4,ORCHK^PSOORFI4"
^XTV(8991,11,1,1,1,65,0)=" Q"
^XTV(8991,11,1,1,1,66,0)="EDT D KV S DIR(""A"",1)=""* Indicates which fields will create an new Order"",DIR(""A"")=""Select Field to Edit by number"",DIR(0)=""LO^1:15"" D ^DIR Q:$D(DTOUT)!($D(DUOUT))"
^XTV(8991,11,1,1,1,67,0)="EDTSEL N LST,FLD,OUT D KV S OUT=0"
^XTV(8991,11,1,1,1,68,0)=" I +Y S LST=Y D FULL^VALM1 N PSODOSE M PSODOSE=PSONEW D  G DSPL"
^XTV(8991,11,1,1,1,69,0)=" .F FLD=1:1:$L(LST,"","") Q:$P(LST,"","",FLD)']""""!(OUT)  D @(+$P(LST,"","",FLD)) D:$P(LST,"","",FLD)=8 REF D KV"
^XTV(8991,11,1,1,1,70,0)=" E  S VALMBCK="""" Q"
^XTV(8991,11,1,1,1,71,0)=" Q"
^XTV(8991,11,1,1,1,72,0)="ACP S (PSODIR(""DFLG""),PSORX(""DFLG""),PSODIR(""QFLD""))=0,ACP=1 D ORCHK"
^XTV(8991,11,1,1,1,73,0)=" G:$G(PSONEW(""QFLG"")) DSPL"
^XTV(8991,11,1,1,1,74,0)=" I $G(PSODIR(""DFLG""))!$G(PSORX(""DFLG"")) Q"
^XTV(8991,11,1,1,1,75,0)=" I $G(PSONEW(""FLD""))!($G(PSODRUG(""NAME""))']"""")!('$O(SIG(0))) G DSPL"
^XTV(8991,11,1,1,1,76,0)=" I $G(PSODRUG(""NAME""))]"""",'$G(ORCHK)!($G(ORDRG)'=PSODRUG(""NAME"")) D  I $G(PSORX(""DFLG"")) D CLEAN^PSOVER1 G DSPL"
^XTV(8991,11,1,1,1,77,0)=" .D POST^PSODRG S:'$G(PSORX(""DFLG"")) ORCHK=1,ORDRG=PSODRUG(""NAME"")"
^XTV(8991,11,1,1,1,78,0)=" I '$D(PSONEW(""RX #"")) S PSOFROM=""NEW"",RTN=$S($P($G(PSOPAR),""^"",7):""AUTO^PSONRXN"",1:""MANUAL^PSONRXN"") D @RTN Q:PSONEW(""QFLG"")  I '$P($G(PSOPAR),""^"",7) S PSOX=PSONEW(""RX #"") D CHECK^PSONRXN"
^XTV(8991,11,1,1,1,79,0)=" D RXNCHK^PSOORNE1 I $G(PSONEW(""QFLG"")) S PSONEW(""DFLG"")=1 Q"
^XTV(8991,11,1,1,1,80,0)=" D STOP^PSONEW2,DISPLAY^PSONEW2,^PSONEWF"
^XTV(8991,11,1,1,1,81,0)=" I $G(PSOCPZ(""DFLG"")) W !!,""No action taken!"",! K DIR S DIR(0)=""E"",DIR(""A"")=""Press Return to continue"" D ^DIR,KV K PSOCPZ(""DFLG""),DRET,PSOANSQD S VALMBCK=""Q"" Q"
^XTV(8991,11,1,1,1,82,0)=" K PSOCPZ(""DFLG"") D KV S DIR(0)=""Y"",DIR(""A"")=""Are you sure you want to Accept this Order"",DIR(""B"")=""NO"" D ^DIR I $D(DIRUT) D KV K DRET,PSOANSQ,PSOANSQD S VALMBCK=""Q"" Q"
^XTV(8991,11,1,1,1,83,0)=" D KV I 'Y K PSOANSQ G DSPL"
^XTV(8991,11,1,1,1,84,0)=" I $G(PSONEW(""MAIL/WINDOW""))[""W"" D:$P($G(PSOPAR),""^"",12)  S BINGCRT=""Y"",BINGRTE=""W"",PSORX(""MAIL/WINDOW"")=""WINDOW"" K RTN"
^XTV(8991,11,1,1,1,85,0)=" .W ! K DIR,DIRUT S DIR(0)=""52,35O"""
^XTV(8991,11,1,1,1,86,0)=" .S:$G(PSORX(""METHOD OF PICK-UP""))]"""" DIR(""B"")=PSORX(""METHOD OF PICK-UP"") D ^DIR I $D(DIRUT) K DIR,DIRUT Q"
^XTV(8991,11,1,1,1,87,0)=" .S (PSONEW(""METHOD OF PICK-UP""),PSORX(""METHOD OF PICK-UP""))=Y K X,Y"
^XTV(8991,11,1,1,1,88,0)=" S PSONEW(""POE"")=1 D EN^PSON52(.PSONEW) G:$G(PSONEW(""DFLG"")) ABORT D DCORD^PSONEW2"
^XTV(8991,11,1,1,1,89,0)=" D NPSOSD^PSOUTIL(.PSONEW),FULL^VALM1 K PSORX(""MAIL/WINDOW"")"
^XTV(8991,11,1,1,1,90,0)=" D EOJ^PSONEW"
^XTV(8991,11,1,1,1,91,0)="ABORT  ;I DUZ(""AG"")[""E"" D LBL^PSOORFIN"
^XTV(8991,11,1,1,1,92,0)=" I DUZ(""AG"")[""E""  D"
^XTV(8991,11,1,1,1,93,0)=" .S RXN=$P(PSORX(""PSOL"",1),"","")"
^XTV(8991,11,1,1,1,94,0)=" .S HRXN=$P(^PSRX(RXN,0),U)"
^XTV(8991,11,1,1,1,95,0)=" .D RX^VEPEPROM(RXN)"
^XTV(8991,11,1,1,1,96,0)=" .S Y=PSOPRDEV,PSOFROM=""NEW"""
^XTV(8991,11,1,1,1,97,0)=" .D:PSOPRDEV=""L"" ^PSORXL"
^XTV(8991,11,1,1,1,98,0)=" .D:PSOPRDEV=""F"" ^VEPERXPR"
^XTV(8991,11,1,1,1,99,0)=" .D:PSOPRDEV=""P"" ^VEPERXPR"
^XTV(8991,11,1,1,1,100,0)=" .D:PSOPRDEV=""E"" ^VEPERXPR"
^XTV(8991,11,1,1,1,101,0)=" .K RXFL"
^XTV(8991,11,1,1,1,102,0)=" .K DIR"
^XTV(8991,11,1,1,1,103,0)=" S VALMBCK=""Q"",DIR(0)=""E"",DIR(""A"")=""Press Return to Continue"" D ^DIR,CLEAN^PSOVER1,KV"
^XTV(8991,11,1,1,1,104,0)=" Q"
^XTV(8991,11,1,1,1,105,0)="KV K DIRUT,DUOUT,DTOUT,DIR"
^XTV(8991,11,1,1,1,106,0)=" Q"
^XTV(8991,11,1,1,1,107,0)="REF Q:$G(PSODRUG(""DEA""))']"""""
^XTV(8991,11,1,1,1,108,0)=" S CS=0 F DEA=1:1 Q:$E(PSODRUG(""DEA""),DEA)=""""  I $E(+PSODRUG(""DEA""),DEA)>1,$E(+PSODRUG(""DEA""),DEA)<6 S CS=1"
^XTV(8991,11,1,1,1,109,0)=" S PTRF=PSONEW(""# OF REFILLS""),PSDAYS=PSONEW(""DAYS SUPPLY"")"
^XTV(8991,11,1,1,1,110,0)=" I CS D"
^XTV(8991,11,1,1,1,111,0)=" .S PSOX1=$S(PTRF>5:5,1:PTRF),PSOX=$S(PSOX1=5:5,1:PSOX1)"
^XTV(8991,11,1,1,1,112,0)=" .S PSOX=$S('PSOX:0,PSDAYS=90:1,1:PSOX),PSDY1=$S(PSDAYS<60:5,PSDAYS'<60&(PSDAYS'>89):2,PSDAYS=90:1,1:0)"
^XTV(8991,11,1,1,1,113,0)=" E  D"
^XTV(8991,11,1,1,1,114,0)=" .S PSOX1=PTRF,PSOX=$S(PSOX1=11:11,1:PSOX1),PSOX=$S('PSOX:0,PSDAYS=90:3,1:PSOX)"
^XTV(8991,11,1,1,1,115,0)=" .S PSDY1=$S(PSDAYS<60:11,PSDAYS'<60&(PSDAYS'>89):5,PSDAYS=90:3,1:0)"
^XTV(8991,11,1,1,1,116,0)=" S PSONEW(""# OF REFILLS"")=$S(PSONEW(""# OF REFILLS"")>PSDY1:PSDY1,1:PSONEW(""# OF REFILLS""))"
^XTV(8991,11,1,1,1,117,0)=" Q"
^XTV(8991,11,1,1,1,118,0)="1 N PSOBDR,PSOBDRG S PSOBDRG=1 D 1^PSOORNW2 Q  ;oi"
^XTV(8991,11,1,1,1,119,0)=" ;"
^XTV(8991,11,1,1,1,120,0)="4 D INS^PSOORNW2 Q"
^XTV(8991,11,1,1,1,121,0)=" ;"
^XTV(8991,11,1,1,1,122,0)="3 D DOSE^PSOORED4(.PSONEW) Q"
^XTV(8991,11,1,1,1,123,0)=" ;"
^XTV(8991,11,1,1,1,124,0)="6 D 4^PSOORNW2 Q  ;idt"
^XTV(8991,11,1,1,1,125,0)=" ;"
^XTV(8991,11,1,1,1,126,0)="7 D 5^PSOORNW2 Q  ;fdt"
^XTV(8991,11,1,1,1,127,0)=" ;"
^XTV(8991,11,1,1,1,128,0)="5 D 3^PSOORNW2 Q  ;pstat"
^XTV(8991,11,1,1,1,129,0)=" ;"
^XTV(8991,11,1,1,1,130,0)="13 D 12^PSOORNW2 Q  ;doc"
^XTV(8991,11,1,1,1,131,0)=" ;"
^XTV(8991,11,1,1,1,132,0)="12 D 11^PSOORNW2 Q  ;cli"
^XTV(8991,11,1,1,1,133,0)=" ;"
^XTV(8991,11,1,1,1,134,0)="2 N PSOCSIG I '$G(PSOBDRG) N PSOBDR,PSOBDRG S PSOBDRG=1"
^XTV(8991,11,1,1,1,135,0)=" D 2^PSOORNW1 Q:$G(PSOQFLG)  ;drg"
^XTV(8991,11,1,1,1,136,0)=" I $G(PSOCSIG) K PSOCSIG G 3"
^XTV(8991,11,1,1,1,137,0)=" Q"
^XTV(8991,11,1,1,1,138,0)=" ;"
^XTV(8991,11,1,1,1,139,0)="9 D 8^PSOORNW2 Q  ;qty"
^XTV(8991,11,1,1,1,140,0)=" ;"
^XTV(8991,11,1,1,1,141,0)="8 D 7^PSOORNW2 Q  ;ds"
^XTV(8991,11,1,1,1,142,0)=" ;"
^XTV(8991,11,1,1,1,143,0)="10 D 9^PSOORNW2 Q  ;#rfs"
^XTV(8991,11,1,1,1,144,0)=" ;"
^XTV(8991,11,1,1,1,145,0)="14 D 13^PSOORNW2 Q  ;cop"
^XTV(8991,11,1,1,1,146,0)=" ;"
^XTV(8991,11,1,1,1,147,0)="11 D 10^PSOORNW2 Q  ;m/w"
^XTV(8991,11,1,1,1,148,0)=" ;"
^XTV(8991,11,1,1,1,149,0)="15 D 14^PSOORNW2 Q  ;rem"
^XTV(8991,11,1,1,1,150,0)=" ;"
^XTV(8991,11,1,1,1,151,0)="DRGMSG ;"
^XTV(8991,11,1,1,1,152,0)=" F SG=1:1:$L($P(^PSDRUG(PSODRUG(""IEN""),0),""^"",10)) S:$L(^TMP(""PSOPO"",$J,IEN,0)_"" ""_$P($P(^PSDRUG(PSODRUG(""IEN""),0),""^"",10),"" "",SG))>80 IEN=IEN+1,$P(^TMP(""PSOPO"",$J,IEN,0),"" "",20)="" "" D"
^XTV(8991,11,1,1,1,153,0)=" .S:$P($P(^PSDRUG(PSODRUG(""IEN""),0),""^"",10),"" "",SG)'="""" ^TMP(""PSOPO"",$J,IEN,0)=$G(^TMP(""PSOPO"",$J,IEN,0))_"" ""_$P($P(^PSDRUG(PSODRUG(""IEN""),0),""^"",10),"" "",SG)"
^XTV(8991,11,1,1,1,154,0)=" K SG Q"
^XTV(8991,11,1,"B",3051210.2014,1)=""
^XTV(8991,12,0)="VEPERVER"
^XTV(8991,12,1,0)="^8991.01^6^6"
^XTV(8991,12,1,1,0)="3061008.0146"
^XTV(8991,12,1,1,1,0)="^8991.11^12^12"
^XTV(8991,12,1,1,1,1,0)=""
^XTV(8991,12,1,1,1,1,"DEL")="VEPERVER ;RED/DAOU ;10/8/06  01:46"
^XTV(8991,12,1,1,1,2,"INS",0)="^8991.12^1^1"
^XTV(8991,12,1,1,1,2,"INS",1,0)="VEPERVER ;RED/DAOU ;11/7/06  16:29"
^XTV(8991,12,1,1,1,9,0)=""
^XTV(8991,12,1,1,1,9,"DEL")=" W "" VOE_2.1.2_Beta """
^XTV(8991,12,1,1,1,10,"INS",0)="^8991.12^1^1"
^XTV(8991,12,1,1,1,10,"INS",1,0)=" W "" VOE_Beta_2.1.4 """
^XTV(8991,12,1,2,0)="3061107.1629"
^XTV(8991,12,1,2,1,0)="^8991.11^12^12"
^XTV(8991,12,1,2,1,1,0)=""
^XTV(8991,12,1,2,1,1,"DEL")="VEPERVER ;RED/DAOU ;11/7/06  16:29"
^XTV(8991,12,1,2,1,2,"INS",0)="^8991.12^1^1"
^XTV(8991,12,1,2,1,2,"INS",1,0)="VEPERVER ;RED/DAOU ;12/25/06  16:58"
^XTV(8991,12,1,2,1,9,0)=""
^XTV(8991,12,1,2,1,9,"DEL")=" W "" VOE_Beta_2.1.4 """
^XTV(8991,12,1,2,1,10,"INS",0)="^8991.12^1^1"
^XTV(8991,12,1,2,1,10,"INS",1,0)=" W "" VOE_Beta_2.1.5 """
^XTV(8991,12,1,3,0)="3061225.1658"
^XTV(8991,12,1,3,1,0)="^8991.11^12^12"
^XTV(8991,12,1,3,1,1,0)=""
^XTV(8991,12,1,3,1,1,"DEL")="VEPERVER ;RED/DAOU ;12/25/06  16:58"
^XTV(8991,12,1,3,1,2,"INS",0)="^8991.12^1^1"
^XTV(8991,12,1,3,1,2,"INS",1,0)="VEPERVER ;RED/DAOU ;1/24/07  21:56"
^XTV(8991,12,1,3,1,9,0)=""
^XTV(8991,12,1,3,1,9,"DEL")=" W "" VOE_Beta_2.1.5 """
^XTV(8991,12,1,3,1,10,"INS",0)="^8991.12^1^1"
^XTV(8991,12,1,3,1,10,"INS",1,0)=" W "" VOE_Beta_2.2.3 """
^XTV(8991,12,1,4,0)="3070124.2156"
^XTV(8991,12,1,4,1,0)="^8991.11^12^12"
^XTV(8991,12,1,4,1,1,0)=""
^XTV(8991,12,1,4,1,1,"DEL")="VEPERVER ;RED/DAOU ;1/24/07  21:56"
^XTV(8991,12,1,4,1,2,"INS",0)="^8991.12^1^1"
^XTV(8991,12,1,4,1,2,"INS",1,0)="VEPERVER ;RED/DAOU ;1/24/07  21:57"
^XTV(8991,12,1,4,1,9,0)=""
^XTV(8991,12,1,4,1,9,"DEL")=" W "" VOE_Beta_2.2.3 """
^XTV(8991,12,1,4,1,10,"INS",0)="^8991.12^1^1"
^XTV(8991,12,1,4,1,10,"INS",1,0)=" W "" VOE_Beta_2.2.2 """
^XTV(8991,12,1,5,0)="3070124.2157"
^XTV(8991,12,1,5,1,0)="^8991.11^12^12"
^XTV(8991,12,1,5,1,1,0)=""
^XTV(8991,12,1,5,1,1,"DEL")="VEPERVER ;RED/DAOU ;1/24/07  21:57"
^XTV(8991,12,1,5,1,2,0)=""
^XTV(8991,12,1,5,1,2,"DEL")=" ; VOE Version display, 1.0.0"
^XTV(8991,12,1,5,1,3,"INS",0)="^8991.12^2^2"
^XTV(8991,12,1,5,1,3,"INS",1,0)="VEPERVER ;RED/DAOU ;1/31/07  15:56"
^XTV(8991,12,1,5,1,3,"INS",2,0)=" ; VOE Version display, 1.0.0;;;;;Build 13"
^XTV(8991,12,1,5,1,9,0)=""
^XTV(8991,12,1,5,1,9,"DEL")=" W "" VOE_Beta_2.2.2 """
^XTV(8991,12,1,5,1,10,"INS",0)="^8991.12^1^1"
^XTV(8991,12,1,5,1,10,"INS",1,0)=" W "" VOE_Beta_2.3.1 """
^XTV(8991,12,1,6,0)="3070131.1556"
^XTV(8991,12,1,6,1,0)="^8991.11^12^12"
^XTV(8991,12,1,6,1,1,0)="VEPERVER ;RED/DAOU ;1/31/07  15:56"
^XTV(8991,12,1,6,1,2,0)=" ; VOE Version display, 1.0.0;;;;;Build 13"
^XTV(8991,12,1,6,1,3,0)=" ;Do not delete!!!"
^XTV(8991,12,1,6,1,4,0)=" ;Updated as baseline for first distribution/CBF"
^XTV(8991,12,1,6,1,5,0)=" ;"
^XTV(8991,12,1,6,1,6,0)="DISP ;"
^XTV(8991,12,1,6,1,7,0)=" N ANS"
^XTV(8991,12,1,6,1,8,0)=" W #!!?33,$C(27),""[33m"",$C(27),""[31m"""
^XTV(8991,12,1,6,1,9,0)=" W "" VOE_Beta_2.3.1 """
^XTV(8991,12,1,6,1,10,0)=" W !!,$C(27),""[0m"",?30,""Press a key to continue"" R ANS#1"
^XTV(8991,12,1,6,1,11,0)=" Q"
^XTV(8991,12,1,6,1,12,0)=" "
^XTV(8991,12,1,"B",3061008.0146,1)=""
^XTV(8991,12,1,"B",3061107.1629,2)=""
^XTV(8991,12,1,"B",3061225.1658,3)=""
^XTV(8991,12,1,"B",3070124.2156,4)=""
^XTV(8991,12,1,"B",3070124.2157,5)=""
^XTV(8991,12,1,"B",3070131.1556,6)=""
^XTV(8991,13,0)="DGREG"
^XTV(8991,13,1,0)="^8991.01^2^2"
^XTV(8991,13,1,1,0)="3061009.2145"
^XTV(8991,13,1,1,1,0)="^8991.11^223^223"
^XTV(8991,13,1,1,1,1,0)=""
^XTV(8991,13,1,1,1,1,"DEL")="DGREG ;ALB/JDS,MRL/PJR/PHH-REGISTER PATIENT ;10/9/06  21:45"
^XTV(8991,13,1,1,1,2,"INS",0)="^8991.12^1^1"
^XTV(8991,13,1,1,1,2,"INS",1,0)="DGREG ;ALB/JDS,MRL/PJR/PHH-REGISTER PATIENT ;10/9/06  21:48"
^XTV(8991,13,1,1,1,38,0)=""
^XTV(8991,13,1,1,1,38,"DEL")=" ; . I DGNEW D NEW^DGRP ; execute new patient DR string"
^XTV(8991,13,1,1,1,47,0)=""
^XTV(8991,13,1,1,1,47,"DEL")=" I $G(DGNEW) D NEW^DGRP"
^XTV(8991,13,1,1,1,51,"INS",0)="^8991.12^2^2"
^XTV(8991,13,1,1,1,51,"INS",1,0)=" I $G(DGNEW) D NEW^DGRP ; execute new patient DR string"
^XTV(8991,13,1,1,1,51,"INS",2,0)=" ;"
^XTV(8991,13,1,2,0)="3061009.2148"
^XTV(8991,13,1,2,1,0)="^8991.11^223^223"
^XTV(8991,13,1,2,1,1,0)="DGREG ;ALB/JDS,MRL/PJR/PHH-REGISTER PATIENT ;10/9/06  21:48"
^XTV(8991,13,1,2,1,2,0)=" ;;5.3;Registration;**1,32,108,147,149,182,245,250,513,425,533,574,563,624,658,634**;Aug 13, 1993"
^XTV(8991,13,1,2,1,3,0)="START ;"
^XTV(8991,13,1,2,1,4,0)="EN D LO^DGUTL S DGCLPR="""""
^XTV(8991,13,1,2,1,5,0)=" N DGDIV"
^XTV(8991,13,1,2,1,6,0)=" S DGDIV=$$PRIM^VASITE"
^XTV(8991,13,1,2,1,7,0)=" S:DGDIV %ZIS(""B"")=$P($G(^DG(40.8,+DGDIV,""DEV"")),U,1)"
^XTV(8991,13,1,2,1,8,0)=" I $P(^DG(43,1,0),U,39) S %ZIS=""NQ"",%ZIS(""A"")=""Select 1010 printer: "" D ^%ZIS Q:POP  S (DGIO(10),DGIO(""PRF""),DGIO(""RT""),DGIO(""HS""))=ION,DGASKDEV="""" I $E(IOST,1,2)'[""P-"" W !,$C(7),""Not a printer"" G DGREG"
^XTV(8991,13,1,2,1,9,0)=" K %ZIS(""B"")"
^XTV(8991,13,1,2,1,10,0)=" I '$D(DGIO),$P(^DG(43,1,0),U,30) S %ZIS=""N"",IOP=""HOME"" D ^%ZIS I $D(IOS),IOS,$D(^%ZIS(1,+IOS,99)),$D(^%ZIS(1,+^(99),0)) S Y=$P(^(0),U,1) W !,""Using closest printer "",Y,! F I=10,""PRF"",""RT"",""HS"" S DGIO(I)=Y"
^XTV(8991,13,1,2,1,11,0)="A D ENDREG($G(DFN))"
^XTV(8991,13,1,2,1,12,0)=" ;"
^XTV(8991,13,1,2,1,13,0)=" ; ** VOE change 1 of 4: DAOU/WCJ 2/1/2005,VA/CJS,WV/TOAD 1/5/2006 **"
^XTV(8991,13,1,2,1,14,0)=" ;"
^XTV(8991,13,1,2,1,15,0)=" ; if not VA agency code, add DIC(""DR"") to default some identifiers and"
^XTV(8991,13,1,2,1,16,0)=" ; skip others also, improve readability"
^XTV(8991,13,1,2,1,17,0)=" ;"
^XTV(8991,13,1,2,1,18,0)=" ; before change:"
^XTV(8991,13,1,2,1,19,0)=" ; W !! S DIC=2,DIC(0)=""ALEQM"",DLAYGO=2 K DIC(""S""),DIC(""B"") D ^DIC K DLAYGO G Q1:Y<0 S (DFN,DA)=+Y,DGNEW=$P(Y,""^"",3) N Y D PAUSE^DG10 D BEGINREG(DFN) I DGNEW D NEW^DGRP"
^XTV(8991,13,1,2,1,20,0)=" ;"
^XTV(8991,13,1,2,1,21,0)=" ; after change:"
^XTV(8991,13,1,2,1,22,0)=" W !!"
^XTV(8991,13,1,2,1,23,0)=" N Y,DGREGY S DGREGY=1 D  I DGREGY<0 G Q1"
^XTV(8991,13,1,2,1,24,0)=" . N DIC S DIC=2 ; Patient file"
^XTV(8991,13,1,2,1,25,0)=" . S DIC(0)=""ALEQM"" ; ask, laygo, echo, question, and multi-index"
^XTV(8991,13,1,2,1,26,0)=" . N DLAYGO S DLAYGO=2 ; override file access by user: allow laygo"
^XTV(8991,13,1,2,1,27,0)=" . I $G(DUZ(""AG""))'=""V"" D  ;adjust identifiers asked for VOE"
^XTV(8991,13,1,2,1,28,0)=" . . S DIC(""DR"")="".02;.03;994;.301///N;391///VISTA OFFICE EHR;1901///N;.09"""
^XTV(8991,13,1,2,1,29,0)=" . ;"
^XTV(8991,13,1,2,1,30,0)=" . D ^DIC ; Select Patient"
^XTV(8991,13,1,2,1,31,0)=" . ;"
^XTV(8991,13,1,2,1,32,0)=" . I Y<0 S DGREGY=-1 Q"
^XTV(8991,13,1,2,1,33,0)=" . K DIC(""DR"")"
^XTV(8991,13,1,2,1,34,0)=" . S (DFN,DA)=+Y"
^XTV(8991,13,1,2,1,35,0)=" . S DGNEW=$P(Y,""^"",3) ; new patient?"
^XTV(8991,13,1,2,1,36,0)=" . N Y D PAUSE^DG10 ; prompt user before continuing"
^XTV(8991,13,1,2,1,37,0)=" . D BEGINREG(DFN) ; lock patient record"
^XTV(8991,13,1,2,1,38,0)=" ;"
^XTV(8991,13,1,2,1,39,0)=" ; ** end of VOE change 1 **"
^XTV(8991,13,1,2,1,40,0)=" ;"
^XTV(8991,13,1,2,1,41,0)=" ;; ask to continue if patient died - DG*5.3*563 - pjr 10/12/04"
^XTV(8991,13,1,2,1,42,0)=" S DOD="""" I $G(DFN) S DOD=$P($G(^DPT(DFN,.35)),""^"",1)"
^XTV(8991,13,1,2,1,43,0)=" I DOD S Y=DOD,DGPME=0 D DIED^DGPMV I DGPME K DFN,DGRPOUT G A"
^XTV(8991,13,1,2,1,44,0)=" ;"
^XTV(8991,13,1,2,1,45,0)=" D CIRN"
^XTV(8991,13,1,2,1,46,0)=" ;"
^XTV(8991,13,1,2,1,47,0)=" ; ** VOE change 2 of 4: DAOU/WCJ 2/1/2005,VA/CJS,WV/TOAD 1/5/2006 **"
^XTV(8991,13,1,2,1,48,0)=" ;"
^XTV(8991,13,1,2,1,49,0)=" I $G(DGNEW) D NEW^DGRP ; execute new patient DR string"
^XTV(8991,13,1,2,1,50,0)=" ;"
^XTV(8991,13,1,2,1,51,0)=" ; send CMOR query and display results only if VA agency code"
^XTV(8991,13,1,2,1,52,0)=" ;"
^XTV(8991,13,1,2,1,53,0)=" ; before change:"
^XTV(8991,13,1,2,1,54,0)=" ; I +$G(DGNEW) D"
^XTV(8991,13,1,2,1,55,0)=" ;"
^XTV(8991,13,1,2,1,56,0)=" ; after change:"
^XTV(8991,13,1,2,1,57,0)=" I $G(DGNEW),$G(DUZ(""AG""))=""V"" D"
^XTV(8991,13,1,2,1,58,0)=" . ;"
^XTV(8991,13,1,2,1,59,0)=" . ; end of change"
^XTV(8991,13,1,2,1,60,0)=" . ;"
^XTV(8991,13,1,2,1,61,0)=" . ; query CMOR for Patient Record Flag Assignments if NEW patient and"
^XTV(8991,13,1,2,1,62,0)=" . ; display results."
^XTV(8991,13,1,2,1,63,0)=" . I $$PRFQRY^DGPFAPI(DFN) D DISPPRF^DGPFAPI(DFN)"
^XTV(8991,13,1,2,1,64,0)=" ;"
^XTV(8991,13,1,2,1,65,0)=" ; before change:"
^XTV(8991,13,1,2,1,66,0)=" ; D ROMQRY"
^XTV(8991,13,1,2,1,67,0)=" ;"
^XTV(8991,13,1,2,1,68,0)=" ; after change:"
^XTV(8991,13,1,2,1,69,0)=" I $G(DUZ(""AG""))=""V"" D ROMQRY"
^XTV(8991,13,1,2,1,70,0)=" ;"
^XTV(8991,13,1,2,1,71,0)=" ; ** end of VOE change 2 **"
^XTV(8991,13,1,2,1,72,0)=" ;"
^XTV(8991,13,1,2,1,73,0)=" S (DGFC,CURR)=0"
^XTV(8991,13,1,2,1,74,0)=" D:'$G(DGNEW) WARN S DA=DFN,DGFC=""^1"",VET=$S($D(^DPT(DFN,""VET"")):^(""VET"")'=""Y"",1:0)"
^XTV(8991,13,1,2,1,75,0)=" S %ZIS=""N"",IOP=""HOME"" D ^%ZIS S DGELVER=0 D EN^DGRPD I $D(DGRPOUT) D ENDREG($G(DFN)) D HL7A08^VAFCDD01 K DFN,DGRPOUT G A"
^XTV(8991,13,1,2,1,76,0)=" D HINQ^DG10"
^XTV(8991,13,1,2,1,77,0)=" I $D(^DIC(195.4,1,""UP"")) I ^(""UP"") D ADM^RTQ3"
^XTV(8991,13,1,2,1,78,0)=" ;"
^XTV(8991,13,1,2,1,79,0)=" ; ** VOE change 3 of 4: DAOU/WCJ 2/1/2005,VA/CJS,WV/TOAD 1/5/2006 **"
^XTV(8991,13,1,2,1,80,0)=" ;"
^XTV(8991,13,1,2,1,81,0)=" ; send financial query only for VA agency code"
^XTV(8991,13,1,2,1,82,0)=" ;"
^XTV(8991,13,1,2,1,83,0)=" ; before change:"
^XTV(8991,13,1,2,1,84,0)=" ; D REG^IVMCQ($G(DFN))  ; send financial query"
^XTV(8991,13,1,2,1,85,0)=" ;"
^XTV(8991,13,1,2,1,86,0)=" ; after change:"
^XTV(8991,13,1,2,1,87,0)=" I $G(DUZ(""AG""))=""V"" D REG^IVMCQ($G(DFN)) ; send financial query"
^XTV(8991,13,1,2,1,88,0)=" ;"
^XTV(8991,13,1,2,1,89,0)=" ; ** end of VOE change 3 **"
^XTV(8991,13,1,2,1,90,0)=" ;"
^XTV(8991,13,1,2,1,91,0)=" G A1"
^XTV(8991,13,1,2,1,92,0)=" ;"
^XTV(8991,13,1,2,1,93,0)="RT I $D(^DIC(195.4,1,""UP"")) I ^(""UP"") S $P(DGFC,U,1)=DIV D ADM^RTQ3"
^XTV(8991,13,1,2,1,94,0)=" Q"
^XTV(8991,13,1,2,1,95,0)=" ;"
^XTV(8991,13,1,2,1,96,0)="A1 W !,""Do you want to "",$S(DGNEW:""enter"",1:""edit""),"" Patient Data"" S %=1 D YN^DICN D  G H:'%,CK:%'=1 S DGRPV=0 D EN1^DGRP G Q:'$D(DA)"
^XTV(8991,13,1,2,1,97,0)=" .I +$G(DGNEW) Q"
^XTV(8991,13,1,2,1,98,0)=" .I $$ADD^DGADDUTL($G(DFN)) ;"
^XTV(8991,13,1,2,1,99,0)=" G CH"
^XTV(8991,13,1,2,1,100,0)="PR W !!,""Is the patient currently being followed in a clinic for the same condition"" S %=0 D YN^DICN G Q:%=-1"
^XTV(8991,13,1,2,1,101,0)=" I '% W !?4,$C(7),""Enter 'Y' if the patient is being followed in clinic for condition for which"",!?6,""registered, 'N' if not."" G PR"
^XTV(8991,13,1,2,1,102,0)=" S CURR=% G SEEN"
^XTV(8991,13,1,2,1,103,0)=" ;"
^XTV(8991,13,1,2,1,104,0)="CK S DGEDCN=1 D ^DGRPC"
^XTV(8991,13,1,2,1,105,0)="CH S X=$S('$D(^DPT(DFN,.36)):1,$P(^(.36),""^"",1)']"""":1,1:0),X1=$S('$D(^DPT(DFN,.32)):1,$P(^(.32),""^"",3)']"""":1,1:0) I 'X,'X1 G CH1"
^XTV(8991,13,1,2,1,106,0)="CH1 S DA=DFN G PR:'$D(^DPT(""ADA"",1,DA)) W !!,""There is still an open disposition--register aborted."",$C(7),$C(7) G Q"
^XTV(8991,13,1,2,1,107,0)="SEEN W !!,""Is the patient to be examined in the medical center today"" S %=1 D YN^DICN S SEEN=% G:%<0 Q I %'>0 W !!,""Enter 'Y' if the patient is to be examined today, 'N' if not."",$C(7) G SEEN"
^XTV(8991,13,1,2,1,108,0)="ABIL D ^DGREGG"
^XTV(8991,13,1,2,1,109,0)="ENR ; next line appears to be dead code.  left commented just to test.  mli 4/28/94"
^XTV(8991,13,1,2,1,110,0)=" ;S DE=0 F I=0:0 S I=$O(^DPT(DA,""DE"",I)) Q:'I  I $P(^(I,0),""^"",3)'?7N Q  D PR:'DE S L=+$P($S($D(^SC(L,0)):^(0),1:""""),""^"",1)"
^XTV(8991,13,1,2,1,111,0)="REG S (DIE,DIC)=""^DPT(""_DFN_"",""""DIS"""","",%DT=""PTEX"",%DT(""A"")=""Registration login date/time: NOW// """
^XTV(8991,13,1,2,1,112,0)=" W !,%DT(""A"") R ANS:DTIME S:'$T ANS=""^"" S:ANS="""" ANS=""N"" S X=ANS G Q:ANS=""^"" S DA(1)=DFN D CHK^DIE(2.101,.01,""E"",X,.RESULT) G REG:RESULT=""^""!('$D(RESULT)),PR3:'(RESULT#1) S Y=RESULT"
^XTV(8991,13,1,2,1,113,0)=" I (RESULT'=""^"") W ""  (""_RESULT(0)_"")"""
^XTV(8991,13,1,2,1,114,0)=" S DINUM=9999999-RESULT"
^XTV(8991,13,1,2,1,115,0)=" S (DFN1,Y1)=DINUM,APD=Y I $D(^DPT(DFN,""DIS"",Y1)) W !!,""You must enter a date that does not exist."",$C(7),$C(7) G REG"
^XTV(8991,13,1,2,1,116,0)=" G:$D(^DPT(""ADA"",1,DA)) CH1 L @(DIE_DINUM_"")""):2 G:'$T MSG S:'($D(^DPT(DA(1),""DIS"",0))#2) ^(0)=""^2.101D^^"" S DIC(0)=""L"",X=+Y D ^DIC"
^XTV(8991,13,1,2,1,117,0)=" ;"
^XTV(8991,13,1,2,1,118,0)=" ;SAVE OFF DATE/TIME OF REGISTRATION FOR HL7 V2.3 MESSAGING, IN VAFCDDT"
^XTV(8991,13,1,2,1,119,0)=" S VAFCDDT=X"
^XTV(8991,13,1,2,1,120,0)=" ;"
^XTV(8991,13,1,2,1,121,0)=" S DA=DFN1,DIE(""NO^"")="""",DA(1)=DFN,DP=2.101,DR=""1///""_$S(SEEN=2:2,CURR=1:1,1:0)_"";Q;2""_$S(CURR=1:""///3"",1:"""")_"";2.1;3//""_$S($P(^DG(43,1,""GL""),""^"",2):"""",1:""/"")_$S($D(^DG(40.8,+$P(^DG(43,1,""GL""),""^"",3),0)):$P(^(0),""^"",1),1:"""")_"";4////""_DUZ"
^XTV(8991,13,1,2,1,122,0)=" ;"
^XTV(8991,13,1,2,1,123,0)=" ; ** VOE change 4 of 4: DAOU/JLG 2/7/2005,VA/CJS,WV/TOAD 1/5/2006 **"
^XTV(8991,13,1,2,1,124,0)=" ;"
^XTV(8991,13,1,2,1,125,0)=" ; for VOE or IHS agency codes, add the following:"
^XTV(8991,13,1,2,1,126,0)=" ; force TYPE OF CARE with ALL OTHER"
^XTV(8991,13,1,2,1,127,0)=" ;"
^XTV(8991,13,1,2,1,128,0)=" I $G(DUZ(""AG""))=""E""!($G(DUZ(""AG""))=""I"") D"
^XTV(8991,13,1,2,1,129,0)=" . S DR=""1///""_$S(SEEN=2:2,CURR=1:1,1:0)_"";Q;2""_$S(CURR=1:""///3"",1:"""")_"";2.1///5;3//""_$S($P(^DG(43,1,""GL""),""^"",2):"""",1:""/"")_$S($D(^DG(40.8,+$P(^DG(43,1,""GL""),""^"",3),0)):$P(^(0),""^"",1),1:"""")_"";4////""_DUZ"
^XTV(8991,13,1,2,1,130,0)=" ;"
^XTV(8991,13,1,2,1,131,0)=" ; ** end of VOE change 4 **"
^XTV(8991,13,1,2,1,132,0)=" ;"
^XTV(8991,13,1,2,1,133,0)=" D EL K DIC(""A"") N DGNDLOCK S DGNDLOCK=DIE_DFN1_"")"" L +@DGNDLOCK:2 G:'$T MSG D ^DIE L -@DGNDLOCK"
^XTV(8991,13,1,2,1,134,0)=" I $D(DTOUT) D  G Q"
^XTV(8991,13,1,2,1,135,0)=" .K DTOUT"
^XTV(8991,13,1,2,1,136,0)=" .N DA,DIK"
^XTV(8991,13,1,2,1,137,0)=" .S DA(1)=DFN,DA=DFN1,DIK=""^DPT(""_DFN_"",""""DIS"""","""
^XTV(8991,13,1,2,1,138,0)=" .D ^DIK"
^XTV(8991,13,1,2,1,139,0)=" .W !!?5,""User Time-out.  Required registration data could be missing."""
^XTV(8991,13,1,2,1,140,0)=" .W !,?5,""This registration has been deleted."""
^XTV(8991,13,1,2,1,141,0)=" ; check whether facility applying to (division) is inactive"
^XTV(8991,13,1,2,1,142,0)=" I '$$DIVCHK^DGREGFAC(DFN,DFN1) G CONT"
^XTV(8991,13,1,2,1,143,0)="ASKDIV W !!?5,""The facility chosen either has no pointer to an Institution"""
^XTV(8991,13,1,2,1,144,0)=" W !?5,""file record or the Institution file record is inactive."""
^XTV(8991,13,1,2,1,145,0)=" W !?5,""Please choose another division."""
^XTV(8991,13,1,2,1,146,0)=" S DA=DFN1,DIE(""NO^"")="""",DA(1)=DFN,DP=2.101,DR=""3"" D ^DIE"
^XTV(8991,13,1,2,1,147,0)=" I $$DIVCHK^DGREGFAC(DFN,DFN1) G ASKDIV"
^XTV(8991,13,1,2,1,148,0)="CONT ; continue"
^XTV(8991,13,1,2,1,149,0)=" S DGXXXD=1 D EL^DGREGE I $P(^DPT(DFN,""DIS"",DFN1,0),""^"",3)=4 S DA=DFN,DIE=""^DPT("",DR="".368;.369"" D ^DIE S DIE=""^DPT(""_DFN_"",""""DIS"""","",DA(1)=DFN,DA=DFN1"
^XTV(8991,13,1,2,1,150,0)=" S DA=DFN,DR=""[DGREG]"",DIE=""^DPT("" D ^DIE K DIE(""NO^"")"
^XTV(8991,13,1,2,1,151,0)=" I $D(^DPT(DFN,""DIS"",DFN1,2)),$P(^(2),""^"",1)=""Y"" S DIE=""^DPT("",DR=""[DG EMPLOYER]"",DA=DFN D ^DIE"
^XTV(8991,13,1,2,1,152,0)=" G ^DGREG0"
^XTV(8991,13,1,2,1,153,0)="PR2 W !!,""You can only enter new registrations through this option."",$C(7),$C(7) G REG"
^XTV(8991,13,1,2,1,154,0)="PR3 W !!,""Time is required to register the patient."",!!,$C(7),$C(7) G REG"
^XTV(8991,13,1,2,1,155,0)="H W !?5,""Enter 'YES' to enter/edit registration data or 'NO' to continue."" G A1"
^XTV(8991,13,1,2,1,156,0)="Q K DG,DQ G Q1^DGREG0"
^XTV(8991,13,1,2,1,157,0)="Q1 K DGIO,DGASKDEV,DGFC,DGCLRP,CURR,DGELVER,DGNEW Q"
^XTV(8991,13,1,2,1,158,0)="EL S DR=DR_"";13//"" I $D(^DPT(DFN,.36)),$D(^DIC(8,+^(.36),0)) S DR=DR_$P(^(0),""^"",1) Q"
^XTV(8991,13,1,2,1,159,0)=" S DR=DR_""HUMANITARIAN EMERGENCY"" Q"
^XTV(8991,13,1,2,1,160,0)="FEE S DGRPFEE=1 D DGREG K DGRPFEE G Q1"
^XTV(8991,13,1,2,1,161,0)=" ;"
^XTV(8991,13,1,2,1,162,0)="WARN I $S('$D(^DPT(DFN,.1)):0,$P(^(.1),""^"",1)']"""":0,1:1) W !,$C(7),""***PATIENT IS CURRENTLY AN INPATIENT***"",! H 2"
^XTV(8991,13,1,2,1,163,0)=" I $S('$D(^DPT(DFN,.107)):0,$P(^(.107),""^"",1)']"""":0,1:1) W !,$C(7),""***PATIENT IS CURRENTLY A LODGER***"",! H 2"
^XTV(8991,13,1,2,1,164,0)=" Q"
^XTV(8991,13,1,2,1,165,0)="MSG W !,""Another user is editing, try later ..."" G Q"
^XTV(8991,13,1,2,1,166,0)=" ;"
^XTV(8991,13,1,2,1,167,0)="BEGINREG(DFN) ;"
^XTV(8991,13,1,2,1,168,0)=" ;Description: This is called at the beginning of the registration process."
^XTV(8991,13,1,2,1,169,0)=" ;Concurrent processes can check the lock to determine if the patient is"
^XTV(8991,13,1,2,1,170,0)=" ;currently being registered."
^XTV(8991,13,1,2,1,171,0)=" ;"
^XTV(8991,13,1,2,1,172,0)=" Q:'$G(DFN) 0"
^XTV(8991,13,1,2,1,173,0)=" I $$QRY^DGENQRY(DFN) W !!,""Enrollment/Eligibility Query sent ..."",!!"
^XTV(8991,13,1,2,1,174,0)=" L +^TMP(DFN,""REGISTRATION IN PROGRESS""):1"
^XTV(8991,13,1,2,1,175,0)=" I $$LOCK^DGENPTA1(DFN) ;try to lock the patient record"
^XTV(8991,13,1,2,1,176,0)=" Q"
^XTV(8991,13,1,2,1,177,0)=" ;"
^XTV(8991,13,1,2,1,178,0)="ENDREG(DFN) ;"
^XTV(8991,13,1,2,1,179,0)=" ;Description: releases the lock obtained by calling BEGINREG."
^XTV(8991,13,1,2,1,180,0)=" ;"
^XTV(8991,13,1,2,1,181,0)=" Q:'$G(DFN)"
^XTV(8991,13,1,2,1,182,0)=" L -^TMP(DFN,""REGISTRATION IN PROGRESS"")"
^XTV(8991,13,1,2,1,183,0)=" D UNLOCK^DGENPTA1(DFN)"
^XTV(8991,13,1,2,1,184,0)=" Q"
^XTV(8991,13,1,2,1,185,0)=" ;"
^XTV(8991,13,1,2,1,186,0)="IFREG(DFN) ;"
^XTV(8991,13,1,2,1,187,0)=" ;Description: tests whether the lock set by BEGINREG is set"
^XTV(8991,13,1,2,1,188,0)=" ;"
^XTV(8991,13,1,2,1,189,0)=" ;Input:  DFN"
^XTV(8991,13,1,2,1,190,0)=" ;Output:"
^XTV(8991,13,1,2,1,191,0)=" ;      Function Value = 1 if lock is set, 0 otherwise"
^XTV(8991,13,1,2,1,192,0)=" ;"
^XTV(8991,13,1,2,1,193,0)=" N RETURN"
^XTV(8991,13,1,2,1,194,0)=" Q:'$G(DFN) 0"
^XTV(8991,13,1,2,1,195,0)=" L +^TMP(DFN,""REGISTRATION IN PROGRESS""):1"
^XTV(8991,13,1,2,1,196,0)=" S RETURN='$T"
^XTV(8991,13,1,2,1,197,0)=" L -^TMP(DFN,""REGISTRATION IN PROGRESS"")"
^XTV(8991,13,1,2,1,198,0)=" Q RETURN"
^XTV(8991,13,1,2,1,199,0)=" Q"
^XTV(8991,13,1,2,1,200,0)="CIRN ;MPI QUERY"
^XTV(8991,13,1,2,1,201,0)=" ;check to see if CIRN PD/MPI is installed"
^XTV(8991,13,1,2,1,202,0)=" N X S X=""MPIFAPI"" X ^%ZOSF(""TEST"") Q:'$T"
^XTV(8991,13,1,2,1,203,0)=" K MPIFRTN"
^XTV(8991,13,1,2,1,204,0)=" D MPIQ^MPIFAPI(DFN)"
^XTV(8991,13,1,2,1,205,0)=" K MPIFRTN"
^XTV(8991,13,1,2,1,206,0)=" Q"
^XTV(8991,13,1,2,1,207,0)="ROMQRY ;"
^XTV(8991,13,1,2,1,208,0)=" I +$G(DGNEW) D"
^XTV(8991,13,1,2,1,209,0)=" . ; query LST for Patient Demographic Information if NEW patient and"
^XTV(8991,13,1,2,1,210,0)=" . ; file into patient's record."
^XTV(8991,13,1,2,1,211,0)=" . N A"
^XTV(8991,13,1,2,1,212,0)=" . I $$ROMQRY^DGROAPI(DFN) D"
^XTV(8991,13,1,2,1,213,0)=" . . ;display busy message to interactive users"
^XTV(8991,13,1,2,1,214,0)=" . .S DGMSG(1)=""Data retrieval from LST site has been completed successfully"""
^XTV(8991,13,1,2,1,215,0)=" . .S DGMSG(2)=""Thank you for your patience."""
^XTV(8991,13,1,2,1,216,0)=" . .D EN^DDIOL(.DGMSG) R A:5"
^XTV(8991,13,1,2,1,217,0)=" . E  D"
^XTV(8991,13,1,2,1,218,0)=" . . ;display busy message to interactive users"
^XTV(8991,13,1,2,1,219,0)=" . .S DGMSG(1)=""Data retrieval from LST site has not been successful."""
^XTV(8991,13,1,2,1,220,0)=" . .S DGMSG(2)=""Please continue the Registration Process."""
^XTV(8991,13,1,2,1,221,0)=" . .D EN^DDIOL(.DGMSG) R A:5"
^XTV(8991,13,1,2,1,222,0)=" . ;"
^XTV(8991,13,1,2,1,223,0)=" Q"
^XTV(8991,13,1,"B",3061009.2145,1)=""
^XTV(8991,13,1,"B",3061009.2148,2)=""
^XTV(8991,14,0)="MPIFQ0"
^XTV(8991,14,1,0)="^8991.01^5^5"
^XTV(8991,14,1,1,0)="3061009.2252"
^XTV(8991,14,1,1,1,0)="^8991.11^195^195"
^XTV(8991,14,1,1,1,1,0)=""
^XTV(8991,14,1,1,1,1,"DEL")="MPIFQ0 ;ALB/RJS-QUERY HANDLER TOP LEVEL ;10/9/06  22:52"
^XTV(8991,14,1,1,1,2,"INS",0)="^8991.12^1^1"
^XTV(8991,14,1,1,1,2,"INS",1,0)="MPIFQ0 ;ALB/RJS-QUERY HANDLER TOP LEVEL ;10/10/06  08:49"
^XTV(8991,14,1,1,1,36,0)=""
^XTV(8991,14,1,1,1,36,"DEL")=" I $G(DUZ(""AG""))=""E"" G END   ;DAOU/WCJ"
^XTV(8991,14,1,1,1,37,"INS",0)="^8991.12^1^1"
^XTV(8991,14,1,1,1,37,"INS",1,0)=" I '($G(DUZ(""AG""))=""V""!($$GET^XPAR(""SYS"",""DG MPI"")=""YES"")) G END ;DAOU/WCJ;WV/CJS"
^XTV(8991,14,1,2,0)="3061010.0849"
^XTV(8991,14,1,2,1,0)="^8991.11^195^195"
^XTV(8991,14,1,2,1,1,0)=""
^XTV(8991,14,1,2,1,1,"DEL")="MPIFQ0 ;ALB/RJS-QUERY HANDLER TOP LEVEL ;10/10/06  08:49"
^XTV(8991,14,1,2,1,2,"INS",0)="^8991.12^1^1"
^XTV(8991,14,1,2,1,2,"INS",1,0)="MPIFQ0 ;ALB/RJS-QUERY HANDLER TOP LEVEL ;10/10/06  15:52"
^XTV(8991,14,1,2,1,4,0)=""
^XTV(8991,14,1,2,1,4,"DEL")=" ; Integration Agreements utilized:"
^XTV(8991,14,1,2,1,5,"INS",0)="^8991.12^1^1"
^XTV(8991,14,1,2,1,5,"INS",1,0)=" ; IA utilized:"
^XTV(8991,14,1,2,1,25,0)=""
^XTV(8991,14,1,2,1,25,"DEL")=" ;MPIQRYNM=""VTQ_PID_ICN_NO_LOAD"" **43 CHANGING QUERY NAME"
^XTV(8991,14,1,2,1,26,"INS",0)="^8991.12^1^1"
^XTV(8991,14,1,2,1,26,"INS",1,0)=" ;MPIQRYNM=""VTQ_PID_ICN_NO_LOAD"" CHANGING QUERY NAME"
^XTV(8991,14,1,2,1,31,0)=""
^XTV(8991,14,1,2,1,31,"DEL")=" ;S MPIQRYNM=""VTQ_PID_ICN_NO_LOAD"" **43 CHANGING QUERY NAME"
^XTV(8991,14,1,2,1,32,"INS",0)="^8991.12^1^1"
^XTV(8991,14,1,2,1,32,"INS",1,0)=" ;S MPIQRYNM=""VTQ_PID_ICN_NO_LOAD"" CHANGING QUERY NAME"
^XTV(8991,14,1,2,1,75,0)=""
^XTV(8991,14,1,2,1,75,"DEL")=" .;**43 log potential match exception if exist"
^XTV(8991,14,1,2,1,76,"INS",0)="^8991.12^1^1"
^XTV(8991,14,1,2,1,76,"INS",1,0)=" .; log potential match exception if exist"
^XTV(8991,14,1,2,1,81,0)=""
^XTV(8991,14,1,2,1,81,"DEL")=" .;**43 Removed &(TSSN=SSN) from line above as there will only be an exact match returned now"
^XTV(8991,14,1,2,1,82,"INS",0)="^8991.12^1^1"
^XTV(8991,14,1,2,1,82,"INS",1,0)=" .; Removed &(TSSN=SSN) from line above as there will only be an exact match returned now"
^XTV(8991,14,1,2,1,138,0)=""
^XTV(8991,14,1,2,1,138,"DEL")=" ; Added for patch 31, create treating facility list"
^XTV(8991,14,1,2,1,139,"INS",0)="^8991.12^1^1"
^XTV(8991,14,1,2,1,139,"INS",1,0)=" ; create treating facility list"
^XTV(8991,14,1,2,1,170,0)=""
^XTV(8991,14,1,2,1,170,"DEL")="QAK ;**43 added check for potential matches"
^XTV(8991,14,1,2,1,171,"INS",0)="^8991.12^1^1"
^XTV(8991,14,1,2,1,171,"INS",1,0)="QAK ; check for potential matches"
^XTV(8991,14,1,3,0)="3061010.1552"
^XTV(8991,14,1,3,1,0)="^8991.11^195^195"
^XTV(8991,14,1,3,1,1,0)=""
^XTV(8991,14,1,3,1,1,"DEL")="MPIFQ0 ;ALB/RJS-QUERY HANDLER TOP LEVEL ;10/10/06  15:52"
^XTV(8991,14,1,3,1,2,"INS",0)="^8991.12^1^1"
^XTV(8991,14,1,3,1,2,"INS",1,0)="MPIFQ0 ;ALB/RJS-QUERY HANDLER TOP LEVEL ;10/10/06  15:55"
^XTV(8991,14,1,3,1,81,0)=""
^XTV(8991,14,1,3,1,81,"DEL")=" .; Removed &(TSSN=SSN) from line above as there will only be an exact match returned now"
^XTV(8991,14,1,3,1,82,"INS",0)="^8991.12^1^1"
^XTV(8991,14,1,3,1,82,"INS",1,0)=" .; Removed &(TSSN=SSN) from line above, only be an exact match returned now"
^XTV(8991,14,1,3,1,170,0)=""
^XTV(8991,14,1,3,1,170,"DEL")="QAK ; check for potential matches"
^XTV(8991,14,1,3,1,171,"INS",0)="^8991.12^1^1"
^XTV(8991,14,1,3,1,171,"INS",1,0)="QAK ; check potential matches"
^XTV(8991,14,1,3,1,195,0)=""
^XTV(8991,14,1,3,1,195,"DEL")=" Q"
^XTV(8991,14,1,4,0)="3061010.1555"
^XTV(8991,14,1,4,1,0)="^8991.11^194^194"
^XTV(8991,14,1,4,1,1,0)=""
^XTV(8991,14,1,4,1,1,"DEL")="MPIFQ0 ;ALB/RJS-QUERY HANDLER TOP LEVEL ;10/10/06  15:55"
^XTV(8991,14,1,4,1,2,0)=""
^XTV(8991,14,1,4,1,2,"DEL")=" ;;1.0; MASTER PATIENT INDEX VISTA ;**1,3,8,14,13,16,17,21,20,24,26,28,31,33,35,38,43**;30 Apr 99"
^XTV(8991,14,1,4,1,3,"INS",0)="^8991.12^2^2"
^XTV(8991,14,1,4,1,3,"INS",1,0)="MPIFQ0 ;ALB/RJS-QUERY HANDLER TOP LEVEL ;10/10/06  18:52"
^XTV(8991,14,1,4,1,3,"INS",2,0)=" ;;1.0; MASTER PATIENT INDEX VISTA ;**1,3,8,14,13,16,17,21,20,24,26,28,31,33,35,38,43,40**;30 Apr 99"
^XTV(8991,14,1,5,0)="3061010.1852"
^XTV(8991,14,1,5,1,0)="^8991.11^194^194"
^XTV(8991,14,1,5,1,1,0)="MPIFQ0 ;ALB/RJS-QUERY HANDLER TOP LEVEL ;10/10/06  18:52"
^XTV(8991,14,1,5,1,2,0)=" ;;1.0; MASTER PATIENT INDEX VISTA ;**1,3,8,14,13,16,17,21,20,24,26,28,31,33,35,38,43,40**;30 Apr 99"
^XTV(8991,14,1,5,1,3,0)=" ;"
^XTV(8991,14,1,5,1,4,0)=" ; IA utilized:"
^XTV(8991,14,1,5,1,5,0)=" ;  EXC, START and STOP^RGHLLOG - #2796"
^XTV(8991,14,1,5,1,6,0)=" ;  FILE^VAFCTFU - #2988"
^XTV(8991,14,1,5,1,7,0)=" ;  $$EN^HLCSAC - #3471"
^XTV(8991,14,1,5,1,8,0)=" ;  NAME^VAFCPID2 - #3492"
^XTV(8991,14,1,5,1,9,0)=" ;"
^XTV(8991,14,1,5,1,10,0)="INTACTV ;Interactive standalone query"
^XTV(8991,14,1,5,1,11,0)=" N DFN,NAME1,MPIFLL"
^XTV(8991,14,1,5,1,12,0)=" K DTOUT,DUOUT,X,Y,DIC"
^XTV(8991,14,1,5,1,13,0)=" S MPIFRES="""",MPIFINT="""",DIC=""^DPT("",DIC(0)=""AEMQ"" D ^DIC"
^XTV(8991,14,1,5,1,14,0)=" I ($D(DTOUT))!($D(DUOUT))!((+$G(Y))<0) W:'$D(MPIFRPC) !,""TRY AGAIN LATER"" G END"
^XTV(8991,14,1,5,1,15,0)=" S DFN=+Y,HLP(""ACKTIME"")=300"
^XTV(8991,14,1,5,1,16,0)=" W:'$D(MPIFRPC) !"
^XTV(8991,14,1,5,1,17,0)="CIRNEXC ; Exception Entry Point"
^XTV(8991,14,1,5,1,18,0)=" I +$$GETICN^MPIF001(DFN)>0,$$IFLOCAL^MPIF001(DFN)'=1 W:'$D(MPIFRPC) !,""Patient already has an ICN"" G END"
^XTV(8991,14,1,5,1,19,0)=" N LOCDATA ;Data Returned from GETDATA in ICN array"
^XTV(8991,14,1,5,1,20,0)=" D GETDATA(""^DPT("",DFN,""LOCDATA"","".01;.02;.03;.09;.301;391;1901"")"
^XTV(8991,14,1,5,1,21,0)=" S LOCDATA(2,DFN,991.01)=$P($$MPINODE^MPIFAPI(DFN),""^""),TSSN=LOCDATA(2,DFN,.09)"
^XTV(8991,14,1,5,1,22,0)=" I $$IFLOCAL^MPIF001(DFN)=1 S MPIFLL="""""
^XTV(8991,14,1,5,1,23,0)=" I $G(LOCDATA(2,DFN,991.01))>0&('$D(MPIFLL)) W:'$D(MPIFRPC) !,""Patient already has an ICN"" G END"
^XTV(8991,14,1,5,1,24,0)=" S HLP(""ACKTIME"")=300,MPIQRYNM=""EXACT_MATCH_QUERY"""
^XTV(8991,14,1,5,1,25,0)=" ;MPIQRYNM=""VTQ_PID_ICN_NO_LOAD"" CHANGING QUERY NAME"
^XTV(8991,14,1,5,1,26,0)=" G JUMP"
^XTV(8991,14,1,5,1,27,0)="VTQ G:$G(DFN)']"""" END"
^XTV(8991,14,1,5,1,28,0)=" N LOCDATA ;Data Returned from GETDATA in ICN array"
^XTV(8991,14,1,5,1,29,0)=" D GETDATA(""^DPT("",DFN,""LOCDATA"","".01;.02;.03;.09;.301;391;1901"")"
^XTV(8991,14,1,5,1,30,0)=" S LOCDATA(2,DFN,991.01)=$P($$MPINODE^MPIFAPI(DFN),""^""),TSSN=LOCDATA(2,DFN,.09)"
^XTV(8991,14,1,5,1,31,0)=" ;S MPIQRYNM=""VTQ_PID_ICN_NO_LOAD"" CHANGING QUERY NAME"
^XTV(8991,14,1,5,1,32,0)=" S MPIQRYNM=""EXACT_MATCH_QUERY"""
^XTV(8991,14,1,5,1,33,0)=" I $G(LOCDATA(2,DFN,991.01))>0 S MPIFRTN=""ALREADY HAS ICN"" G END ;If Pt already has ICN don't connect to MPI"
^XTV(8991,14,1,5,1,34,0)=" ;New EHR code    ;DAOU/WCJ  2/7/05"
^XTV(8991,14,1,5,1,35,0)=" ;Agency EHR does not use MPI"
^XTV(8991,14,1,5,1,36,0)=" I '($G(DUZ(""AG""))=""V""!($$GET^XPAR(""SYS"",""DG MPI"")=""YES"")) G END ;DAOU/WCJ;WV/CJS"
^XTV(8991,14,1,5,1,37,0)=" ;End EHR modifications"
^XTV(8991,14,1,5,1,38,0)="JUMP N TIME,% D NOW^%DTC S TIME=%"
^XTV(8991,14,1,5,1,39,0)=" N HL,MPIINM,MPIOUT,MPIIN,MPIMCNT,MPICNT,MPICS,HEADER,TEST,SITE,MPIDC,SSN"
^XTV(8991,14,1,5,1,40,0)=" I $G(HLP(""ACKTIME""))="""" S HLP(""ACKTIME"")=30 ;If the HLP(""ACKTIME"") is not already set for the D/C"
^XTV(8991,14,1,5,1,41,0)=" S HL(""ECH"")=""^~\&"",HL(""FS"")=""|"""
^XTV(8991,14,1,5,1,42,0)=" I '$D(MPIQRYNM) S MPIQRYNM=""VTQ_PID_ICN"""
^XTV(8991,14,1,5,1,43,0)=" S MPIIN="""",MPIMCNT=DFN,MPICNT=1,MPICS=$E(HL(""ECH""),1)"
^XTV(8991,14,1,5,1,44,0)=" D VTQ1^MPIFVTQ(DFN,.MPIOUT,.HL,.MPIQRYNM) ; **33 remove field list to get all now"
^XTV(8991,14,1,5,1,45,0)=" I +MPIOUT(0)=-1 D  G EXIT"
^XTV(8991,14,1,5,1,46,0)=" .S ^TMP($J,""MPIFQ0-ERROR-LOG"",DFN,TIME)=$G(MPIOUT(0)),MPIFRTN=""CONTINUE"""
^XTV(8991,14,1,5,1,47,0)=" ;Create MSH"
^XTV(8991,14,1,5,1,48,0)=" S SITE=$$SITE^VASITE,SITE=$P(SITE,""^"",3),SITE=SITE\1,HEADER=""MSH""_HL(""FS"")_HL(""ECH"")_HL(""FS"")_""MPI_LOAD""_HL(""FS"")_SITE_HL(""FS"")"
^XTV(8991,14,1,5,1,49,0)=" S HEADER=HEADER_""MPI-ICN""_HL(""FS"")_HL(""FS"")_HL(""FS"")_HL(""FS"")_""VQQ""_MPICS_""Q02""_HL(""FS"")_MPIMCNT_""-""_MPICNT_HL(""FS"") ;**38 changed VTQ to VQQ"
^XTV(8991,14,1,5,1,50,0)=" S MPIOUT(1)=HEADER K MPIOUT(0)"
^XTV(8991,14,1,5,1,51,0)=" I '$D(MPIFS) W:'$D(MPIFRPC) !!,""Attempting to connect to the Master Patient Index in Austin..."",!,""If no SSN or inexact DOB or common name, this request"",!,""may take some time, please be patient..."",!"
^XTV(8991,14,1,5,1,52,0)=" S TEST=$$EN^HLCSAC(""MPIVA DIR"",""MPIOUT"",""MPIDC"")"
^XTV(8991,14,1,5,1,53,0)=" K HLP(""ACKTIME"") ;kill the HLP array set for the ack timeout"
^XTV(8991,14,1,5,1,54,0)=" I +TEST=-1 D  G EXIT"
^XTV(8991,14,1,5,1,55,0)=" .S ^TMP($J,""MPIFQ0-ERROR-LOG"",DFN,TIME)=TEST"
^XTV(8991,14,1,5,1,56,0)=" .I '$D(MPIFS) W:'$D(MPIFRPC) !!,""Could not connect to MPI or Timed Out, assigning local ICN (if not already assigned)..."""
^XTV(8991,14,1,5,1,57,0)=" .D LOCAL^MPIFQ3(DFN) S MPIFRTN=""ASSIGNING LOCAL"""
^XTV(8991,14,1,5,1,58,0)=" K ^TMP(""MPIFVQQ"",$J),^TMP(""MPIFQ0"",$J) ;array data is parsed into for display in LM"
^XTV(8991,14,1,5,1,59,0)="INIPARS ;"
^XTV(8991,14,1,5,1,60,0)=" N SEG,INDEX,SKIP,CHECK,AL,TTF2,TFLL,TF,TF2,MPIREP,MPICOMP"
^XTV(8991,14,1,5,1,61,0)=" S INDEX=0 K CHECK"
^XTV(8991,14,1,5,1,62,0)="LOOP1 ;"
^XTV(8991,14,1,5,1,63,0)=" ;process in ADT type messages"
^XTV(8991,14,1,5,1,64,0)=" N MPIX S MPIX=0 N REP,SG,MSG,MPIQUIT,MPINODE"
^XTV(8991,14,1,5,1,65,0)=" K TWODFN S MPIQUIT=0"
^XTV(8991,14,1,5,1,66,0)=" F MPIX=0:1 X ""D LOOP2"" D  K MPINODE,MSG Q:MPIQUIT'>0"
^XTV(8991,14,1,5,1,67,0)=" . I $D(MPINODE(1)) S SG=$E(MPINODE(1),1,3) S MSG(1)=MPINODE(1) D"
^XTV(8991,14,1,5,1,68,0)=" .. S MPIJ=1 F  S MPIJ=$O(MPINODE(MPIJ)) Q:'MPIJ  S MSG(MPIJ)=MPINODE(MPIJ)"
^XTV(8991,14,1,5,1,69,0)=" .. D:SG?2A1(1A,1N) @SG"
^XTV(8991,14,1,5,1,70,0)="DECIDE ;If no data in ^TMP that means the patient was not found in the MPI w/VTQ Query. So we go to A28 to add the patient to the MPI."
^XTV(8991,14,1,5,1,71,0)=" N EXC,TEXT,EXACT,EXACT2"
^XTV(8991,14,1,5,1,72,0)=" I '$D(^TMP(""MPIFVQQ"",$J)) D  G EXIT"
^XTV(8991,14,1,5,1,73,0)=" .I '$D(MPIFS) W:'$D(MPIFRPC) !!,""Exact match for Patient was not found in the MPI..."""
^XTV(8991,14,1,5,1,74,0)=" .D A28^MPIFQ3(DFN) S MPIFRTN=""DID A28"""
^XTV(8991,14,1,5,1,75,0)=" .; log potential match exception if exist"
^XTV(8991,14,1,5,1,76,0)=" .I MPIPOT=1 D"
^XTV(8991,14,1,5,1,77,0)=" ..D START^RGHLLOG(0),EXC^RGHLLOG(218,""Potential match(es) found, please review via MPI/PD Exception Handler"",DFN),STOP^RGHLLOG(0)"
^XTV(8991,14,1,5,1,78,0)=" ..K MPIPOT"
^XTV(8991,14,1,5,1,79,0)=" ;If INDEX=1 it means we got 1 match check SSN see if definitely same pt"
^XTV(8991,14,1,5,1,80,0)=" I (INDEX=1) D  G EXIT"
^XTV(8991,14,1,5,1,81,0)=" .; Removed &(TSSN=SSN) from line above, only be an exact match returned now"
^XTV(8991,14,1,5,1,82,0)=" .N CCMOR,ICN,DATA,TICN,SNM,SNM2,IEN"
^XTV(8991,14,1,5,1,83,0)=" .S DATA=^TMP(""MPIFVQQ"",$J,INDEX,""DATA""),CMOR=$P(DATA,""^"",5),ICN=$P(DATA,""^"",6),IEN=$$IEN^XUAF4(CMOR)"
^XTV(8991,14,1,5,1,84,0)=" .D START^RGHLLOG(0)"
^XTV(8991,14,1,5,1,85,0)=" .S TICN=$$GETDFN^MPIF001(+ICN)"
^XTV(8991,14,1,5,1,86,0)=" .I TICN>0,DFN'=TICN D"
^XTV(8991,14,1,5,1,87,0)=" ..D TWODFNS^MPIF002(TICN,DFN,ICN) S TWODFN=1"
^XTV(8991,14,1,5,1,88,0)=" ..I '$D(MPIFS) W:'$D(MPIFRPC) !!,""Exception logged, another patient has the ICN returned already, requesting new ICN for this patient..."""
^XTV(8991,14,1,5,1,89,0)=" ..D A28^MPIFQ3(DFN),STOP^RGHLLOG(0) S MPIFRTN=""Did A28"" Q"
^XTV(8991,14,1,5,1,90,0)=" .;I TICN>0&(DFN'=TICN)"
^XTV(8991,14,1,5,1,91,0)=" .; CHECK IF NAME IS SAME - IF NOT POTENTIAL MATCH EXCEPTION"
^XTV(8991,14,1,5,1,92,0)=" .; **43 remove checks here as only exact match will be returned from the MPI"
^XTV(8991,14,1,5,1,93,0)=" .;S SNM=LOCDATA(2,DFN,.01) D NAME^VAFCPID2(DFN,.SNM,0) ;reformat name to DG 149 standard"
^XTV(8991,14,1,5,1,94,0)=" .;S SNM2=$P(DATA,""^"") D NAME^VAFCPID2(0,.SNM2,0) S $P(DATA,""^"")=SNM2"
^XTV(8991,14,1,5,1,95,0)=" .;I $P(SNM,"","")=$P(SNM2,"","")&($P($P(SNM2,"","",2),"" "")=$P($P(SNM,"","",2),"" "")) D"
^XTV(8991,14,1,5,1,96,0)=" .; ^first and last match - check for middle name vs middle initial"
^XTV(8991,14,1,5,1,97,0)=" .;N SNMN,SNMN2"
^XTV(8991,14,1,5,1,98,0)=" .;S SNMN=$P($P(SNM,"","",2),"" "",2),SNMN2=$P($P(SNM2,"","",2),"" "",2)"
^XTV(8991,14,1,5,1,99,0)=" .;I $L(SNMN)>1&($L(SNMN2)=1),$E(SNMN,1)=SNMN2 S EXACT=1"
^XTV(8991,14,1,5,1,100,0)=" .;I $L(SNMN2)>1&($L(SNMN)=1),$E(SNMN2,1)=SNMN S EXACT=1"
^XTV(8991,14,1,5,1,101,0)=" .;I $P($G(^DPT(DFN,0)),""^"",2)'=$P(DATA,""^"",11) S EXC=209,TEXT=""Gender fields don't match between site and MPI for DFN ""_DFN S EXACT2=1"
^XTV(8991,14,1,5,1,102,0)=" .;I SNM2'=SNM&('$D(EXACT))!($D(EXACT2)) D  Q"
^XTV(8991,14,1,5,1,103,0)=" .;I '$D(EXC) S EXC=214,TEXT=""Name fields don't match between site and MPI for DFN ""_DFN"
^XTV(8991,14,1,5,1,104,0)=" .;I $D(MPIFINT) D START^MPIFQ1(INDEX) Q"
^XTV(8991,14,1,5,1,105,0)=" .;I '$D(MPIFINT) D LOC2^MPIFQ3(DFN) Q"
^XTV(8991,14,1,5,1,106,0)=" .I '$D(MPIFS)&('$D(TWODFN)) W:'$D(MPIFRPC) !!,""Found Patient ""_$G(LOCDATA(2,DFN,.01))_"" on MPI"",!,""  Updating ICN to ""_+ICN_"" and CMOR to ""_$P($$NS^XUAF4(IEN),""^"")_"" (""_CMOR_"")  - just a minute..."""
^XTV(8991,14,1,5,1,107,0)=" .D STOP^RGHLLOG(0),UPDATE(DFN,ICN,CMOR) S MPIFRTN=""GOT 1 HIT FROM MPI"""
^XTV(8991,14,1,5,1,108,0)=" ;I '$D(MPIFINT) D  G EXIT"
^XTV(8991,14,1,5,1,109,0)=" ;. came in via PIMS options to d/c with MPI"
^XTV(8991,14,1,5,1,110,0)=" ;.I '$D(MPIFS) W:'$D(MPIFRPC) !!,""Potential Matches Found, Assigning Local ICN..."""
^XTV(8991,14,1,5,1,111,0)=" ;.I '$D(EXC) S EXC=218,TEXT=""Potential matches found for patient DFN= ""_DFN_"" Use Single Patient Initialization to MPI option to manually process."""
^XTV(8991,14,1,5,1,112,0)=" ;.D START^RGHLLOG(0),EXC^RGHLLOG(EXC,TEXT,DFN),STOP^RGHLLOG(0)"
^XTV(8991,14,1,5,1,113,0)=" ;.D LOCAL^MPIFQ3(DFN) S MPIFRTN=""ASSIGNING LOCAL"""
^XTV(8991,14,1,5,1,114,0)=" ;D START^MPIFQ1(INDEX) G END"
^XTV(8991,14,1,5,1,115,0)="EXIT I $D(MPIFINT) K MPIFINT,MPIFRES,MPIQRYNM,TSSN,TWODFN"
^XTV(8991,14,1,5,1,116,0)=" K VALMCNT,VALMLST,CCMOR,FICN H 3 W:'$D(MPIFRPC) !!"
^XTV(8991,14,1,5,1,117,0)="END K ^TMP(""MPIFVQQ"",$J),^TMP(""MPIFQ0"",$J) Q"
^XTV(8991,14,1,5,1,118,0)=" ;"
^XTV(8991,14,1,5,1,119,0)="UPDATE(DFN,ICN,CMOR) ;"
^XTV(8991,14,1,5,1,120,0)=" N TICN,CHKSUM,SETICN,SETLOC,CHANGE,RGLOG,LOCAL"
^XTV(8991,14,1,5,1,121,0)=" S CHKSUM=$P(ICN,""V"",2),ICN=$P(ICN,""V"",1),TICN=$$GETDFN^MPIF001(+ICN)"
^XTV(8991,14,1,5,1,122,0)=" I TICN>0,TICN'=DFN,'$D(TWODFN) D TWODFNS^MPIF002(TICN,DFN,ICN) Q"
^XTV(8991,14,1,5,1,123,0)=" S SETICN=$$SETICN^MPIF001(DFN,ICN,CHKSUM)"
^XTV(8991,14,1,5,1,124,0)=" I +SETICN'>0 S ^TMP($J,""MPIFQ0-ERROR-LOG"",DFN,TIME)=""COULD NOT SET ICN IN MPIFQ0"" Q"
^XTV(8991,14,1,5,1,125,0)=" S SETLOC=1,LOCAL=""N"""
^XTV(8991,14,1,5,1,126,0)=" I $E(ICN,1,3)=$P($$SITE^VASITE(),""^"",3) S LOCAL=""Y"""
^XTV(8991,14,1,5,1,127,0)=" I $G(LOCAL)=""Y"" S SETLOC=$$SETLOC^MPIF001(DFN,1)"
^XTV(8991,14,1,5,1,128,0)=" I $G(LOCAL)'=""Y"" S SETLOC=$$SETLOC^MPIF001(DFN,0)"
^XTV(8991,14,1,5,1,129,0)=" I +SETLOC'>0 S ^TMP($J,""MPIFQ0-ERROR-LOG"",DFN,TIME)=""COULD NOT SETLOC IN MPIFQ0"" Q"
^XTV(8991,14,1,5,1,130,0)=" N CMOR1 S CMOR1=$$LKUP^XUAF4(CMOR)"
^XTV(8991,14,1,5,1,131,0)=" I CMOR1'="""" S CHANGE=$$CHANGE^MPIF001(DFN,CMOR1)"
^XTV(8991,14,1,5,1,132,0)=" I CMOR1="""" S CHANGE=-1"
^XTV(8991,14,1,5,1,133,0)=" I $G(LOCAL)=""Y"" S CHANGE=$$CHANGE^MPIF001(DFN,$P($$SITE^VASITE,""^""))"
^XTV(8991,14,1,5,1,134,0)=" I +CHANGE'>0 S ^TMP($J,""MPIFQ0-ERROR-LOG"",DFN,TIME)=""COULD NOT SET CMOR IN MPIFQ0"" Q"
^XTV(8991,14,1,5,1,135,0)=" Q:$G(LOCAL)=""Y"""
^XTV(8991,14,1,5,1,136,0)=" N RESLT S RESLT=$$A24^MPIFA24B(DFN)"
^XTV(8991,14,1,5,1,137,0)=" I +RESLT<0 D EXC^RGHLLOG(208,""Problem building A24 (ADD TF) for DFN= ""_DFN,DFN)"
^XTV(8991,14,1,5,1,138,0)=" ; create treating facility list"
^XTV(8991,14,1,5,1,139,0)=" I $D(^TMP(""MPIFVQQ"",$J,INDEX,""TF"")) D"
^XTV(8991,14,1,5,1,140,0)=" . N MPINTFI,MPINTF,TFSTRG,TFIEN,MPIFMDT"
^XTV(8991,14,1,5,1,141,0)=" . S MPINTFI=0"
^XTV(8991,14,1,5,1,142,0)=" . F  S MPINTFI=$O(^TMP(""MPIFVQQ"",$J,INDEX,""TF"",MPINTFI)) Q:'MPINTFI  D"
^XTV(8991,14,1,5,1,143,0)=" .. S MPINTF=^TMP(""MPIFVQQ"",$J,INDEX,""TF"",MPINTFI)"
^XTV(8991,14,1,5,1,144,0)=" .. S TFIEN=$$IEN^XUAF4($P(MPINTF,""^"",1))"
^XTV(8991,14,1,5,1,145,0)=" .. S MPIFMDT=$$HL7TFM^XLFDT($P(MPINTF,""^"",2)) I MPIFMDT<0 S MPIFMDT="""""
^XTV(8991,14,1,5,1,146,0)=" .. S TFSTRG=TFIEN_""^""_$G(MPIFMDT)_""^""_$P(MPINTF,""^"",3)"
^XTV(8991,14,1,5,1,147,0)=" .. D FILE^VAFCTFU(DFN,TFSTRG,1)"
^XTV(8991,14,1,5,1,148,0)=" Q"
^XTV(8991,14,1,5,1,149,0)="GETDATA(DIC,DA,MPIFAR,DR,EI) ;"
^XTV(8991,14,1,5,1,150,0)=" ;This function returns the values stored in the fields via FM call DIQ1"
^XTV(8991,14,1,5,1,151,0)=" ;DIC=file reference, DA=IEN in file, ARRAY=array for the values to be stored in, DR=fields requested, EI=external/internal values"
^XTV(8991,14,1,5,1,152,0)=" N DIQ S DIQ=MPIFAR"
^XTV(8991,14,1,5,1,153,0)=" I $G(EI)]"""" S DIQ(0)=EI"
^XTV(8991,14,1,5,1,154,0)=" D EN^DIQ1"
^XTV(8991,14,1,5,1,155,0)=" Q"
^XTV(8991,14,1,5,1,156,0)="LOOP2 ;"
^XTV(8991,14,1,5,1,157,0)=" N MPIDONE,MPII,MPIJ"
^XTV(8991,14,1,5,1,158,0)=" S MPII=0,MPIDONE=0"
^XTV(8991,14,1,5,1,159,0)=" F  S MPIQUIT=$O(MPIDC(MPIQUIT)) Q:'MPIQUIT  D  Q:MPIDONE"
^XTV(8991,14,1,5,1,160,0)=" . I MPIDC(MPIQUIT)="""" S MPIDONE=1 Q"
^XTV(8991,14,1,5,1,161,0)=" . S MPII=MPII+1,MPINODE(MPII)=$G(MPIDC(MPIQUIT)) Q"
^XTV(8991,14,1,5,1,162,0)=" Q"
^XTV(8991,14,1,5,1,163,0)="MSH ;"
^XTV(8991,14,1,5,1,164,0)=" S MPIREP=$E(HL(""ECH""),2),MPICOMP=$E(HL(""ECH""),1)"
^XTV(8991,14,1,5,1,165,0)=" Q"
^XTV(8991,14,1,5,1,166,0)="MSA ;"
^XTV(8991,14,1,5,1,167,0)=" Q"
^XTV(8991,14,1,5,1,168,0)="RDF ;"
^XTV(8991,14,1,5,1,169,0)=" Q"
^XTV(8991,14,1,5,1,170,0)="QAK ; check potential matches"
^XTV(8991,14,1,5,1,171,0)=" K MPIPOT S MPIPOT=0"
^XTV(8991,14,1,5,1,172,0)=" I MSG(1)[""POTENTIAL MATCHES"" S MPIPOT=1"
^XTV(8991,14,1,5,1,173,0)=" Q"
^XTV(8991,14,1,5,1,174,0)="RDT ;"
^XTV(8991,14,1,5,1,175,0)=" N NAME,ICN,BIRTHDAY,CMOR,IEN,SEG,HEREICN,STRING,LASTNAME,FRSTNAME,MIDDLE,SUFF,SEX"
^XTV(8991,14,1,5,1,176,0)=" S STRING="""",INDEX=$G(INDEX)+1"
^XTV(8991,14,1,5,1,177,0)=" D RDT^MPIFSA3(.INDEX,.HL,.MSG)"
^XTV(8991,14,1,5,1,178,0)=" S SEG=^TMP(""MPIFVQQ"",$J,INDEX,""DATA"")"
^XTV(8991,14,1,5,1,179,0)=" S FRSTNAME=$P(SEG,""^"",7),LASTNAME=$P(SEG,""^"",2),MIDDLE=$P(SEG,""^"",10),SUFF=$P(SEG,""^"",15)"
^XTV(8991,14,1,5,1,180,0)=" S SSN=$P(SEG,""^"",3),NAME=LASTNAME_"",""_FRSTNAME"
^XTV(8991,14,1,5,1,181,0)=" I MIDDLE'="""" S NAME=NAME_"" ""_MIDDLE"
^XTV(8991,14,1,5,1,182,0)=" I SUFF'="""" S NAME=NAME_"" ""_SUFF"
^XTV(8991,14,1,5,1,183,0)=" S SEX=$P(SEG,""^"",11)"
^XTV(8991,14,1,5,1,184,0)=" S ICN=$P(SEG,""^"",6)"
^XTV(8991,14,1,5,1,185,0)=" S BIRTHDAY=$P(SEG,""^"",4)"
^XTV(8991,14,1,5,1,186,0)=" S CMOR=$P(SEG,""^"",5),IEN=$$IEN^XUAF4(CMOR)"
^XTV(8991,14,1,5,1,187,0)=" S CMOR=$P($$NS^XUAF4(IEN),""^"")"
^XTV(8991,14,1,5,1,188,0)=" S HEREICN=$$HEREICN^MPIFQ3($P(ICN,""V"",1))"
^XTV(8991,14,1,5,1,189,0)=" I HEREICN S STRING=$$SETSTR^VALM1(""*"",STRING,1,1),^TMP(""MPIFVQQ"",$J,INDEX,""INDICATOR"")=""*""_""^""_HEREICN"
^XTV(8991,14,1,5,1,190,0)=" S STRING=$$SETSTR^VALM1(INDEX,STRING,2,4),STRING=$$SETSTR^VALM1($E(NAME,1,23),STRING,6,23)"
^XTV(8991,14,1,5,1,191,0)=" S STRING=$$SETSTR^VALM1(SSN,STRING,30,9),STRING=$$SETSTR^VALM1(BIRTHDAY,STRING,41,10)"
^XTV(8991,14,1,5,1,192,0)=" S STRING=$$SETSTR^VALM1(CMOR,STRING,54,20)"
^XTV(8991,14,1,5,1,193,0)=" S ^TMP(""MPIFVQQ"",$J,INDEX,0)=STRING,^TMP(""MPIFVQQ"",$J,""IDX"",INDEX,INDEX)="""""
^XTV(8991,14,1,5,1,194,0)=" Q"
^XTV(8991,14,1,"B",3061009.2252,1)=""
^XTV(8991,14,1,"B",3061010.0849,2)=""
^XTV(8991,14,1,"B",3061010.1552,3)=""
^XTV(8991,14,1,"B",3061010.1555,4)=""
^XTV(8991,14,1,"B",3061010.1852,5)=""
^XTV(8991,15,0)="XPDIL"
^XTV(8991,15,1,0)="^8991.01^3^3"
^XTV(8991,15,1,1,0)="3061009.2255"
^XTV(8991,15,1,1,1,0)="^8991.11^131^131"
^XTV(8991,15,1,1,1,1,0)=""
^XTV(8991,15,1,1,1,1,"DEL")="XPDIL ;SFISC/RSD - load Distribution Global ;10/9/06  22:55"
^XTV(8991,15,1,1,1,2,"INS",0)="^8991.12^1^1"
^XTV(8991,15,1,1,1,2,"INS",1,0)="XPDIL ;SFISC/RSD - load Distribution Global ;10/9/06  22:56"
^XTV(8991,15,1,1,1,43,0)=""
^XTV(8991,15,1,1,1,43,"DEL")=" S:$D(AAQFILE) DIR(""B"")=AAQFILE ;L33 used only by XPDZPAT"
^XTV(8991,15,1,1,1,44,"INS",0)="^8991.12^1^1"
^XTV(8991,15,1,1,1,44,"INS",1,0)=" S:$D(AAQFILE) DIR(""B"")=AAQFILE ;L33 used only by XPDZPAT - line added for VOE"
^XTV(8991,15,1,2,0)="3061009.2256"
^XTV(8991,15,1,2,1,0)="^8991.11^131^131"
^XTV(8991,15,1,2,1,1,0)=""
^XTV(8991,15,1,2,1,1,"DEL")="XPDIL ;SFISC/RSD - load Distribution Global ;10/9/06  22:56"
^XTV(8991,15,1,2,1,2,"INS",0)="^8991.12^1^1"
^XTV(8991,15,1,2,1,2,"INS",1,0)="XPDIL ;SFISC/RSD - load Distribution Global ;10/10/06  17:00"
^XTV(8991,15,1,2,1,43,"INS",0)="^8991.12^1^1"
^XTV(8991,15,1,2,1,43,"INS",1,0)=" S:$D(AAQFILE) DIR(""B"")=AAQFILE ;L33 used only by XPDZPAT"
^XTV(8991,15,1,3,0)="3061010.17"
^XTV(8991,15,1,3,1,0)="^8991.11^132^132"
^XTV(8991,15,1,3,1,1,0)="XPDIL ;SFISC/RSD - load Distribution Global ;10/10/06  17:00"
^XTV(8991,15,1,3,1,2,0)=" ;;8.0;KERNEL;**15,44,58,68,108,422**;Jul 10, 1995;Build 2"
^XTV(8991,15,1,3,1,3,0)=" ;This routine has the changes made for patch 345 but was released as 422 to fix a read HFS problem"
^XTV(8991,15,1,3,1,4,0)=" ;"
^XTV(8991,15,1,3,1,5,0)="EN1 N POP,XPDA,XPDST,XPDIT,XPDT,XPDGP,XPDQUIT,XPDREQAB,XPDSKPE"
^XTV(8991,15,1,3,1,6,0)=" S:'$D(DT) DT=$$DT^XLFDT S:'$D(U) U=""^"""
^XTV(8991,15,1,3,1,7,0)=" S XPDST=0"
^XTV(8991,15,1,3,1,8,0)=" D ST I $G(XPDQUIT) D ABRTALL^XPDI(1) G NONE"
^XTV(8991,15,1,3,1,9,0)=" ;XPDST= starting Build"
^XTV(8991,15,1,3,1,10,0)=" ;XPDT(""DA"",ien)=seq # to install"
^XTV(8991,15,1,3,1,11,0)=" ;XPDT(""NM"",build name)=seq #"
^XTV(8991,15,1,3,1,12,0)=" ;XPDT(seq #)=ien^Build name"
^XTV(8991,15,1,3,1,13,0)=" ;XPDT(""GP"",global)= 1-replace, 0-overwrite^ien"
^XTV(8991,15,1,3,1,14,0)=" ;XPDGP=globals from a Global Package"
^XTV(8991,15,1,3,1,15,0)=" ;XPDSKPE=1 don't run Environment Check^has question been asked"
^XTV(8991,15,1,3,1,16,0)=" S XPDIT=0,XPDSKPE=""0^0"""
^XTV(8991,15,1,3,1,17,0)=" F  S XPDIT=$O(XPDT(XPDIT)) Q:'XPDIT  S XPDA=+XPDT(XPDIT) D  I '$D(XPDT) Q"
^XTV(8991,15,1,3,1,18,0)=" .;check if this Build has an Envir. Check"
^XTV(8991,15,1,3,1,19,0)=" .I $G(^XTMP(""XPDI"",XPDA,""PRE""))]"""" D  I $G(XPDQUIT) D ABRTALL^XPDI(1) Q"
^XTV(8991,15,1,3,1,20,0)=" ..;quit if we already asked this question"
^XTV(8991,15,1,3,1,21,0)=" ..Q:$P(XPDSKPE,U,2)"
^XTV(8991,15,1,3,1,22,0)=" ..S $P(XPDSKPE,U,2)=1"
^XTV(8991,15,1,3,1,23,0)=" ..N DIR,DIRUT"
^XTV(8991,15,1,3,1,24,0)=" ..S DIR(0)=""Y"",DIR(""A"")=""Want to RUN the Environment Check Routine"",DIR(""B"")=""YES"""
^XTV(8991,15,1,3,1,25,0)=" ..S DIR(""A"",1)=""Build ""_$P(XPDT(XPDIT),U,2)_"" has an Enviromental Check Routine"""
^XTV(8991,15,1,3,1,26,0)=" ..;p345-rename AND* to XPD*"
^XTV(8991,15,1,3,1,27,0)=" ..I '$G(XPDAUTO) D ^DIR I $D(DIRUT) S XPDQUIT=1 Q"
^XTV(8991,15,1,3,1,28,0)=" ..I $G(XPDAUTO) S Y=1"
^XTV(8991,15,1,3,1,29,0)=" ..S:'Y XPDSKPE=""1^1"""
^XTV(8991,15,1,3,1,30,0)=" .D PKG^XPDIL1(XPDA)"
^XTV(8991,15,1,3,1,31,0)=" ;Global Package"
^XTV(8991,15,1,3,1,32,0)=" G:$D(XPDGP) ^XPDIGP"
^XTV(8991,15,1,3,1,33,0)=" ;p345-rename AND* to XPD*"
^XTV(8991,15,1,3,1,34,0)=" I $D(XPDT),$D(^XPD(9.7,+XPDST,0)) S:$G(XPDAUTO) XPDANM=$P(^(0),U) W:'$G(XPDAUTO) !,""Use INSTALL NAME: "",$P(^(0),U),"" to install this Distribution."",!"
^XTV(8991,15,1,3,1,35,0)=" Q"
^XTV(8991,15,1,3,1,36,0)="ST ;global input"
^XTV(8991,15,1,3,1,37,0)=" N DIR,DIRUT,GR,IOP,X,Y,Z,%ZIS"
^XTV(8991,15,1,3,1,38,0)=" G:'$D(^DD(3.5,0)) OPEN"
^XTV(8991,15,1,3,1,39,0)=" I '$D(^%ZIS(1,""B"",""HFS"")) W !!,""You must have a device called 'HFS' in order to load a distribution!"",*7 S XPDQUIT=1 Q"
^XTV(8991,15,1,3,1,40,0)=" ;p345-rename AND* to XPD*"
^XTV(8991,15,1,3,1,41,0)=" I '$G(XPDAUTO) D HOME^%ZIS"
^XTV(8991,15,1,3,1,42,0)=" I $G(XPDAUTO) S IO(0)=XPDDEV"
^XTV(8991,15,1,3,1,43,0)=" S:$D(AAQFILE) DIR(""B"")=AAQFILE ;L33 used only by XPDZPAT"
^XTV(8991,15,1,3,1,44,0)=" S:$D(AAQFILE) DIR(""B"")=AAQFILE ;L33 used only by XPDZPAT - line added for VOE"
^XTV(8991,15,1,3,1,45,0)=" S DIR(0)=""F^3:75"",DIR(""A"")=""Enter a Host File"",DIR(""?"")=""Enter a filename and/or path to input Distribution."""
^XTV(8991,15,1,3,1,46,0)=" ;p345-rename AND* to XPD*"
^XTV(8991,15,1,3,1,47,0)=" I '$G(XPDAUTO) D ^DIR I $D(DIRUT) S XPDQUIT=1 Q"
^XTV(8991,15,1,3,1,48,0)=" I $G(XPDAUTO) S (X,Y)=XPDFTPF"
^XTV(8991,15,1,3,1,49,0)=" S %ZIS="""",%ZIS(""HFSNAME"")=Y,%ZIS(""HFSMODE"")=""R"",IOP=""HFS"""
^XTV(8991,15,1,3,1,50,0)=" D ^%ZIS I POP W !,""Couldn't open file or HFS device!!"",*7 S XPDQUIT=1 Q"
^XTV(8991,15,1,3,1,51,0)=" ;don't close device if we have a global package, we need to bring in the globals now"
^XTV(8991,15,1,3,1,52,0)=" D GI,^%ZISC:'$D(XPDGP)!$G(XPDQUIT)"
^XTV(8991,15,1,3,1,53,0)=" Q"
^XTV(8991,15,1,3,1,54,0)=" ;"
^XTV(8991,15,1,3,1,55,0)=" ;if no device file, Virgin Install"
^XTV(8991,15,1,3,1,56,0)="OPEN ;use open command"
^XTV(8991,15,1,3,1,57,0)=" N IO,IOPAR,DIR,DIRUT"
^XTV(8991,15,1,3,1,58,0)=" S DIR(0)=""F^1:79"",DIR(""A"")=""Device Name"""
^XTV(8991,15,1,3,1,59,0)=" S DIR(""?"",1)=""Device Name is either the name of the HFS file or the name of the HFS Device."",DIR(""?"",2)=""i.e.  for MSM enter  51"",DIR(""?"")=""      for DSM enter  DISK$USER::[ANONYMOUS]:KRN8.KID"""
^XTV(8991,15,1,3,1,60,0)=" D ^DIR I $D(DIRUT) S POP=1 Q"
^XTV(8991,15,1,3,1,61,0)=" S IO=Y,DIR(0)=""FO^1:79"",DIR(""A"")=""Device Parameters"""
^XTV(8991,15,1,3,1,62,0)=" S DIR(""?"",1)=""Device Parameter is the Open parameter this M operating system needs to"",DIR(""?"",2)=""open the Device Name."",DIR(""?"",3)=""i.e. for MSM enter  (""""B:\KRN8.KID"""":""""R"""")"",DIR(""?"")=""     for DSM enter  READONLY"""
^XTV(8991,15,1,3,1,63,0)=" D ^DIR I $D(DTOUT)!$D(DUOUT) S POP=1 Q"
^XTV(8991,15,1,3,1,64,0)=" S IOPAR=Y"
^XTV(8991,15,1,3,1,65,0)=" X ""O IO:""_IOPAR_"":10"" E  U $P W !,""Couldn't open "",IO S POP=1 Q"
^XTV(8991,15,1,3,1,66,0)=" S IO(0)=$P"
^XTV(8991,15,1,3,1,67,0)=" D GI D ^%ZISC"
^XTV(8991,15,1,3,1,68,0)=" Q"
^XTV(8991,15,1,3,1,69,0)=" ;"
^XTV(8991,15,1,3,1,70,0)="GI N X,XPDSEQ,Y,Z"
^XTV(8991,15,1,3,1,71,0)=" U IO R X:10,Y:10 ;rwf was :0"
^XTV(8991,15,1,3,1,72,0)=" U IO(0) W !!,X,!,""Comment: "",Y"
^XTV(8991,15,1,3,1,73,0)=" S XPDST(""H"")=Y,XPDST(""H1"")=Y_""  ;Created on ""_$P(X,""KIDS Distribution saved on "",2)"
^XTV(8991,15,1,3,1,74,0)=" ;Z is the string of Builds in this file"
^XTV(8991,15,1,3,1,75,0)=" U IO F X=1:1 R Z:1 S Z=$P(Z,""**KIDS**"",2,99) Q:Z=""""  S X(X)=Z"
^XTV(8991,15,1,3,1,76,0)=" U IO(0) I $G(X(1))="""" W !!,""This is not a Distribution HFS File!"" S XPDQUIT=1 Q"
^XTV(8991,15,1,3,1,77,0)=" ;global package, set XPDGP=flag;global^flag;global^...  flag=1 replace"
^XTV(8991,15,1,3,1,78,0)=" I $P(X(1),"":"")=""GLOBALS"" S XPDGP=$P(X(1),U,2,99),X(1)=$P(X(1),U)"
^XTV(8991,15,1,3,1,79,0)=" S XPDIT=0,X(1)=$P(X(1),"":"",2,99)"
^XTV(8991,15,1,3,1,80,0)=" W !!,""This Distribution contains Transport Globals for the following Package(s):"""
^XTV(8991,15,1,3,1,81,0)=" F X=1:1:X-1 F Z=1:1 S Y=$P(X(X),U,Z) Q:Y=""""  D  Q:$G(XPDQUIT)"
^XTV(8991,15,1,3,1,82,0)=" . ;can't install if global exist, that means Build never finish install"
^XTV(8991,15,1,3,1,83,0)=" . ;INST will show name"
^XTV(8991,15,1,3,1,84,0)=" . S XPDIT=XPDIT+1 I '$$INST^XPDIL1(Y) S XPDQUIT=1 Q"
^XTV(8991,15,1,3,1,85,0)=" Q:$G(XPDQUIT)"
^XTV(8991,15,1,3,1,86,0)=" W !,""Distribution OK!"",!"
^XTV(8991,15,1,3,1,87,0)=" D:$D(XPDGP) DISP^XPDIGP"
^XTV(8991,15,1,3,1,88,0)=" S DIR(0)=""Y"",DIR(""A"")=""Want to Continue with Load"",DIR(""B"")=""YES"""
^XTV(8991,15,1,3,1,89,0)=" ;p345-rename AND* to XPD*"
^XTV(8991,15,1,3,1,90,0)=" I '$G(XPDAUTO) D ^DIR I $D(DIRUT)!'Y S XPDQUIT=1 Q"
^XTV(8991,15,1,3,1,91,0)=" I $G(XPDAUTO) S Y=1"
^XTV(8991,15,1,3,1,92,0)=" W !,""Loading Distribution..."",!"
^XTV(8991,15,1,3,1,93,0)=" ;reset expiration date to T+7 on transport global"
^XTV(8991,15,1,3,1,94,0)=" S ^XTMP(""XPDI"",0)=$$FMADD^XLFDT(DT,7)_U_DT"
^XTV(8991,15,1,3,1,95,0)=" ;start reading the HFS again"
^XTV(8991,15,1,3,1,96,0)=" U IO R X:10,Y:10 ;rwf was :0"
^XTV(8991,15,1,3,1,97,0)=" ;the next read must be the INSTALL NAME"
^XTV(8991,15,1,3,1,98,0)=" I X'=""**INSTALL NAME**""!'$D(XPDT(""NM"",Y)) U IO(0) W !!,""ERROR in HFS file format!"" S XPDQUIT=1 Q"
^XTV(8991,15,1,3,1,99,0)=" ;XPDSEQ is the disk sequence number"
^XTV(8991,15,1,3,1,100,0)=" S %=XPDT(""NM"",Y),GR=""^XTMP(""""XPDI"""",""_+XPDT(%)_"","",XPDSEQ=1"
^XTV(8991,15,1,3,1,101,0)=" ;X=global ref, Y=global value. DIRUT is when user is prompted for next disk in NEXTD and they abort"
^XTV(8991,15,1,3,1,102,0)=" ;rwf next line was :0"
^XTV(8991,15,1,3,1,103,0)=" F  R X:10,Y:10 Q:X=""**END**""  D  I $D(DIRUT) S XPDQUIT=1 Q"
^XTV(8991,15,1,3,1,104,0)=" .I X=""**INSTALL NAME**"" D  Q"
^XTV(8991,15,1,3,1,105,0)=" ..S %=+$G(XPDT(""NM"",Y)) I '% S DIRUT=1 Q"
^XTV(8991,15,1,3,1,106,0)=" ..S GR=""^XTMP(""""XPDI"""",""_+XPDT(%)_"","""
^XTV(8991,15,1,3,1,107,0)=" .;I X=""**CONTINUE**"" D NEXTD Q"
^XTV(8991,15,1,3,1,108,0)=" .S @(GR_X)=Y"
^XTV(8991,15,1,3,1,109,0)=" U IO(0)"
^XTV(8991,15,1,3,1,110,0)=" Q"
^XTV(8991,15,1,3,1,111,0)=" ;"
^XTV(8991,15,1,3,1,112,0)="NEXTD I ^%ZOSF(""OS"")'[""MSM"" U IO(0) W !!,""Error in disk, ABORTING load!!"" S XPDQUIT=1 Q"
^XTV(8991,15,1,3,1,113,0)=" N DIR"
^XTV(8991,15,1,3,1,114,0)=" ;close current device"
^XTV(8991,15,1,3,1,115,0)=" C IO U IO(0)"
^XTV(8991,15,1,3,1,116,0)=" S XPDSEQ=XPDSEQ+1,DIR(0)=""E"",DIR(""A"")=""Insert the next diskette, #""_XPDSEQ_"", and Press the return key"",DIR(""?"")=""This distribution is continued on another diskette"""
^XTV(8991,15,1,3,1,117,0)=" D ^DIR Q:$D(DIRUT)"
^XTV(8991,15,1,3,1,118,0)=" W ""  OK"",!"
^XTV(8991,15,1,3,1,119,0)=" ;MSM specific code to open HFS"
^XTV(8991,15,1,3,1,120,0)=" O @(""""""""_IO_"""""":""_IOPAR) U IO"
^XTV(8991,15,1,3,1,121,0)=" R X:10,Y:10 ;rwf was :0"
^XTV(8991,15,1,3,1,122,0)=" ;quit if comments are not the same on each diskette"
^XTV(8991,15,1,3,1,123,0)=" G:Y'=XPDST(""H"") NEXTQ"
^XTV(8991,15,1,3,1,124,0)=" ;quit if not the expected sequence, Z is for the blank line"
^XTV(8991,15,1,3,1,125,0)=" R Y:10,Z:10 G:Y'=(""**SEQ**:""_XPDSEQ) NEXTQ ;rwf was :0"
^XTV(8991,15,1,3,1,126,0)=" Q"
^XTV(8991,15,1,3,1,127,0)="NEXTQ U IO(0) W !!,""This is NOT the correct diskette!!  The comment on this diskette is:"",!,X,!!"
^XTV(8991,15,1,3,1,128,0)=" S XPDSEQ=XPDSEQ-1"
^XTV(8991,15,1,3,1,129,0)=" G NEXTD"
^XTV(8991,15,1,3,1,130,0)=" ;"
^XTV(8991,15,1,3,1,131,0)="NONE W !!,""**NOTHING LOADED**"",!"
^XTV(8991,15,1,3,1,132,0)=" Q"
^XTV(8991,15,1,"B",3061009.2255,1)=""
^XTV(8991,15,1,"B",3061009.2256,2)=""
^XTV(8991,15,1,"B",3061010.17,3)=""
^XTV(8991,16,0)="DGRPE"
^XTV(8991,16,1,0)="^8991.01^1^1"
^XTV(8991,16,1,1,0)="3061009.2352"
^XTV(8991,16,1,1,1,0)="^8991.11^105^105"
^XTV(8991,16,1,1,1,1,0)="DGRPE ;ALB/MRL,LBD,BRM - REGISTRATIONS EDITS ;10/9/06  23:52"
^XTV(8991,16,1,1,1,2,0)=" ;;5.3;Registration;**32,114,139,169,175,247,190,343,397,342,454,415,489,506,244,547,522,528,555,508,451,626,638,624,677,672,702**;Aug 13, 1993"
^XTV(8991,16,1,1,1,3,0)=" ;"
^XTV(8991,16,1,1,1,4,0)=" ; VOE changes: DAOU,VA/CJS,WV/TOAD 5/9/2006"
^XTV(8991,16,1,1,1,5,0)=" ; conditionally add edit fields to the following lines:"
^XTV(8991,16,1,1,1,6,0)=" ;    201: Is Patient a Veteran (19902), Interpreter Language (19906)"
^XTV(8991,16,1,1,1,7,0)=" ;    202: skip line if agency code for IHS or VOE"
^XTV(8991,16,1,1,1,8,0)=" ; 305002+1: for VOE, Mother's Country of Birth (19903), Father's Country"
^XTV(8991,16,1,1,1,9,0)=" ;         of Birth (19904), Year Arrived in U.S. (19905)"
^XTV(8991,16,1,1,1,10,0)=" ;"
^XTV(8991,16,1,1,1,11,0)=" ;DGDR contains a string of edits; edit=screen*10+item #"
^XTV(8991,16,1,1,1,12,0)=" ;"
^XTV(8991,16,1,1,1,13,0)=" ;line tag screen*10+item*1000 = continuation line"
^XTV(8991,16,1,1,1,14,0)=" ;"
^XTV(8991,16,1,1,1,15,0)=" I DGRPS=1,DGDR[""101,"" D CEDITS^DGRPECE(DFN)"
^XTV(8991,16,1,1,1,16,0)=" I DGRPS=8 D ^DGRPEIS,Q Q  ; family demographic edit...not conventional!!  :)"
^XTV(8991,16,1,1,1,17,0)=" I DGRPS=9 D EDIT9^DGRPEIS2,Q Q  ; income screening data ($$$)"
^XTV(8991,16,1,1,1,18,0)=" I DGRPS=5,DGDR[""501,"" D"
^XTV(8991,16,1,1,1,19,0)=" .I $G(DGPRFLG) D PREG^IBCNBME(DFN) Q"
^XTV(8991,16,1,1,1,20,0)=" .D REG^IBCNBME(DFN)"
^XTV(8991,16,1,1,1,21,0)=" .Q"
^XTV(8991,16,1,1,1,22,0)=" ;-- Tricare screen #15"
^XTV(8991,16,1,1,1,23,0)=" I DGRPS=15 D EDIT^DGRP15,Q Q"
^XTV(8991,16,1,1,1,24,0)=" ;"
^XTV(8991,16,1,1,1,25,0)=" N DGPH,DGPHFLG"
^XTV(8991,16,1,1,1,26,0)=" K DR S (DA,Y)=DFN,DIE=""^DPT("",DR="""",DGDRS=""DR"",DGCT=0"
^XTV(8991,16,1,1,1,27,0)=" G ^DGRPE1:DGRPS>6"
^XTV(8991,16,1,1,1,28,0)=" I DGRPS=4 D ^DGRPE4"
^XTV(8991,16,1,1,1,29,0)=" K DR S (DA,Y)=DFN,DIE=""^DPT("",DR="""",DGDRS=""DR"",DGCT=0"
^XTV(8991,16,1,1,1,30,0)=" F I=1:1 S J=$P(DGDR,"","",I) Q:J=""""  F J1=J,J*1000,J*1000+1,J*1000+2 Q:'$T(@J1)  S DGDRD=$P($T(@J1),"";;"",2) D S"
^XTV(8991,16,1,1,1,31,0)=" D ^DIE"
^XTV(8991,16,1,1,1,32,0)=" ;check for Combat Vet status"
^XTV(8991,16,1,1,1,33,0)=" I $G(DGCVFLG)=1,($P($$CVEDT^DGCV(DFN),U,2)']"""") D"
^XTV(8991,16,1,1,1,34,0)=" . W !!,""**NOTE-Change(s) made in this session deleted the veteran's Combat Vet status!"""
^XTV(8991,16,1,1,1,35,0)=" . S DIR(0)=""EA"" D ^DIR K DIR"
^XTV(8991,16,1,1,1,36,0)=" I $G(DGPHFLG)>0 D EDITPH1^DGRPLE()"
^XTV(8991,16,1,1,1,37,0)="Q K DA,DIE,DR,DGCT,DGCVFLG,DGDR,DGDRD,DGDRS,DGRPADI,I,J,J1,DGCOMLOC"
^XTV(8991,16,1,1,1,38,0)=" Q"
^XTV(8991,16,1,1,1,39,0)="S I $L(@DGDRS)+$L(DGDRD)<241 S @DGDRS=@DGDRS_DGDRD Q"
^XTV(8991,16,1,1,1,40,0)=" S DGCT=DGCT+1,DGDRS=""DR(1,2,""_DGCT_"")"",@DGDRS=DGDRD Q"
^XTV(8991,16,1,1,1,41,0)=" Q"
^XTV(8991,16,1,1,1,42,0)=" ;"
^XTV(8991,16,1,1,1,43,0)=" ; VOE changes at lines 201, 202, 304 & after 305002"
^XTV(8991,16,1,1,1,44,0)=" ;"
^XTV(8991,16,1,1,1,45,0)="101 ;;"
^XTV(8991,16,1,1,1,46,0)="102 ;;1;"
^XTV(8991,16,1,1,1,47,0)="103 ;;.091;"
^XTV(8991,16,1,1,1,48,0)="104 ;;N FLG S (FLG(1),FLG(2))=1 D EN^DGREGAED(DFN,.FLG);"
^XTV(8991,16,1,1,1,49,0)="105 ;;.12105//NO;S:X=""N"" Y=""@15"" S:X=""Y"" DIE(""NO^"")="""";.1217;I X']"""" W !?4,$C(7),""But I need a Start Date for this Temporary Address."" S Y=.12105;.1218;.1211;I X']"""" W !?4,$C(7),""But I need at least one line of a Temporary address."" S Y=.12105;"
^XTV(8991,16,1,1,1,50,0)="105000 ;;.1212;S:X']"""" Y=.1214;.1213:.1215;.12112;Q;.12111;.1219;@15;K DIE(""NO^"");"
^XTV(8991,16,1,1,1,51,0)="109 ;;N FLG S (FLG(1),FLG(2))=1 D EN^DGREGAED(DFN,.FLG);.02;D DR109^DGRPE;6;2;K DR(2,2.02),DR(2,2.06);.05;.08;K DIE(""NO^"");"
^XTV(8991,16,1,1,1,52,0)="111 ;;.14105//NO;S:X=""N"" Y=""@111"" S:X=""Y"" DIE(""NO^"")="""";.1417;I X']"""" W !?4,$C(7),""But I need a Start Date."" S Y=.14105;.1418;D DR111^DGRPE;.141;I '$P($$CAACT^DGRPCADD(DFN),U,2) W !?4,""But I need at least one active category."" S Y=.14105;"
^XTV(8991,16,1,1,1,53,0)="111000 ;;K DR(2,2.141);.1411;I X']"""" W !?4,$C(7),""I need at least one line of Address."" S Y=.14105;.1412;S:X']"""" Y=.1414;.1413;.1414;.1415;.1416;Q;.14111;@111;K DIE(""NO^"");"
^XTV(8991,16,1,1,1,54,0)="112 ;;.134;.135;.133"
^XTV(8991,16,1,1,1,55,0)="201 ;;.05;.08;.092;.093;.2401:.2403;57.4//NOT APPLICABLE;;S:$G(DUZ(""AG""))'=""E"" Y=""@21"";19902;19906;@21"
^XTV(8991,16,1,1,1,56,0)="202 ;;S:""IE""[$G(DUZ(""AG"")) Y=""@22"";1010.15//NO;S:X'=""Y"" Y=""@22"";S DIE(""NO^"")="""";1010.152;I X']"""" W !?4,*7,""But I need to know where you were treated most recently."" S Y=1010.15;1010.151;1010.154;S:X']"""" Y=""@22"";1010.153;@22;K DIE(""NO^"");"
^XTV(8991,16,1,1,1,57,0)="203 ;;D DR203^DGRPE;6ETHNICITY;2RACE;K DR(2,2.02),DR(2,2.06);"
^XTV(8991,16,1,1,1,58,0)="205 ;;.181;"
^XTV(8991,16,1,1,1,59,0)="301 ;;.211;S:X']"""" Y=""@31"";.212;.2125//NO;I X=""Y"" S DGADD="".21"" D AD^DGRPE S Y=.21011;.213;S:X']"""" Y=.216;.214;S:X']"""" Y=.216;.215:.217;.2207;.219;.21011;@31;"
^XTV(8991,16,1,1,1,60,0)="302 ;;.2191;S:X']"""" Y=""@32"";.2192;.21925//NO;I X=""Y"" S DGADD="".211"" D AD^DGRPE S Y=.211011;"
^XTV(8991,16,1,1,1,61,0)="302000 ;;.2193;S:X']"""" Y=.2196;.2194;S:X']"""" Y=.2196;.2195:.2197;.2203;.2199;.211011;@32;"
^XTV(8991,16,1,1,1,62,0)="303 ;;N DGX1,DGX2;I '$L($P($G(^DPT(DFN,.21)),U)) S Y=""@33"";.3305//NO;I X=""Y"" S Y=""@34"",DGX1=1;@33;S:$D(^DPT(DFN,.22)) $P(^(.22),U,1)=$P(^(.22),U,7);@33;.331;S:X']"""" DGX1=2,Y=""@34"";.332;@34;"
^XTV(8991,16,1,1,1,63,0)="303000 ;;S:$G(DGX1) Y=""@341"";.333;S:X']"""" Y=.336;.334;S:X']"""" Y=.336;.335:.337;.2201;.339;.33011;S DGX1=2;@341;"
^XTV(8991,16,1,1,1,64,0)="303001 ;;S:$G(DGX1)=2 Y=""@35"";S DGX2=$G(^DPT(DA,.21));.331///^S X=$P(DGX2,U);.332///^S X=$P(DGX2,U,2);.333////^S X=$P(DGX2,U,3);.334///^S X=$P(DGX2,U,4);@35;"
^XTV(8991,16,1,1,1,65,0)="303002 ;;S:$G(DGX1)=2 Y=""@351"";.335///^S X=$P(DGX2,U,5);.336///^S X=$P(DGX2,U,6);.337///^S X=$P(DGX2,U,7);.338///^S X=$P(DGX2,U,8);.339///^S X=$P(DGX2,U,9);.33011///^S X=$P(DGX2,U,11);@351;K DGX1,DGX2;"
^XTV(8991,16,1,1,1,66,0)="304 ;;.3311;S:X']"""" Y=""@36"";.3312;.3313;S:X']"""" Y=.3316;.3314;S:X']"""" Y=.3316;.3315:.3317;.2204;.3319;.331011;@36;        "
^XTV(8991,16,1,1,1,67,0)="305 ;;N DGX1,DGX2;I '$L($P($G(^DPT(DFN,.21)),U)) S Y=""@37"";.3405//NO;I X=""Y"" S DGX1=1,Y=""@371"";@37;S:$D(^DPT(DFN,.22)) $P(^(.22),U,2)=$P(^(.22),U,7);@37;.341;S:X']"""" DGX1=2,Y=""@371"";.342;@371;"
^XTV(8991,16,1,1,1,68,0)="305000 ;;S:$G(DGX1) Y=""@38"";.343;S:X']"""" Y=.346;.344;S:X']"""" Y=.346;.345:.347;.2202;.349;.34011;S DGX1=2;@38;"
^XTV(8991,16,1,1,1,69,0)="305001 ;;S:$G(DGX1)=2 Y=""@381"";S DGX2=$G(^DPT(DA,.21));.341///^S X=$P(DGX2,U);.342///^S X=$P(DGX2,U,2);.343///^S X=$P(DGX2,U,3);.344///^S X=$P(DGX2,U,4);@381"
^XTV(8991,16,1,1,1,70,0)="305002 ;;S:$G(DGX1)=2 Y=""@39"";.345///^S X=$P(DGX2,U,5);.346///^S X=$P(DGX2,U,6);.347///^S X=$P(DGX2,U,7);.348///^S X=$P(DGX2,U,8);.349///^S X=$P(DGX2,U,9);.34011///^S X=$P(DGX2,U,11);@39;K DGX1,DGX2;"
^XTV(8991,16,1,1,1,71,0)=" ;;S:$G(DUZ(""AG""))'=""E"" Y=""@36"";19903;19904;19905;@36401 ;;.01;.31115;S:($S(X']"""":1,X=3:1,X=9:1,1:0)) Y=""@41"" S:(X'=5) Y=.3111;.31116;.3111;S:X']"""" Y=""@41"";.3113;S:X']"""" Y=.3116;.3114;S:X']"""" Y=.3116;.3115:.3117;.2205;.3119;@41;"
^XTV(8991,16,1,1,1,72,0)="402 ;;.2514;.2515;S:($S(X']"""":1,X=3:1,X=9:1,1:0)) Y=""@42"" S:(X'=5) Y=.251;.2516;.251;S:X']"""" Y=""@42"";.252;S:X']"""" Y=.255;.253;S:X']"""" Y=.255;.254:.256;.2206;.258;@42;"
^XTV(8991,16,1,1,1,73,0)="501 ;;"
^XTV(8991,16,1,1,1,74,0)="502 ;;.381;.382///NOW;"
^XTV(8991,16,1,1,1,75,0)="503 ;;.383;"
^XTV(8991,16,1,1,1,76,0)="601 ;;.325;S:X']"""" Y=""@61"";S:$$FV^DGRPMS(X)'=1 Y="".328"";.3214;I X']"""" W !?4,$C(7),""Proof is required for Filipino Vet."" S Y="".325"";.328;.326;.327;.324;"
^XTV(8991,16,1,1,1,77,0)="601000 ;;.3285//NO;S:X'=""Y"" Y=""@61"";.3291;S:X']"""" Y=""@61"";S:$$FV^DGRPMS(X)'=1 Y="".3294"";.3214;I X']"""" W !?4,$C(7),""Proof is required for Filipino Vet."" S Y="".3291"";.3294;.3292;.3293;.329;"
^XTV(8991,16,1,1,1,78,0)="601001 ;;.32945//NO;S:X'=""Y"" Y=""@61"";.3296;S:X']"""" Y=""@61"";S:$$FV^DGRPMS(X)'=1 Y="".3299"";.3214;I X']"""" W !?4,$C(7),""Proof is required for Filipino Vet."" S Y="".3296"";.3299;.3297;.3298;.3295;@61;"
^XTV(8991,16,1,1,1,79,0)="602 ;;.525//NO;S:X'=""Y"" Y=""@62"";.526:.528;@62;"
^XTV(8991,16,1,1,1,80,0)="603 ;;.5291//NO;S:X'=""Y"" Y=""@63"";.5292:.5294;@63;"
^XTV(8991,16,1,1,1,81,0)="604 ;;.32101//NO;S:X'=""Y"" Y=""@64"";.32104;.32105;@64;"
^XTV(8991,16,1,1,1,82,0)="605 ;;.32102//NO;S:X'=""Y"" Y=""@65"";.32107;.32109;.3211;.3213;@65;"
^XTV(8991,16,1,1,1,83,0)="606 ;;.32103//NO;S:X'=""Y"" Y=""@66"";.3212;.32111;@66;"
^XTV(8991,16,1,1,1,84,0)="607 ;;.3221//NO;S:X'=""Y"" Y=""@67"";.3222;Q;.3223;@67;"
^XTV(8991,16,1,1,1,85,0)="608 ;;.3224//NO;S:X'=""Y"" Y=""@68"";.3225;Q;.3226;@68;"
^XTV(8991,16,1,1,1,86,0)="609 ;;.3227//NO;S:X'=""Y"" Y=""@69"";.3228;Q;.3229;@69;"
^XTV(8991,16,1,1,1,87,0)="610 ;;.32201//NO;S:X'=""Y"" Y=""@610"";.322011;Q;.322012;@610;"
^XTV(8991,16,1,1,1,88,0)="611 ;;.322016//NO;S:X'=""Y"" Y=""@611"";.322017;Q;.322018;@611;"
^XTV(8991,16,1,1,1,89,0)="612 ;;.322013//NO;S:X'=""Y"" Y=""@612"";.322014;Q;.322015;@612;"
^XTV(8991,16,1,1,1,90,0)="613 ;;I $P($G(^DPT(DFN,.361)),U,3)=""H"" S Y=""@6131"";.3602//NO;.3603//NO;S Y=""@6132"";@6131;.3602;.3603;@6132;"
^XTV(8991,16,1,1,1,91,0)="614 ;;.368//NO;.369//NO;I $S('$D(^DPT(DA,.36)):1,$P(^(.36),U,8)=""Y""!($P(^(.36),U,9)=""Y""):0,1:1) S Y=""@614"";.37;@614;"
^XTV(8991,16,1,1,1,92,0)="615 ;;.322019//NO;S:X'=""Y"" Y=""@615"";.32202;Q;.322021;@615;"
^XTV(8991,16,1,1,1,93,0)="616 ;;S DGPHFLG=0;.531;S:X'=""Y"" DGX=X,Y=""@616"";.532///^S X=""PENDING"";S Y=""@6161"";@616;S:DGX'=""N"" Y=""@6162"";.533///^S X=""VAMC"";@6161;S DGPHFLG=1;.535///^S X=$$DIV^DGRPLE();@6162;"
^XTV(8991,16,1,1,1,94,0)="617 ;;D REG^DGNTQ(DFN);"
^XTV(8991,16,1,1,1,95,0)="AD N DGZ4,DGPC"
^XTV(8991,16,1,1,1,96,0)=" S X=$S($D(^DPT(DA,.11)):^(.11),1:""""),DGZ4=$P(X,U,12),DGPHONE=$S($D(^(.13)):$P(^(.13),U,1),1:""""),Y=$S($D(^(DGADD)):^(DGADD),1:""""),^(DGADD)=$P(Y,U,1)_U_$P(Y,U,2)_U_$P(X,U,1,6)_U_DGPHONE_U_$P(Y,U,10)"
^XTV(8991,16,1,1,1,97,0)=" I DGZ4 S DGPC=$S((DGADD=.33):1,(DGADD=.34):2,(DGADD=.211):3,(DGADD=.331):4,(DGADD=.311):5,(DGADD=.25):6,(DGADD=.21):7,1:0) S:DGPC $P(^DPT(DFN,.22),U,DGPC)=DGZ4"
^XTV(8991,16,1,1,1,98,0)=" K DGADD,DGPHONE Q"
^XTV(8991,16,1,1,1,99,0)="DR109 ;Drop through (use same logic as DR203)"
^XTV(8991,16,1,1,1,100,0)="DR203 S DR(2,2.02)="".01RACE;I $P($G(^DIC(10.3,+$P($G(^DPT(DA(1),.02,DA,0)),""""^"""",2),0)),""""^"""",2)=""""S"""" S Y=""""@2031"""";.02;@2031;"""
^XTV(8991,16,1,1,1,101,0)=" S DR(2,2.06)="".01ETHNICITY;I $P($G(^DIC(10.3,+$P($G(^DPT(DA(1),.06,DA,0)),""""^"""",2),0)),""""^"""",2)=""""S"""" S Y=""""@2032"""";.02;@2032;"""
^XTV(8991,16,1,1,1,102,0)=" Q"
^XTV(8991,16,1,1,1,103,0)="DR111 ;Set DR string for Confidential Address categories"
^XTV(8991,16,1,1,1,104,0)=" S DR(2,2.141)="".01;1//YES;"""
^XTV(8991,16,1,1,1,105,0)=" Q"
^XTV(8991,16,1,"B",3061009.2352,1)=""
^XTV(8991,17,0)="DGREGAED"
^XTV(8991,17,1,0)="^8991.01^1^1"
^XTV(8991,17,1,1,0)="3061010.0805"
^XTV(8991,17,1,1,1,0)="^8991.11^167^167"
^XTV(8991,17,1,1,1,1,0)="DGREGAED ;ALB/DW/PHH - Address Edit API; 1/5/2006  23:03 ;10/10/06  08:05"
^XTV(8991,17,1,1,1,2,0)=" ;;5.3;Registration;**522,560,658,634**;Aug 13, 1993"
^XTV(8991,17,1,1,1,3,0)="EN(DFN,FLG) ;Entry point"
^XTV(8991,17,1,1,1,4,0)=" ;Input: "
^XTV(8991,17,1,1,1,5,0)=" ;  DFN (required) - Internal Entry # of Patient File (#2)"
^XTV(8991,17,1,1,1,6,0)=" ;  FLG (optional) - Flags of 1 or 0; if null, 0 is assumed. Details:"
^XTV(8991,17,1,1,1,7,0)=" ;    FLG(1) - if 1, let user edit phone numbers (field #.131 and #.132)"
^XTV(8991,17,1,1,1,8,0)=" ;    FLG(2) - if 1, display before & after address for user confirmation"
^XTV(8991,17,1,1,1,9,0)=" K EASZIPLK"
^XTV(8991,17,1,1,1,10,0)=" N DGINPUT"
^XTV(8991,17,1,1,1,11,0)=" N I,X,Y"
^XTV(8991,17,1,1,1,12,0)=" I $G(DFN)="""" Q"
^XTV(8991,17,1,1,1,13,0)=" I ($G(DFN)'?.N) Q"
^XTV(8991,17,1,1,1,14,0)=" S FLG(1)=$G(FLG(1)),FLG(2)=$G(FLG(2))"
^XTV(8991,17,1,1,1,15,0)=" D INPUT(.DGINPUT,DFN)"
^XTV(8991,17,1,1,1,16,0)=" I $G(DGINPUT)=-1 Q"
^XTV(8991,17,1,1,1,17,0)=" I $G(FLG(2))=1 D COMPARE(.DGINPUT,DFN)"
^XTV(8991,17,1,1,1,18,0)=" I '$$CONFIRM() W !,""Change aborted."" D EOP Q"
^XTV(8991,17,1,1,1,19,0)=" N DGPRIOR"
^XTV(8991,17,1,1,1,20,0)=" D GETPRIOR^DGADDUTL(DFN,.DGPRIOR)"
^XTV(8991,17,1,1,1,21,0)=" D SAVE(.DGINPUT,DFN)"
^XTV(8991,17,1,1,1,22,0)=" I +$G(DGNEW) Q"
^XTV(8991,17,1,1,1,23,0)=" Q:'$$FILEYN^DGADDUTL(.DGPRIOR,.DGINPUT)"
^XTV(8991,17,1,1,1,24,0)=" D GETUPDTS^DGADDUTL(DFN,.DGINPUT)"
^XTV(8991,17,1,1,1,25,0)=" D UPDADDLG^DGADDUTL(DFN,.DGPRIOR,.DGINPUT)"
^XTV(8991,17,1,1,1,26,0)=" Q"
^XTV(8991,17,1,1,1,27,0)="INPUT(DGINPUT,DFN) ;Let user input address changes"
^XTV(8991,17,1,1,1,28,0)=" ;Output: DGINPUT(field#)=external^internal(if any)"
^XTV(8991,17,1,1,1,29,0)=" N DIR,X,Y,DA,DGR,DTOUT,DUOUT,DIROUT,DGN,POP"
^XTV(8991,17,1,1,1,30,0)=" S POP=0"
^XTV(8991,17,1,1,1,31,0)=" ;"
^XTV(8991,17,1,1,1,32,0)=" ; ** VOE change 1 of 3: DAOU/WCJ 2/7/2005,VA/CJS,WV/TOAD 1/5/2006 **"
^XTV(8991,17,1,1,1,33,0)=" ;"
^XTV(8991,17,1,1,1,34,0)=" ; .134 is new field ALTERNATE PHONE for VOE"
^XTV(8991,17,1,1,1,35,0)=" ;"
^XTV(8991,17,1,1,1,36,0)=" ; before change:"
^XTV(8991,17,1,1,1,37,0)=" ;"
^XTV(8991,17,1,1,1,38,0)=" ; F DGN=.111,.112,.113,.1112,.131,.132,.121 Q:POP  D"
^XTV(8991,17,1,1,1,39,0)=" ;"
^XTV(8991,17,1,1,1,40,0)=" ; after change:"
^XTV(8991,17,1,1,1,41,0)=" ;"
^XTV(8991,17,1,1,1,42,0)=" F DGN=.111,.112,.113,.1112,.131,.132,.134,.121 Q:POP  D"
^XTV(8991,17,1,1,1,43,0)=" . ;"
^XTV(8991,17,1,1,1,44,0)=" . ; end change"
^XTV(8991,17,1,1,1,45,0)=" . ;"
^XTV(8991,17,1,1,1,46,0)=" . I ($G(DGINPUT(.111))="""")&((DGN=.112)!(DGN=.113)) Q"
^XTV(8991,17,1,1,1,47,0)=" . I ($G(DGINPUT(.112))="""")&(DGN=.113) Q"
^XTV(8991,17,1,1,1,48,0)=" . I ($G(FLG(1))'=1)&((DGN=.131)!(DGN=.132)) Q"
^XTV(8991,17,1,1,1,49,0)=" . I DGN=.1112 D  Q"
^XTV(8991,17,1,1,1,50,0)=" .. D EN^DGREGAZL(.DGR,DFN)"
^XTV(8991,17,1,1,1,51,0)=" .. I $G(DGR)=-1 S POP=1 Q"
^XTV(8991,17,1,1,1,52,0)=" .. N DGM F DGM=.1112,.114,.115,.117 S DGINPUT(DGM)=$G(DGR(DGM))"
^XTV(8991,17,1,1,1,53,0)=" . ;"
^XTV(8991,17,1,1,1,54,0)=" . ; new line:"
^XTV(8991,17,1,1,1,55,0)=" . ;"
^XTV(8991,17,1,1,1,56,0)=" . I DGN=.134,$G(DUZ(""AG""))'=""E"" Q"
^XTV(8991,17,1,1,1,57,0)=" . ;"
^XTV(8991,17,1,1,1,58,0)=" . ; ** end of VOE change 1 **"
^XTV(8991,17,1,1,1,59,0)=" . ;"
^XTV(8991,17,1,1,1,60,0)="AGN . S DIR(0)=2_"",""_DGN"
^XTV(8991,17,1,1,1,61,0)=" . S DA=DFN"
^XTV(8991,17,1,1,1,62,0)=" . D ^DIR"
^XTV(8991,17,1,1,1,63,0)=" . I $D(DTOUT) S POP=1 Q"
^XTV(8991,17,1,1,1,64,0)=" . I $D(DUOUT)!$D(DIROUT) D UPCT G AGN"
^XTV(8991,17,1,1,1,65,0)=" . I DGN'=.121 S DGINPUT(DGN)=$G(Y)"
^XTV(8991,17,1,1,1,66,0)=" . I DGN=.121 D"
^XTV(8991,17,1,1,1,67,0)=" .. I $P($G(Y),U)=$$GET1^DIQ(2,DFN_"","",DGN,""I"") D"
^XTV(8991,17,1,1,1,68,0)=" ... S DGINPUT(DGN)=$$GET1^DIQ(2,DFN_"","",DGN)_U_$P($G(Y),U)"
^XTV(8991,17,1,1,1,69,0)=" .. I $P($G(Y),U)'=$$GET1^DIQ(2,DFN_"","",DGN,""I"") D"
^XTV(8991,17,1,1,1,70,0)=" ... S DGINPUT(DGN)=$P($G(Y(0)),U)_U_$G(Y)"
^XTV(8991,17,1,1,1,71,0)=" I $G(POP)=1 S DGINPUT=-1"
^XTV(8991,17,1,1,1,72,0)=" Q"
^XTV(8991,17,1,1,1,73,0)="COMPARE(DGINPUT,DFN) ;Display before & after address fileds."
^XTV(8991,17,1,1,1,74,0)=" N DGCURR,DGN,DGCMP,DGM,DGCNTY,DGCIEN,DGST"
^XTV(8991,17,1,1,1,75,0)=" D GETS^DIQ(2,DFN_"","","".111;.112;.113;.114;.115;.117;.1112;.131;.132;.121"",""EI"",""DGCURR"")"
^XTV(8991,17,1,1,1,76,0)=" ;"
^XTV(8991,17,1,1,1,77,0)=" ; ** VOE change 2 of 3: DAOU/WCJ 2/7/2005,VA/CJS,WV/TOAD 1/5/2006 **"
^XTV(8991,17,1,1,1,78,0)=" ;"
^XTV(8991,17,1,1,1,79,0)=" ; for VOE agency code, add new ALTERNATE PHONE field (.134)"
^XTV(8991,17,1,1,1,80,0)=" ; to DGCMP(""OLD"") array"
^XTV(8991,17,1,1,1,81,0)=" ;"
^XTV(8991,17,1,1,1,82,0)=" ; before change:"
^XTV(8991,17,1,1,1,83,0)=" ;"
^XTV(8991,17,1,1,1,84,0)=" ; F DGN=.111,.112,.113,.114,.115,.117,.1112,.131,.132,.121 D"
^XTV(8991,17,1,1,1,85,0)=" ; . S DGCMP(""OLD"",DGN)=$G(DGCURR(2,DFN_"","",DGN,""E""))"
^XTV(8991,17,1,1,1,86,0)=" ;"
^XTV(8991,17,1,1,1,87,0)=" ; after change:"
^XTV(8991,17,1,1,1,88,0)=" ;"
^XTV(8991,17,1,1,1,89,0)=" I $G(DUZ(""AG""))=""E"" D GETS^DIQ(2,DFN,.134,""EI"",""DGCURR"")"
^XTV(8991,17,1,1,1,90,0)=" F DGN=.111,.112,.113,.114,.115,.117,.1112,.131,.132,.134,.121 D"
^XTV(8991,17,1,1,1,91,0)=" . I $G(DUZ(""AG""))'=""E"",DGN=.134 Q  ; skip for non-VOE"
^XTV(8991,17,1,1,1,92,0)=" . ;"
^XTV(8991,17,1,1,1,93,0)=" . ; ** end of VOE change 2 **"
^XTV(8991,17,1,1,1,94,0)=" . ;"
^XTV(8991,17,1,1,1,95,0)=" . S DGCMP(""OLD"",DGN)=$G(DGCURR(2,DFN_"","",DGN,""E""))"
^XTV(8991,17,1,1,1,96,0)=" S DGCIEN=$G(DGCURR(2,DFN_"","",.117,""I""))"
^XTV(8991,17,1,1,1,97,0)=" S DGST=$G(DGCURR(2,DFN_"","",.115,""I""))"
^XTV(8991,17,1,1,1,98,0)=" S DGCNTY=$$CNTY^DGREGAZL(DGST,DGCIEN)"
^XTV(8991,17,1,1,1,99,0)=" I DGCNTY=-1 S DGCNTY="""""
^XTV(8991,17,1,1,1,100,0)=" S DGCMP(""OLD"",.117)=$P(DGCNTY,U)_"" ""_$P(DGCNTY,U,3)"
^XTV(8991,17,1,1,1,101,0)=" M DGCMP(""NEW"")=DGINPUT"
^XTV(8991,17,1,1,1,102,0)=" S DGCNTY=$P($G(DGCMP(""NEW"",.117)),U)_"" ""_$P($G(DGCMP(""NEW"",.117)),U,3)"
^XTV(8991,17,1,1,1,103,0)=" S DGCMP(""NEW"",.117)=DGCNTY"
^XTV(8991,17,1,1,1,104,0)=" I ($L(DGCMP(""NEW"",.1112))>5)&($P(DGCMP(""NEW"",.1112),""-"",2)="""") S DGCMP(""NEW"",.1112)=$E(DGCMP(""NEW"",.1112),1,5)_""-""_$E(DGCMP(""NEW"",.1112),6,9)"
^XTV(8991,17,1,1,1,105,0)=" F DGM=""OLD"",""NEW"" D"
^XTV(8991,17,1,1,1,106,0)=" . W !,?2,""["",DGM,"" ADDRESS]"""
^XTV(8991,17,1,1,1,107,0)=" . W ?16,$P($G(DGCMP(DGM,.111)),U)"
^XTV(8991,17,1,1,1,108,0)=" . I $P($G(DGCMP(DGM,.112)),U)'="""" W !,?16,$P($G(DGCMP(DGM,.112)),U)"
^XTV(8991,17,1,1,1,109,0)=" . I $P($G(DGCMP(DGM,.113)),U)'="""" W !,?16,$P($G(DGCMP(DGM,.113)),U)"
^XTV(8991,17,1,1,1,110,0)=" . W !,?16,$P($G(DGCMP(DGM,.114)),U)"
^XTV(8991,17,1,1,1,111,0)=" . W:($P($G(DGCMP(DGM,.114)),U)'="""")!($P($G(DGCMP(DGM,.115)),U)'="""") "","""
^XTV(8991,17,1,1,1,112,0)=" . W $P($G(DGCMP(DGM,.115)),U)"
^XTV(8991,17,1,1,1,113,0)=" . W "" "",$G(DGCMP(DGM,.1112))"
^XTV(8991,17,1,1,1,114,0)=" . I $P($G(DGCMP(DGM,.117)),U)'="""" W !,?6,""  County: "",$P($G(DGCMP(DGM,.117)),U)"
^XTV(8991,17,1,1,1,115,0)=" . I $G(FLG(1))=1 D"
^XTV(8991,17,1,1,1,116,0)=" .. W !,?6,""   Phone: "",?16,$P($G(DGCMP(DGM,.131)),U)"
^XTV(8991,17,1,1,1,117,0)=" .. W !,?6,""  Office: "",?16,$P($G(DGCMP(DGM,.132)),U)"
^XTV(8991,17,1,1,1,118,0)=" .. ;"
^XTV(8991,17,1,1,1,119,0)=" .. ; ** VOE change 3 of 3: DAOU/WCJ 2/7/2005,VA/CJS,WV/TOAD 1/5/2006 **"
^XTV(8991,17,1,1,1,120,0)=" .. ;"
^XTV(8991,17,1,1,1,121,0)=" .. ; for VOE agency code, display new ALTERNATE PHONE field (.134)"
^XTV(8991,17,1,1,1,122,0)=" .. ;"
^XTV(8991,17,1,1,1,123,0)=" .. ; insert line:"
^XTV(8991,17,1,1,1,124,0)=" .. ;"
^XTV(8991,17,1,1,1,125,0)=" .. I $G(DUZ(""AG""))=""E"" W !,?6,"" Alt Phone: "",?16,$P($G(DGCMP(DGM,.134)),U)"
^XTV(8991,17,1,1,1,126,0)=" .. ;"
^XTV(8991,17,1,1,1,127,0)=" .. ; ** end of VOE change 3 **"
^XTV(8991,17,1,1,1,128,0)=" .. ;"
^XTV(8991,17,1,1,1,129,0)=" . W !,?6,""Bad Addr: "",?16,$P($G(DGCMP(DGM,.121)),U)"
^XTV(8991,17,1,1,1,130,0)=" . W !"
^XTV(8991,17,1,1,1,131,0)=" Q"
^XTV(8991,17,1,1,1,132,0)="CONFIRM() ;Confirm if user wants to save the change"
^XTV(8991,17,1,1,1,133,0)=" N DIR,X,Y,DTOUT,DUOUT,DIROUT"
^XTV(8991,17,1,1,1,134,0)=" S DIR(0)=""Y"""
^XTV(8991,17,1,1,1,135,0)=" S DIR(""A"")=""Are you sure that you want to save the above changes"""
^XTV(8991,17,1,1,1,136,0)=" S DIR(""?"")=""Please answer Y for YES or N for NO."""
^XTV(8991,17,1,1,1,137,0)=" D ^DIR"
^XTV(8991,17,1,1,1,138,0)=" I $D(DTOUT)!($G(Y)=0) Q 0"
^XTV(8991,17,1,1,1,139,0)=" I $D(DUOUT)!$D(DIROUT) Q 0"
^XTV(8991,17,1,1,1,140,0)=" Q 1"
^XTV(8991,17,1,1,1,141,0)="SAVE(DGINPUT,DFN) ;Save changes"
^XTV(8991,17,1,1,1,142,0)=" N DGN,DGER,DGM"
^XTV(8991,17,1,1,1,143,0)=" S DGER=0"
^XTV(8991,17,1,1,1,144,0)=" F DGN=.111,.112,.113,.131,.132,.1112,.114,.115,.117,.121 D"
^XTV(8991,17,1,1,1,145,0)=" . I ($G(FLG(1))'=1)&((DGN=.131)!(DGN=.132)) Q"
^XTV(8991,17,1,1,1,146,0)=" . N DGCODE,DGNAME,FDA,MSG"
^XTV(8991,17,1,1,1,147,0)=" . S DGCODE=$P($G(DGINPUT(DGN)),U,2)"
^XTV(8991,17,1,1,1,148,0)=" . S DGNAME=$P($G(DGINPUT(DGN)),U)"
^XTV(8991,17,1,1,1,149,0)=" . S FDA(2,DFN_"","",DGN)=$S(DGCODE:DGCODE,1:DGNAME)"
^XTV(8991,17,1,1,1,150,0)=" . D FILE^DIE($S(DGCODE:"""",1:""E""),""FDA"",""MSG"")"
^XTV(8991,17,1,1,1,151,0)=" . I $D(MSG) D"
^XTV(8991,17,1,1,1,152,0)=" .. S DGM="""",DGER=1"
^XTV(8991,17,1,1,1,153,0)=" .. W !,""Please review the saved changes!!"",!"
^XTV(8991,17,1,1,1,154,0)=" .. F  S DGM=$O(MSG(""DIERR"",1,""TEXT"",DGM)) Q:DGM=""""  D"
^XTV(8991,17,1,1,1,155,0)=" ... W $G(MSG(""DIERR"",1,""TEXT"",DGM))"
^XTV(8991,17,1,1,1,156,0)=" I $G(DGER)=0 W !,""Change saved."""
^XTV(8991,17,1,1,1,157,0)=" D EOP"
^XTV(8991,17,1,1,1,158,0)=" Q"
^XTV(8991,17,1,1,1,159,0)="EOP ;End of page prompt"
^XTV(8991,17,1,1,1,160,0)=" N DIR,DTOUT,DUOUT,DIROUT,X,Y"
^XTV(8991,17,1,1,1,161,0)=" S DIR(0)=""E"""
^XTV(8991,17,1,1,1,162,0)=" S DIR(""A"")=""Press ENTER to continue"""
^XTV(8991,17,1,1,1,163,0)=" D ^DIR"
^XTV(8991,17,1,1,1,164,0)=" Q"
^XTV(8991,17,1,1,1,165,0)="UPCT ;Indicate ""^"" or ""^^"" are unacceptable inputs."
^XTV(8991,17,1,1,1,166,0)=" W !,""EXIT NOT ALLOWED ??"""
^XTV(8991,17,1,1,1,167,0)=" Q"
^XTV(8991,17,1,"B",3061010.0805,1)=""
^XTV(8991,18,0)="DGRP1"
^XTV(8991,18,1,0)="^8991.01^1^1"
^XTV(8991,18,1,1,0)="3061010.0809"
^XTV(8991,18,1,1,1,0)="^8991.11^190^190"
^XTV(8991,18,1,1,1,1,0)="DGRP1 ;ALB/MRL - DEMOGRAPHIC DATA ;10/10/06  08:09"
^XTV(8991,18,1,1,1,2,0)=" ;;5.3;Registration;**109,161,506,244,546,570,629,638,649,700,634**;Aug 13, 1993"
^XTV(8991,18,1,1,1,3,0)=" ;"
^XTV(8991,18,1,1,1,4,0)=" ; 2005 03 18 (VA/JT): DG*5.3*629, stop Missing Patient message based"
^XTV(8991,18,1,1,1,5,0)=" ; on questionable data in Missing Person Date fld (.153)."
^XTV(8991,18,1,1,1,6,0)=" ;"
^XTV(8991,18,1,1,1,7,0)=" ; 2005 04 25? (VA/MRY): DG*5.3*638, add Sex to IDs shown."
^XTV(8991,18,1,1,1,8,0)=" ;"
^XTV(8991,18,1,1,1,9,0)=" ; 2005 04 27 (VA/JT): DG*5.3*649, change last $EXTRACT for Alias SSN in"
^XTV(8991,18,1,1,1,10,0)=" ; GETNCAL to 10 chars instead of 9, to preserve trailing P for pseudo-"
^XTV(8991,18,1,1,1,11,0)=" ; SSNs."
^XTV(8991,18,1,1,1,12,0)=" ;"
^XTV(8991,18,1,1,1,13,0)=" ; 2006 04 21 (WV/TOAD, after DAOU/WCJ (2005 02 07) and"
^XTV(8991,18,1,1,1,14,0)=" ; VA/CJS (2005/12/23)): restore 6-part VOE change; space dots and"
^XTV(8991,18,1,1,1,15,0)=" ; semi-colons."
^XTV(8991,18,1,1,1,16,0)=" ;"
^XTV(8991,18,1,1,1,17,0)=" ; 2006 05 09 (WV/TOAD): rewrite VOE change to fix bugs introduced by"
^XTV(8991,18,1,1,1,18,0)=" ; VA and VOE, and completely refactor bug-prone GETNCAL, and merge back"
^XTV(8991,18,1,1,1,19,0)=" ; into main subroutine body."
^XTV(8991,18,1,1,1,20,0)=" ;"
^XTV(8991,18,1,1,1,21,0)="EN S (DGRPS,DGRPW)=1 D H^DGRPU F I=0,.11,.121,.13,.15,.24,57 S DGRP(I)=$S($D(^DPT(DFN,I)):^(I),1:"""")"
^XTV(8991,18,1,1,1,22,0)=" I $P(DGRP(.15),""^"",2)]"""" S Z=""APPLICANT IS LISTED AS 'INELIGIBLE' FOR TREATMENT!"",DGRPCM=1 D WW^DGRPV S DGRPCM=0"
^XTV(8991,18,1,1,1,23,0)=" ;I $P(DGRP(.15),""^"",3)]"""" S Z=""APPLICANT IS LISTED AS 'MISSING'.  NOTIFY APPROPRIATE PERSONNEL!"",DGRPCM=1 D WW^DGRPV S DGRPCM=0"
^XTV(8991,18,1,1,1,24,0)=" ;"
^XTV(8991,18,1,1,1,25,0)=" ; ** VOE change 1 of 3 **"
^XTV(8991,18,1,1,1,26,0)=" ;"
^XTV(8991,18,1,1,1,27,0)=" ; if EHR agency code, display Registration Date (Date Entered into"
^XTV(8991,18,1,1,1,28,0)=" ; File, .097)"
^XTV(8991,18,1,1,1,29,0)=" ;"
^XTV(8991,18,1,1,1,30,0)=" ; new lines:"
^XTV(8991,18,1,1,1,31,0)=" I $G(DUZ(""AG""))=""E"" D"
^XTV(8991,18,1,1,1,32,0)=" . W !?58,""Reg Dt: "",$$FMTE^XLFDT($P(DGRP(0),U,16),""2D"")"
^XTV(8991,18,1,1,1,33,0)=" ;"
^XTV(8991,18,1,1,1,34,0)=" ;"
^XTV(8991,18,1,1,1,35,0)=" ; show field groups 1 and 2 in two columns"
^XTV(8991,18,1,1,1,36,0)=" ;"
^XTV(8991,18,1,1,1,37,0)=" ; field groups 1 & 2 part 1: show Name, SSN, and DOB"
^XTV(8991,18,1,1,1,38,0)=" ;"
^XTV(8991,18,1,1,1,39,0)=" ;"
^XTV(8991,18,1,1,1,40,0)=" ; ** end of VOE change 1 **"
^XTV(8991,18,1,1,1,41,0)=" ;"
^XTV(8991,18,1,1,1,42,0)=" W ! S Z=1 D WW^DGRPV W ""    Name: "" S Z=$P(DGRP(0),""^"",1),Z1=31 D WW1^DGRPV W ""SS: "" S X=$P(DGRP(0),""^"",9),Z=$E(X,1,3)_""-""_$E(X,4,5)_""-""_$E(X,6,10),Z1=13 D WW1^DGRPV S Y=$P(DGRP(0),""^"",3) X ^DD(""DD"") W ""DOB: "",Y"
^XTV(8991,18,1,1,1,43,0)=" ;"
^XTV(8991,18,1,1,1,44,0)=" ; ** VOE change 2 of 3 **"
^XTV(8991,18,1,1,1,45,0)=" ;"
^XTV(8991,18,1,1,1,46,0)=" ; eliminate unnecessary subroutine GETNCAL and merge code back into"
^XTV(8991,18,1,1,1,47,0)=" ; the main subroutine, and make the following changes:"
^XTV(8991,18,1,1,1,48,0)=" ;"
^XTV(8991,18,1,1,1,49,0)=" ; For EHR or IHS agency code, show Health Record No. (.02) for the"
^XTV(8991,18,1,1,1,50,0)=" ; current Facility from the Health Record No. multiple field"
^XTV(8991,18,1,1,1,51,0)=" ; (4101/9000001.41) of the IHS Patient file (9000001) for the current"
^XTV(8991,18,1,1,1,52,0)=" ; patient."
^XTV(8991,18,1,1,1,53,0)=" ;"
^XTV(8991,18,1,1,1,54,0)=" ; Move Sex field over so it shows up in the same location for"
^XTV(8991,18,1,1,1,55,0)=" ; VA, IHS, and EHR, leaving a blank for where HRN can appear."
^XTV(8991,18,1,1,1,56,0)=" ;"
^XTV(8991,18,1,1,1,57,0)=" ; Fix the VA bug in which patients having five valid aliases"
^XTV(8991,18,1,1,1,58,0)=" ; were showing ""< More alias entries on file >"" instead of the fifth"
^XTV(8991,18,1,1,1,59,0)=" ; alias."
^XTV(8991,18,1,1,1,60,0)=" ;"
^XTV(8991,18,1,1,1,61,0)=" ; Refactor entire subroutine: clean original design was broken"
^XTV(8991,18,1,1,1,62,0)=" ; by patching and had become fragile and confusing; tighten variable"
^XTV(8991,18,1,1,1,63,0)=" ; scopes, use clearer names, comment."
^XTV(8991,18,1,1,1,64,0)=" ;"
^XTV(8991,18,1,1,1,65,0)=" ; before:"
^XTV(8991,18,1,1,1,66,0)=" ;"
^XTV(8991,18,1,1,1,67,0)=" ; D GETNCAL  ;Display name component, sex, and alias information"
^XTV(8991,18,1,1,1,68,0)=" ;"
^XTV(8991,18,1,1,1,69,0)=" ; after:"
^XTV(8991,18,1,1,1,70,0)=" ;"
^XTV(8991,18,1,1,1,71,0)=" ; field groups 1 & 2 part 2: load name components"
^XTV(8991,18,1,1,1,72,0)=" ;"
^XTV(8991,18,1,1,1,73,0)=" ;"
^XTV(8991,18,1,1,1,74,0)=" N DGLABEL S DGLABEL=""^ Given^Middle^Prefix^Suffix^Degree"" ; labels"
^XTV(8991,18,1,1,1,75,0)=" N DGCOMP S DGCOMP=+$G(^DPT(DFN,""NAME""))_"","" ; Name Components fd (1.01)"
^XTV(8991,18,1,1,1,76,0)=" I DGCOMP D GETS^DIQ(20,DGCOMP,""1:6"",,""DGCOMP"") ; Name Components file"
^XTV(8991,18,1,1,1,77,0)=" ; loads Family (Last) Name (1), Given (First) Name (2),"
^XTV(8991,18,1,1,1,78,0)=" ; Middle Name (3), Prefix (4), Suffix (5), and Degree (6)"
^XTV(8991,18,1,1,1,79,0)=" ;"
^XTV(8991,18,1,1,1,80,0)=" ;"
^XTV(8991,18,1,1,1,81,0)=" ; field groups 1 & 2 part 3: load aliases"
^XTV(8991,18,1,1,1,82,0)=" ;"
^XTV(8991,18,1,1,1,83,0)=" ;"
^XTV(8991,18,1,1,1,84,0)=" N DGCOUNT S DGCOUNT=0 ; how many aliases do we find"
^XTV(8991,18,1,1,1,85,0)=" N DGALIAS S DGALIAS=0 ; IEN of Alias subfile (1/2.01) of Patient fl (2)"
^XTV(8991,18,1,1,1,86,0)=" ;                       and array of aliases found"
^XTV(8991,18,1,1,1,87,0)=" S DGALIAS=0 F  D  Q:'DGALIAS"
^XTV(8991,18,1,1,1,88,0)=" . ;"
^XTV(8991,18,1,1,1,89,0)=" . S DGALIAS=$O(^DPT(DFN,.01,DGALIAS))"
^XTV(8991,18,1,1,1,90,0)=" . Q:'DGALIAS  ; out of alias subrecords"
^XTV(8991,18,1,1,1,91,0)=" . N DGNODE S DGNODE=$G(^DPT(DFN,.01,DGALIAS,0)) ; 0-node of subrecord"
^XTV(8991,18,1,1,1,92,0)=" . Q:'$L(DGNODE)  ; bad node"
^XTV(8991,18,1,1,1,93,0)=" . ;"
^XTV(8991,18,1,1,1,94,0)=" . S DGCOUNT=DGCOUNT+1 ; another valid alias"
^XTV(8991,18,1,1,1,95,0)=" . I DGCOUNT=6 S DGALIAS=0 Q  ; can't show > 5, need to know if 6 or >"
^XTV(8991,18,1,1,1,96,0)=" . ;"
^XTV(8991,18,1,1,1,97,0)=" . S DGALIAS(DGCOUNT)=$P(DGNODE,U) ; Alias fld (.01)"
^XTV(8991,18,1,1,1,98,0)=" . ;"
^XTV(8991,18,1,1,1,99,0)=" . N DGSSN S DGSSN=$P(DGNODE,U,2) ; Alias SSN fld (1)"
^XTV(8991,18,1,1,1,100,0)=" . I $L(DGSSN) D"
^XTV(8991,18,1,1,1,101,0)=" . . S DGSSN="" ""_$E(DGSSN,1,3)_""-""_$E(DGSSN,4,5)_""-""_$E(DGSSN,6,10)"
^XTV(8991,18,1,1,1,102,0)=" . . ; incl leading space to separate from alias name"
^XTV(8991,18,1,1,1,103,0)=" . . ; incl 10 chars to allow for P of pseudo-SSNs"
^XTV(8991,18,1,1,1,104,0)=" . . S $E(DGALIAS(DGCOUNT),20)=DGSSN ; truncate alias name & append SSN"
^XTV(8991,18,1,1,1,105,0)=" . ;"
^XTV(8991,18,1,1,1,106,0)=" . S DGALIAS(DGCOUNT)=$E(DGALIAS(DGCOUNT),1,32) ; truncate alias"
^XTV(8991,18,1,1,1,107,0)=" ;"
^XTV(8991,18,1,1,1,108,0)=" I DGCOUNT=0 S DGALIAS(1)=""< No alias entries on file >"""
^XTV(8991,18,1,1,1,109,0)=" I DGCOUNT=6 S DGALIAS(5)=""< More alias entries on file >"""
^XTV(8991,18,1,1,1,110,0)=" K DGCOUNT"
^XTV(8991,18,1,1,1,111,0)=" ;"
^XTV(8991,18,1,1,1,112,0)=" ;"
^XTV(8991,18,1,1,1,113,0)=" ; field groups 1 & 2 part 4: show 1st name component, and IDs HRN & Sex"
^XTV(8991,18,1,1,1,114,0)=" ;"
^XTV(8991,18,1,1,1,115,0)=" ;"
^XTV(8991,18,1,1,1,116,0)=" W !?5,""Family: """
^XTV(8991,18,1,1,1,117,0)=" W $E($G(DGCOMP(20,DGCOMP,1)),1,27)"
^XTV(8991,18,1,1,1,118,0)=" ;"
^XTV(8991,18,1,1,1,119,0)=" I ""EI""[$G(DUZ(""AG"")),$G(DUZ(2)) D"
^XTV(8991,18,1,1,1,120,0)=" . N DGNODE S DGNODE=$G(^AUPNPAT(DFN,41,DUZ(2),0)) ; get 0-node for the"
^XTV(8991,18,1,1,1,121,0)=" . ; current Facility from the Health Record No. multiple field"
^XTV(8991,18,1,1,1,122,0)=" . ; (4101/9000001.41) for DFN in the IHS Patient file (9000001)"
^XTV(8991,18,1,1,1,123,0)=" . N DGHRN S DGHRN=$P(DGNODE,U,2) ; Health Record No. (.02)"
^XTV(8991,18,1,1,1,124,0)=" . W ?42,"" HRN: "",DGHRN"
^XTV(8991,18,1,1,1,125,0)=" ;"
^XTV(8991,18,1,1,1,126,0)=" D"
^XTV(8991,18,1,1,1,127,0)=" . N DGSEX S DGSEX=$P(DGRP(0),U,2) ; Sex fld (.02) of Patient file (2)"
^XTV(8991,18,1,1,1,128,0)=" . W ?61,""Sex: "",$S(X=""M"":""MALE"",X=""F"":""FEMALE"",1:""UNANSWERED"")"
^XTV(8991,18,1,1,1,129,0)=" ;"
^XTV(8991,18,1,1,1,130,0)=" ;"
^XTV(8991,18,1,1,1,131,0)=" ; field groups 1 & 2 part 5: show remaining name components and aliases"
^XTV(8991,18,1,1,1,132,0)=" ;"
^XTV(8991,18,1,1,1,133,0)=" ;"
^XTV(8991,18,1,1,1,134,0)=" N DGCOUNT F DGCOUNT=2:1:6 D"
^XTV(8991,18,1,1,1,135,0)=" . W !?5,$P(DGLABEL,U,DGCOUNT),"": """
^XTV(8991,18,1,1,1,136,0)=" . N DGNAME S DGNAME=$G(DGCOMP(20,DGCOMP,DGCOUNT)) ; next name component"
^XTV(8991,18,1,1,1,137,0)=" . W $E(DGNAME,1,$S(DGCOUNT=2:23,1:27)) ; 1st line leaves room for ""[2]"""
^XTV(8991,18,1,1,1,138,0)=" . I DGCOUNT=2 D  ; header for aliases"
^XTV(8991,18,1,1,1,139,0)=" . . W ?37 N DGRPW,Z S DGRPW=0,Z=2 D WW^DGRPV ; write [2], suppress LF"
^XTV(8991,18,1,1,1,140,0)=" . . W "" Alias: """
^XTV(8991,18,1,1,1,141,0)=" . W ?47,$G(DGALIAS(DGCOUNT-1)) ; show next alias"
^XTV(8991,18,1,1,1,142,0)=" ;"
^XTV(8991,18,1,1,1,143,0)=" ;"
^XTV(8991,18,1,1,1,144,0)=" ; show field group 3: remarks"
^XTV(8991,18,1,1,1,145,0)=" ;"
^XTV(8991,18,1,1,1,146,0)=" ;"
^XTV(8991,18,1,1,1,147,0)=" ; ** end of VOE change 2 **"
^XTV(8991,18,1,1,1,148,0)=" ;"
^XTV(8991,18,1,1,1,149,0)=" S Z=3,DGRPX=DGRP(0) D WW^DGRPV W "" Remarks: "",$S($P(DGRPX,""^"",10)]"""":$E($P(DGRPX,""^"",10),1,65),1:""NO REMARKS ENTERED FOR THIS PATIENT"") S DGAD=.11,(DGA1,DGA2)=1 D A^DGRPU I $P(DGRP(.121),""^"",9)=""Y"" S DGAD=.121,DGA1=1,DGA2=2 D A^DGRPU"
^XTV(8991,18,1,1,1,150,0)=" S Z=4 D WW^DGRPV W "" Permanent Address: "" S Z="" "",Z1=17"
^XTV(8991,18,1,1,1,151,0)=" D WW1^DGRPV S Z=5,DGRPW=0 D WW^DGRPV W "" Temporary Address: """
^XTV(8991,18,1,1,1,152,0)=" W !?11"
^XTV(8991,18,1,1,1,153,0)=" S Z1=40,Z=$S($D(DGA(1)):DGA(1),1:""NONE ON FILE"") D WW1^DGRPV W $S($D(DGA(2)):DGA(2),1:""NO TEMPORARY ADDRESS"")"
^XTV(8991,18,1,1,1,154,0)=" S I=2 F I1=0:0 S I=$O(DGA(I)) Q:I=""""  W:(I#2)!($X>50) !?11 W:'(I#2) ?51 W DGA(I)"
^XTV(8991,18,1,1,1,155,0)=" S DGCC=$S($D(^DIC(5,+$P(DGRP(.11),U,5),1,+$P(DGRP(.11),U,7),0)):$E($P(^(0),U,1),1,20)_$S($P(^(0),U,3)]"""":"" (""_$P(^(0),U,3)_"")"",1:""""),1:DGRPU) W !?3,""County: "",DGCC K DGCC"
^XTV(8991,18,1,1,1,156,0)=" S DGCC=$S($P(DGRP(.121),U,9)'=""Y"":""NOT APPLICABLE"",$D(^DIC(5,+$P(DGRP(.121),U,5),1,+$P(DGRP(.121),U,11),0)):$E($P(^(0),U,1),1,20)_$S($P(^(0),U,3)]"""":"" (""_$P(^(0),U,3)_"")"",1:""""),1:DGRPU) W ?43,""County: "",DGCC K DGCC"
^XTV(8991,18,1,1,1,157,0)=" W !?4,""Phone: "",$S($P(DGRP(.13),U,1)]"""":$P(DGRP(.13),U,1),1:DGRPU),?44,""Phone: "",$S($P(DGRP(.121),U,9)'=""Y"":""NOT APPLICABLE"",$P(DGRP(.121),U,10)]"""":$P(DGRP(.121),U,10),1:DGRPU)"
^XTV(8991,18,1,1,1,158,0)=" S X=""NOT APPLICABLE"" I $P(DGRP(.121),U,9)=""Y"" S Y=$P(DGRP(.121),U,7) X:Y]"""" ^DD(""DD"") S X=$S(Y]"""":Y,1:DGRPU)_""-"",Y=$P(DGRP(.121),U,8) X:Y]"""" ^DD(""DD"") S X=X_$S(Y]"""":Y,1:DGRPU)"
^XTV(8991,18,1,1,1,159,0)=" W !?3,""Office: "",$S($P(DGRP(.13),U,2)]"""":$P(DGRP(.13),U,2),1:DGRPU),?42,""From/To: "",X"
^XTV(8991,18,1,1,1,160,0)=" ;"
^XTV(8991,18,1,1,1,161,0)=" ; ** VOE change 3 of 3 **"
^XTV(8991,18,1,1,1,162,0)=" ;"
^XTV(8991,18,1,1,1,163,0)=" ; if EHR agency code, display Alternate Phone Number (.134)"
^XTV(8991,18,1,1,1,164,0)=" ;"
^XTV(8991,18,1,1,1,165,0)=" ; new lines:"
^XTV(8991,18,1,1,1,166,0)=" I $G(DUZ(""AG""))=""E"" D"
^XTV(8991,18,1,1,1,167,0)=" . W !?1,""Alt Ph: "",$P($G(^DPT(DFN,.13)),U,4)"
^XTV(8991,18,1,1,1,168,0)=" ;"
^XTV(8991,18,1,1,1,169,0)=" ; ** end of VOE change 3 **"
^XTV(8991,18,1,1,1,170,0)=" ;"
^XTV(8991,18,1,1,1,171,0)=" W !?1,""Bad Addr: "",$$EXTERNAL^DILFD(2,.121,"""",$P(DGRP(.11),U,16))"
^XTV(8991,18,1,1,1,172,0)=" ;"
^XTV(8991,18,1,1,1,173,0)=" ; ***  Additional displays added for Pre-Registration"
^XTV(8991,18,1,1,1,174,0)=" I $G(DGPRFLG)=1 D"
^XTV(8991,18,1,1,1,175,0)=" . W !"
^XTV(8991,18,1,1,1,176,0)=" . N I,MIS1,X,X1,SA1,TP1,X2,X3,ES1"
^XTV(8991,18,1,1,1,177,0)=" . I $D(^DIA(2,""B"",DFN)) S X="""" F I=1:1 S X=$O(^DIA(2,""B"",DFN,X)) Q:X<1  I $P(^DIA(2,X,0),U,3)=.05 S MIS1=$P(^DIA(2,X,0),U,2)"
^XTV(8991,18,1,1,1,178,0)=" . W:$D(MIS1)>0 !,"" [MARITAL STATUS CHANGED:] ""_$$FMTE^XLFDT(MIS1,""5D"")"
^XTV(8991,18,1,1,1,179,0)=" . I $D(^DIA(2,""B"",DFN)) S X1="""" F I=1:1 S X1=$O(^DIA(2,""B"",DFN,X1)) Q:X1<1  S:$P(^DIA(2,X1,0),U,3)=.111 SA1=$P(^DIA(2,X1,0),U,2)"
^XTV(8991,18,1,1,1,180,0)=" . W:$D(SA1)>0 !,"" [STREET ADDRESS LAST CHANGED:] ""_$$FMTE^XLFDT(SA1,""5D"")"
^XTV(8991,18,1,1,1,181,0)=" . I $D(^DIA(2,""B"",DFN)) S X2="""" F I=1:1 S X2=$O(^DIA(2,""B"",DFN,X2)) Q:X2<1  S:$P(^DIA(2,X2,0),U,3)=.131 TP1=$P(^DIA(2,X2,0),U,2)"
^XTV(8991,18,1,1,1,182,0)=" . W:$D(TP1)>0 !,"" [HOME PHONE NUMBER CHANGED:] ""_$$FMTE^XLFDT(TP1,""5D"")"
^XTV(8991,18,1,1,1,183,0)=" . I $D(^DIA(2,""B"",DFN)) S X3="""" F I=1:1 S X3=$O(^DIA(2,""B"",DFN,X3)) Q:X3<1  S:$P(^DIA(2,X3,0),U,3)=.31115 ES1=$P(^DIA(2,X3,0),U,2)"
^XTV(8991,18,1,1,1,184,0)=" . W:$D(ES1)>0 !,"" [EMPLOYMENT STATUS CHANGED:] ""_$$FMTE^XLFDT(ES1,""5D"")"
^XTV(8991,18,1,1,1,185,0)=" . ; The IB Insurance API does not provide date entered or edited information, so this information will not be displayed for preregistration"
^XTV(8991,18,1,1,1,186,0)=" . I $$INSUR^IBBAPI(DFN,"""",""AR"",.DGDATA,""1,10,11"") F DGI=0:0 S DGI=$O(DGDATA(""IBBAPI"",""INSUR"",DGI)) Q:'DGI  D"
^XTV(8991,18,1,1,1,187,0)=" .. W !,"" [INSURANCE:] "",$P(DGDATA(""IBBAPI"",""INSUR"",DGI,1),U,2)"
^XTV(8991,18,1,1,1,188,0)=" .. W ""  EFFECTIVE DATE: "",$$FMTE^XLFDT(DGDATA(""IBBAPI"",""INSUR"",DGI,10),""5D""),""  EXPIRATION DATE: "",$$FMTE^XLFDT(DGDATA(""IBBAPI"",""INSUR"",DGI,11),""5D"")"
^XTV(8991,18,1,1,1,189,0)=" ;"
^XTV(8991,18,1,1,1,190,0)=" G ^DGRPP"
^XTV(8991,18,1,"B",3061010.0809,1)=""
^XTV(8991,19,0)="DGRPD"
^XTV(8991,19,1,0)="^8991.01^4^4"
^XTV(8991,19,1,1,0)="3061010.0836"
^XTV(8991,19,1,1,1,0)="^8991.11^193^193"
^XTV(8991,19,1,1,1,1,0)=""
^XTV(8991,19,1,1,1,1,"DEL")="DGRPD ;ALB/MRL/MLR/JAN/LBD/EG/BRM/JRC-PATIENT INQUIRY (NEW) ;10/10/06  08:36"
^XTV(8991,19,1,1,1,2,"INS",0)="^8991.12^1^1"
^XTV(8991,19,1,1,1,2,"INS",1,0)="DGRPD ;ALB/MRL/MLR/JAN/LBD/EG/BRM/JRC-PATIENT INQUIRY (NEW) ;10/10/06  15:44"
^XTV(8991,19,1,1,1,4,0)=""
^XTV(8991,19,1,1,1,4,"DEL")=" ;  *358*  If a patient is on a domiciliary ward, don't display MEANS"
^XTV(8991,19,1,1,1,5,0)=""
^XTV(8991,19,1,1,1,5,"DEL")=" ;         TEST required/Medication Copayment Exemption messages"
^XTV(8991,19,1,1,1,6,0)=""
^XTV(8991,19,1,1,1,6,"DEL")=" ;  *436*  If an inpatient is not on a domiciliary ward, don't display"
^XTV(8991,19,1,1,1,7,0)=""
^XTV(8991,19,1,1,1,7,"DEL")=" ;         Medication Copayment Exemption message"
^XTV(8991,19,1,1,1,8,0)=""
^XTV(8991,19,1,1,1,8,"DEL")=" ;  *545*  Add death information near the remarks field"
^XTV(8991,19,1,1,1,9,0)=""
^XTV(8991,19,1,1,1,9,"DEL")=" ;  *677*  Added Emergency Response"
^XTV(8991,19,1,1,1,10,0)=""
^XTV(8991,19,1,1,1,10,"DEL")=" ;  *634*  VistA-Office EHR: Remove ref to service connected node .3"
^XTV(8991,19,1,2,0)="3061010.1544"
^XTV(8991,19,1,2,1,0)="^8991.11^186^186"
^XTV(8991,19,1,2,1,1,0)=""
^XTV(8991,19,1,2,1,1,"DEL")="DGRPD ;ALB/MRL/MLR/JAN/LBD/EG/BRM/JRC-PATIENT INQUIRY (NEW) ;10/10/06  15:44"
^XTV(8991,19,1,2,1,2,"INS",0)="^8991.12^1^1"
^XTV(8991,19,1,2,1,2,"INS",1,0)="DGRPD ;ALB/MRL/MLR/JAN/LBD/EG/BRM/JRC-PATIENT INQUIRY (NEW) ;10/11/06  15:54"
^XTV(8991,19,1,2,1,14,0)=""
^XTV(8991,19,1,2,1,14,"DEL")=" ;"
^XTV(8991,19,1,2,1,15,0)=""
^XTV(8991,19,1,2,1,15,"DEL")=" ; for VOE take out ref to ^DPT(DFN,.3)"
^XTV(8991,19,1,2,1,16,0)=""
^XTV(8991,19,1,2,1,16,"DEL")=" ;"
^XTV(8991,19,1,2,1,17,0)=""
^XTV(8991,19,1,2,1,17,"DEL")=" I DUZ(""AG"")'=""V"" K DGRP(.3)"
^XTV(8991,19,1,2,1,18,0)=""
^XTV(8991,19,1,2,1,18,"DEL")=" ;"
^XTV(8991,19,1,2,1,19,0)=""
^XTV(8991,19,1,2,1,19,"DEL")=" ; end change for VOE"
^XTV(8991,19,1,2,1,20,0)=""
^XTV(8991,19,1,2,1,20,"DEL")=" ;"
^XTV(8991,19,1,3,0)="3061011.1555"
^XTV(8991,19,1,3,1,0)="^8991.11^179^179"
^XTV(8991,19,1,3,1,1,0)=""
^XTV(8991,19,1,3,1,1,"DEL")="DGRPD ;ALB/MRL/MLR/JAN/LBD/EG/BRM/JRC-PATIENT INQUIRY (NEW) ;10/11/06  15:54"
^XTV(8991,19,1,3,1,2,0)=""
^XTV(8991,19,1,3,1,2,"DEL")=" ;;5.3;Registration;**109,124,121,57,161,149,286,358,436,445,489,498,506,513,518,550,545,568,585,677,703**;Aug 13, 1993"
^XTV(8991,19,1,3,1,3,"INS",0)="^8991.12^2^2"
^XTV(8991,19,1,3,1,3,"INS",1,0)="DGRPD ;ALB/MRL/MLR/JAN/LBD/EG/BRM/JRC-PATIENT INQUIRY (NEW) ;12/25/06  18:18"
^XTV(8991,19,1,3,1,3,"INS",2,0)=" ;;5.3;Registration;**109,124,121,57,161,149,286,358,436,445,489,498,506,513,518,550,545,568,585,677,703,634**;Aug 13, 1993;Build 4"
^XTV(8991,19,1,3,1,116,0)=""
^XTV(8991,19,1,3,1,116,"DEL")=" W @IOF,!,$P(VADM(1),""^"",1),?40,$P(VADM(2),""^"",2),?65,$P(VADM(3),""^"",2) S X="""",$P(X,""="",78)="""" W !,X,!?15,""COORDINATING MASTER OF RECORD: "",DGCMOR,! Q"
^XTV(8991,19,1,3,1,117,"INS",0)="^8991.12^3^3"
^XTV(8991,19,1,3,1,117,"INS",1,0)=" ; VOE CHANGE"
^XTV(8991,19,1,3,1,117,"INS",2,0)=" ; W @IOF,!,$P(VADM(1),""^"",1),?40,$P(VADM(2),""^"",2),?65,$P(VADM(3),""^"",2) S X="""",$P(X,""="",78)="""" W !,X,!?15,""COORDINATING MASTER OF RECORD: "",DGCMOR,! Q"
^XTV(8991,19,1,3,1,117,"INS",3,0)=" W @IOF,!,$P(VADM(1),""^"",1),?32,$P(VADM(2),""^"",2),?50,$$HRNV(DFN),?65,$P(VADM(3),""^"",2) S X="""",$P(X,""="",78)="""" W !,X,!?15,""COORDINATING MASTER OF RECORD: "",DGCMOR,! Q"
^XTV(8991,19,1,3,1,118,"INS",0)="^8991.12^8^8"
^XTV(8991,19,1,3,1,118,"INS",1,0)="HRNV(DFN) ;"
^XTV(8991,19,1,3,1,118,"INS",2,0)=" N IRET"
^XTV(8991,19,1,3,1,118,"INS",3,0)=" S IRET=$$HRN^DGLBPID(DFN)"
^XTV(8991,19,1,3,1,118,"INS",4,0)=" I IRET=""#"" Q """""
^XTV(8991,19,1,3,1,118,"INS",5,0)=" S IRET=""HRN ""_IRET"
^XTV(8991,19,1,3,1,118,"INS",6,0)=" Q IRET"
^XTV(8991,19,1,3,1,118,"INS",7,0)=" ; END VOE CHANGE"
^XTV(8991,19,1,3,1,118,"INS",8,0)=" ;"
^XTV(8991,19,1,4,0)="3061225.1818"
^XTV(8991,19,1,4,1,0)="^8991.11^189^189"
^XTV(8991,19,1,4,1,1,0)="DGRPD ;ALB/MRL/MLR/JAN/LBD/EG/BRM/JRC-PATIENT INQUIRY (NEW) ;12/25/06  18:18"
^XTV(8991,19,1,4,1,2,0)=" ;;5.3;Registration;**109,124,121,57,161,149,286,358,436,445,489,498,506,513,518,550,545,568,585,677,703,634**;Aug 13, 1993;Build 4"
^XTV(8991,19,1,4,1,3,0)=" ;  *286*  Newing variables X,Y in OKLINE subroutine"
^XTV(8991,19,1,4,1,4,0)=" ;  "
^XTV(8991,19,1,4,1,5,0)="SEL K DFN,DGRPOUT W ! S DIC=""^DPT("",DIC(0)=""AEQMZ"" D ^DIC G Q:Y'>0 S DFN=+Y N Y W ! S DIR(0)=""E"" D ^DIR G SEL:$D(DTOUT)!($D(DUOUT)) D EN G SEL"
^XTV(8991,19,1,4,1,6,0)=" ;"
^XTV(8991,19,1,4,1,7,0)="EN ;call to display patient inquiry - input DFN"
^XTV(8991,19,1,4,1,8,0)=" ;MPI/PD CHANGE"
^XTV(8991,19,1,4,1,9,0)=" S DGCMOR=""UNSPECIFIED"",DGMPI=$G(^DPT(+DFN,""MPI""))"
^XTV(8991,19,1,4,1,10,0)=" S DGLOCATN=$$FIND1^DIC(4,"""",""MX"",""`""_+$P(DGMPI,U,3)),DGLOCATN=$S(+DGLOCATN>0:$P($$NS^XUAF4(DGLOCATN),U),1:""NOT LISTED"")"
^XTV(8991,19,1,4,1,11,0)=" I $D(DGMPI),$D(DGLOCATN) S DGCMOR=$P(DGLOCATN,""^"")"
^XTV(8991,19,1,4,1,12,0)=" ;END MPI/PD CHANGE"
^XTV(8991,19,1,4,1,13,0)=" K DGRPOUT,DGHOW S DGABBRV=$S($D(^DG(43,1,0)):+$P(^(0),""^"",38),1:0),DGRPU=""UNSPECIFIED"" D DEM^VADPT,HDR F I=0,.11,.13,.121,.31,.32,.36,.361,.141,.3 S DGRP(I)=$S($D(^DPT(DFN,I)):^(I),1:"""")"
^XTV(8991,19,1,4,1,14,0)=" S DGAD=.11,(DGA1,DGA2)=1 D A^DGRPU S DGTMPAD=0 I $P(DGRP(.121),""^"",9)=""Y"" S DGTMPAD=$S('$P(DGRP(.121),""^"",8):1,$P(DGRP(.121),""^"",8)'<DT:1,1:0) I DGTMPAD S DGAD=.121,DGA1=1,DGA2=2 D A^DGRPU"
^XTV(8991,19,1,4,1,15,0)=" W ?1,""Address: "",$S($D(DGA(1)):DGA(1),1:""NONE ON FILE""),?40,""Temporary: "",$S($D(DGA(2)):DGA(2),1:""NO TEMPORARY ADDRESS"")"
^XTV(8991,19,1,4,1,16,0)=" S I=2 F I1=0:0 S I=$O(DGA(I)) Q:I=""""  W:(I#2)!($X>50) !?10 W:'(I#2) ?51 W DGA(I)"
^XTV(8991,19,1,4,1,17,0)=" S DGCC=+$P(DGRP(.11),U,7),DGST=+$P(DGRP(.11),U,5),DGCC=$S($D(^DIC(5,DGST,1,DGCC,0)):$E($P(^(0),U,1),1,20)_$S($P(^(0),U,3)]"""":"" (""_$P(^(0),U,3)_"")"",1:""""),1:DGRPU) W !?2,""County: "",DGCC"
^XTV(8991,19,1,4,1,18,0)=" S X=""NOT APPLICABLE"" I DGTMPAD S Y=$P(DGRP(.121),U,7) X:Y]"""" ^DD(""DD"") S X=$S(Y]"""":Y,1:DGRPU)_""-"",Y=$P(DGRP(.121),U,8) X:Y]"""" ^DD(""DD"") S X=X_$S(Y]"""":Y,1:DGRPU)"
^XTV(8991,19,1,4,1,19,0)=" W ?42,""From/To: "",X,!?3,""Phone: "",$S($P(DGRP(.13),U,1)]"""":$P(DGRP(.13),U,1),1:DGRPU),?44,""Phone: "",$S('DGTMPAD:X,$P(DGRP(.121),U,10)]"""":$P(DGRP(.121),U,10),1:DGRPU) K DGTMPAD"
^XTV(8991,19,1,4,1,20,0)=" W !?2,""Office: "",$S($P(DGRP(.13),U,2)]"""":$P(DGRP(.13),U,2),1:DGRPU)"
^XTV(8991,19,1,4,1,21,0)=" W !?4,""Cell: "",$S($P(DGRP(.13),U,4)]"""":$P(DGRP(.13),U,4),1:DGRPU)"
^XTV(8991,19,1,4,1,22,0)=" W !?2,""E-mail: "",$S($P(DGRP(.13),U,3)]"""":$P(DGRP(.13),U,3),1:DGRPU)"
^XTV(8991,19,1,4,1,23,0)=" W !,""Bad Addr: "",$$EXTERNAL^DILFD(2,.121,"""",$$BADADR^DGUTL3(+DFN))"
^XTV(8991,19,1,4,1,24,0)=" D CA"
^XTV(8991,19,1,4,1,25,0)=" N DGEMER S DGEMER=$$EXTERNAL^DILFD(2,.181,"""",$P($G(^DPT(DFN,.18)),""^""))"
^XTV(8991,19,1,4,1,26,0)=" W:DGEMER]"""" !?32,""Emergency Response: "",DGEMER"
^XTV(8991,19,1,4,1,27,0)=" I 'DGABBRV W !!?4,""POS: "",$S($D(^DIC(21,+$P(DGRP(.32),""^"",3),0)):$P(^(0),""^"",1),1:DGRPU),?42,""Claim #: "",$S($P(DGRP(.31),""^"",3)]"""":$P(DGRP(.31),""^"",3),1:""UNSPECIFIED"")"
^XTV(8991,19,1,4,1,28,0)=" I 'DGABBRV W !?2,""Relig: "",$S($D(^DIC(13,+$P(DGRP(0),""^"",8),0)):$P(^(0),""^"",1),1:DGRPU),?46,""Sex: "",$S($P(VADM(5),""^"",2)]"""":$P(VADM(5),""^"",2),1:""UNSPECIFIED"")"
^XTV(8991,19,1,4,1,29,0)=" I 'DGABBRV W ! D"
^XTV(8991,19,1,4,1,30,0)=" .N RACE,ETHNIC,PTR,VAL,X,DIWL,DIWR,DIWF"
^XTV(8991,19,1,4,1,31,0)=" .K ^UTILITY($J,""W"")"
^XTV(8991,19,1,4,1,32,0)=" .S PTR=0 F  S PTR=+$O(^DPT(DFN,.02,PTR)) Q:'PTR  D"
^XTV(8991,19,1,4,1,33,0)=" ..S VAL=+$G(^DPT(DFN,.02,PTR,0))"
^XTV(8991,19,1,4,1,34,0)=" ..Q:$$INACTIVE^DGUTL4(VAL,1)"
^XTV(8991,19,1,4,1,35,0)=" ..S VAL=$$PTR2TEXT^DGUTL4(VAL,1) S:+$O(^DPT(DFN,.02,PTR)) VAL=VAL_"", """
^XTV(8991,19,1,4,1,36,0)=" ..S X=VAL,DIWL=0,DIWR=30,DIWF="""" D ^DIWP"
^XTV(8991,19,1,4,1,37,0)=" .M RACE=^UTILITY($J,""W"",0) S:$G(RACE(1,0))="""" RACE(1,0)=""UNANSWERED"""
^XTV(8991,19,1,4,1,38,0)=" .K ^UTILITY($J,""W"")"
^XTV(8991,19,1,4,1,39,0)=" .S PTR=0 F  S PTR=+$O(^DPT(DFN,.06,PTR)) Q:'PTR  D"
^XTV(8991,19,1,4,1,40,0)=" ..S VAL=+$G(^DPT(DFN,.06,PTR,0))"
^XTV(8991,19,1,4,1,41,0)=" ..Q:$$INACTIVE^DGUTL4(VAL,2)"
^XTV(8991,19,1,4,1,42,0)=" ..S VAL=$$PTR2TEXT^DGUTL4(VAL,2) S:+$O(^DPT(DFN,.06,PTR)) VAL=VAL_"", """
^XTV(8991,19,1,4,1,43,0)=" ..S X=VAL,DIWL=0,DIWR=30,DIWF="""" D ^DIWP"
^XTV(8991,19,1,4,1,44,0)=" .M ETHNIC=^UTILITY($J,""W"",0) S:$G(ETHNIC(1,0))="""" ETHNIC(1,0)=""UNANSWERED"""
^XTV(8991,19,1,4,1,45,0)=" .K ^UTILITY($J,""W"")"
^XTV(8991,19,1,4,1,46,0)=" .W ?3,""Race: "",RACE(1,0),?40,""Ethnicity: "",ETHNIC(1,0)"
^XTV(8991,19,1,4,1,47,0)=" .F X=2:1 Q:'$D(RACE(X,0))&'$D(ETHNIC(X,0))  W !,?9,$G(RACE(X,0)),?51,$G(ETHNIC(X,0))"
^XTV(8991,19,1,4,1,48,0)=" I '$$OKLINE(16) G Q"
^XTV(8991,19,1,4,1,49,0)=" ;"
^XTV(8991,19,1,4,1,50,0)=" ; VOE change added 10/9/06 WV/CJS ;"
^XTV(8991,19,1,4,1,51,0)=" ;"
^XTV(8991,19,1,4,1,52,0)=" I DUZ(""AG"")=""V"" D"
^XTV(8991,19,1,4,1,53,0)=" . ;display cv status #4156"
^XTV(8991,19,1,4,1,54,0)=" . N DGCV S DGCV=$$CVEDT^DGCV(+DFN)"
^XTV(8991,19,1,4,1,55,0)=" . W !!,?2,""Combat Vet Status: ""_$S($P(DGCV,U,3)=1:""ELIGIBLE"",$P(DGCV,U,3)="""":""NOT ELIGIBLE"",1:""EXPIRED"") I DGCV>0 W ?45,""End Date: ""_$$FMTE^XLFDT($P(DGCV,U,2),""5DZ"")"
^XTV(8991,19,1,4,1,56,0)=" ;"
^XTV(8991,19,1,4,1,57,0)=" ; end VOE change"
^XTV(8991,19,1,4,1,58,0)=" ;"
^XTV(8991,19,1,4,1,59,0)=" ;display primary eligibility"
^XTV(8991,19,1,4,1,60,0)=" S X1=DGRP(.36),X=$P(DGRP(.361),""^"",1) W !,""Primary Eligibility: "",$S($D(^DIC(8,+X1,0)):$P(^(0),""^"",1)_"" (""_$S(X=""V"":""VERIFIED"",X=""P"":""PENDING VERIFICATION"",X=""R"":""PENDING REVERIFICATION"",1:""NOT VERIFIED"")_"")"",1:DGRPU)"
^XTV(8991,19,1,4,1,61,0)=" W !,""Other Eligibilities: "" F I=0:0 S I=$O(^DIC(8,I)) Q:'I  I $D(^DIC(8,I,0)),I'=+X1 S X=$P(^(0),""^"",1)_"", "" I $D(^DPT(""AEL"",DFN,I)) W:$X+$L(X)>79 !?21 W X"
^XTV(8991,19,1,4,1,62,0)=" I '$$OKLINE(16) G Q"
^XTV(8991,19,1,4,1,63,0)=" ;employability status"
^XTV(8991,19,1,4,1,64,0)=" W !?6,""Unemployable: "",$S($P(DGRP(.3),U,5)=""Y"":""YES"",1:""NO"")"
^XTV(8991,19,1,4,1,65,0)=" ;display the catastrophic disability review date if there is one"
^XTV(8991,19,1,4,1,66,0)=" D CATDIS^DGRPD1"
^XTV(8991,19,1,4,1,67,0)=" I $G(DGPRFLG)=1 G Q:'$$OKLINE(19) D"
^XTV(8991,19,1,4,1,68,0)=" . N DGPDT,DGPTM"
^XTV(8991,19,1,4,1,69,0)=" . W !,$$REPEAT^XLFSTR(""-"",78)"
^XTV(8991,19,1,4,1,70,0)=" . S DGPDT="""",DGPDT=$O(^DGS(41.41,""ADC"",DFN,DGPDT),-1)"
^XTV(8991,19,1,4,1,71,0)=" . W !,""[PRE-REGISTER DATE:]  ""_$S(DGPDT]"""":$$FMTE^XLFDT(DGPDT,""1D""),1:""NONE ON FILE"")"
^XTV(8991,19,1,4,1,72,0)=" . S DGPTM=$$PCTEAM^DGSDUTL(DFN)"
^XTV(8991,19,1,4,1,73,0)=" . I $P(DGPTM,U,2)]"""" W !,""[PRIMARY CARE TEAM:] ""_$P(DGPTM,U,2)"
^XTV(8991,19,1,4,1,74,0)=" . W !,$$REPEAT^XLFSTR(""-"",78)"
^XTV(8991,19,1,4,1,75,0)=" ; Check if patient is an inpatient and on a DOM ward"
^XTV(8991,19,1,4,1,76,0)=" ; If inpatient is on a DOM ward, don't display MT or CP messages"
^XTV(8991,19,1,4,1,77,0)=" ; If inpatient is NOT on a DOM ward, don't display CP message"
^XTV(8991,19,1,4,1,78,0)=" N DGDOM,DGDOM1,VAHOW,VAROOT,VAINDT,VAIP,VAERR"
^XTV(8991,19,1,4,1,79,0)=" G Q:'$$OKLINE(14)"
^XTV(8991,19,1,4,1,80,0)=" D DOM^DGMTR"
^XTV(8991,19,1,4,1,81,0)=" I '$G(DGDOM) D"
^XTV(8991,19,1,4,1,82,0)=" .D DIS^DGMTU(DFN)"
^XTV(8991,19,1,4,1,83,0)=" .D IN5^VADPT"
^XTV(8991,19,1,4,1,84,0)=" .I $G(VAIP(1))="""" D DISP^IBARXEU(DFN,DT,3,1)"
^XTV(8991,19,1,4,1,85,0)=" ;I 'DGABBRV,$E(IOST,1,2)=""C-"" F I=$Y:1:20 W !"
^XTV(8991,19,1,4,1,86,0)=" D DIS^EASECU(DFN)   ;Added for LTC III (DG*5.3*518)"
^XTV(8991,19,1,4,1,87,0)=" S VAIP(""L"")="""""
^XTV(8991,19,1,4,1,88,0)=" I $$OKLINE(14) D INP"
^XTV(8991,19,1,4,1,89,0)=" I '$G(DGRPOUT),($$OKLINE(17)) D SA"
^XTV(8991,19,1,4,1,90,0)=" ;MPI/PD CHANGE"
^XTV(8991,19,1,4,1,91,0)="Q D KVA^VADPT K %DT,D0,D1,DGA,DGA1,DGA2,DGABBRV,DGAD,DGCC,DGCMOR,DGDOM,DGLOCATN,DGMPI,DGRP,DGRPU,DGS,DGST,DGXFR0,DIC,DIR,DTOUT,DUOUT,DIRUT,DIROUT,I,I1,L,LDM,POP,SDCT,VA,X,X1,Y Q"
^XTV(8991,19,1,4,1,92,0)="CA ;Confidential Address"
^XTV(8991,19,1,4,1,93,0)=" W !!?1,""Confidential Address:  "",?44,""Confidential Address Categories:"""
^XTV(8991,19,1,4,1,94,0)=" N DGCABEG,DGCAEND,DGA,DGARRAY,DGERROR"
^XTV(8991,19,1,4,1,95,0)=" S DGCABEG=$P(DGRP(.141),U,7),DGCAEND=$P(DGRP(.141),U,8)"
^XTV(8991,19,1,4,1,96,0)=" I 'DGCABEG!(DGCABEG>DT)!(DGCAEND&(DGCAEND<DT)) D  Q"
^XTV(8991,19,1,4,1,97,0)=" .W !?9,""NO CONFIDENTIAL ADDRESS"""
^XTV(8991,19,1,4,1,98,0)=" .W !?1,""From/To: NOT APPLICABLE"""
^XTV(8991,19,1,4,1,99,0)=" S DGAD=.141,(DGA1,DGA2)=1"
^XTV(8991,19,1,4,1,100,0)=" D AL^DGRPU(30)"
^XTV(8991,19,1,4,1,101,0)=" D GETS^DIQ(2,DFN,"".141*,"",""E"",""DGARRAY"",""DGERROR"")"
^XTV(8991,19,1,4,1,102,0)=" ;Format Confidential Address categories"
^XTV(8991,19,1,4,1,103,0)=" N DGIEN,DGCAST"
^XTV(8991,19,1,4,1,104,0)=" S DGIEN=0"
^XTV(8991,19,1,4,1,105,0)=" S DGA2=2"
^XTV(8991,19,1,4,1,106,0)=" F  S DGIEN=$O(DGARRAY(2.141,DGIEN)) Q:'DGIEN  D"
^XTV(8991,19,1,4,1,107,0)=" .S DGA(DGA2)=DGARRAY(2.141,DGIEN,.01,""E"")"
^XTV(8991,19,1,4,1,108,0)=" .S DGCAST=DGARRAY(2.141,DGIEN,1,""E"")"
^XTV(8991,19,1,4,1,109,0)=" .S DGA(DGA2)=DGA(DGA2)_""(""_$S(DGCAST=""YES"":""Active"",1:""Inactive"")_"")"""
^XTV(8991,19,1,4,1,110,0)=" .S DGA2=DGA2+2"
^XTV(8991,19,1,4,1,111,0)=" S I=0 F I1=0:0 S I=$O(DGA(I)) Q:I=""""  W:(I#2)!($X>43) !?9 W:'(I#2) ?44 W DGA(I)"
^XTV(8991,19,1,4,1,112,0)=" W !?1,""From/To:  "",$$FMTE^XLFDT(DGCABEG)_""-""_$S(DGCAEND'="""":$$FMTE^XLFDT(DGCAEND),1:""UNANSWERED"")"
^XTV(8991,19,1,4,1,113,0)=" Q"
^XTV(8991,19,1,4,1,114,0)="HDR I '$D(IOF) S IOP=""HOME"" D ^%ZIS K IOP"
^XTV(8991,19,1,4,1,115,0)=" ;MPI/PD CHANGE"
^XTV(8991,19,1,4,1,116,0)=" ; VOE CHANGE"
^XTV(8991,19,1,4,1,117,0)=" ; W @IOF,!,$P(VADM(1),""^"",1),?40,$P(VADM(2),""^"",2),?65,$P(VADM(3),""^"",2) S X="""",$P(X,""="",78)="""" W !,X,!?15,""COORDINATING MASTER OF RECORD: "",DGCMOR,! Q"
^XTV(8991,19,1,4,1,118,0)=" W @IOF,!,$P(VADM(1),""^"",1),?32,$P(VADM(2),""^"",2),?50,$$HRNV(DFN),?65,$P(VADM(3),""^"",2) S X="""",$P(X,""="",78)="""" W !,X,!?15,""COORDINATING MASTER OF RECORD: "",DGCMOR,! Q"
^XTV(8991,19,1,4,1,119,0)=" ;END MPI/PD CHANGE"
^XTV(8991,19,1,4,1,120,0)="HRNV(DFN) ;"
^XTV(8991,19,1,4,1,121,0)=" N IRET"
^XTV(8991,19,1,4,1,122,0)=" S IRET=$$HRN^DGLBPID(DFN)"
^XTV(8991,19,1,4,1,123,0)=" I IRET=""#"" Q """""
^XTV(8991,19,1,4,1,124,0)=" S IRET=""HRN ""_IRET"
^XTV(8991,19,1,4,1,125,0)=" Q IRET"
^XTV(8991,19,1,4,1,126,0)=" ; END VOE CHANGE"
^XTV(8991,19,1,4,1,127,0)=" ;"
^XTV(8991,19,1,4,1,128,0)="INP S VAIP(""D"")=""L"" D INP^DGPMV10"
^XTV(8991,19,1,4,1,129,0)=" S DGPMT=0"
^XTV(8991,19,1,4,1,130,0)=" D CS^DGPMV10 K DGPMT,DGPMIFN K:'$D(DGSWITCH) DGPMVI,DGPMDCD Q"
^XTV(8991,19,1,4,1,131,0)="SA F I=0:0 S I=$O(^DGS(41.1,""B"",DFN,I)) G CL:'I S X=^DGS(41.1,I,0) I $P(X,""^"",2)>(DT-1),$P(X,""^"",13)']"""",'$P(X,""^"",17) S L=$P(X,""^"",2) D:$$OKLINE(17) SAA Q:$G(DGRPOUT)"
^XTV(8991,19,1,4,1,132,0)=" Q"
^XTV(8991,19,1,4,1,133,0)="SAA ;Scheduled Admit Data"
^XTV(8991,19,1,4,1,134,0)=" W !!?14,""Scheduled Admit"""
^XTV(8991,19,1,4,1,135,0)=" W:$D(^DIC(42,+$P(X,U,8),0)) "" on ward ""_$P(^(0),U)"
^XTV(8991,19,1,4,1,136,0)=" W:$D(^DIC(45.7,+$P(X,U,9),0)) "" for treating specialty ""_$P(^(0),U)"
^XTV(8991,19,1,4,1,137,0)=" W "" on ""_$$FMTE^XLFDT(L,""5DZ"")"
^XTV(8991,19,1,4,1,138,0)=" Q  ;SAA"
^XTV(8991,19,1,4,1,139,0)=" ;"
^XTV(8991,19,1,4,1,140,0)="CL G FA:$O(^DPT(DFN,""DE"",0))="""" S SDCT=0 F I=0:0 S I=$O(^DPT(DFN,""DE"",I)) Q:'I  I $D(^(I,0)),$P(^(0),""^"",2)'=""I"",$O(^(0)) S SDCT=SDCT+1 W:SDCT=1 !!,""Currently enrolled in "" W:$X>50 !?22 W $S($D(^SC(+^(0),0)):$P(^(0),""^"",1)_"", "",1:"""")"
^XTV(8991,19,1,4,1,141,0)=" ;"
^XTV(8991,19,1,4,1,142,0)="FA G:'$$OKLINE(20) RMK"
^XTV(8991,19,1,4,1,143,0)=" ;"
^XTV(8991,19,1,4,1,144,0)=" N DGARRAY,SDCNT"
^XTV(8991,19,1,4,1,145,0)=" S DGARRAY(""FLDS"")=""1;2;3;18"",DGARRAY(4)=DFN,DGARRAY(1)=DT,DGARRAY(""SORT"")=""P"""
^XTV(8991,19,1,4,1,146,0)=" S SDCNT=$$SDAPI^SDAMA301(.DGARRAY),CT=0 W !!,""Future Appointments: """
^XTV(8991,19,1,4,1,147,0)=" ;if there is lower subscripts hanging from the 101 node,"
^XTV(8991,19,1,4,1,148,0)=" ;then it is a valid appointment, otherwise it is"
^XTV(8991,19,1,4,1,149,0)=" ;an error eg 01/20/2005"
^XTV(8991,19,1,4,1,150,0)=" I $D(^TMP($J,""SDAMA301"",101))=1 W ""Appointment Database is Unavailable"" G RMK"
^XTV(8991,19,1,4,1,151,0)=" I $O(^TMP($J,""SDAMA301"",DFN,DT))'>0 W ""NONE"" G RMK"
^XTV(8991,19,1,4,1,152,0)=" ;"
^XTV(8991,19,1,4,1,153,0)=" W ?22,""Date"",?33,""Time"",?39,""Clinic"",!?22 F I=22:1:75 W ""="""
^XTV(8991,19,1,4,1,154,0)=" F FA=DT:0 S FA=$O(^TMP($J,""SDAMA301"",DFN,FA)) G RMK:'FA D  Q:CT>5"
^XTV(8991,19,1,4,1,155,0)=" .N STAT S STAT=$P($P(^TMP($J,""SDAMA301"",DFN,FA),U,3),"";"")"
^XTV(8991,19,1,4,1,156,0)=" .S C=+$P(^TMP($J,""SDAMA301"",DFN,FA),U,2) I STAT'[""C"" D"
^XTV(8991,19,1,4,1,157,0)=" ..D COV"
^XTV(8991,19,1,4,1,158,0)=" ..N DGAPPT S DGAPPT=$$FMTE^XLFDT($E(FA,1,12),""5Z"")"
^XTV(8991,19,1,4,1,159,0)=" ..W !?22,$P(DGAPPT,""@""),?33,$P(DGAPPT,""@"",2)"
^XTV(8991,19,1,4,1,160,0)=" ..W ?39,$P($P(^TMP($J,""SDAMA301"",DFN,FA),U,2),"";"",2),"" "",COV"
^XTV(8991,19,1,4,1,161,0)=" ..Q"
^XTV(8991,19,1,4,1,162,0)=" I $O(^TMP($J,""SDAMA301"",DFN,FA))>0 W !,""See Scheduling options for additional appointments."""
^XTV(8991,19,1,4,1,163,0)="RMK I '$G(DGRPOUT),($$OKLINE(21)) W !!,""Remarks: "",$P(^DPT(DFN,0),""^"",10)"
^XTV(8991,19,1,4,1,164,0)=" D GETS^DIQ(2,DFN_"","","".351;.353;.354;.355"",""E"",""PDTHINFO"")"
^XTV(8991,19,1,4,1,165,0)=" W !!"
^XTV(8991,19,1,4,1,166,0)=" W ""Date of Death Information"""
^XTV(8991,19,1,4,1,167,0)=" W !,?5,""Date of Death: "",$G(PDTHINFO(2,DFN_"","",.351,""E""))"
^XTV(8991,19,1,4,1,168,0)=" W !,?5,""Source of Notification: "",$G(PDTHINFO(2,DFN_"","",.353,""E""))"
^XTV(8991,19,1,4,1,169,0)=" W !,?5,""Updated Date/Time: "",$G(PDTHINFO(2,DFN_"","",.354,""E""))"
^XTV(8991,19,1,4,1,170,0)=" W !,?5,""Last Edited By: "",$G(PDTHINFO(2,DFN_"","",.355,""E"")),!"
^XTV(8991,19,1,4,1,171,0)=" I $$OKLINE(14) D EC^DGRPD1"
^XTV(8991,19,1,4,1,172,0)=" K DGARRAY,SDCNT,^TMP($J,""SDAMA301""),ADM,L,TRN,DIS,SSN,FA,C,COV,NOW,CT,DGD,DGD1,I ;Y killed after dghinqky"
^XTV(8991,19,1,4,1,173,0)=" Q"
^XTV(8991,19,1,4,1,174,0)="COV S COV=$S(+$P(^TMP($J,""SDAMA301"",DFN,FA),U,18)=7:"" (Collateral) "",1:"""")"
^XTV(8991,19,1,4,1,175,0)=" S COV=COV_$S(STAT[""NT"":"" * NO ACTION TAKEN *"",STAT[""N"":"" * NO-SHOW *"",1:""""),CT=CT+1 Q"
^XTV(8991,19,1,4,1,176,0)=" Q"
^XTV(8991,19,1,4,1,177,0)=" ;"
^XTV(8991,19,1,4,1,178,0)="OREN S XQORQUIT=1 Q:'$D(ORVP)  S DFN=+ORVP D EN R !!,""Press RETURN to CONTINUE: "",X:DTIME"
^XTV(8991,19,1,4,1,179,0)=" Q"
^XTV(8991,19,1,4,1,180,0)="OKLINE(DGLINE) ;DOES PAUSE/HEADER IF $Y EXCEEDS DGLINE"
^XTV(8991,19,1,4,1,181,0)=" ;"
^XTV(8991,19,1,4,1,182,0)=" ;IN:   DGLINE --MAX LINE COUNT W/O PAUSE"
^XTV(8991,19,1,4,1,183,0)=" ;OUT:  DGLINE[RETURNED] -- 0 IF TIMEOUT/UP ARROW"
^XTV(8991,19,1,4,1,184,0)=" ;      DGRPOUT[SET]     -- 1 IF """
^XTV(8991,19,1,4,1,185,0)=" N X,Y  ;**286** MLR 09/25/00  Newing X & Y variables prior to ^DIR"
^XTV(8991,19,1,4,1,186,0)=" I $G(IOST)[""P-"" Q DGLINE ; if printer, quit"
^XTV(8991,19,1,4,1,187,0)=" I $Y>DGLINE N DIR S DIR(0)=""E"" D ^DIR D:Y HDR I 'Y S DGRPOUT=1,DGLINE=0"
^XTV(8991,19,1,4,1,188,0)=" Q DGLINE"
^XTV(8991,19,1,4,1,189,0)=" ;"
^XTV(8991,19,1,"B",3061010.0836,1)=""
^XTV(8991,19,1,"B",3061010.1544,2)=""
^XTV(8991,19,1,"B",3061011.1555,3)=""
^XTV(8991,19,1,"B",3061225.1818,4)=""
^XTV(8991,20,0)="AUPNPAT"
^XTV(8991,20,1,0)="^8991.01^1^1"
^XTV(8991,20,1,1,0)="3061010.0857"
^XTV(8991,20,1,1,1,0)="^8991.11^103^103"
^XTV(8991,20,1,1,1,1,0)="AUPNPAT ; IHS/CMI/LAB - POST SELECTION SETS FOR PATIENT LOOKUP ;10/10/06  08:57"
^XTV(8991,20,1,1,1,2,0)=" ;;99.1;IHS DICTIONARIES (PATIENT);**8,9,10**;JUN 13,2003"
^XTV(8991,20,1,1,1,3,0)=" ;"
^XTV(8991,20,1,1,1,4,0)=" ; This routine sets standard patient variables"
^XTV(8991,20,1,1,1,5,0)=" ;IHS/SET/GTH AUPN*99.1*8 10/04/2002 Removed all refs to AUPN*93.2*3."
^XTV(8991,20,1,1,1,6,0)="START ;"
^XTV(8991,20,1,1,1,7,0)=" S:$D(X) AUPNPATX=X"
^XTV(8991,20,1,1,1,8,0)=" S AUPNPAT=+Y"
^XTV(8991,20,1,1,1,9,0)=" S AUPNSEX=$P(^DPT(AUPNPAT,0),U,2),AUPNDOB=$P(^(0),U,3),AUPNDOD="""" S:$D(^(.35)) AUPNDOD=$P(^(.35),U,1)"
^XTV(8991,20,1,1,1,10,0)=" S X2=AUPNDOB,X1=$S('AUPNDOD:DT,AUPNDOD:AUPNDOD,1:DT)"
^XTV(8991,20,1,1,1,11,0)=" D ^%DTC"
^XTV(8991,20,1,1,1,12,0)=" S AUPNDAYS=X"
^XTV(8991,20,1,1,1,13,0)=" K X,X1,X2"
^XTV(8991,20,1,1,1,14,0)=" S:$D(AUPNPATX) X=AUPNPATX"
^XTV(8991,20,1,1,1,15,0)=" K %T,%Y,AUPNPATX"
^XTV(8991,20,1,1,1,16,0)=" ;New EHR code    ;DAOU/WCJ   2/8/05"
^XTV(8991,20,1,1,1,17,0)=" ; VOE change to permit VA, IHS and VOE to use the same code"
^XTV(8991,20,1,1,1,18,0)=" Q:$G(DUZ(""AG""))=""V""  ; WV/CJS"
^XTV(8991,20,1,1,1,19,0)=" ;End EHR modifications"
^XTV(8991,20,1,1,1,20,0)=" S DFN=AUPNPAT"
^XTV(8991,20,1,1,1,21,0)=" S SSN=$$SSN(AUPNPAT)"
^XTV(8991,20,1,1,1,22,0)=" S AGE=$$AGE(AUPNPAT)"
^XTV(8991,20,1,1,1,23,0)=" S DOB=$$DOB(AUPNPAT)"
^XTV(8991,20,1,1,1,24,0)=" S SEX=$$SEX(AUPNPAT)"
^XTV(8991,20,1,1,1,25,0)=" Q"
^XTV(8991,20,1,1,1,26,0)=" ;"
^XTV(8991,20,1,1,1,27,0)="KILL ;PEP - KILL VARIABLES SET BY THIS ROUTINE"
^XTV(8991,20,1,1,1,28,0)=" K AUPNPAT,AUPNSEX,AUPNDOB,AUPNDOD,AUPNDAYS"
^XTV(8991,20,1,1,1,29,0)=" ;New EHR code    ;DAOU/WCJ   2/8/05"
^XTV(8991,20,1,1,1,30,0)=" ; VOE change to permit VA, IHS and VOE to use the same code"
^XTV(8991,20,1,1,1,31,0)=" Q:$G(DUZ(""AG""))'=""E"""
^XTV(8991,20,1,1,1,32,0)=" ;End EHR modifications"
^XTV(8991,20,1,1,1,33,0)=" K AGE,DFN,DOB,SEX,SSN"
^XTV(8991,20,1,1,1,34,0)=" Q"
^XTV(8991,20,1,1,1,35,0)=" ;"
^XTV(8991,20,1,1,1,36,0)=" ;  NOTE TO PROGRAMMERS:"
^XTV(8991,20,1,1,1,37,0)=" ;   All parameters are required, except the Format parameter (""F"")."
^XTV(8991,20,1,1,1,38,0)=" ;   The default for the Format parameter is the internal format of"
^XTV(8991,20,1,1,1,39,0)=" ;   the returned value."
^XTV(8991,20,1,1,1,40,0)=" ;"
^XTV(8991,20,1,1,1,41,0)="AGE(DFN,D,F) ;PEP - Given DFN, return Age."
^XTV(8991,20,1,1,1,42,0)=" ;return age on date d in format f (defaults to DT and age in years)"
^XTV(8991,20,1,1,1,43,0)=" Q $$AGE^AUPNPAT3(DFN,$G(D),$G(F))"
^XTV(8991,20,1,1,1,44,0)=" ;"
^XTV(8991,20,1,1,1,45,0)="BEN(DFN,F) ;PEP - returns classifications/beneficiary in format F."
^XTV(8991,20,1,1,1,46,0)=" Q $$BEN^AUPNPAT3(DFN,$G(F))"
^XTV(8991,20,1,1,1,47,0)=" ;"
^XTV(8991,20,1,1,1,48,0)="BENYN(DFN) ;PEP - Return BEN/Non-BEN Status."
^XTV(8991,20,1,1,1,49,0)=" Q $$BEN^AUPNPAT1(DFN)"
^XTV(8991,20,1,1,1,50,0)=" ;"
^XTV(8991,20,1,1,1,51,0)="CDEATH(DFN,F) ;PEP - returns Cause of Death in F format"
^XTV(8991,20,1,1,1,52,0)=" Q $$CDEATH^AUPNPAT3(DFN,$G(F))"
^XTV(8991,20,1,1,1,53,0)=" ;"
^XTV(8991,20,1,1,1,54,0)="COMMRES(DFN,F) ;PEP - Given DFN, return comm of res in F format"
^XTV(8991,20,1,1,1,55,0)=" Q $$COMMRES^AUPNPAT3(DFN,$G(F))"
^XTV(8991,20,1,1,1,56,0)=" ;"
^XTV(8991,20,1,1,1,57,0)="DEC(PID) ;PEP - RETURN DECRYPTED PATIENT IDENTIFIER"
^XTV(8991,20,1,1,1,58,0)=" G DEC^AUPNPAT4"
^XTV(8991,20,1,1,1,59,0)=" ;----------"
^XTV(8991,20,1,1,1,60,0)="ENC(DFN) ;PEP"
^XTV(8991,20,1,1,1,61,0)=" G ENC^AUPNPAT4"
^XTV(8991,20,1,1,1,62,0)=" ;----------"
^XTV(8991,20,1,1,1,63,0)="DOB(DFN,F) ;PEP - Given DFN, return Date of Birth according to F."
^XTV(8991,20,1,1,1,64,0)=" Q $$DOB^AUPNPAT3(DFN,$G(F))"
^XTV(8991,20,1,1,1,65,0)=" ;"
^XTV(8991,20,1,1,1,66,0)="DOD(DFN,F) ;PEP - Given DFN, return Date of Death in FM format."
^XTV(8991,20,1,1,1,67,0)=" Q $$DOD^AUPNPAT3(DFN,$G(F))"
^XTV(8991,20,1,1,1,68,0)=" ;"
^XTV(8991,20,1,1,1,69,0)="ELIGSTAT(DFN,F) ;PEP - returns eligibility status in F format"
^XTV(8991,20,1,1,1,70,0)=" Q $$ELIGSTAT^AUPNPAT3(DFN,$G(F))"
^XTV(8991,20,1,1,1,71,0)=" ;"
^XTV(8991,20,1,1,1,72,0)="HRN(DFN,L,F) ;PEP"
^XTV(8991,20,1,1,1,73,0)=" ;f patch 4 05/08/96"
^XTV(8991,20,1,1,1,74,0)=" Q $$HRN^AUPNPAT3(DFN,L,$G(F))"
^XTV(8991,20,1,1,1,75,0)=" ;"
^XTV(8991,20,1,1,1,76,0)="MCD(P,D) ;PEP - Is patient P medicaid eligible on date D?"
^XTV(8991,20,1,1,1,77,0)=" Q $$MCD^AUPNPAT2(P,D)"
^XTV(8991,20,1,1,1,78,0)=" ;"
^XTV(8991,20,1,1,1,79,0)="MCDPN(P,D,F) ;PEP - return medicaid plan name for patient P on date D in form F."
^XTV(8991,20,1,1,1,80,0)=" Q $$MCDPN^AUPNPAT2(P,D,$G(F))"
^XTV(8991,20,1,1,1,81,0)=" ;"
^XTV(8991,20,1,1,1,82,0)="MCR(P,D) ;PEP - Is patient P medicare eligible on date D?"
^XTV(8991,20,1,1,1,83,0)=" Q $$MCR^AUPNPAT2(P,D)"
^XTV(8991,20,1,1,1,84,0)=" ;"
^XTV(8991,20,1,1,1,85,0)="PI(P,D) ;PEP - Is patient P private insurance eligible on date D?"
^XTV(8991,20,1,1,1,86,0)=" Q $$PI^AUPNPAT2(P,D)"
^XTV(8991,20,1,1,1,87,0)=" ;"
^XTV(8991,20,1,1,1,88,0)="PIN(P,D,F) ;PEP - return private insurer name for patient P on date D in form F."
^XTV(8991,20,1,1,1,89,0)=" Q $$PIN^AUPNPAT2(P,D,$G(F))"
^XTV(8991,20,1,1,1,90,0)=" ;"
^XTV(8991,20,1,1,1,91,0)="SEX(DFN) ;PEP - Given DFN, return Sex."
^XTV(8991,20,1,1,1,92,0)=" Q $$SEX^AUPNPAT3(DFN)"
^XTV(8991,20,1,1,1,93,0)=" ;"
^XTV(8991,20,1,1,1,94,0)="SSN(DFN) ;PEP - Given DFN, return SSN."
^XTV(8991,20,1,1,1,95,0)=" Q $$SSN^AUPNPAT3(DFN)"
^XTV(8991,20,1,1,1,96,0)=" ;"
^XTV(8991,20,1,1,1,97,0)="TRIBE(DFN,F) ;PEP - Given DFN, return Tribe in F format"
^XTV(8991,20,1,1,1,98,0)=" Q $$TRIBE^AUPNPAT3(DFN,$G(F))"
^XTV(8991,20,1,1,1,99,0)=" ;"
^XTV(8991,20,1,1,1,100,0)=" ;Begin New Code;IHS/SET/GTH AUPN*99.1*8 10/04/2002"
^XTV(8991,20,1,1,1,101,0)="RR(P,D) ;PEP -  Is patient P railroad eligible on date D?"
^XTV(8991,20,1,1,1,102,0)=" Q $$RRE^AUPNPAT2(P,D)"
^XTV(8991,20,1,1,1,103,0)=" ;End New Code;IHS/SET/GTH AUPN*99.1*8 10/04/2002"
^XTV(8991,20,1,"B",3061010.0857,1)=""
^XTV(8991,21,0)="PXTTU1"
^XTV(8991,21,1,0)="^8991.01^2^2"
^XTV(8991,21,1,1,0)="3061010.0908"
^XTV(8991,21,1,1,1,0)="^8991.11^48^48"
^XTV(8991,21,1,1,1,1,0)=""
^XTV(8991,21,1,1,1,1,"DEL")="PXTTU1 ;ISL/JVS/ESW - Utility Routine-calls from input transforms ;10/10/06  09:08"
^XTV(8991,21,1,1,1,2,0)=""
^XTV(8991,21,1,1,1,2,"DEL")=" ;;1.0;PCE PATIENT CARE ENCOUNTER;**106**;Aug 12, 1996"
^XTV(8991,21,1,1,1,3,"INS",0)="^8991.12^2^2"
^XTV(8991,21,1,1,1,3,"INS",1,0)="PXTTU1 ;ISL/JVS/ESW - Utility Routine-calls from input transforms ;10/10/06  19:07"
^XTV(8991,21,1,1,1,3,"INS",2,0)=" ;;1.0;PCE PATIENT CARE ENCOUNTER;**106,167**;Aug 12, 1996"
^XTV(8991,21,1,2,0)="3061010.1907"
^XTV(8991,21,1,2,1,0)="^8991.11^48^48"
^XTV(8991,21,1,2,1,1,0)="PXTTU1 ;ISL/JVS/ESW - Utility Routine-calls from input transforms ;10/10/06  19:07"
^XTV(8991,21,1,2,1,2,0)=" ;;1.0;PCE PATIENT CARE ENCOUNTER;**106,167**;Aug 12, 1996"
^XTV(8991,21,1,2,1,3,0)=" Q"
^XTV(8991,21,1,2,1,4,0)=" ; This routines purpose is to hold utilities used by the supporting"
^XTV(8991,21,1,2,1,5,0)=" ;files for the v files."
^XTV(8991,21,1,2,1,6,0)=" ;"
^XTV(8991,21,1,2,1,7,0)="ZERO(PXB,PXNAT) ;PXTT TOPICS - Reset the zero node for new ifn's to add"
^XTV(8991,21,1,2,1,8,0)=" ;                      at option"
^XTV(8991,21,1,2,1,9,0)=" ;PXB - parameter ""^AUTT...("" passed from ENTRY ACTION of the related"
^XTV(8991,21,1,2,1,10,0)=" ;      Option:"
^XTV(8991,21,1,2,1,11,0)=" ;             PXTT EDIT EDUCATION TOPICS"
^XTV(8991,21,1,2,1,12,0)=" ;             PXTT EDIT HEALTH FACTORS"
^XTV(8991,21,1,2,1,13,0)=" ;             PXTT EDIT IMMUNIZATIONS"
^XTV(8991,21,1,2,1,14,0)=" ;             PXTT EDIT SKIN TESTS"
^XTV(8991,21,1,2,1,15,0)=" ;             PXTT EDIT TREATMENT"
^XTV(8991,21,1,2,1,16,0)=" ;             PXTT EDIT EXAM"
^XTV(8991,21,1,2,1,17,0)=" ;PXNAT (optional) - a variable to be set temporarily to PXNAT=1 in"
^XTV(8991,21,1,2,1,18,0)=" ;       ENTRY ACTION, see above, by a developer for setting/editing"
^XTV(8991,21,1,2,1,19,0)=" ;       a national package."
^XTV(8991,21,1,2,1,20,0)=" ;"
^XTV(8991,21,1,2,1,21,0)=" D GETSITE Q:$L(PXTDUZ)'=3"
^XTV(8991,21,1,2,1,22,0)=" I +$G(PXNAT) S $P(@(PXB_""0)""),U,3)=0"
^XTV(8991,21,1,2,1,23,0)=" E  S:(+$P($G(@(PXB_""0)"")),U,3)<(PXTDUZ_""000""))!(+$P($G(@(PXB_""0)"")),U,3)>(PXTDUZ_""999"")) $P(@(PXB_""0)""),U,3)=PXTDUZ_""000"""
^XTV(8991,21,1,2,1,24,0)=" Q"
^XTV(8991,21,1,2,1,25,0)=" ;"
^XTV(8991,21,1,2,1,26,0)="GETSITE S PXTDUZ=$P($$SITE^VASITE,U,3) S:$G(DUZ(""AG""))=""V"" PXTDUZ=+PXTDUZ"
^XTV(8991,21,1,2,1,27,0)=" I $L(PXTDUZ)'=3 W !,""Primary site is not 3 character station number! See IRM for setup."" Q"
^XTV(8991,21,1,2,1,28,0)=" Q"
^XTV(8991,21,1,2,1,29,0)=" ;"
^XTV(8991,21,1,2,1,30,0)="CKNA(PXB) ;Check for duplicat names."
^XTV(8991,21,1,2,1,31,0)=" ;PXB - parameter ""^AUTT...("" passed by INPUT TRANSFORM of .01 field"
^XTV(8991,21,1,2,1,32,0)=" ;      of the related file:"
^XTV(8991,21,1,2,1,33,0)=" ;           HEALTH FACTORS   ; 9999999.64"
^XTV(8991,21,1,2,1,34,0)=" ;           EDUCATION TOPICS ; 9999999.09"
^XTV(8991,21,1,2,1,35,0)=" ;           IMMUNIZATION     ; 9999999.14"
^XTV(8991,21,1,2,1,36,0)=" ;           EXAM             ; 9999999.15"
^XTV(8991,21,1,2,1,37,0)=" ;           TREATMENT        ; 9999999.17"
^XTV(8991,21,1,2,1,38,0)=" ;           SKIN TEST        ; 9999999.28"
^XTV(8991,21,1,2,1,39,0)=" ;PXNAT - optional variable, see above"
^XTV(8991,21,1,2,1,40,0)=" N PXD"
^XTV(8991,21,1,2,1,41,0)=" S PXD=PXB_""""""B""""""_"",""_""""""""_X_"""""")"""
^XTV(8991,21,1,2,1,42,0)=" I $D(@PXD),$O(@PXD@(""""))<100000 D  Q"
^XTV(8991,21,1,2,1,43,0)=" .;check for existing national"
^XTV(8991,21,1,2,1,44,0)=" .W !,""Duplicate NAMES not allowed."" K X"
^XTV(8991,21,1,2,1,45,0)=" ;additional check for EDUCATION TOPICS"
^XTV(8991,21,1,2,1,46,0)=" I $P(PXB,""("")=""^AUTTEDT"",$F(X,""VA-"")=4,'$G(PXNAT) D"
^XTV(8991,21,1,2,1,47,0)=" .W !,""NAME cannot start with """"VA-"""", reserved for national distribution!"" K X"
^XTV(8991,21,1,2,1,48,0)=" Q"
^XTV(8991,21,1,"B",3061010.0908,1)=""
^XTV(8991,21,1,"B",3061010.1907,2)=""
^XTV(8991,22,0)="PXRMETX"
^XTV(8991,22,1,0)="^8991.01^4^4"
^XTV(8991,22,1,1,0)="3061010.0917"
^XTV(8991,22,1,1,1,0)="^8991.11^332^332"
^XTV(8991,22,1,1,1,1,0)=""
^XTV(8991,22,1,1,1,1,"DEL")="PXRMETX ; SLC/PJH - Run Extract for QUERI ;10/10/06  09:17"
^XTV(8991,22,1,1,1,2,"INS",0)="^8991.12^1^1"
^XTV(8991,22,1,1,1,2,"INS",1,0)="PXRMETX ; SLC/PJH - Run Extract for QUERI ;10/10/06  10:49"
^XTV(8991,22,1,1,1,12,0)=""
^XTV(8991,22,1,1,1,12,"DEL")=" I $G(DUZ(""AG""))=""E"" D GETS^DIQ(810.2,IEN_"","",""3;5"",""I"",""VDATA"")"
^XTV(8991,22,1,1,1,13,"INS",0)="^8991.12^1^1"
^XTV(8991,22,1,1,1,13,"INS",1,0)=" I $$GET^XPAR(""SYS"",""DOQ-IT"")=""YES"" D GETS^DIQ(810.2,IEN_"","",""3;5"",""I"",""VDATA"")"
^XTV(8991,22,1,1,1,169,0)=""
^XTV(8991,22,1,1,1,169,"DEL")=" I ID[""DOQ-IT"" D EXTRACT^VEPER7EX(VDATA(810.2,IEN_"","",3,""I""),VDATA(810.2,IEN_"","",5,""I""),PXRMLIST)"
^XTV(8991,22,1,1,1,170,"INS",0)="^8991.12^1^1"
^XTV(8991,22,1,1,1,170,"INS",1,0)=" I $$GET^XPAR(""SYS"",""DOQ-IT"")=""YES"" D EXTRACT^VEPER7EX(VDATA(810.2,IEN_"","",3,""I""),VDATA(810.2,IEN_"","",5,""I""),PXRMLIST)"
^XTV(8991,22,1,2,0)="3061010.1049"
^XTV(8991,22,1,2,1,0)="^8991.11^332^332"
^XTV(8991,22,1,2,1,1,0)=""
^XTV(8991,22,1,2,1,1,"DEL")="PXRMETX ; SLC/PJH - Run Extract for QUERI ;10/10/06  10:49"
^XTV(8991,22,1,2,1,2,0)=""
^XTV(8991,22,1,2,1,2,"DEL")=" ;;2.0;CLINICAL REMINDERS;;Feb 04, 2005"
^XTV(8991,22,1,2,1,3,"INS",0)="^8991.12^2^2"
^XTV(8991,22,1,2,1,3,"INS",1,0)="PXRMETX ; SLC/PJH - Run Extract for QUERI ;10/10/06  19:06"
^XTV(8991,22,1,2,1,3,"INS",2,0)=" ;;2.0;CLINICAL REMINDERS;**167**;Feb 04, 2005"
^XTV(8991,22,1,3,0)="3061010.1907"
^XTV(8991,22,1,3,1,0)="^8991.11^332^332"
^XTV(8991,22,1,3,1,1,0)=""
^XTV(8991,22,1,3,1,1,"DEL")="PXRMETX ; SLC/PJH - Run Extract for QUERI ;10/10/06  19:06"
^XTV(8991,22,1,3,1,2,0)=""
^XTV(8991,22,1,3,1,2,"DEL")=" ;;2.0;CLINICAL REMINDERS;**167**;Feb 04, 2005"
^XTV(8991,22,1,3,1,3,"INS",0)="^8991.12^4^4"
^XTV(8991,22,1,3,1,3,"INS",1,0)="PXRMETX ; SLC/PJH - Run Extract for QUERI ;1/22/07  21:25"
^XTV(8991,22,1,3,1,3,"INS",2,0)=" ;;2.0;CLINICAL REMINDERS;**4,7**;Feb 04, 2005;Build 3"
^XTV(8991,22,1,3,1,3,"INS",3,0)=" ; Modified from FOIA VISTA,"
^XTV(8991,22,1,3,1,3,"INS",4,0)=" ; Copyright (C) 2007 WorldVistA"
^XTV(8991,22,1,3,1,4,0)=""
^XTV(8991,22,1,3,1,4,"DEL")="AUTO(ID) ;Called from option scheduling (#19.2)"
^XTV(8991,22,1,3,1,5,0)=""
^XTV(8991,22,1,3,1,5,"DEL")=" N IEN,LIST,LUVALUE,MODE,NEXT,VDATA"
^XTV(8991,22,1,3,1,6,"INS",0)="^8991.12^16^16"
^XTV(8991,22,1,3,1,6,"INS",1,0)=" ; This program is free software; you can redistribute it and/or modify"
^XTV(8991,22,1,3,1,6,"INS",2,0)=" ; it under the terms of the GNU General Public License as published by"
^XTV(8991,22,1,3,1,6,"INS",3,0)=" ; the Free Software Foundation; either version 2 of the License, or"
^XTV(8991,22,1,3,1,6,"INS",4,0)=" ; (at your option) any later version."
^XTV(8991,22,1,3,1,6,"INS",5,0)=" ;"
^XTV(8991,22,1,3,1,6,"INS",6,0)=" ; This program is distributed in the hope that it will be useful,"
^XTV(8991,22,1,3,1,6,"INS",7,0)=" ; but WITHOUT ANY WARRANTY; without even the implied warranty of"
^XTV(8991,22,1,3,1,6,"INS",8,0)=" ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the"
^XTV(8991,22,1,3,1,6,"INS",9,0)=" ; GNU General Public License for more details."
^XTV(8991,22,1,3,1,6,"INS",10,0)=" ;"
^XTV(8991,22,1,3,1,6,"INS",11,0)=" ; You should have received a copy of the GNU General Public License"
^XTV(8991,22,1,3,1,6,"INS",12,0)=" ; along with this program; if not, write to the Free Software"
^XTV(8991,22,1,3,1,6,"INS",13,0)=" ; Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA"
^XTV(8991,22,1,3,1,6,"INS",14,0)=" ;"
^XTV(8991,22,1,3,1,6,"INS",15,0)="AUTO(ID,PURGE) ;Called from option scheduling (#19.2)"
^XTV(8991,22,1,3,1,6,"INS",16,0)=" N IEN,LIST,LUVALUE,MODE,NEXT"
^XTV(8991,22,1,3,1,12,0)=""
^XTV(8991,22,1,3,1,12,"DEL")=" I $$GET^XPAR(""SYS"",""DOQ-IT"")=""YES"" D GETS^DIQ(810.2,IEN_"","",""3;5"",""I"",""VDATA"")"
^XTV(8991,22,1,3,1,14,0)=""
^XTV(8991,22,1,3,1,14,"DEL")=" S MODE=0"
^XTV(8991,22,1,3,1,15,"INS",0)="^8991.12^1^1"
^XTV(8991,22,1,3,1,15,"INS",1,0)=" S MODE=$S($P($G(^PXRM(810.2,IEN,100)),U)=""N"":0,1:1)"
^XTV(8991,22,1,3,1,16,0)=""
^XTV(8991,22,1,3,1,16,"DEL")=" D RUN^PXRMETX(IEN,NEXT,MODE)"
^XTV(8991,22,1,3,1,17,"INS",0)="^8991.12^1^1"
^XTV(8991,22,1,3,1,17,"INS",1,0)=" D RUN^PXRMETX(IEN,NEXT,MODE,PURGE)"
^XTV(8991,22,1,3,1,18,0)=""
^XTV(8991,22,1,3,1,18,"DEL")=" D PRGES"
^XTV(8991,22,1,3,1,19,"INS",0)="^8991.12^1^1"
^XTV(8991,22,1,3,1,19,"INS",1,0)=" D PRGES^PXRMETXU"
^XTV(8991,22,1,3,1,20,0)=""
^XTV(8991,22,1,3,1,20,"DEL")=" D PRGPL"
^XTV(8991,22,1,3,1,21,"INS",0)="^8991.12^1^1"
^XTV(8991,22,1,3,1,21,"INS",1,0)=" D PRGPL^PXRMETXU"
^XTV(8991,22,1,3,1,25,0)=""
^XTV(8991,22,1,3,1,25,"DEL")="CREX(NAME) ;Create extract summary entry"
^XTV(8991,22,1,3,1,26,"INS",0)="^8991.12^2^2"
^XTV(8991,22,1,3,1,26,"INS",1,0)="GETNAME(NAME,CLASS) ;Get the extract name."
^XTV(8991,22,1,3,1,26,"INS",2,0)=" I '$D(^PXRMXT(810.3,""B"",NAME)) Q NAME"
^XTV(8991,22,1,3,1,27,0)=""
^XTV(8991,22,1,3,1,27,"DEL")=" S CNT=0,NEW=0"
^XTV(8991,22,1,3,1,28,"INS",0)="^8991.12^1^1"
^XTV(8991,22,1,3,1,28,"INS",1,0)=" S (CNT,NEW)=0"
^XTV(8991,22,1,3,1,32,0)=""
^XTV(8991,22,1,3,1,32,"DEL")=" ;Create new entry"
^XTV(8991,22,1,3,1,33,0)=""
^XTV(8991,22,1,3,1,33,"DEL")=" N FDA,FDAIEN,MSG"
^XTV(8991,22,1,3,1,34,0)=""
^XTV(8991,22,1,3,1,34,"DEL")=" S FDA(810.3,""+1,"",.01)=NAME"
^XTV(8991,22,1,3,1,35,0)=""
^XTV(8991,22,1,3,1,35,"DEL")=" D UPDATE^DIE("""",""FDA"",""FDAIEN"",""MSG"")"
^XTV(8991,22,1,3,1,36,0)=""
^XTV(8991,22,1,3,1,36,"DEL")=" ;Error"
^XTV(8991,22,1,3,1,37,0)=""
^XTV(8991,22,1,3,1,37,"DEL")=" I $D(MSG) Q 0"
^XTV(8991,22,1,3,1,38,0)=""
^XTV(8991,22,1,3,1,38,"DEL")=" ;Otherwise list ien"
^XTV(8991,22,1,3,1,39,0)=""
^XTV(8991,22,1,3,1,39,"DEL")=" Q FDAIEN(1)"
^XTV(8991,22,1,3,1,40,"INS",0)="^8991.12^1^1"
^XTV(8991,22,1,3,1,40,"INS",1,0)=" Q NAME"
^XTV(8991,22,1,3,1,41,"INS",0)="^8991.12^4^4"
^XTV(8991,22,1,3,1,41,"INS",1,0)="IHD ;Monthly IHD Extract, called from option PXRM EXTRACT VA-IHD QUERI."
^XTV(8991,22,1,3,1,41,"INS",2,0)=" D AUTO(""VA-IHD QUERI"",""Y"")"
^XTV(8991,22,1,3,1,41,"INS",3,0)=" Q"
^XTV(8991,22,1,3,1,41,"INS",4,0)=" ;"
^XTV(8991,22,1,3,1,56,0)=""
^XTV(8991,22,1,3,1,56,"DEL")="IHD ;Monthly IHD Extract from option PXRM EXTRACT VA-IHD QUERI"
^XTV(8991,22,1,3,1,57,0)=""
^XTV(8991,22,1,3,1,57,"DEL")=" D AUTO(""VA-IHD QUERI"")"
^XTV(8991,22,1,3,1,58,"INS",0)="^8991.12^2^2"
^XTV(8991,22,1,3,1,58,"INS",1,0)="MH ;Monthly MH Extract, called from option PXRM EXTRACT VA-MH QUERI."
^XTV(8991,22,1,3,1,58,"INS",2,0)=" D AUTO(""VA-MH QUERI"",""Y"")"
^XTV(8991,22,1,3,1,60,0)=""
^XTV(8991,22,1,3,1,60,"DEL")="MH ;Monthly MH Extract from option PXRM EXTRACT VA-MH QUERI"
^XTV(8991,22,1,3,1,61,0)=""
^XTV(8991,22,1,3,1,61,"DEL")=" D AUTO(""VA-MH QUERI"")"
^XTV(8991,22,1,3,1,62,0)=""
^XTV(8991,22,1,3,1,62,"DEL")=" Q"
^XTV(8991,22,1,3,1,63,0)=""
^XTV(8991,22,1,3,1,63,"DEL")=" ;"
^XTV(8991,22,1,3,1,84,0)=""
^XTV(8991,22,1,3,1,84,"DEL")="PRGES ;Delete any Extract Summaries over 5 years old"
^XTV(8991,22,1,3,1,85,0)=""
^XTV(8991,22,1,3,1,85,"DEL")=" N DIFF,EDATE,OLD"
^XTV(8991,22,1,3,1,86,0)=""
^XTV(8991,22,1,3,1,86,"DEL")=" S OLD=0"
^XTV(8991,22,1,3,1,87,0)=""
^XTV(8991,22,1,3,1,87,"DEL")=" F  S OLD=$O(^PXRMXT(810.3,OLD)) Q:'OLD  D"
^XTV(8991,22,1,3,1,88,0)=""
^XTV(8991,22,1,3,1,88,"DEL")=" .;Ignore EPI"
^XTV(8991,22,1,3,1,89,0)=""
^XTV(8991,22,1,3,1,89,"DEL")=" .I $E($G(^PXRMXT(810.3,OLD,0)),1,5)=""LREPI"" Q"
^XTV(8991,22,1,3,1,90,0)=""
^XTV(8991,22,1,3,1,90,"DEL")=" .;Extract Date"
^XTV(8991,22,1,3,1,91,0)=""
^XTV(8991,22,1,3,1,91,"DEL")=" .S EDATE=$P($G(^PXRMXT(810.3,OLD,0)),U,6)"
^XTV(8991,22,1,3,1,92,0)=""
^XTV(8991,22,1,3,1,92,"DEL")=" .;Ignore if < 5 years since creation"
^XTV(8991,22,1,3,1,93,0)=""
^XTV(8991,22,1,3,1,93,"DEL")=" .I $$FMDIFF^XLFDT(DT,EDATE,1)<(365*5) Q"
^XTV(8991,22,1,3,1,94,0)=""
^XTV(8991,22,1,3,1,94,"DEL")=" .;Otherwise delete"
^XTV(8991,22,1,3,1,95,0)=""
^XTV(8991,22,1,3,1,95,"DEL")=" .N DIK,DA"
^XTV(8991,22,1,3,1,96,0)=""
^XTV(8991,22,1,3,1,96,"DEL")=" .S DIK=""^PXRMXT(810.3,"",DA=OLD D ^DIK"
^XTV(8991,22,1,3,1,97,0)=""
^XTV(8991,22,1,3,1,97,"DEL")=" Q"
^XTV(8991,22,1,3,1,98,0)=""
^XTV(8991,22,1,3,1,98,"DEL")=" ;"
^XTV(8991,22,1,3,1,99,0)=""
^XTV(8991,22,1,3,1,99,"DEL")="PRGPL ;Delete any Patient Lists over 5 years old"
^XTV(8991,22,1,3,1,100,0)=""
^XTV(8991,22,1,3,1,100,"DEL")=" N LDATE,OLD"
^XTV(8991,22,1,3,1,101,0)=""
^XTV(8991,22,1,3,1,101,"DEL")=" S OLD=0"
^XTV(8991,22,1,3,1,102,0)=""
^XTV(8991,22,1,3,1,102,"DEL")=" F  S OLD=$O(^PXRMXP(810.5,OLD)) Q:'OLD  D"
^XTV(8991,22,1,3,1,103,0)=""
^XTV(8991,22,1,3,1,103,"DEL")=" .;Patient List Date"
^XTV(8991,22,1,3,1,104,0)=""
^XTV(8991,22,1,3,1,104,"DEL")=" .S LDATE=$P($G(^PXRMXP(810.5,OLD,0)),U,4)"
^XTV(8991,22,1,3,1,105,0)=""
^XTV(8991,22,1,3,1,105,"DEL")=" .;Ignore if < 5 years since creation"
^XTV(8991,22,1,3,1,106,0)=""
^XTV(8991,22,1,3,1,106,"DEL")=" .I $$FMDIFF^XLFDT(DT,LDATE,1)<(365*5) Q"
^XTV(8991,22,1,3,1,107,0)=""
^XTV(8991,22,1,3,1,107,"DEL")=" .;Otherwise delete"
^XTV(8991,22,1,3,1,108,0)=""
^XTV(8991,22,1,3,1,108,"DEL")=" .N DIK,DA"
^XTV(8991,22,1,3,1,109,0)=""
^XTV(8991,22,1,3,1,109,"DEL")=" .S DIK=""^PXRMXP(810.5,"",DA=OLD D ^DIK"
^XTV(8991,22,1,3,1,110,0)=""
^XTV(8991,22,1,3,1,110,"DEL")=" Q"
^XTV(8991,22,1,3,1,111,0)=""
^XTV(8991,22,1,3,1,111,"DEL")=" ;"
^XTV(8991,22,1,3,1,112,0)=""
^XTV(8991,22,1,3,1,112,"DEL")="RUN(IEN,NEXT,MODE) ;Process extract parameter"
^XTV(8991,22,1,3,1,113,0)=""
^XTV(8991,22,1,3,1,113,"DEL")=" ;"
^XTV(8991,22,1,3,1,114,0)=""
^XTV(8991,22,1,3,1,114,"DEL")=" S BEG=$H"
^XTV(8991,22,1,3,1,115,0)=""
^XTV(8991,22,1,3,1,115,"DEL")=" ;"
^XTV(8991,22,1,3,1,116,"INS",0)="^8991.12^1^1"
^XTV(8991,22,1,3,1,116,"INS",1,0)="RUN(IEN,NEXT,MODE,PURGE) ;Process extract parameter"
^XTV(8991,22,1,3,1,123,0)=""
^XTV(8991,22,1,3,1,123,"DEL")=" N CLASS,PXRMLIST,PXRMNODE,PXRMRULE,PXRMSTRT,PXRMXIEN,PATCREAT,XNAME"
^XTV(8991,22,1,3,1,124,"INS",0)="^8991.12^2^2"
^XTV(8991,22,1,3,1,124,"INS",1,0)=" N CLASS,FDA,FDAIEN,MSG"
^XTV(8991,22,1,3,1,124,"INS",2,0)=" N PXRMLIST,PXRMNODE,PXRMRULE,PXRMSTRT,PXRMXIEN,PATCREAT,XNAME"
^XTV(8991,22,1,3,1,129,0)=""
^XTV(8991,22,1,3,1,129,"DEL")=" N DATA,LIST,NAME,PARTYPE,PERIOD,SNAME,TEXT,YEAR"
^XTV(8991,22,1,3,1,130,"INS",0)="^8991.12^1^1"
^XTV(8991,22,1,3,1,130,"INS",1,0)=" N DATA,INDP,INTP,LIST,NAME,PARTYPE,PERIOD,SNAME,TEXT,YEAR"
^XTV(8991,22,1,3,1,153,"INS",0)="^8991.12^2^2"
^XTV(8991,22,1,3,1,153,"INS",1,0)=" .S INDP=+$P(DATA,U,4)"
^XTV(8991,22,1,3,1,153,"INS",2,0)=" .S INTP=+$P(DATA,U,5)"
^XTV(8991,22,1,3,1,155,0)=""
^XTV(8991,22,1,3,1,155,"DEL")=" .D START^PXRMRULE(PXRMRULE,PXRMLIST,PXRMNODE,PXRMSTRT,PXRMSTOP,IEN,YEAR,PERIOD)"
^XTV(8991,22,1,3,1,156,"INS",0)="^8991.12^2^2"
^XTV(8991,22,1,3,1,156,"INS",1,0)=" .;"
^XTV(8991,22,1,3,1,156,"INS",2,0)=" .D START^PXRMRULE(PXRMRULE,PXRMLIST,PXRMNODE,PXRMSTRT,PXRMSTOP,IEN,YEAR,PERIOD,INDP,INTP)"
^XTV(8991,22,1,3,1,161,"INS",0)="^8991.12^2^2"
^XTV(8991,22,1,3,1,161,"INS",1,0)=" ;Get the name"
^XTV(8991,22,1,3,1,161,"INS",2,0)=" S NAME=$$GETNAME(XNAME)"
^XTV(8991,22,1,3,1,162,0)=""
^XTV(8991,22,1,3,1,162,"DEL")=" S PXRMXIEN=$$CREX(XNAME) Q:'PXRMXIEN"
^XTV(8991,22,1,3,1,163,"INS",0)="^8991.12^15^15"
^XTV(8991,22,1,3,1,163,"INS",1,0)=" S FDA(810.3,""+1,"",.01)=NAME"
^XTV(8991,22,1,3,1,163,"INS",2,0)=" S FDA(810.3,""+1,"",.02)=PXRMSTRT"
^XTV(8991,22,1,3,1,163,"INS",3,0)=" S FDA(810.3,""+1,"",.03)=PXRMSTOP"
^XTV(8991,22,1,3,1,163,"INS",4,0)=" S FDA(810.3,""+1,"",.06)=$$NOW^XLFDT"
^XTV(8991,22,1,3,1,163,"INS",5,0)=" S FDA(810.3,""+1,"",1)=IEN"
^XTV(8991,22,1,3,1,163,"INS",6,0)=" S FDA(810.3,""+1,"",2)=PARTYPE"
^XTV(8991,22,1,3,1,163,"INS",7,0)=" S FDA(810.3,""+1,"",3)=$E(PERIOD,2,99)"
^XTV(8991,22,1,3,1,163,"INS",8,0)=" S FDA(810.3,""+1,"",4)=YEAR"
^XTV(8991,22,1,3,1,163,"INS",9,0)=" S FDA(810.3,""+1,"",5)=$S(MODE<2:""A"",1:""M"")"
^XTV(8991,22,1,3,1,163,"INS",10,0)=" S FDA(810.3,""+1,"",7)=$E(PERIOD)"
^XTV(8991,22,1,3,1,163,"INS",11,0)=" I PURGE=""Y"" S FDA(810.3,""+1,"",50)=1"
^XTV(8991,22,1,3,1,163,"INS",12,0)=" S FDA(810.3,""+1,"",100)=CLASS"
^XTV(8991,22,1,3,1,163,"INS",13,0)=" D UPDATE^DIE("""",""FDA"",""FDAIEN"",""MSG"")"
^XTV(8991,22,1,3,1,163,"INS",14,0)=" I $D(MSG) D AWRITE^PXRMUTIL(""MSG"") G EXIT"
^XTV(8991,22,1,3,1,163,"INS",15,0)=" ;"
^XTV(8991,22,1,3,1,164,0)=""
^XTV(8991,22,1,3,1,164,"DEL")=" D UPDEX I $D(MSG) D MES^PXRMEUT(MSG) Q"
^XTV(8991,22,1,3,1,165,"INS",0)="^8991.12^1^1"
^XTV(8991,22,1,3,1,165,"INS",1,0)=" D UPDEX(FDAIEN(1))"
^XTV(8991,22,1,3,1,167,0)=""
^XTV(8991,22,1,3,1,167,"DEL")=" I (MODE=0)!(MODE=2) D TRANS(PXRMXIEN)"
^XTV(8991,22,1,3,1,168,"INS",0)="^8991.12^1^1"
^XTV(8991,22,1,3,1,168,"INS",1,0)=" I (MODE=0)!(MODE=2) D TRANS(FDAIEN(1))"
^XTV(8991,22,1,3,1,177,0)=""
^XTV(8991,22,1,3,1,177,"DEL")=" ;Clear workfile"
^XTV(8991,22,1,3,1,178,"INS",0)="^8991.12^1^1"
^XTV(8991,22,1,3,1,178,"INS",1,0)="EXIT ;Clear workfile"
^XTV(8991,22,1,3,1,184,0)=""
^XTV(8991,22,1,3,1,184,"DEL")=" W !,""Transmitting HL7"""
^XTV(8991,22,1,3,1,188,0)=""
^XTV(8991,22,1,3,1,188,"DEL")=" D LOCK Q:$D(DUOUT)"
^XTV(8991,22,1,3,1,189,"INS",0)="^8991.12^1^1"
^XTV(8991,22,1,3,1,189,"INS",1,0)=" D LOCK(PXRMXIEN) Q:$D(DUOUT)"
^XTV(8991,22,1,3,1,192,0)=""
^XTV(8991,22,1,3,1,192,"DEL")=" W !,""Updating ""_NAME"
^XTV(8991,22,1,3,1,196,"INS",0)="^8991.12^4^4"
^XTV(8991,22,1,3,1,196,"INS",1,0)=" D UPDATE^DIE("""",""FDA"","""",""MSG"")"
^XTV(8991,22,1,3,1,196,"INS",2,0)=" ;Unlock extract summary"
^XTV(8991,22,1,3,1,196,"INS",3,0)=" D UNLOCK(PXRMXIEN)"
^XTV(8991,22,1,3,1,196,"INS",4,0)=" Q"
^XTV(8991,22,1,3,1,197,0)=""
^XTV(8991,22,1,3,1,197,"DEL")=" D UPDATE^DIE("""",""FDA"","""",""MSG"")"
^XTV(8991,22,1,3,1,198,0)=""
^XTV(8991,22,1,3,1,198,"DEL")=" ;Unlock extract summary"
^XTV(8991,22,1,3,1,199,0)=""
^XTV(8991,22,1,3,1,199,"DEL")=" D UNLOCK"
^XTV(8991,22,1,3,1,200,"INS",0)="^8991.12^4^4"
^XTV(8991,22,1,3,1,200,"INS",1,0)="UPDEX(IEN) ;Update extract summary"
^XTV(8991,22,1,3,1,200,"INS",2,0)=" N DUOUT"
^XTV(8991,22,1,3,1,200,"INS",3,0)=" ;Lock extract summary"
^XTV(8991,22,1,3,1,200,"INS",4,0)=" D LOCK(IEN) Q:$D(DUOUT)"
^XTV(8991,22,1,3,1,201,0)=""
^XTV(8991,22,1,3,1,201,"DEL")=" Q"
^XTV(8991,22,1,3,1,202,0)=""
^XTV(8991,22,1,3,1,202,"DEL")=" ;"
^XTV(8991,22,1,3,1,203,0)=""
^XTV(8991,22,1,3,1,203,"DEL")="UPDEX ;Update extract summary"
^XTV(8991,22,1,3,1,204,0)=""
^XTV(8991,22,1,3,1,204,"DEL")=" N CNT,DA,DFN,DIK,DUOUT,MSG,NAME,SUB,TEMP"
^XTV(8991,22,1,3,1,205,0)=""
^XTV(8991,22,1,3,1,205,"DEL")=" ;Lock extract summary"
^XTV(8991,22,1,3,1,206,0)=""
^XTV(8991,22,1,3,1,206,"DEL")=" D LOCK Q:$D(DUOUT)"
^XTV(8991,22,1,3,1,207,0)=""
^XTV(8991,22,1,3,1,207,"DEL")=" ;"
^XTV(8991,22,1,3,1,208,0)=""
^XTV(8991,22,1,3,1,208,"DEL")=" ;Clear existing records"
^XTV(8991,22,1,3,1,209,0)=""
^XTV(8991,22,1,3,1,209,"DEL")=" S SUB=0"
^XTV(8991,22,1,3,1,210,0)=""
^XTV(8991,22,1,3,1,210,"DEL")=" F  S SUB=$O(^PXRMXT(810.3,PXRMXIEN,3,SUB)) Q:'SUB  D"
^XTV(8991,22,1,3,1,211,0)=""
^XTV(8991,22,1,3,1,211,"DEL")=" .S DA=SUB,DA(1)=PXRMXIEN,DIK=""^PXRMXP(810.3,""_DA(1)_"",30,"""
^XTV(8991,22,1,3,1,212,0)=""
^XTV(8991,22,1,3,1,212,"DEL")=" .D ^DIK"
^XTV(8991,22,1,3,1,213,0)=""
^XTV(8991,22,1,3,1,213,"DEL")=" ;"
^XTV(8991,22,1,3,1,214,0)=""
^XTV(8991,22,1,3,1,214,"DEL")=" ;Merge ^TMP into extract summary"
^XTV(8991,22,1,3,1,215,0)=""
^XTV(8991,22,1,3,1,215,"DEL")=" S NAME=$P($G(^PXRMXT(810.3,PXRMXIEN,0)),U)"
^XTV(8991,22,1,3,1,216,0)=""
^XTV(8991,22,1,3,1,216,"DEL")=" ;FDA array"
^XTV(8991,22,1,3,1,217,0)=""
^XTV(8991,22,1,3,1,217,"DEL")=" K ^TMP(""PXRMFDA"",$J)"
^XTV(8991,22,1,3,1,218,0)=""
^XTV(8991,22,1,3,1,218,"DEL")=" S TEMP=""^TMP(""""PXRMFDA"""",""_$J_"")"""
^XTV(8991,22,1,3,1,219,0)=""
^XTV(8991,22,1,3,1,219,"DEL")=" ;"
^XTV(8991,22,1,3,1,220,0)=""
^XTV(8991,22,1,3,1,220,"DEL")=" ;Update run information"
^XTV(8991,22,1,3,1,221,0)=""
^XTV(8991,22,1,3,1,221,"DEL")=" S @TEMP@(810.3,""?1,"",.01)=NAME"
^XTV(8991,22,1,3,1,222,0)=""
^XTV(8991,22,1,3,1,222,"DEL")=" S @TEMP@(810.3,""?1,"",.02)=PXRMSTRT"
^XTV(8991,22,1,3,1,223,0)=""
^XTV(8991,22,1,3,1,223,"DEL")=" S @TEMP@(810.3,""?1,"",.03)=PXRMSTOP"
^XTV(8991,22,1,3,1,224,0)=""
^XTV(8991,22,1,3,1,224,"DEL")=" S @TEMP@(810.3,""?1,"",.06)=$$NOW^XLFDT"
^XTV(8991,22,1,3,1,225,0)=""
^XTV(8991,22,1,3,1,225,"DEL")=" S @TEMP@(810.3,""?1,"",1)=IEN"
^XTV(8991,22,1,3,1,226,0)=""
^XTV(8991,22,1,3,1,226,"DEL")=" S @TEMP@(810.3,""?1,"",2)=PARTYPE"
^XTV(8991,22,1,3,1,227,0)=""
^XTV(8991,22,1,3,1,227,"DEL")=" S @TEMP@(810.3,""?1,"",3)=$E(PERIOD,2,99)"
^XTV(8991,22,1,3,1,228,0)=""
^XTV(8991,22,1,3,1,228,"DEL")=" S @TEMP@(810.3,""?1,"",4)=YEAR"
^XTV(8991,22,1,3,1,229,0)=""
^XTV(8991,22,1,3,1,229,"DEL")=" S @TEMP@(810.3,""?1,"",5)=$S(MODE<2:""A"",1:""M"")"
^XTV(8991,22,1,3,1,230,0)=""
^XTV(8991,22,1,3,1,230,"DEL")=" S @TEMP@(810.3,""?1,"",7)=$E(PERIOD)"
^XTV(8991,22,1,3,1,231,0)=""
^XTV(8991,22,1,3,1,231,"DEL")=" ;"
^XTV(8991,22,1,3,1,233,0)=""
^XTV(8991,22,1,3,1,233,"DEL")=" N APPL,DUE,DATA,ETYP,EVAL"
^XTV(8991,22,1,3,1,234,"INS",0)="^8991.12^1^1"
^XTV(8991,22,1,3,1,234,"INS",1,0)=" N APPL,CNT,DFN,DUE,DATA,ETYP,EVAL"
^XTV(8991,22,1,3,1,235,0)=""
^XTV(8991,22,1,3,1,235,"DEL")=" N GDATA,GSEQ,INST,NAPPL,NDUE,PXRMLIST,RCNT,RIEN,RSEQ,SEQ"
^XTV(8991,22,1,3,1,236,0)=""
^XTV(8991,22,1,3,1,236,"DEL")=" S SEQ=0,CNT=1"
^XTV(8991,22,1,3,1,237,0)=""
^XTV(8991,22,1,3,1,237,"DEL")=" F  S SEQ=$O(^TMP(""PXRMETX"",$J,SEQ)) Q:'SEQ  D"
^XTV(8991,22,1,3,1,238,0)=""
^XTV(8991,22,1,3,1,238,"DEL")=" .S INST=0,RSEQ=0"
^XTV(8991,22,1,3,1,239,"INS",0)="^8991.12^4^4"
^XTV(8991,22,1,3,1,239,"INS",1,0)=" N GDATA,GSEQ,INST,NAPPL,NDUE,PCNT,PXRMLIST,RCNT,RIEN,RSEQ,SEQ,TEMP"
^XTV(8991,22,1,3,1,239,"INS",2,0)=" S SEQ="""",CNT=1,RSEQ=0"
^XTV(8991,22,1,3,1,239,"INS",3,0)=" F  S SEQ=$O(^TMP(""PXRMETX"",$J,SEQ)) Q:SEQ=""""  D"
^XTV(8991,22,1,3,1,239,"INS",4,0)=" .S INST=0"
^XTV(8991,22,1,3,1,243,0)=""
^XTV(8991,22,1,3,1,243,"DEL")=" ...S RIEN=$P(DATA,U)"
^XTV(8991,22,1,3,1,244,0)=""
^XTV(8991,22,1,3,1,244,"DEL")=" ...S EVAL=$P(DATA,U,2),APPL=$P(DATA,U,3),NAPPL=$P(DATA,U,4)"
^XTV(8991,22,1,3,1,245,0)=""
^XTV(8991,22,1,3,1,245,"DEL")=" ...S DUE=$P(DATA,U,5),NDUE=$P(DATA,U,6),PXRMLIST=$P(DATA,U,7)"
^XTV(8991,22,1,3,1,246,"INS",0)="^8991.12^3^3"
^XTV(8991,22,1,3,1,246,"INS",1,0)=" ...S RIEN=$P(DATA,U,1),EVAL=$P(DATA,U,2),APPL=$P(DATA,U,3)"
^XTV(8991,22,1,3,1,246,"INS",2,0)=" ...S NAPPL=$P(DATA,U,4),DUE=$P(DATA,U,5),NDUE=$P(DATA,U,6)"
^XTV(8991,22,1,3,1,246,"INS",3,0)=" ...S PXRMLIST=$P(DATA,U,7)"
^XTV(8991,22,1,3,1,247,0)=""
^XTV(8991,22,1,3,1,247,"DEL")=" ...S @TEMP@(810.33,""?+""_CNT_"",?1,"",.01)=$$RJ^XLFSTR(RSEQ,3,0)"
^XTV(8991,22,1,3,1,248,0)=""
^XTV(8991,22,1,3,1,248,"DEL")=" ...S @TEMP@(810.33,""?+""_CNT_"",?1,"",.02)=RIEN"
^XTV(8991,22,1,3,1,249,0)=""
^XTV(8991,22,1,3,1,249,"DEL")=" ...S @TEMP@(810.33,""?+""_CNT_"",?1,"",.03)=INST"
^XTV(8991,22,1,3,1,250,0)=""
^XTV(8991,22,1,3,1,250,"DEL")=" ...S @TEMP@(810.33,""?+""_CNT_"",?1,"",.04)=PXRMLIST"
^XTV(8991,22,1,3,1,251,0)=""
^XTV(8991,22,1,3,1,251,"DEL")=" ...S @TEMP@(810.33,""?+""_CNT_"",?1,"",2)=EVAL"
^XTV(8991,22,1,3,1,252,0)=""
^XTV(8991,22,1,3,1,252,"DEL")=" ...S @TEMP@(810.33,""?+""_CNT_"",?1,"",3)=APPL"
^XTV(8991,22,1,3,1,253,0)=""
^XTV(8991,22,1,3,1,253,"DEL")=" ...S @TEMP@(810.33,""?+""_CNT_"",?1,"",4)=NAPPL"
^XTV(8991,22,1,3,1,254,0)=""
^XTV(8991,22,1,3,1,254,"DEL")=" ...S @TEMP@(810.33,""?+""_CNT_"",?1,"",5)=DUE"
^XTV(8991,22,1,3,1,255,0)=""
^XTV(8991,22,1,3,1,255,"DEL")=" ...S @TEMP@(810.33,""?+""_CNT_"",?1,"",6)=NDUE"
^XTV(8991,22,1,3,1,256,"INS",0)="^8991.12^3^3"
^XTV(8991,22,1,3,1,256,"INS",1,0)=" ...S TEMP=$$RJ^XLFSTR(RSEQ,3,0)_U_RIEN_U_INST_U_PXRMLIST_U_EVAL_U_APPL_U_NAPPL_U_DUE_U_NDUE"
^XTV(8991,22,1,3,1,256,"INS",2,0)=" ...S ^PXRMXT(810.3,IEN,3,RSEQ,0)=TEMP"
^XTV(8991,22,1,3,1,256,"INS",3,0)=" ...S ^PXRMXT(810.3,IEN,3,""B"",$P(TEMP,U,1),RSEQ)="""""
^XTV(8991,22,1,3,1,257,0)=""
^XTV(8991,22,1,3,1,257,"DEL")=" ...S GSEQ="""",FCNT=CNT"
^XTV(8991,22,1,3,1,258,"INS",0)="^8991.12^1^1"
^XTV(8991,22,1,3,1,258,"INS",1,0)=" ...S GSEQ="""",FCNT=0"
^XTV(8991,22,1,3,1,270,0)=""
^XTV(8991,22,1,3,1,270,"DEL")=" .....S @TEMP@(810.331,""?+""_FCNT_"",?+""_CNT_"",?1,"",.01)=$$RJ^XLFSTR(FSEQ,3,0)"
^XTV(8991,22,1,3,1,271,0)=""
^XTV(8991,22,1,3,1,271,"DEL")=" .....S @TEMP@(810.331,""?+""_FCNT_"",?+""_CNT_"",?1,"",.02)=$P(FIND,"";"")"
^XTV(8991,22,1,3,1,272,0)=""
^XTV(8991,22,1,3,1,272,"DEL")=" .....S @TEMP@(810.331,""?+""_FCNT_"",?+""_CNT_"",?1,"",.03)=ETYP"
^XTV(8991,22,1,3,1,273,0)=""
^XTV(8991,22,1,3,1,273,"DEL")=" .....S @TEMP@(810.331,""?+""_FCNT_"",?+""_CNT_"",?1,"",.04)=FGNAM"
^XTV(8991,22,1,3,1,274,0)=""
^XTV(8991,22,1,3,1,274,"DEL")=" .....S @TEMP@(810.331,""?+""_FCNT_"",?+""_CNT_"",?1,"",.05)=FGSTA"
^XTV(8991,22,1,3,1,275,0)=""
^XTV(8991,22,1,3,1,275,"DEL")=" .....S @TEMP@(810.331,""?+""_FCNT_"",?+""_CNT_"",?1,"",1)=FEVAL"
^XTV(8991,22,1,3,1,276,0)=""
^XTV(8991,22,1,3,1,276,"DEL")=" .....S @TEMP@(810.331,""?+""_FCNT_"",?+""_CNT_"",?1,"",2)=FAPPL"
^XTV(8991,22,1,3,1,277,0)=""
^XTV(8991,22,1,3,1,277,"DEL")=" .....S @TEMP@(810.331,""?+""_FCNT_"",?+""_CNT_"",?1,"",3)=FNAPPL"
^XTV(8991,22,1,3,1,278,0)=""
^XTV(8991,22,1,3,1,278,"DEL")=" .....S @TEMP@(810.331,""?+""_FCNT_"",?+""_CNT_"",?1,"",4)=FDUE"
^XTV(8991,22,1,3,1,279,0)=""
^XTV(8991,22,1,3,1,279,"DEL")=" .....S @TEMP@(810.331,""?+""_FCNT_"",?+""_CNT_"",?1,"",5)=FNDUE"
^XTV(8991,22,1,3,1,280,0)=""
^XTV(8991,22,1,3,1,280,"DEL")=" ...;Update CNT"
^XTV(8991,22,1,3,1,281,0)=""
^XTV(8991,22,1,3,1,281,"DEL")=" ...S CNT=FCNT"
^XTV(8991,22,1,3,1,282,0)=""
^XTV(8991,22,1,3,1,282,"DEL")=" ;Book mark - needs error trap"
^XTV(8991,22,1,3,1,283,0)=""
^XTV(8991,22,1,3,1,283,"DEL")=" D UPDATE^DIE("""",TEMP,"""",""MSG"")"
^XTV(8991,22,1,3,1,284,"INS",0)="^8991.12^10^10"
^XTV(8991,22,1,3,1,284,"INS",1,0)=" .....S TEMP=FSEQ_U_$P(FIND,"";"")_U_ETYP_U_FEVAL_U_FAPPL_U_FNAPPL_U_FDUE_U_FNDUE_U_FGNAM_U_FGSTA"
^XTV(8991,22,1,3,1,284,"INS",2,0)=" .....S ^PXRMXT(810.3,IEN,3,RSEQ,1,FCNT,0)=TEMP"
^XTV(8991,22,1,3,1,284,"INS",3,0)=" .....;"
^XTV(8991,22,1,3,1,284,"INS",4,0)=" .....;AGP REMOVE UNTIL A DECISION CAN BE MADE"
^XTV(8991,22,1,3,1,284,"INS",5,0)=" .....;S DFN=0,PCNT=0"
^XTV(8991,22,1,3,1,284,"INS",6,0)=" .....;F  S DFN=$O(^TMP(""PXRMETX"",$J,SEQ,INST,RCNT,GSEQ,FSEQ,DFN)) Q:DFN'>0  D"
^XTV(8991,22,1,3,1,284,"INS",7,0)=" .....;.S PCNT=PCNT+1,^PXRMXT(810.3,IEN,3,RSEQ,1,FCNT,1,PCNT,0)=DFN"
^XTV(8991,22,1,3,1,284,"INS",8,0)=" .....;I PCNT>0 S ^PXRMXT(810.3,IEN,3,RSEQ,1,FCNT,1,0)=""^810.3316PA""_U_PCNT_U_PCNT"
^XTV(8991,22,1,3,1,284,"INS",9,0)=" ....I FCNT>0 S ^PXRMXT(810.3,IEN,3,RSEQ,1,0)=""^810.331I""_U_FCNT_U_FCNT"
^XTV(8991,22,1,3,1,284,"INS",10,0)=" .I RSEQ>0 S ^PXRMXT(810.3,IEN,3,0)=""^810.33I""_U_RSEQ_U_RSEQ"
^XTV(8991,22,1,3,1,285,0)=""
^XTV(8991,22,1,3,1,285,"DEL")=" D UNLOCK"
^XTV(8991,22,1,3,1,286,0)=""
^XTV(8991,22,1,3,1,286,"DEL")=" ;Clear FDA array"
^XTV(8991,22,1,3,1,287,0)=""
^XTV(8991,22,1,3,1,287,"DEL")=" K ^TMP(""PXRMFDA"",$J)"
^XTV(8991,22,1,3,1,288,"INS",0)="^8991.12^1^1"
^XTV(8991,22,1,3,1,288,"INS",1,0)=" D UNLOCK(IEN)"
^XTV(8991,22,1,3,1,291,0)=""
^XTV(8991,22,1,3,1,291,"DEL")="UNLOCK L -^PXRMXT(810.3,PXRMXIEN) Q"
^XTV(8991,22,1,3,1,292,0)=""
^XTV(8991,22,1,3,1,292,"DEL")="LOCK L +^PXRMXT(810.3,PXRMXIEN):0"
^XTV(8991,22,1,3,1,293,0)=""
^XTV(8991,22,1,3,1,293,"DEL")=" E  W !!?5,""Another user is using this extract summary"" S DUOUT=1"
^XTV(8991,22,1,3,1,294,0)=""
^XTV(8991,22,1,3,1,294,"DEL")=" ;BOOKMARK - needs to go in background"
^XTV(8991,22,1,3,1,295,"INS",0)="^8991.12^2^2"
^XTV(8991,22,1,3,1,295,"INS",1,0)="LOCK(PXRMXIEN) L +^PXRMXT(810.3,PXRMXIEN):0"
^XTV(8991,22,1,3,1,295,"INS",2,0)=" I '$T W !!?5,""Another user is using this extract summary"" S DUOUT=1"
^XTV(8991,22,1,3,1,297,"INS",0)="^8991.12^2^2"
^XTV(8991,22,1,3,1,297,"INS",1,0)="UNLOCK(PXRMXIEN) L -^PXRMXT(810.3,PXRMXIEN) Q"
^XTV(8991,22,1,3,1,297,"INS",2,0)=" ;"
^XTV(8991,22,1,3,1,315,0)=""
^XTV(8991,22,1,3,1,315,"DEL")="HELP(CALL) ;General help text routine"
^XTV(8991,22,1,3,1,316,0)=""
^XTV(8991,22,1,3,1,316,"DEL")=" N HTEXT"
^XTV(8991,22,1,3,1,317,0)=""
^XTV(8991,22,1,3,1,317,"DEL")=" ;"
^XTV(8991,22,1,3,1,318,0)=""
^XTV(8991,22,1,3,1,318,"DEL")=" I CALL=1 D"
^XTV(8991,22,1,3,1,319,0)=""
^XTV(8991,22,1,3,1,319,"DEL")=" .S HTEXT(1)=""Enter 'Y' to overwrite this existing list. Enter 'N' to"""
^XTV(8991,22,1,3,1,320,0)=""
^XTV(8991,22,1,3,1,320,"DEL")=" .S HTEXT(2)=""use a different patient list name."""
^XTV(8991,22,1,3,1,321,0)=""
^XTV(8991,22,1,3,1,321,"DEL")=" ;"
^XTV(8991,22,1,3,1,322,0)=""
^XTV(8991,22,1,3,1,322,"DEL")=" I CALL=3 D"
^XTV(8991,22,1,3,1,323,0)=""
^XTV(8991,22,1,3,1,323,"DEL")=" .S HTEXT(1)=""Enter 'Y' to transmit extract. Otherwise enter 'N'."""
^XTV(8991,22,1,3,1,324,0)=""
^XTV(8991,22,1,3,1,324,"DEL")=" ;"
^XTV(8991,22,1,3,1,325,0)=""
^XTV(8991,22,1,3,1,325,"DEL")=" I CALL=4 D"
^XTV(8991,22,1,3,1,326,0)=""
^XTV(8991,22,1,3,1,326,"DEL")=" .S HTEXT(1)=""The selected period is the same as next scheduled extract."""
^XTV(8991,22,1,3,1,327,0)=""
^XTV(8991,22,1,3,1,327,"DEL")=" .S HTEXT(2)=""Enter 'Y' to if this extract will replace the scheduled"""
^XTV(8991,22,1,3,1,328,0)=""
^XTV(8991,22,1,3,1,328,"DEL")=" .S HTEXT(3)=""extract. Enter 'N' if you still want the scheduled extract"""
^XTV(8991,22,1,3,1,329,0)=""
^XTV(8991,22,1,3,1,329,"DEL")=" .S HTEXT(3)=""to run."""
^XTV(8991,22,1,3,1,330,0)=""
^XTV(8991,22,1,3,1,330,"DEL")=" ;"
^XTV(8991,22,1,3,1,331,0)=""
^XTV(8991,22,1,3,1,331,"DEL")=" D HELP^PXRMEUT(.HTEXT)"
^XTV(8991,22,1,3,1,332,0)=""
^XTV(8991,22,1,3,1,332,"DEL")=" Q"
^XTV(8991,22,1,4,0)="3070122.2125"
^XTV(8991,22,1,4,1,0)="^8991.11^272^272"
^XTV(8991,22,1,4,1,1,0)="PXRMETX ; SLC/PJH - Run Extract for QUERI ;1/22/07  21:25"
^XTV(8991,22,1,4,1,2,0)=" ;;2.0;CLINICAL REMINDERS;**4,7**;Feb 04, 2005;Build 3"
^XTV(8991,22,1,4,1,3,0)=" ; Modified from FOIA VISTA,"
^XTV(8991,22,1,4,1,4,0)=" ; Copyright (C) 2007 WorldVistA"
^XTV(8991,22,1,4,1,5,0)=" ;"
^XTV(8991,22,1,4,1,6,0)=" ; This program is free software; you can redistribute it and/or modify"
^XTV(8991,22,1,4,1,7,0)=" ; it under the terms of the GNU General Public License as published by"
^XTV(8991,22,1,4,1,8,0)=" ; the Free Software Foundation; either version 2 of the License, or"
^XTV(8991,22,1,4,1,9,0)=" ; (at your option) any later version."
^XTV(8991,22,1,4,1,10,0)=" ;"
^XTV(8991,22,1,4,1,11,0)=" ; This program is distributed in the hope that it will be useful,"
^XTV(8991,22,1,4,1,12,0)=" ; but WITHOUT ANY WARRANTY; without even the implied warranty of"
^XTV(8991,22,1,4,1,13,0)=" ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the"
^XTV(8991,22,1,4,1,14,0)=" ; GNU General Public License for more details."
^XTV(8991,22,1,4,1,15,0)=" ;"
^XTV(8991,22,1,4,1,16,0)=" ; You should have received a copy of the GNU General Public License"
^XTV(8991,22,1,4,1,17,0)=" ; along with this program; if not, write to the Free Software"
^XTV(8991,22,1,4,1,18,0)=" ; Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA"
^XTV(8991,22,1,4,1,19,0)=" ;"
^XTV(8991,22,1,4,1,20,0)="AUTO(ID,PURGE) ;Called from option scheduling (#19.2)"
^XTV(8991,22,1,4,1,21,0)=" N IEN,LIST,LUVALUE,MODE,NEXT"
^XTV(8991,22,1,4,1,22,0)=" S LUVALUE(1)=ID"
^XTV(8991,22,1,4,1,23,0)=" D FIND^DIC(810.2,"""","""",""U"",.LUVALUE,"""","""","""","""",""LIST"")"
^XTV(8991,22,1,4,1,24,0)=" ;Get ien of extract parameter"
^XTV(8991,22,1,4,1,25,0)=" S IEN=$P(LIST(""DILIST"",2,1),U,1) Q:'IEN"
^XTV(8991,22,1,4,1,26,0)=" ;Get next extract period"
^XTV(8991,22,1,4,1,27,0)=" S NEXT=$P($G(^PXRM(810.2,IEN,0)),U,6) Q:NEXT="""""
^XTV(8991,22,1,4,1,28,0)=" ;Node is Extract and Transmit"
^XTV(8991,22,1,4,1,29,0)=" S MODE=$S($P($G(^PXRM(810.2,IEN,100)),U)=""N"":0,1:1)"
^XTV(8991,22,1,4,1,30,0)=" ;Run extract"
^XTV(8991,22,1,4,1,31,0)=" D RUN^PXRMETX(IEN,NEXT,MODE,PURGE)"
^XTV(8991,22,1,4,1,32,0)=" ;Purge Extract Summary"
^XTV(8991,22,1,4,1,33,0)=" D PRGES^PXRMETXU"
^XTV(8991,22,1,4,1,34,0)=" ;Purge Patient Lists"
^XTV(8991,22,1,4,1,35,0)=" D PRGPL^PXRMETXU"
^XTV(8991,22,1,4,1,36,0)=" ;Call the DOQ-IT HL7 generating routine"
^XTV(8991,22,1,4,1,37,0)=" ;D EXTRACT^VEPER7EX(VDATA(810.2,IEN_"","",3,""I""),VDATA(810.2,IEN_"","",5,""I""))"
^XTV(8991,22,1,4,1,38,0)=" Q"
^XTV(8991,22,1,4,1,39,0)=" ;"
^XTV(8991,22,1,4,1,40,0)="GETNAME(NAME,CLASS) ;Get the extract name."
^XTV(8991,22,1,4,1,41,0)=" I '$D(^PXRMXT(810.3,""B"",NAME)) Q NAME"
^XTV(8991,22,1,4,1,42,0)=" N CNT,NEW"
^XTV(8991,22,1,4,1,43,0)=" S (CNT,NEW)=0"
^XTV(8991,22,1,4,1,44,0)=" ;If name exists concatenate count"
^XTV(8991,22,1,4,1,45,0)=" F  D  Q:NEW"
^XTV(8991,22,1,4,1,46,0)=" .I '$D(^PXRMXT(810.3,""B"",NAME)) S NEW=1 Q"
^XTV(8991,22,1,4,1,47,0)=" .S CNT=CNT+1,NAME=$P(NAME,""/"")_""/""_$$RJ^XLFSTR(CNT,2,0)"
^XTV(8991,22,1,4,1,48,0)=" Q NAME"
^XTV(8991,22,1,4,1,49,0)=" ;"
^XTV(8991,22,1,4,1,50,0)="IHD ;Monthly IHD Extract, called from option PXRM EXTRACT VA-IHD QUERI."
^XTV(8991,22,1,4,1,51,0)=" D AUTO(""VA-IHD QUERI"",""Y"")"
^XTV(8991,22,1,4,1,52,0)=" Q"
^XTV(8991,22,1,4,1,53,0)=" ;"
^XTV(8991,22,1,4,1,54,0)="MAIL(NAME,NEXT,MODE) ;Completion mail message"
^XTV(8991,22,1,4,1,55,0)=" N FREQ,TEXT"
^XTV(8991,22,1,4,1,56,0)=" S FREQ=""year"""
^XTV(8991,22,1,4,1,57,0)=" I $E(NEXT)=""M"" S FREQ=""month"""
^XTV(8991,22,1,4,1,58,0)=" I $E(NEXT)=""Q"" S FREQ=""quarter"""
^XTV(8991,22,1,4,1,59,0)=" ;"
^XTV(8991,22,1,4,1,60,0)=" I MODE=0 S TEXT=""Extract and Transmission"""
^XTV(8991,22,1,4,1,61,0)=" I MODE=1 S TEXT=""Extract (No Transmission)"""
^XTV(8991,22,1,4,1,62,0)=" I MODE=2 S TEXT=""Manual Extract and Transmission"""
^XTV(8991,22,1,4,1,63,0)=" I MODE=3 S TEXT=""Manual Extract (No Transmission)"""
^XTV(8991,22,1,4,1,64,0)=" ;"
^XTV(8991,22,1,4,1,65,0)=" S TEXT=NAME_"" ""_TEXT_"" completed for ""_FREQ_"" ""_NEXT"
^XTV(8991,22,1,4,1,66,0)=" D MES^PXRMEUT(TEXT)"
^XTV(8991,22,1,4,1,67,0)=" Q"
^XTV(8991,22,1,4,1,68,0)=" ;"
^XTV(8991,22,1,4,1,69,0)="MH ;Monthly MH Extract, called from option PXRM EXTRACT VA-MH QUERI."
^XTV(8991,22,1,4,1,70,0)=" D AUTO(""VA-MH QUERI"",""Y"")"
^XTV(8991,22,1,4,1,71,0)=" Q"
^XTV(8991,22,1,4,1,72,0)=" ;"
^XTV(8991,22,1,4,1,73,0)="ACAD ;Auto CAD entry point"
^XTV(8991,22,1,4,1,74,0)=" D AUTO(""VOE DOQ-IT CAD EXTRACTION"")"
^XTV(8991,22,1,4,1,75,0)=" Q"
^XTV(8991,22,1,4,1,76,0)=" ;"
^XTV(8991,22,1,4,1,77,0)="ADM ;Auto DM entry point"
^XTV(8991,22,1,4,1,78,0)=" D AUTO(""VOE DOQ-IT DM EXTRACTION"")"
^XTV(8991,22,1,4,1,79,0)=" Q"
^XTV(8991,22,1,4,1,80,0)=" ;"
^XTV(8991,22,1,4,1,81,0)="AHF ;Auto HF entry point"
^XTV(8991,22,1,4,1,82,0)=" D AUTO(""VOE DOQ-IT HF EXTRACTION"")"
^XTV(8991,22,1,4,1,83,0)=" Q"
^XTV(8991,22,1,4,1,84,0)=" ;"
^XTV(8991,22,1,4,1,85,0)="AHTN ;Auto HTN entry point"
^XTV(8991,22,1,4,1,86,0)=" D AUTO(""VOE DOQ-IT HTN EXTRACTION"")"
^XTV(8991,22,1,4,1,87,0)=" Q"
^XTV(8991,22,1,4,1,88,0)=" ;"
^XTV(8991,22,1,4,1,89,0)="APC ;Auto PC entry point"
^XTV(8991,22,1,4,1,90,0)=" D AUTO(""VOE DOQ-IT PC EXTRACTION"")"
^XTV(8991,22,1,4,1,91,0)=" Q"
^XTV(8991,22,1,4,1,92,0)=" ;"
^XTV(8991,22,1,4,1,93,0)="RUN(IEN,NEXT,MODE,PURGE) ;Process extract parameter"
^XTV(8991,22,1,4,1,94,0)=" ; IEN is ien of Extract Parameter"
^XTV(8991,22,1,4,1,95,0)=" ; NEXT is period to extract"
^XTV(8991,22,1,4,1,96,0)=" ; MODE = 0 is extract and transmission"
^XTV(8991,22,1,4,1,97,0)=" ; MODE = 1 is extract only"
^XTV(8991,22,1,4,1,98,0)=" ; MODE = 2 is manual extract and transmission (doesn't update 810.2)"
^XTV(8991,22,1,4,1,99,0)=" ; MODE = 3 is manual extract only (doesn't update 810.2)"
^XTV(8991,22,1,4,1,100,0)=" ;"
^XTV(8991,22,1,4,1,101,0)=" N CLASS,FDA,FDAIEN,MSG"
^XTV(8991,22,1,4,1,102,0)=" N PXRMLIST,PXRMNODE,PXRMRULE,PXRMSTRT,PXRMXIEN,PATCREAT,XNAME"
^XTV(8991,22,1,4,1,103,0)=" ;Initialise"
^XTV(8991,22,1,4,1,104,0)=" K ^TMP(""PXRMETX"",$J),^TMP(""PXRMETX1"",$J)"
^XTV(8991,22,1,4,1,105,0)=" ;Workfile node for ^TMP"
^XTV(8991,22,1,4,1,106,0)=" S PXRMNODE=""PXRMRULE"""
^XTV(8991,22,1,4,1,107,0)=" ;Get details from parameter file"
^XTV(8991,22,1,4,1,108,0)=" N DATA,INDP,INTP,LIST,NAME,PARTYPE,PERIOD,SNAME,TEXT,YEAR"
^XTV(8991,22,1,4,1,109,0)=" ;Get class from extract parameter"
^XTV(8991,22,1,4,1,110,0)=" S CLASS=$P($G(^PXRM(810.2,IEN,100)),U)"
^XTV(8991,22,1,4,1,111,0)=" ;Otherwise default to local"
^XTV(8991,22,1,4,1,112,0)=" I $G(CLASS)="""" S CLASS=""L"""
^XTV(8991,22,1,4,1,113,0)=" ;"
^XTV(8991,22,1,4,1,114,0)=" S DATA=$G(^PXRM(810.2,IEN,0))"
^XTV(8991,22,1,4,1,115,0)=" ;Determine Extract Name and period"
^XTV(8991,22,1,4,1,116,0)=" S NAME=$P(DATA,U),PARTYPE=$P(DATA,U,2)"
^XTV(8991,22,1,4,1,117,0)=" S YEAR=$P(NEXT,""/"",2),PERIOD=$P(NEXT,""/"")"
^XTV(8991,22,1,4,1,118,0)=" ;Calculate report period start and end dates"
^XTV(8991,22,1,4,1,119,0)=" D CALC^PXRMEUT(NEXT,.PXRMSTRT,.PXRMSTOP)"
^XTV(8991,22,1,4,1,120,0)=" ;Determine output name for patient list and extract summary"
^XTV(8991,22,1,4,1,121,0)=" S XNAME=NAME_"" ""_YEAR_"" ""_PERIOD"
^XTV(8991,22,1,4,1,122,0)=" ;Process (single) Denominator rule into patient list"
^XTV(8991,22,1,4,1,123,0)=" N SEQ,SUB"
^XTV(8991,22,1,4,1,124,0)=" S SEQ="""""
^XTV(8991,22,1,4,1,125,0)=" F  S SEQ=$O(^PXRM(810.2,IEN,10,""B"",SEQ)) Q:'SEQ  D"
^XTV(8991,22,1,4,1,126,0)=" .S SUB=$O(^PXRM(810.2,IEN,10,""B"",SEQ,"""")) Q:'SUB"
^XTV(8991,22,1,4,1,127,0)=" .S DATA=$G(^PXRM(810.2,IEN,10,SUB,0)) Q:DATA="""""
^XTV(8991,22,1,4,1,128,0)=" .S PXRMRULE=$P(DATA,U,2) Q:'PXRMRULE"
^XTV(8991,22,1,4,1,129,0)=" .S LIST=$P(DATA,U,3) Q:LIST="""""
^XTV(8991,22,1,4,1,130,0)=" .I LIST[""yyyy"" S LIST=$P(LIST,""yyyy"")_YEAR_$P(LIST,""yyyy"",2)"
^XTV(8991,22,1,4,1,131,0)=" .I LIST[""nn"" S LIST=$P(LIST,""nn"")_$E(PERIOD,2,10)_$P(LIST,""nn"",2)"
^XTV(8991,22,1,4,1,132,0)=" .S INDP=+$P(DATA,U,4)"
^XTV(8991,22,1,4,1,133,0)=" .S INTP=+$P(DATA,U,5)"
^XTV(8991,22,1,4,1,134,0)=" .;Create new patient list"
^XTV(8991,22,1,4,1,135,0)=" .S PATCREAT=""Y"",PXRMLIST=$$CRLST^PXRMRULE(LIST,CLASS) Q:'PXRMLIST"
^XTV(8991,22,1,4,1,136,0)=" .;"
^XTV(8991,22,1,4,1,137,0)=" .D START^PXRMRULE(PXRMRULE,PXRMLIST,PXRMNODE,PXRMSTRT,PXRMSTOP,IEN,YEAR,PERIOD,INDP,INTP)"
^XTV(8991,22,1,4,1,138,0)=" .;Clear ^TMP lists created for rule"
^XTV(8991,22,1,4,1,139,0)=" .D CLEAR^PXRMRULE(PXRMRULE,PXRMNODE)"
^XTV(8991,22,1,4,1,140,0)=" .;Process reminders and finding rules"
^XTV(8991,22,1,4,1,141,0)=" .D REM^PXRMETXR(SUB,PXRMLIST,PXRMSTRT,PXRMSTOP,PARTYPE)"
^XTV(8991,22,1,4,1,142,0)=" ;"
^XTV(8991,22,1,4,1,143,0)=" ;Get the name"
^XTV(8991,22,1,4,1,144,0)=" S NAME=$$GETNAME(XNAME)"
^XTV(8991,22,1,4,1,145,0)=" ;Create extract summary entry"
^XTV(8991,22,1,4,1,146,0)=" S FDA(810.3,""+1,"",.01)=NAME"
^XTV(8991,22,1,4,1,147,0)=" S FDA(810.3,""+1,"",.02)=PXRMSTRT"
^XTV(8991,22,1,4,1,148,0)=" S FDA(810.3,""+1,"",.03)=PXRMSTOP"
^XTV(8991,22,1,4,1,149,0)=" S FDA(810.3,""+1,"",.06)=$$NOW^XLFDT"
^XTV(8991,22,1,4,1,150,0)=" S FDA(810.3,""+1,"",1)=IEN"
^XTV(8991,22,1,4,1,151,0)=" S FDA(810.3,""+1,"",2)=PARTYPE"
^XTV(8991,22,1,4,1,152,0)=" S FDA(810.3,""+1,"",3)=$E(PERIOD,2,99)"
^XTV(8991,22,1,4,1,153,0)=" S FDA(810.3,""+1,"",4)=YEAR"
^XTV(8991,22,1,4,1,154,0)=" S FDA(810.3,""+1,"",5)=$S(MODE<2:""A"",1:""M"")"
^XTV(8991,22,1,4,1,155,0)=" S FDA(810.3,""+1,"",7)=$E(PERIOD)"
^XTV(8991,22,1,4,1,156,0)=" I PURGE=""Y"" S FDA(810.3,""+1,"",50)=1"
^XTV(8991,22,1,4,1,157,0)=" S FDA(810.3,""+1,"",100)=CLASS"
^XTV(8991,22,1,4,1,158,0)=" D UPDATE^DIE("""",""FDA"",""FDAIEN"",""MSG"")"
^XTV(8991,22,1,4,1,159,0)=" I $D(MSG) D AWRITE^PXRMUTIL(""MSG"") G EXIT"
^XTV(8991,22,1,4,1,160,0)=" ;"
^XTV(8991,22,1,4,1,161,0)=" ;Update extract summary from ^TMP"
^XTV(8991,22,1,4,1,162,0)=" D UPDEX(FDAIEN(1))"
^XTV(8991,22,1,4,1,163,0)=" ;"
^XTV(8991,22,1,4,1,164,0)=" ;Transmit results"
^XTV(8991,22,1,4,1,165,0)=" I (MODE=0)!(MODE=2) D TRANS(FDAIEN(1))"
^XTV(8991,22,1,4,1,166,0)=" ;"
^XTV(8991,22,1,4,1,167,0)=" I $$GET^XPAR(""SYS"",""DOQ-IT"")=""YES"" D EXTRACT^VEPER7EX(VDATA(810.2,IEN_"","",3,""I""),VDATA(810.2,IEN_"","",5,""I""),PXRMLIST)"
^XTV(8991,22,1,4,1,168,0)=" ;"
^XTV(8991,22,1,4,1,169,0)=" ;Update extract parameters"
^XTV(8991,22,1,4,1,170,0)=" I MODE<2 D UPDPAR"
^XTV(8991,22,1,4,1,171,0)=" ;"
^XTV(8991,22,1,4,1,172,0)=" ;Mail message that extract completed"
^XTV(8991,22,1,4,1,173,0)=" D MAIL(NAME,NEXT,MODE)"
^XTV(8991,22,1,4,1,174,0)=" ;"
^XTV(8991,22,1,4,1,175,0)="EXIT ;Clear workfile"
^XTV(8991,22,1,4,1,176,0)=" K ^TMP(""PXRMETX"",$J),^TMP(""PXRMETX1"",$J)"
^XTV(8991,22,1,4,1,177,0)=" Q"
^XTV(8991,22,1,4,1,178,0)=" ;"
^XTV(8991,22,1,4,1,179,0)="TRANS(PXRMXIEN) ;Transmit HL7 messages"
^XTV(8991,22,1,4,1,180,0)=" N HL7ID,NAME,NEXT"
^XTV(8991,22,1,4,1,181,0)=" S HL7ID="""""
^XTV(8991,22,1,4,1,182,0)=" D HL7^PXRM7API(PXRMXIEN,1,.HL7ID)"
^XTV(8991,22,1,4,1,183,0)=" H 2"
^XTV(8991,22,1,4,1,184,0)=" ;Lock extract summary"
^XTV(8991,22,1,4,1,185,0)=" D LOCK(PXRMXIEN) Q:$D(DUOUT)"
^XTV(8991,22,1,4,1,186,0)=" ;Update run information"
^XTV(8991,22,1,4,1,187,0)=" S NAME=$P($G(^PXRMXT(810.3,PXRMXIEN,0)),U)"
^XTV(8991,22,1,4,1,188,0)=" S NEXT=$P($G(^PXRMXT(810.3,PXRMXIEN,4)),U,3)"
^XTV(8991,22,1,4,1,189,0)=" S FDA(810.3,""?1,"",.01)=NAME"
^XTV(8991,22,1,4,1,190,0)=" S FDA(810.36,""?+2,?1,"",.01)=HL7ID"
^XTV(8991,22,1,4,1,191,0)=" S FDA(810.36,""?+2,?1,"",.02)=$$NOW^XLFDT"
^XTV(8991,22,1,4,1,192,0)=" D UPDATE^DIE("""",""FDA"","""",""MSG"")"
^XTV(8991,22,1,4,1,193,0)=" ;Unlock extract summary"
^XTV(8991,22,1,4,1,194,0)=" D UNLOCK(PXRMXIEN)"
^XTV(8991,22,1,4,1,195,0)=" Q"
^XTV(8991,22,1,4,1,196,0)=" ;"
^XTV(8991,22,1,4,1,197,0)="UPDEX(IEN) ;Update extract summary"
^XTV(8991,22,1,4,1,198,0)=" N DUOUT"
^XTV(8991,22,1,4,1,199,0)=" ;Lock extract summary"
^XTV(8991,22,1,4,1,200,0)=" D LOCK(IEN) Q:$D(DUOUT)"
^XTV(8991,22,1,4,1,201,0)=" ;"
^XTV(8991,22,1,4,1,202,0)=" ;Update totals section"
^XTV(8991,22,1,4,1,203,0)=" N APPL,CNT,DFN,DUE,DATA,ETYP,EVAL"
^XTV(8991,22,1,4,1,204,0)=" N FAPPL,FCNT,FDATA,FDUE,FEVAL,FGNAM,FGSTA,FIND,FNAPPL,FNDUE,FSEQ"
^XTV(8991,22,1,4,1,205,0)=" N GDATA,GSEQ,INST,NAPPL,NDUE,PCNT,PXRMLIST,RCNT,RIEN,RSEQ,SEQ,TEMP"
^XTV(8991,22,1,4,1,206,0)=" S SEQ="""",CNT=1,RSEQ=0"
^XTV(8991,22,1,4,1,207,0)=" F  S SEQ=$O(^TMP(""PXRMETX"",$J,SEQ)) Q:SEQ=""""  D"
^XTV(8991,22,1,4,1,208,0)=" .S INST=0"
^XTV(8991,22,1,4,1,209,0)=" .F  S INST=$O(^TMP(""PXRMETX"",$J,SEQ,INST)) Q:'INST  D"
^XTV(8991,22,1,4,1,210,0)=" ..S RCNT="""""
^XTV(8991,22,1,4,1,211,0)=" ..F  S RCNT=$O(^TMP(""PXRMETX"",$J,SEQ,INST,RCNT)) Q:RCNT=""""  D"
^XTV(8991,22,1,4,1,212,0)=" ...S DATA=$G(^TMP(""PXRMETX"",$J,SEQ,INST,RCNT)) Q:'DATA"
^XTV(8991,22,1,4,1,213,0)=" ...S RIEN=$P(DATA,U,1),EVAL=$P(DATA,U,2),APPL=$P(DATA,U,3)"
^XTV(8991,22,1,4,1,214,0)=" ...S NAPPL=$P(DATA,U,4),DUE=$P(DATA,U,5),NDUE=$P(DATA,U,6)"
^XTV(8991,22,1,4,1,215,0)=" ...S PXRMLIST=$P(DATA,U,7)"
^XTV(8991,22,1,4,1,216,0)=" ...S CNT=CNT+1,RSEQ=RSEQ+1"
^XTV(8991,22,1,4,1,217,0)=" ...S TEMP=$$RJ^XLFSTR(RSEQ,3,0)_U_RIEN_U_INST_U_PXRMLIST_U_EVAL_U_APPL_U_NAPPL_U_DUE_U_NDUE"
^XTV(8991,22,1,4,1,218,0)=" ...S ^PXRMXT(810.3,IEN,3,RSEQ,0)=TEMP"
^XTV(8991,22,1,4,1,219,0)=" ...S ^PXRMXT(810.3,IEN,3,""B"",$P(TEMP,U,1),RSEQ)="""""
^XTV(8991,22,1,4,1,220,0)=" ...;For each count type"
^XTV(8991,22,1,4,1,221,0)=" ...S GSEQ="""",FCNT=0"
^XTV(8991,22,1,4,1,222,0)=" ...F  S GSEQ=$O(^TMP(""PXRMETX1"",$J,SEQ,RCNT,GSEQ)) Q:GSEQ=""""  D"
^XTV(8991,22,1,4,1,223,0)=" ....S GDATA=$G(^TMP(""PXRMETX1"",$J,SEQ,RCNT,GSEQ))"
^XTV(8991,22,1,4,1,224,0)=" ....S FGNAM=$P(GDATA,U),ETYP=$P(GDATA,U,2),FGSTA=$P(GDATA,U,3)"
^XTV(8991,22,1,4,1,225,0)=" ....;For each term"
^XTV(8991,22,1,4,1,226,0)=" ....S FSEQ=0"
^XTV(8991,22,1,4,1,227,0)=" ....F  S FSEQ=$O(^TMP(""PXRMETX1"",$J,SEQ,RCNT,GSEQ,FSEQ)) Q:FSEQ=""""  D"
^XTV(8991,22,1,4,1,228,0)=" .....;Get the term ien"
^XTV(8991,22,1,4,1,229,0)=" .....S FIND=$P($G(^TMP(""PXRMETX1"",$J,SEQ,RCNT,GSEQ,FSEQ)),U),FCNT=FCNT+1"
^XTV(8991,22,1,4,1,230,0)=" .....;Update finding totals"
^XTV(8991,22,1,4,1,231,0)=" .....S FDATA=$G(^TMP(""PXRMETX"",$J,SEQ,INST,RCNT,GSEQ,FSEQ))"
^XTV(8991,22,1,4,1,232,0)=" .....S FEVAL=$P(FDATA,U,2),FAPPL=$P(FDATA,U,3),FNAPPL=$P(FDATA,U,4)"
^XTV(8991,22,1,4,1,233,0)=" .....S FDUE=$P(FDATA,U,5),FNDUE=$P(FDATA,U,6)"
^XTV(8991,22,1,4,1,234,0)=" .....S TEMP=FSEQ_U_$P(FIND,"";"")_U_ETYP_U_FEVAL_U_FAPPL_U_FNAPPL_U_FDUE_U_FNDUE_U_FGNAM_U_FGSTA"
^XTV(8991,22,1,4,1,235,0)=" .....S ^PXRMXT(810.3,IEN,3,RSEQ,1,FCNT,0)=TEMP"
^XTV(8991,22,1,4,1,236,0)=" .....;"
^XTV(8991,22,1,4,1,237,0)=" .....;AGP REMOVE UNTIL A DECISION CAN BE MADE"
^XTV(8991,22,1,4,1,238,0)=" .....;S DFN=0,PCNT=0"
^XTV(8991,22,1,4,1,239,0)=" .....;F  S DFN=$O(^TMP(""PXRMETX"",$J,SEQ,INST,RCNT,GSEQ,FSEQ,DFN)) Q:DFN'>0  D"
^XTV(8991,22,1,4,1,240,0)=" .....;.S PCNT=PCNT+1,^PXRMXT(810.3,IEN,3,RSEQ,1,FCNT,1,PCNT,0)=DFN"
^XTV(8991,22,1,4,1,241,0)=" .....;I PCNT>0 S ^PXRMXT(810.3,IEN,3,RSEQ,1,FCNT,1,0)=""^810.3316PA""_U_PCNT_U_PCNT"
^XTV(8991,22,1,4,1,242,0)=" ....I FCNT>0 S ^PXRMXT(810.3,IEN,3,RSEQ,1,0)=""^810.331I""_U_FCNT_U_FCNT"
^XTV(8991,22,1,4,1,243,0)=" .I RSEQ>0 S ^PXRMXT(810.3,IEN,3,0)=""^810.33I""_U_RSEQ_U_RSEQ"
^XTV(8991,22,1,4,1,244,0)=" ;Unlock extract summary"
^XTV(8991,22,1,4,1,245,0)=" D UNLOCK(IEN)"
^XTV(8991,22,1,4,1,246,0)=" Q"
^XTV(8991,22,1,4,1,247,0)=" ;"
^XTV(8991,22,1,4,1,248,0)=" ;File locking"
^XTV(8991,22,1,4,1,249,0)="LOCK(PXRMXIEN) L +^PXRMXT(810.3,PXRMXIEN):0"
^XTV(8991,22,1,4,1,250,0)=" I '$T W !!?5,""Another user is using this extract summary"" S DUOUT=1"
^XTV(8991,22,1,4,1,251,0)=" Q"
^XTV(8991,22,1,4,1,252,0)=" ;"
^XTV(8991,22,1,4,1,253,0)="UNLOCK(PXRMXIEN) L -^PXRMXT(810.3,PXRMXIEN) Q"
^XTV(8991,22,1,4,1,254,0)=" ;"
^XTV(8991,22,1,4,1,255,0)="UPDPAR ;Update parameters when run complete"
^XTV(8991,22,1,4,1,256,0)=" N DATA,LAST,NEXT,PERIOD,TYPE,YEAR"
^XTV(8991,22,1,4,1,257,0)=" S DATA=$G(^PXRM(810.2,IEN,0)),NEXT=$P(DATA,U,6),TYPE=$P(DATA,U,3)"
^XTV(8991,22,1,4,1,258,0)=" ;Last run updated"
^XTV(8991,22,1,4,1,259,0)=" S LAST=NEXT"
^XTV(8991,22,1,4,1,260,0)=" ;Calculate next run"
^XTV(8991,22,1,4,1,261,0)=" I TYPE=""Y"" S NEXT=NEXT+1"
^XTV(8991,22,1,4,1,262,0)=" I ""QM""[TYPE D"
^XTV(8991,22,1,4,1,263,0)=" .N NUM"
^XTV(8991,22,1,4,1,264,0)=" .S PERIOD=$P(NEXT,""/"",1),YEAR=$P(NEXT,""/"",2)"
^XTV(8991,22,1,4,1,265,0)=" .S NUM=$P(PERIOD,TYPE,2)+1"
^XTV(8991,22,1,4,1,266,0)=" .I TYPE=""Q"",NUM>4 S NUM=1,YEAR=YEAR+1"
^XTV(8991,22,1,4,1,267,0)=" .I TYPE=""M"",NUM>12 S NUM=1,YEAR=YEAR+1"
^XTV(8991,22,1,4,1,268,0)=" .S NEXT=TYPE_NUM_""/""_YEAR"
^XTV(8991,22,1,4,1,269,0)=" ;Update last and next run fields"
^XTV(8991,22,1,4,1,270,0)=" S $P(^PXRM(810.2,IEN,0),U,4,6)=LAST_U_$$NOW^XLFDT_U_NEXT"
^XTV(8991,22,1,4,1,271,0)=" Q"
^XTV(8991,22,1,4,1,272,0)=" ;"
^XTV(8991,22,1,"B",3061010.0917,1)=""
^XTV(8991,22,1,"B",3061010.1049,2)=""
^XTV(8991,22,1,"B",3061010.1907,3)=""
^XTV(8991,22,1,"B",3070122.2125,4)=""
^XTV(8991,23,0)="MPIFAG1"
^XTV(8991,23,1,0)="^8991.01^5^5"
^XTV(8991,23,1,1,0)="3061010.1504"
^XTV(8991,23,1,1,1,0)="^8991.11^70^70"
^XTV(8991,23,1,1,1,1,0)=""
^XTV(8991,23,1,1,1,1,"DEL")="MPIFAG1 ; EHR/DAOU/WCJ - ENTER HEALTH RECORD NUMBER ;10/10/06  15:04"
^XTV(8991,23,1,1,1,2,"INS",0)="^8991.12^1^1"
^XTV(8991,23,1,1,1,2,"INS",1,0)="MPIFAG1 ; EHR/DAOU/WCJ - ENTER HEALTH RECORD NUMBER ;10/10/06  15:41"
^XTV(8991,23,1,1,1,17,0)=""
^XTV(8991,23,1,1,1,17,"DEL")=" N DTOUT,DFOUT,DLOUT,DUOUT,DQOUT,Y "
^XTV(8991,23,1,1,1,18,"INS",0)="^8991.12^1^1"
^XTV(8991,23,1,1,1,18,"INS",1,0)=" N DTOUT,DFOUT,DLOUT,DUOUT,DQOUT,Y"
^XTV(8991,23,1,1,1,21,0)=""
^XTV(8991,23,1,1,1,21,"DEL")=" S IENS="",""_DFN_"","" "
^XTV(8991,23,1,1,1,22,"INS",0)="^8991.12^1^1"
^XTV(8991,23,1,1,1,22,"INS",1,0)=" S IENS="",""_DFN_"","""
^XTV(8991,23,1,1,1,70,0)=""
^XTV(8991,23,1,1,1,70,"DEL")=" Q HRN "
^XTV(8991,23,1,1,1,71,"INS",0)="^8991.12^1^1"
^XTV(8991,23,1,1,1,71,"INS",1,0)=" Q HRN"
^XTV(8991,23,1,2,0)="3061010.1541"
^XTV(8991,23,1,2,1,0)="^8991.11^70^70"
^XTV(8991,23,1,2,1,1,0)=""
^XTV(8991,23,1,2,1,1,"DEL")="MPIFAG1 ; EHR/DAOU/WCJ - ENTER HEALTH RECORD NUMBER ;10/10/06  15:41"
^XTV(8991,23,1,2,1,2,"INS",0)="^8991.12^2^2"
^XTV(8991,23,1,2,1,2,"INS",1,0)="MPIFAG1 ; EHR/DAOU/WCJ - ENTER HEALTH RECORD NUMBER ;10/10/06  15:42"
^XTV(8991,23,1,2,1,2,"INS",2,0)=" ;;1.0; MASTER PATIENT INDEX VISTA ;;30 Apr 99"
^XTV(8991,23,1,3,0)="3061010.1542"
^XTV(8991,23,1,3,1,0)="^8991.11^71^71"
^XTV(8991,23,1,3,1,1,0)=""
^XTV(8991,23,1,3,1,1,"DEL")="MPIFAG1 ; EHR/DAOU/WCJ - ENTER HEALTH RECORD NUMBER ;10/10/06  15:42"
^XTV(8991,23,1,3,1,2,0)=""
^XTV(8991,23,1,3,1,2,"DEL")=" ;;1.0; MASTER PATIENT INDEX VISTA ;;30 Apr 99"
^XTV(8991,23,1,3,1,3,"INS",0)="^8991.12^2^2"
^XTV(8991,23,1,3,1,3,"INS",1,0)="MPIFAG1 ; EHR/DAOU/WCJ - ENTER HEALTH RECORD NUMBER ;10/10/06  18:52"
^XTV(8991,23,1,3,1,3,"INS",2,0)=" ;;1.0; MASTER PATIENT INDEX VISTA ;**40**;30 Apr 99"
^XTV(8991,23,1,4,0)="3061010.1852"
^XTV(8991,23,1,4,1,0)="^8991.11^71^71"
^XTV(8991,23,1,4,1,1,0)=""
^XTV(8991,23,1,4,1,1,"DEL")="MPIFAG1 ; EHR/DAOU/WCJ - ENTER HEALTH RECORD NUMBER ;10/10/06  18:52"
^XTV(8991,23,1,4,1,2,0)=""
^XTV(8991,23,1,4,1,2,"DEL")=" ;;1.0; MASTER PATIENT INDEX VISTA ;**40**;30 Apr 99"
^XTV(8991,23,1,4,1,3,"INS",0)="^8991.12^2^2"
^XTV(8991,23,1,4,1,3,"INS",1,0)="MPIFAG1 ; EHR/DAOU/WCJ - ENTER HEALTH RECORD NUMBER ;12/26/06  10:39"
^XTV(8991,23,1,4,1,3,"INS",2,0)=" ;;1.0; MASTER PATIENT INDEX VISTA ;**40**;30 Apr 99;Build 18"
^XTV(8991,23,1,4,1,27,0)=""
^XTV(8991,23,1,4,1,27,"DEL")=" I SEQ S LIEN=$O(OUT(""DILIST"",2,SEQ))"
^XTV(8991,23,1,4,1,28,"INS",0)="^8991.12^1^1"
^XTV(8991,23,1,4,1,28,"INS",1,0)=" I SEQ S LIEN=$O(OUT(""DILIST"",2,SEQ)) ;(No point to this!)"
^XTV(8991,23,1,4,1,33,0)=""
^XTV(8991,23,1,4,1,33,"DEL")=" W AG(""CH""),""//  """
^XTV(8991,23,1,4,1,34,"INS",0)="^8991.12^1^1"
^XTV(8991,23,1,4,1,34,"INS",1,0)=" W:AG(""CH"")]"""" AG(""CH""),""//  """
^XTV(8991,23,1,4,1,38,0)=""
^XTV(8991,23,1,4,1,38,"DEL")=" I $G(AG(""CH"")),($D(DTOUT)!$D(DLOUT)) Q"
^XTV(8991,23,1,4,1,39,0)=""
^XTV(8991,23,1,4,1,39,"DEL")=" I $D(DUOUT) W !,""EXIT NOT ALLOWED ??"""
^XTV(8991,23,1,4,1,40,0)=""
^XTV(8991,23,1,4,1,40,"DEL")=" I (Y'?1N.N)!($L(Y)>6)!(+Y<1) D  G L1"
^XTV(8991,23,1,4,1,41,0)=""
^XTV(8991,23,1,4,1,41,"DEL")=" . W !,""Enter the 1 to 6-digit Health Record Number."""
^XTV(8991,23,1,4,1,42,0)=""
^XTV(8991,23,1,4,1,42,"DEL")=" ;"
^XTV(8991,23,1,4,1,43,"INS",0)="^8991.12^6^6"
^XTV(8991,23,1,4,1,43,"INS",1,0)=" I $G(AG(""CH""))]"""",($D(DTOUT)!$D(DLOUT)) Q"
^XTV(8991,23,1,4,1,43,"INS",2,0)=" I $D(DUOUT) Q  ;W !,""EXIT NOT ALLOWED ??"""
^XTV(8991,23,1,4,1,43,"INS",3,0)=" ;I (Y'?1N.N)!($L(Y)>6)!(+Y<1) D  G L1"
^XTV(8991,23,1,4,1,43,"INS",4,0)=" ;. W !,""Enter the 1 to 6-digit Health Record Number."""
^XTV(8991,23,1,4,1,43,"INS",5,0)=" I '$$CHECK(Y) D  G L1"
^XTV(8991,23,1,4,1,43,"INS",6,0)=" .W !,$G(^DD(9000001.41,.02,3)),! I $D(^(4)) W ! X ^(4)"
^XTV(8991,23,1,4,1,67,"INS",0)="^8991.12^7^7"
^XTV(8991,23,1,4,1,67,"INS",1,0)=" ;"
^XTV(8991,23,1,4,1,67,"INS",2,0)=" ;"
^XTV(8991,23,1,4,1,67,"INS",3,0)="CHECK(Y) ;"
^XTV(8991,23,1,4,1,67,"INS",4,0)=" N X,DA S DA(1)=+$G(DFN),DA=DUZ(2),X=Y"
^XTV(8991,23,1,4,1,67,"INS",5,0)=" X $P(^DD(9000001.41,.02,0),U,5,99) Q $D(X)>0"
^XTV(8991,23,1,4,1,67,"INS",6,0)=" ;"
^XTV(8991,23,1,4,1,67,"INS",7,0)=" ;"
^XTV(8991,23,1,4,1,68,0)=""
^XTV(8991,23,1,4,1,68,"DEL")=" N HRN S HRN=1000000"
^XTV(8991,23,1,4,1,69,0)=""
^XTV(8991,23,1,4,1,69,"DEL")=" S HRN=$O(^AUPNPAT(""D"",HRN),-1)+1 I $L(HRN)>6 S HRN=1"
^XTV(8991,23,1,4,1,70,0)=""
^XTV(8991,23,1,4,1,70,"DEL")=" F  Q:'$D(^AUPNPAT(""D"",HRN))  S HRN=HRN+1 I $L(HRN)>6 S HRN=1"
^XTV(8991,23,1,4,1,71,0)=""
^XTV(8991,23,1,4,1,71,"DEL")=" Q HRN"
^XTV(8991,23,1,4,1,72,"INS",0)="^8991.12^6^6"
^XTV(8991,23,1,4,1,72,"INS",1,0)=" N HRN"
^XTV(8991,23,1,4,1,72,"INS",2,0)=" S HRN=$O(^AUPNPAT(""D"",999999999),-1) I HRN'?.N S HRN="""" G Q"
^XTV(8991,23,1,4,1,72,"INS",3,0)=" S HRN=HRN+1 "
^XTV(8991,23,1,4,1,72,"INS",4,0)=" I '$$CHECK(HRN) S HRN="""" G Q"
^XTV(8991,23,1,4,1,72,"INS",5,0)=" F  Q:'$D(^AUPNPAT(""D"",HRN))  S HRN=HRN+1 I '$$CHECK(HRN) S HRN="""" G Q"
^XTV(8991,23,1,4,1,72,"INS",6,0)="Q Q HRN"
^XTV(8991,23,1,5,0)="3061226.1039"
^XTV(8991,23,1,5,1,0)="^8991.11^81^81"
^XTV(8991,23,1,5,1,1,0)="MPIFAG1 ; EHR/DAOU/WCJ - ENTER HEALTH RECORD NUMBER ;12/26/06  10:39"
^XTV(8991,23,1,5,1,2,0)=" ;;1.0; MASTER PATIENT INDEX VISTA ;**40**;30 Apr 99;Build 18"
^XTV(8991,23,1,5,1,3,0)=" ;;;EHR PATIENT REGISTRATION;;"
^XTV(8991,23,1,5,1,4,0)=" ;"
^XTV(8991,23,1,5,1,5,0)=" ;This routine was originally from IHS routine AG1."
^XTV(8991,23,1,5,1,6,0)=" ;It was modified so that it could be called from anywhere as long as"
^XTV(8991,23,1,5,1,7,0)=" ;DFN - patient"
^XTV(8991,23,1,5,1,8,0)=" ;DUZ(2) - location"
^XTV(8991,23,1,5,1,9,0)=" ;are defined."
^XTV(8991,23,1,5,1,10,0)=" ;"
^XTV(8991,23,1,5,1,11,0)=" ;It was specifcally written so that it could be called within a DR string"
^XTV(8991,23,1,5,1,12,0)=" ;It is used to modify file 9000001 while in file 2."
^XTV(8991,23,1,5,1,13,0)=" ;"
^XTV(8991,23,1,5,1,14,0)="HRN ;"
^XTV(8991,23,1,5,1,15,0)=" Q:'$G(DUZ(2))"
^XTV(8991,23,1,5,1,16,0)=" Q:'$G(DFN)"
^XTV(8991,23,1,5,1,17,0)=" N IENS,OUT,AG,SEQ,LIEN"
^XTV(8991,23,1,5,1,18,0)=" N DTOUT,DFOUT,DLOUT,DUOUT,DQOUT,Y"
^XTV(8991,23,1,5,1,19,0)=" N FDA,FDAIEN,XXX,PATID"
^XTV(8991,23,1,5,1,20,0)=" ;"
^XTV(8991,23,1,5,1,21,0)=" ; Find HRN for this DFN/location"
^XTV(8991,23,1,5,1,22,0)=" S IENS="",""_DFN_"","""
^XTV(8991,23,1,5,1,23,0)=" D FIND^DIC(9000001.41,IENS,""@;.01;.02;"",""X"",DUZ(2),,,,,""OUT"")"
^XTV(8991,23,1,5,1,24,0)=" ;"
^XTV(8991,23,1,5,1,25,0)=" ; Check if it's a new location "
^XTV(8991,23,1,5,1,26,0)=" S SEQ=$O(OUT(""DILIST"",""ID"",0))"
^XTV(8991,23,1,5,1,27,0)=" I SEQ S LIEN=$O(OUT(""DILIST"",2,SEQ)) ;(No point to this!)"
^XTV(8991,23,1,5,1,28,0)=" ;"
^XTV(8991,23,1,5,1,29,0)=" ; prompt user for HRN"
^XTV(8991,23,1,5,1,30,0)="L1 W !,""HEALTH RECORD NUMBER: """
^XTV(8991,23,1,5,1,31,0)=" I SEQ S (AG(""CH""),AG(""OCH""))=OUT(""DILIST"",""ID"",SEQ,.02)"
^XTV(8991,23,1,5,1,32,0)=" I 'SEQ S (AG(""CH""),AG(""OCH""))=$$GENHRN()"
^XTV(8991,23,1,5,1,33,0)=" W:AG(""CH"")]"""" AG(""CH""),""//  """
^XTV(8991,23,1,5,1,34,0)=" ;"
^XTV(8991,23,1,5,1,35,0)=" ; Get the new one"
^XTV(8991,23,1,5,1,36,0)=" D READ^AG"
^XTV(8991,23,1,5,1,37,0)=" I 'SEQ,$D(DLOUT)!($D(DTOUT)) S Y=$G(AG(""CH"")) K DLOUT,DTOUT"
^XTV(8991,23,1,5,1,38,0)=" I $G(AG(""CH""))]"""",($D(DTOUT)!$D(DLOUT)) Q"
^XTV(8991,23,1,5,1,39,0)=" I $D(DUOUT) Q  ;W !,""EXIT NOT ALLOWED ??"""
^XTV(8991,23,1,5,1,40,0)=" ;I (Y'?1N.N)!($L(Y)>6)!(+Y<1) D  G L1"
^XTV(8991,23,1,5,1,41,0)=" ;. W !,""Enter the 1 to 6-digit Health Record Number."""
^XTV(8991,23,1,5,1,42,0)=" I '$$CHECK(Y) D  G L1"
^XTV(8991,23,1,5,1,43,0)=" .W !,$G(^DD(9000001.41,.02,3)),! I $D(^(4)) W ! X ^(4)"
^XTV(8991,23,1,5,1,44,0)=" ; See if anyone is using that one"
^XTV(8991,23,1,5,1,45,0)=" S AG(""CH"")=+Y"
^XTV(8991,23,1,5,1,46,0)=" G L3:'$D(^AUPNPAT(""D"",AG(""CH"")))"
^XTV(8991,23,1,5,1,47,0)=" S AG(""D"")=0"
^XTV(8991,23,1,5,1,48,0)=" ;"
^XTV(8991,23,1,5,1,49,0)=" ; someone is using this one already, see if it's the same location"
^XTV(8991,23,1,5,1,50,0)="L2 ;"
^XTV(8991,23,1,5,1,51,0)=" S AG(""D"")=$O(^AUPNPAT(""D"",AG(""CH""),AG(""D"")))"
^XTV(8991,23,1,5,1,52,0)=" G L3:AG(""D"")="""""
^XTV(8991,23,1,5,1,53,0)=" S AG(""DD"")=0"
^XTV(8991,23,1,5,1,54,0)=" S AG(""DD"")=$O(^AUPNPAT(""D"",AG(""CH""),AG(""D""),AG(""DD"")))"
^XTV(8991,23,1,5,1,55,0)=" G L2:AG(""DD"")'=DUZ(2)"
^XTV(8991,23,1,5,1,56,0)=" W !,*7,AG(""CH""),"" is already assigned to "",$P(^DPT(AG(""D""),0),U)"
^XTV(8991,23,1,5,1,57,0)=" G L1"
^XTV(8991,23,1,5,1,58,0)=" ;"
^XTV(8991,23,1,5,1,59,0)=" ; let's do it.  unique for this Location"
^XTV(8991,23,1,5,1,60,0)="L3 ;"
^XTV(8991,23,1,5,1,61,0)=" S IENS=""?+1,""_DFN_"","""
^XTV(8991,23,1,5,1,62,0)=" S FDAIEN(1)=DUZ(2)"
^XTV(8991,23,1,5,1,63,0)=" S XXX=""FDA"""
^XTV(8991,23,1,5,1,64,0)=" S FDA(9000001.41,IENS,.01)=DUZ(2)"
^XTV(8991,23,1,5,1,65,0)=" S FDA(9000001.41,IENS,.02)=AG(""CH"")"
^XTV(8991,23,1,5,1,66,0)=" D UPDATE^DIE("""",XXX,""FDAIEN"",""RET"")"
^XTV(8991,23,1,5,1,67,0)=" Q"
^XTV(8991,23,1,5,1,68,0)=" ;"
^XTV(8991,23,1,5,1,69,0)=" ;"
^XTV(8991,23,1,5,1,70,0)="CHECK(Y) ;"
^XTV(8991,23,1,5,1,71,0)=" N X,DA S DA(1)=+$G(DFN),DA=DUZ(2),X=Y"
^XTV(8991,23,1,5,1,72,0)=" X $P(^DD(9000001.41,.02,0),U,5,99) Q $D(X)>0"
^XTV(8991,23,1,5,1,73,0)=" ;"
^XTV(8991,23,1,5,1,74,0)=" ;"
^XTV(8991,23,1,5,1,75,0)="GENHRN() ;"
^XTV(8991,23,1,5,1,76,0)=" N HRN"
^XTV(8991,23,1,5,1,77,0)=" S HRN=$O(^AUPNPAT(""D"",999999999),-1) I HRN'?.N S HRN="""" G Q"
^XTV(8991,23,1,5,1,78,0)=" S HRN=HRN+1 "
^XTV(8991,23,1,5,1,79,0)=" I '$$CHECK(HRN) S HRN="""" G Q"
^XTV(8991,23,1,5,1,80,0)=" F  Q:'$D(^AUPNPAT(""D"",HRN))  S HRN=HRN+1 I '$$CHECK(HRN) S HRN="""" G Q"
^XTV(8991,23,1,5,1,81,0)="Q Q HRN"
^XTV(8991,23,1,"B",3061010.1504,1)=""
^XTV(8991,23,1,"B",3061010.1541,2)=""
^XTV(8991,23,1,"B",3061010.1542,3)=""
^XTV(8991,23,1,"B",3061010.1852,4)=""
^XTV(8991,23,1,"B",3061226.1039,5)=""
^XTV(8991,24,0)="VEPERI3"
^XTV(8991,24,1,0)="^8991.01^1^1"
^XTV(8991,24,1,1,0)="3061010.1511"
^XTV(8991,24,1,1,1,0)="^8991.11^121^121"
^XTV(8991,24,1,1,1,1,0)="VEPERI3 ;DAOU/WCJ - Incoming HL7 messages ;10/10/06  15:11"
^XTV(8991,24,1,1,1,2,0)=" ;;1.0;VOEB;;Jun 12, 2005"
^XTV(8991,24,1,1,1,3,0)=" ;;;VISTA OFFICE/EHR;"
^XTV(8991,24,1,1,1,4,0)=" ;;Per VHA Directive 10-93-142, this routine should not be modified."
^XTV(8991,24,1,1,1,5,0)=" ;"
^XTV(8991,24,1,1,1,6,0)=" ;**Program Description**"
^XTV(8991,24,1,1,1,7,0)=" ; Find patient"
^XTV(8991,24,1,1,1,8,0)=" ; Add if not found and addflag set"
^XTV(8991,24,1,1,1,9,0)=" Q"
^XTV(8991,24,1,1,1,10,0)=" ;"
^XTV(8991,24,1,1,1,11,0)=" ; Find the patient's DFN"
^XTV(8991,24,1,1,1,12,0)=" ; If patient can not be found, add it or save it off depending on the flag being"
^XTV(8991,24,1,1,1,13,0)=" ; passed in"
^XTV(8991,24,1,1,1,14,0)=" ; "
^XTV(8991,24,1,1,1,15,0)="FINDPAT(HLP,FE,DFN,NPADDFLG,HLMTIEN) ;"
^XTV(8991,24,1,1,1,16,0)=" N NAME,DOB,HRN,ID,SEX,MSHDTTM,%DT,X,RESULT,MBI,SSN"
^XTV(8991,24,1,1,1,17,0)=" ;"
^XTV(8991,24,1,1,1,18,0)=" S FE=0"
^XTV(8991,24,1,1,1,19,0)=" ;"
^XTV(8991,24,1,1,1,20,0)=" ; There are some required fields to lookup a patient"
^XTV(8991,24,1,1,1,21,0)=" S MSHDTTM=$$GETDATA(""MSH"",1000,6)"
^XTV(8991,24,1,1,1,22,0)=" I MSHDTTM="""" D  Q"
^XTV(8991,24,1,1,1,23,0)=" . S FE=$$FATALERR^VEPERI6(1,""DATA"",""REQUIRED PATIENT IDENTIFIER - MSH DATE/TIME MISSING"",HLMTIEN,.HLP) Q"
^XTV(8991,24,1,1,1,24,0)=" ;"
^XTV(8991,24,1,1,1,25,0)=" S NAME=$$GETDATA(""PID"",1000,5)"
^XTV(8991,24,1,1,1,26,0)=" I NAME="""" D  Q"
^XTV(8991,24,1,1,1,27,0)=" . S FE=$$FATALERR^VEPERI6(1,""DATA"",""REQUIRED PATIENT IDENTIFIER - NAME MISSING"",HLMTIEN,.HLP) Q"
^XTV(8991,24,1,1,1,28,0)=" ;"
^XTV(8991,24,1,1,1,29,0)=" S DOB=$$GETDATA(""PID"",1000,7)"
^XTV(8991,24,1,1,1,30,0)=" I DOB="""" D  Q"
^XTV(8991,24,1,1,1,31,0)=" . S FE=$$FATALERR^VEPERI6(1,""DATA"",""REQUIRED PATIENT IDENTIFIER - DOB MISSING"",HLMTIEN,.HLP) Q"
^XTV(8991,24,1,1,1,32,0)=" I DOB[""/"" D  Q:FE"
^XTV(8991,24,1,1,1,33,0)=" . S %DT="""",X=DOB D ^%DT"
^XTV(8991,24,1,1,1,34,0)=" . I Y>0 S DOB=Y Q"
^XTV(8991,24,1,1,1,35,0)=" . S FE=$$FATALERR^VEPERI6(1,""DATA"",""REQUIRED PATIENT IDENTIFIER - DOB INVALID"",HLMTIEN,.HLP) Q"
^XTV(8991,24,1,1,1,36,0)=" ;"
^XTV(8991,24,1,1,1,37,0)=" ; This won't be there since we are no longer doing a 2 way interface"
^XTV(8991,24,1,1,1,38,0)=" ; S HRN=$$GETDATA(""PID"",1000,2)   ;not required"
^XTV(8991,24,1,1,1,39,0)=" S HRN="""""
^XTV(8991,24,1,1,1,40,0)=" ;"
^XTV(8991,24,1,1,1,41,0)=" S ID=$$GETDATA(""PID"",1000,3)"
^XTV(8991,24,1,1,1,42,0)=" I ID="""" D  Q"
^XTV(8991,24,1,1,1,43,0)=" . S FE=$$FATALERR^VEPERI6(1,""DATA"",""REQUIRED PATIENT IDENTIFIER - ID MISSING"",HLMTIEN,.HLP) Q"
^XTV(8991,24,1,1,1,44,0)=" ;"
^XTV(8991,24,1,1,1,45,0)=" S SEX=$$GETDATA(""PID"",1000,8)"
^XTV(8991,24,1,1,1,46,0)=" I SEX="""" D  Q"
^XTV(8991,24,1,1,1,47,0)=" . S FE=$$FATALERR^VEPERI6(1,""DATA"",""REQUIRED PATIENT IDENTIFIER - SEX MISSING"",HLMTIEN,.HLP) Q"
^XTV(8991,24,1,1,1,48,0)=" ;"
^XTV(8991,24,1,1,1,49,0)=" S RESULT=$$LKUP^VEPERIC(HLMTIEN,MSHDTTM,"""",DOB,ID,HRN,NAME,SEX)"
^XTV(8991,24,1,1,1,50,0)=" ;"
^XTV(8991,24,1,1,1,51,0)=" ; -1 is BAD.  Error is logged in VEPERIC   "
^XTV(8991,24,1,1,1,52,0)=" I RESULT=-1 S FE=1 Q"
^XTV(8991,24,1,1,1,53,0)=" ;"
^XTV(8991,24,1,1,1,54,0)=" ; We have a match"
^XTV(8991,24,1,1,1,55,0)=" I +RESULT S DFN=RESULT Q"
^XTV(8991,24,1,1,1,56,0)=" ;"
^XTV(8991,24,1,1,1,57,0)=" ; Me thinks we have a new patient"
^XTV(8991,24,1,1,1,58,0)=" S MBI=$$GETDATA(""PID"",1000,24)   ; multiple birth indicator"
^XTV(8991,24,1,1,1,59,0)=" S SSN=$$GETDATA(""PID"",1000,19)   ; social security number"
^XTV(8991,24,1,1,1,60,0)=" I RESULT=0 D  Q:FE"
^XTV(8991,24,1,1,1,61,0)=" .I NPADDFLG D ADDPAT(NAME,DOB,SEX,.DFN,FE,HLMTIEN,.HLP) Q"
^XTV(8991,24,1,1,1,62,0)=" .I 'NPADDFLG D SAVEPAT(NAME,DOB,SEX,ID,HLMTIEN,MSHDTTM,.DUZ,FE,.HLP)"
^XTV(8991,24,1,1,1,63,0)=" Q"
^XTV(8991,24,1,1,1,64,0)=" ;"
^XTV(8991,24,1,1,1,65,0)=" ; The data will be in one of two places."
^XTV(8991,24,1,1,1,66,0)=" ; On if it was mapped or manipulated after coming in or another if it was not."
^XTV(8991,24,1,1,1,67,0)=" ; SETID is always 1000 on non repeating segments such as PID "
^XTV(8991,24,1,1,1,68,0)="GETDATA(SEG,SETID,SEQ) ;"
^XTV(8991,24,1,1,1,69,0)=" N DATA"
^XTV(8991,24,1,1,1,70,0)=" S DATA=$G(HLP(SEG,SETID,SEQ,0)) I DATA]"""" Q DATA"
^XTV(8991,24,1,1,1,71,0)=" Q $G(HLP(SEG,SETID,SEQ))"
^XTV(8991,24,1,1,1,72,0)=" ;"
^XTV(8991,24,1,1,1,73,0)=" ; Save the information on this record for another day"
^XTV(8991,24,1,1,1,74,0)=" ; Dates need be in MMDDYYYY@HHMMSS or MM/DD/YYYY@HHMMSS"
^XTV(8991,24,1,1,1,75,0)=" ; "
^XTV(8991,24,1,1,1,76,0)="SAVEPAT(NAME,DOB,SEX,ID,HLMTIEN,MSGDTTM,DUZ,FE,HLP) ;"
^XTV(8991,24,1,1,1,77,0)=" N DIE,DIC,X,DR"
^XTV(8991,24,1,1,1,78,0)=" S X=""`""_HLMTIEN"
^XTV(8991,24,1,1,1,79,0)=" S DIC=19904.21,DIC(0)=""L"""
^XTV(8991,24,1,1,1,80,0)=" S DIC(""DR"")="".02///^S X=NAME;.03///^S X=DOB;.04///^S X=SEX;.06///^S X=ID;.07///NOW;.08///^S X=DUZ;.09///^S X=MSGDTTM"""
^XTV(8991,24,1,1,1,81,0)=" D ^DIC"
^XTV(8991,24,1,1,1,82,0)=" ;"
^XTV(8991,24,1,1,1,83,0)=" I '+Y D  Q"
^XTV(8991,24,1,1,1,84,0)=" . S FE=$$FATALERR^VEPERI6(1,""SYSTEM"",""CAN'T ADD TO NEW PATIENT HOLD FILE 19904.21"",HLMTIEN,.HLP) Q"
^XTV(8991,24,1,1,1,85,0)=" ;"
^XTV(8991,24,1,1,1,86,0)=" Q"
^XTV(8991,24,1,1,1,87,0)=" ;"
^XTV(8991,24,1,1,1,88,0)=" ; Add a patient to file 2 & 9000001"
^XTV(8991,24,1,1,1,89,0)=" ; This just adds a stub to get the patient started."
^XTV(8991,24,1,1,1,90,0)="ADDPAT(NAME,DOB,SEX,DFN,FE,HLMTIEN,HLP) ;"
^XTV(8991,24,1,1,1,91,0)=" N DIC,HRN,IENS,DATA,DLAYGO,RET,X,FDA"
^XTV(8991,24,1,1,1,92,0)=" ;"
^XTV(8991,24,1,1,1,93,0)=" ; These variables are most likely set by DIC,DIE and IHS lookup routines."
^XTV(8991,24,1,1,1,94,0)=" N Y,VAERR,FDAIEN,DIW,DGUSER,DFN,DDER,DA,C,DICR,SSN"
^XTV(8991,24,1,1,1,95,0)=" N AUPNSEX,AUPNPAT,AUPNLK,AUPNDOD,AUPNDOB,AUPNDAYS,AGE,%I,%1,%L"
^XTV(8991,24,1,1,1,96,0)=" ;"
^XTV(8991,24,1,1,1,97,0)=" S FE=0"
^XTV(8991,24,1,1,1,98,0)=" I $G(NAME)=""""!($G(DOB)="""")!($G(SEX)="""") D  Q"
^XTV(8991,24,1,1,1,99,0)=" . S FE=$$FATALERR^VEPERI6(1,""DATA"",""NAME, DOB OR SEX MISSING FROM PATIENT ADD"",HLMTIEN,.HLP) Q"
^XTV(8991,24,1,1,1,100,0)=" ;"
^XTV(8991,24,1,1,1,101,0)=" ; Add stub patient"
^XTV(8991,24,1,1,1,102,0)=" ; Force the entry because we already determined it was a new patient"
^XTV(8991,24,1,1,1,103,0)=" S X=""""""""_NAME_"""""""""
^XTV(8991,24,1,1,1,104,0)=" S DIC=2,DIC(0)=""L"",DLAYGO=2"
^XTV(8991,24,1,1,1,105,0)=" S DIC(""DR"")="".301///N;391///VISTA OFFICE EHR;1901///N;.03///""_DOB_"";.02///""_SEX"
^XTV(8991,24,1,1,1,106,0)=" D ^DIC"
^XTV(8991,24,1,1,1,107,0)=" I Y<0 D  Q"
^XTV(8991,24,1,1,1,108,0)=" . S FE=$$FATALERR^VEPERI6(1,""PATADD"",""PROBLEM ADDING PATIENT"",HLMTIEN,.HLP) Q"
^XTV(8991,24,1,1,1,109,0)=" ;"
^XTV(8991,24,1,1,1,110,0)=" S DFN=+Y"
^XTV(8991,24,1,1,1,111,0)=" ;"
^XTV(8991,24,1,1,1,112,0)=" ; Create patient in IHS global"
^XTV(8991,24,1,1,1,113,0)=" S HRN=$$GENHRN^MPIFAG1()"
^XTV(8991,24,1,1,1,114,0)=" S IENS=""?+1,""_+Y_"","""
^XTV(8991,24,1,1,1,115,0)=" S DATA=""FDA"""
^XTV(8991,24,1,1,1,116,0)=" S FDA(9000001.41,IENS,.01)=DUZ(2)"
^XTV(8991,24,1,1,1,117,0)=" S FDA(9000001.41,IENS,.02)=HRN"
^XTV(8991,24,1,1,1,118,0)=" D UPDATE^DIE("""",DATA,""FDAIEN"",""RET"")"
^XTV(8991,24,1,1,1,119,0)=" I $D(RET) D  Q"
^XTV(8991,24,1,1,1,120,0)=" . S FE=$$FATALERR^VEPERI6(1,""PATADD"",""PROBLEM ADDING PATIENT HRN"",HLMTIEN,.HLP) Q"
^XTV(8991,24,1,1,1,121,0)=" Q"
^XTV(8991,24,1,"B",3061010.1511,1)=""
^XTV(8991,25,0)="MPIFAPI"
^XTV(8991,25,1,0)="^8991.01^2^2"
^XTV(8991,25,1,1,0)="3061010.1512"
^XTV(8991,25,1,1,1,0)="^8991.11^194^194"
^XTV(8991,25,1,1,1,1,0)=""
^XTV(8991,25,1,1,1,1,"DEL")="MPIFAPI ;CMC/BP-APIS FOR MPI ;10/10/06  15:12"
^XTV(8991,25,1,1,1,2,0)=""
^XTV(8991,25,1,1,1,2,"DEL")=" ;;1.0; MASTER PATIENT INDEX VISTA ;**1,3,14,16,17,21,27,28,33,35,37,43,45**;30 Apr 99"
^XTV(8991,25,1,1,1,3,"INS",0)="^8991.12^2^2"
^XTV(8991,25,1,1,1,3,"INS",1,0)="MPIFAPI ;CMC/BP-APIS FOR MPI ;10/10/06  18:51"
^XTV(8991,25,1,1,1,3,"INS",2,0)=" ;;1.0; MASTER PATIENT INDEX VISTA ;**1,3,14,16,17,21,27,28,33,35,37,43,45,40**;30 Apr 99"
^XTV(8991,25,1,2,0)="3061010.1851"
^XTV(8991,25,1,2,1,0)="^8991.11^194^194"
^XTV(8991,25,1,2,1,1,0)="MPIFAPI ;CMC/BP-APIS FOR MPI ;10/10/06  18:51"
^XTV(8991,25,1,2,1,2,0)=" ;;1.0; MASTER PATIENT INDEX VISTA ;**1,3,14,16,17,21,27,28,33,35,37,43,45,40**;30 Apr 99"
^XTV(8991,25,1,2,1,3,0)=" ;"
^XTV(8991,25,1,2,1,4,0)=" ; 2/5/2005  DAOU/WCJ: VOE patch created"
^XTV(8991,25,1,2,1,5,0)=" ; 4/22/2005 ALB/PTD: MPIF*1*37"
^XTV(8991,25,1,2,1,6,0)=" ; 9/14/2005 VA/CJS: VOE patch reworked as MPIF*1*40 T1"
^XTV(8991,25,1,2,1,7,0)=" ; 4/3/2006  WV/TOAD: VOE patch reapplied after YS*5.01*37"
^XTV(8991,25,1,2,1,8,0)=" ;"
^XTV(8991,25,1,2,1,9,0)=" ; Integration Agreements Utilized:"
^XTV(8991,25,1,2,1,10,0)=" ;   ^DPT( - #2070 and #4079"
^XTV(8991,25,1,2,1,11,0)=" ;   ^DPT(""AICN"", ^DPT(""AMPIMIS"", ^DPT(""ASCN2"" - #2070"
^XTV(8991,25,1,2,1,12,0)=" ;   EXC, START, STOP^RGHLLOG - #2796"
^XTV(8991,25,1,2,1,13,0)=" ;"
^XTV(8991,25,1,2,1,14,0)="EN2() ;NEW ENTRY POINT FOR LOCALS"
^XTV(8991,25,1,2,1,15,0)=" N MPIOUT,DIC,MPICHK,MPINCK,MPINNM,MPINUM1,DA,MPINUM"
^XTV(8991,25,1,2,1,16,0)=" I $O(^MPIF(984.1,0))="""" G SETUP"
^XTV(8991,25,1,2,1,17,0)="AGN2 L +^MPIF(984.1):1 E  H 3 G AGN2"
^XTV(8991,25,1,2,1,18,0)=" S MPINUM=0,X=$$SITE^VASITE,X=$P(X,""^"",3),X=X\1"
^XTV(8991,25,1,2,1,19,0)=" S DIC=""^MPIF(984.1,"",DIC(0)=""XZ"" D ^DIC"
^XTV(8991,25,1,2,1,20,0)=" S MPINUM1=$P(Y(0),""^"",4),MPICHK=$P(Y(0),""^"",5),MPINNM=MPINUM1+1"
^XTV(8991,25,1,2,1,21,0)=" S MPINUM=MPINUM1_""V""_MPICHK,MPINCK=$$CHECKDG^MPIFSPC(MPINNM)"
^XTV(8991,25,1,2,1,22,0)=" S DA=1,DIE=""^MPIF(984.1,"",DR=""1////^S X=MPINUM1;2////^S X=MPICHK;3////^S X=MPINNM;5////""_MPINCK"
^XTV(8991,25,1,2,1,23,0)=" D ^DIE"
^XTV(8991,25,1,2,1,24,0)=" K DIE,DR,X,Y"
^XTV(8991,25,1,2,1,25,0)=" L -^MPIF(984.1)"
^XTV(8991,25,1,2,1,26,0)=" Q MPINUM"
^XTV(8991,25,1,2,1,27,0)="SETUP ;"
^XTV(8991,25,1,2,1,28,0)=" N CHK,NUM,NXTCHK,NXTNUM,SITE,DA"
^XTV(8991,25,1,2,1,29,0)=" S SITE=$$SITE^VASITE,SITE=$P(SITE,""^"",3),SITE=SITE\1"
^XTV(8991,25,1,2,1,30,0)=" S DIC=""^MPIF(984.1,"",DA=1,DIC(0)="""",X=SITE"
^XTV(8991,25,1,2,1,31,0)=" S NUM=SITE_""0000000"",CHK=$$CHECKDG^MPIFSPC(NUM),MPINUM=NUM_""V""_CHK"
^XTV(8991,25,1,2,1,32,0)=" S NXTNUM=NUM+1,NXTCHK=$$CHECKDG^MPIFSPC(NXTNUM)"
^XTV(8991,25,1,2,1,33,0)=" S DIC(""DR"")=""1////^S X=NUM;2////^S X=CHK;3////^S X=NXTNUM;5////""_NXTCHK"
^XTV(8991,25,1,2,1,34,0)=" K DD,D0"
^XTV(8991,25,1,2,1,35,0)=" D FILE^DICN"
^XTV(8991,25,1,2,1,36,0)=" K DIC,X,Y"
^XTV(8991,25,1,2,1,37,0)=" Q MPINUM"
^XTV(8991,25,1,2,1,38,0)=" ;"
^XTV(8991,25,1,2,1,39,0)="MPILINK() ;returns MPI logical Link"
^XTV(8991,25,1,2,1,40,0)=" N MPIL,MPILINK"
^XTV(8991,25,1,2,1,41,0)=" D LINK^HLUTIL3(""MPI"",.MPIL)"
^XTV(8991,25,1,2,1,42,0)=" I '$D(MPIL) Q ""-1^NOT DEFINED"""
^XTV(8991,25,1,2,1,43,0)=" S MPILINK=$O(MPIL(0))"
^XTV(8991,25,1,2,1,44,0)=" I MPILINK="""" Q ""-1^NOT DEFINED"""
^XTV(8991,25,1,2,1,45,0)=" S MPILINK=$G(MPIL(MPILINK))"
^XTV(8991,25,1,2,1,46,0)=" Q MPILINK"
^XTV(8991,25,1,2,1,47,0)=" ;"
^XTV(8991,25,1,2,1,48,0)="SUBNUM(DFN) ; returns SCN from MPI node for given DFN"
^XTV(8991,25,1,2,1,49,0)=" ; DFN - ien of patient file"
^XTV(8991,25,1,2,1,50,0)=" ; returns:  -1^error message << always returns."
^XTV(8991,25,1,2,1,51,0)=" ;*** Subscription control numbers no longer exist"
^XTV(8991,25,1,2,1,52,0)=" Q ""-1^No Subscription Control Number for DFN ""_DFN"
^XTV(8991,25,1,2,1,53,0)=" ;"
^XTV(8991,25,1,2,1,54,0)="MPINODE(DFN) ; returns MPI node for given DFN"
^XTV(8991,25,1,2,1,55,0)=" ;DFN - patient file ien"
^XTV(8991,25,1,2,1,56,0)=" ; returns:  -1^error message or MPI node from patient file"
^XTV(8991,25,1,2,1,57,0)=" I '$D(DFN) Q ""-1^DFN not defined"""
^XTV(8991,25,1,2,1,58,0)=" I '$D(^DPT(DFN)) Q ""-1^DFN doesn't exist"""
^XTV(8991,25,1,2,1,59,0)=" I '$D(^DPT(DFN,""MPI"")) Q ""-1^No MPI node for DFN ""_DFN"
^XTV(8991,25,1,2,1,60,0)=" L +^DPT(""MPI"",DFN):10 ;**45 added lock check for getting ICN data back"
^XTV(8991,25,1,2,1,61,0)=" N NODE S NODE=$G(^DPT(DFN,""MPI""))"
^XTV(8991,25,1,2,1,62,0)=" I NODE=""""!(NODE?.""^"") S NODE=""-1^No MPI data for DFN ""_DFN"
^XTV(8991,25,1,2,1,63,0)=" I +NODE>0 D"
^XTV(8991,25,1,2,1,64,0)=" .;**45 checking if checksum for ICN is correct, if not update the 991.02 field"
^XTV(8991,25,1,2,1,65,0)=" .; and include new value in NODE returned."
^XTV(8991,25,1,2,1,66,0)=" .N CHK S CHK=$$CHECKDG^MPIFSPC($P(NODE,""^""))"
^XTV(8991,25,1,2,1,67,0)=" .I CHK'=$P(NODE,""^"",2) D SETICN^MPIF001(DFN,$P(NODE,""^""),CHK) S $P(NODE,""^"",2)=CHK"
^XTV(8991,25,1,2,1,68,0)=" L -^DPT(""MPI"",DFN)"
^XTV(8991,25,1,2,1,69,0)=" Q NODE"
^XTV(8991,25,1,2,1,70,0)=" ;"
^XTV(8991,25,1,2,1,71,0)="GETADFN(ICN) ; return DFN ONLY if ICN is the active ICN"
^XTV(8991,25,1,2,1,72,0)=" ; ICN - Integration Control Number for patient to be returned"
^XTV(8991,25,1,2,1,73,0)=" ; returns:  -1^error message"
^XTV(8991,25,1,2,1,74,0)=" ;           DFN - IEN for the patient entry in the Patient file (#2)"
^XTV(8991,25,1,2,1,75,0)=" N RETURN,DFN"
^XTV(8991,25,1,2,1,76,0)=" I $G(ICN)'>0 Q ""-1^NO ICN"""
^XTV(8991,25,1,2,1,77,0)=" I '$D(^DPT(""AICN"",ICN)) Q ""-1^ICN NOT IN DATABASE"""
^XTV(8991,25,1,2,1,78,0)=" S DFN=$O(^DPT(""AICN"",ICN,0))"
^XTV(8991,25,1,2,1,79,0)=" I $G(DFN)'>0 Q ""-1^BAD AICN CROSS-REFERENCE"""
^XTV(8991,25,1,2,1,80,0)=" I $P($G(^DPT(DFN,""MPI"")),""^"")'=ICN Q ""-1^ICN is not Active one"""
^XTV(8991,25,1,2,1,81,0)=" Q DFN"
^XTV(8991,25,1,2,1,82,0)=" ;"
^XTV(8991,25,1,2,1,83,0)="UPDATE(DFN,ARR,MPISILNT,REMOVE) ;api to edit 'mpi','mpifhis' and 'mpicmor' nodes"
^XTV(8991,25,1,2,1,84,0)=" ;**37 UPDATE module moved 3/30/05 from MPIFAPI into MPIFAPI1."
^XTV(8991,25,1,2,1,85,0)=" ;Linetag must remain due to DBIA #2706."
^XTV(8991,25,1,2,1,86,0)=" Q $$UPDATE^MPIFAPI1(DFN,ARR,.MPISILNT,.REMOVE)"
^XTV(8991,25,1,2,1,87,0)=" ;"
^XTV(8991,25,1,2,1,88,0)="MPIQ(DFN) ;MPI QUERY"
^XTV(8991,25,1,2,1,89,0)=" L +^DPT(DFN):2 I '$T,'$D(MPIFS) W $C(7),!!,""Patient is being edited. No attempt will be made to connect to the MPI."" H 2 Q"
^XTV(8991,25,1,2,1,90,0)=" I '$D(MPIFS) D  ;Not from SmartCard background job"
^XTV(8991,25,1,2,1,91,0)=" .;**37 mods to L -^DPT"
^XTV(8991,25,1,2,1,92,0)=" .I $G(DGNEW)=1 D  ;New patient, fields always blank, ask"
^XTV(8991,25,1,2,1,93,0)=" ..D WRTLN"
^XTV(8991,25,1,2,1,94,0)=" ..S DIE=""^DPT("",DA=DFN,DIE(""NO^"")=""BACK"""
^XTV(8991,25,1,2,1,95,0)=" ..;"
^XTV(8991,25,1,2,1,96,0)=" ..; start of VOE change part 1 of 2"
^XTV(8991,25,1,2,1,97,0)=" ..; if agency is EHR or IHS, ask Health Record Number before other fields"
^XTV(8991,25,1,2,1,98,0)=" ..;"
^XTV(8991,25,1,2,1,99,0)=" ..; before change"
^XTV(8991,25,1,2,1,100,0)=" ..;S DR="".2403;.092;.093;1"",DR(2,2.01)="".01"" D ^DIE K DA,DIE,DR Q"
^XTV(8991,25,1,2,1,101,0)=" ..;"
^XTV(8991,25,1,2,1,102,0)=" ..; after change"
^XTV(8991,25,1,2,1,103,0)=" ..S DR="".2403;.092;.093;1"""
^XTV(8991,25,1,2,1,104,0)=" ..I ""EI""[$G(DUZ(""AG"")) S DR=""D HRN^MPIFAG1;""_DR"
^XTV(8991,25,1,2,1,105,0)=" ..S DR(2,2.01)="".01"""
^XTV(8991,25,1,2,1,106,0)=" ..D ^DIE"
^XTV(8991,25,1,2,1,107,0)=" ..K DA,DIE,DR"
^XTV(8991,25,1,2,1,108,0)=" ..;"
^XTV(8991,25,1,2,1,109,0)=" ..; end of VOE change 1 of 2"
^XTV(8991,25,1,2,1,110,0)=" ..;"
^XTV(8991,25,1,2,1,111,0)=" .I $G(DGNEW)="""" D  ;Existing patient, get current values"
^XTV(8991,25,1,2,1,112,0)=" ..K MPIFARR N MPIDOB,IMPRS,MPIMMN,MPICTY,MPIST"
^XTV(8991,25,1,2,1,113,0)=" ..S DIC=2,DR="".02;.03;.09;.092;.093;.2403;994;1"",DR(2.01)="".01"""
^XTV(8991,25,1,2,1,114,0)=" ..S DA=DFN,DA(2.01)=1,DIQ(0)=""EI"",DIQ=""MPIFARR"""
^XTV(8991,25,1,2,1,115,0)=" ..D EN^DIQ1 K DA,DIC,DIQ,DR"
^XTV(8991,25,1,2,1,116,0)=" ..;build DR from blank fields / imprecise DOB / pseudo SSN"
^XTV(8991,25,1,2,1,117,0)=" ..S DR="""""
^XTV(8991,25,1,2,1,118,0)=" ..S MPIDOB=$G(MPIFARR(2,DFN,.03,""I"")) ;DATE OF BIRTH"
^XTV(8991,25,1,2,1,119,0)=" ..I MPIDOB="""" S DR=DR_"".03;"" ;DOB null"
^XTV(8991,25,1,2,1,120,0)=" ..;Is DOB imprecise?"
^XTV(8991,25,1,2,1,121,0)=" ..I MPIDOB'="""" S IMPRS=0 D"
^XTV(8991,25,1,2,1,122,0)=" ...I $E(MPIDOB,4,7)=""0000"" S IMPRS=1 ;Year only; no month/day"
^XTV(8991,25,1,2,1,123,0)=" ...I ($E(MPIDOB,6,7)=""00"")&($E(MPIDOB,4,5)'=""00"") S IMPRS=1 ;Year/month only; no day"
^XTV(8991,25,1,2,1,124,0)=" ...I IMPRS=1 S DR=DR_"".03;"" ;DOB imprecise"
^XTV(8991,25,1,2,1,125,0)=" ..I $G(MPIFARR(2,DFN,.02,""I""))="""" S DR=DR_"".02;"" ;SEX"
^XTV(8991,25,1,2,1,126,0)=" ..I ($G(MPIFARR(2,DFN,.09,""E""))="""")!($G(MPIFARR(2,DFN,.09,""E""))[""P"") S DR=DR_"".09;"" ;SOCIAL SECURITY NUMBER"
^XTV(8991,25,1,2,1,127,0)=" ..;"
^XTV(8991,25,1,2,1,128,0)=" ..; start of VOE change part 2 of 2"
^XTV(8991,25,1,2,1,129,0)=" ..; if agency is EHR or IHS, ask Health Record Number after SSN"
^XTV(8991,25,1,2,1,130,0)=" ..;"
^XTV(8991,25,1,2,1,131,0)=" ..I ""EI""[$G(DUZ(""AG"")) S DR=DR_""D HRN^MPIFAG1;"""
^XTV(8991,25,1,2,1,132,0)=" ..;"
^XTV(8991,25,1,2,1,133,0)=" ..; end of VOE change 2 of 2"
^XTV(8991,25,1,2,1,134,0)=" ..;"
^XTV(8991,25,1,2,1,135,0)=" ..I $G(MPIFARR(2,DFN,994,""I""))="""" S DR=DR_""994;"" ;MULTIPLE BIRTH INDICATOR"
^XTV(8991,25,1,2,1,136,0)=" ..S MPIMMN=$G(MPIFARR(2,DFN,.2403,""E"")) ;MOTHER'S MAIDEN NAME"
^XTV(8991,25,1,2,1,137,0)=" ..I $$VALDT(MPIMMN) S DR=DR_"".2403;"" ;Validate MMN value"
^XTV(8991,25,1,2,1,138,0)=" ..S MPICTY=$G(MPIFARR(2,DFN,.092,""E"")) ;PLACE OF BIRTH [CITY]"
^XTV(8991,25,1,2,1,139,0)=" ..S MPIST=$G(MPIFARR(2,DFN,.093,""E"")) ;PLACE OF BIRTH [STATE]"
^XTV(8991,25,1,2,1,140,0)=" ..I $S($$VALDT(MPICTY):1,$$VALDT(MPIST):1,1:0) S DR=DR_"".092;.093;"" ;Validate POB [CITY] & [STATE] value"
^XTV(8991,25,1,2,1,141,0)=" ..I $G(MPIFARR(2.01,1,.01,""E""))="""" S DR=DR_""1"",DR(2,2.01)="".01"" ;ALIAS"
^XTV(8991,25,1,2,1,142,0)=" ..K MPIFARR"
^XTV(8991,25,1,2,1,143,0)=" ..I DR'="""" D"
^XTV(8991,25,1,2,1,144,0)=" ...D WRTLN"
^XTV(8991,25,1,2,1,145,0)=" ...S DIE=""^DPT("",DA=DFN,DIE(""NO^"")=""BACK"""
^XTV(8991,25,1,2,1,146,0)=" ...D ^DIE K DA,DIE,DR"
^XTV(8991,25,1,2,1,147,0)=" L -^DPT(DFN)"
^XTV(8991,25,1,2,1,148,0)=" I $D(ZTQUEUED) S ZTREQ=""@"""
^XTV(8991,25,1,2,1,149,0)=" K MPIFRTN D VTQ^MPIFQ0"
^XTV(8991,25,1,2,1,150,0)=" ;**43 No longer get list of potential matches to pick from"
^XTV(8991,25,1,2,1,151,0)=" ;I $G(MPIFRTN)="""" D"
^XTV(8991,25,1,2,1,152,0)=" ;. ^ Quit at LM screen when presented with a list of possible matches"
^XTV(8991,25,1,2,1,153,0)=" ;. \/ setup Local ICN and proceed"
^XTV(8991,25,1,2,1,154,0)=" ;.N ICN,ERR"
^XTV(8991,25,1,2,1,155,0)=" ;.S ICN=$$EN2^MPIFAPI()"
^XTV(8991,25,1,2,1,156,0)=" ;.Q:ICN=""""!(+ICN=-1)"
^XTV(8991,25,1,2,1,157,0)=" ;.S ERR=$$SETICN^MPIF001(DFN,+ICN,$P(ICN,""V"",2))"
^XTV(8991,25,1,2,1,158,0)=" ;.Q:+ERR=-1"
^XTV(8991,25,1,2,1,159,0)=" ;. ^ couldn't set ICN don't set other fields"
^XTV(8991,25,1,2,1,160,0)=" ;.S ERR=$$SETLOC^MPIF001(DFN,1),ERR=$$CHANGE^MPIF001(DFN,$P($$SITE^VASITE,""^""))"
^XTV(8991,25,1,2,1,161,0)=" K MPIFRTN,ZTREQ"
^XTV(8991,25,1,2,1,162,0)=" Q"
^XTV(8991,25,1,2,1,163,0)=" ;"
^XTV(8991,25,1,2,1,164,0)="MPIQQ(PDFN) ; Entry point for queuing d/c"
^XTV(8991,25,1,2,1,165,0)=" ; Returned is -1^error message OR Task #"
^XTV(8991,25,1,2,1,166,0)=" Q:'$D(PDFN) ""-1^No DFN passed"""
^XTV(8991,25,1,2,1,167,0)=" S ZTRTN=""MPIQ^MPIFAPI(PDFN)"""
^XTV(8991,25,1,2,1,168,0)=" I $D(DUZ) S ZTSAVE(""DUZ"")=DUZ"
^XTV(8991,25,1,2,1,169,0)=" S ZTSAVE(""PDFN"")=PDFN,ZTSAVE(""MPIFS"")=1"
^XTV(8991,25,1,2,1,170,0)=" ; ^ silent flag"
^XTV(8991,25,1,2,1,171,0)=" S ZTIO="""",ZTDTH=$$FMADD^XLFDT($$NOW^XLFDT,0,0,1,0)"
^XTV(8991,25,1,2,1,172,0)=" D ^%ZTLOAD"
^XTV(8991,25,1,2,1,173,0)=" D HOME^%ZIS K IO(""Q"")"
^XTV(8991,25,1,2,1,174,0)=" N TSK S TSK=ZTSK"
^XTV(8991,25,1,2,1,175,0)=" K ZTSAVE,ZTRTN,ZTIO,ZTDTH,ZTSK"
^XTV(8991,25,1,2,1,176,0)=" Q TSK"
^XTV(8991,25,1,2,1,177,0)=" ;"
^XTV(8991,25,1,2,1,178,0)="WRTLN ;**37 Write intro text ONLY if there are fields to ask"
^XTV(8991,25,1,2,1,179,0)=" W !!,""Please verify or update the following information:"",!"
^XTV(8991,25,1,2,1,180,0)=" Q"
^XTV(8991,25,1,2,1,181,0)=" ;"
^XTV(8991,25,1,2,1,182,0)="VALDT(VAL) ;**37 Validate value passed in."
^XTV(8991,25,1,2,1,183,0)=" ;Prompt if field contains invalid data (e.g., UNKNOWN, NOT KNOWN, etc.)"
^XTV(8991,25,1,2,1,184,0)=" ;Returns 0 if not found"
^XTV(8991,25,1,2,1,185,0)=" ;Returns 1 if found"
^XTV(8991,25,1,2,1,186,0)=" I VAL="""" Q 1"
^XTV(8991,25,1,2,1,187,0)=" I $E($$UP^XLFSTR(VAL),1,3)=""UNK"" Q 1"
^XTV(8991,25,1,2,1,188,0)=" I $E($$UP^XLFSTR(VAL),1,4)=""NONE"" Q 1"
^XTV(8991,25,1,2,1,189,0)=" I $E($$UP^XLFSTR(VAL),1,4)=""NOT "" Q 1"
^XTV(8991,25,1,2,1,190,0)=" I $$UP^XLFSTR(VAL)[""UNAVAILABLE"" Q 1"
^XTV(8991,25,1,2,1,191,0)=" I $$UP^XLFSTR(VAL)[""DECEASED"" Q 1"
^XTV(8991,25,1,2,1,192,0)=" I $E($$UP^XLFSTR(VAL),1,2)=""DC"" Q 1"
^XTV(8991,25,1,2,1,193,0)=" Q 0"
^XTV(8991,25,1,2,1,194,0)=" ;"
^XTV(8991,25,1,"B",3061010.1512,1)=""
^XTV(8991,25,1,"B",3061010.1851,2)=""
^XTV(8991,26,0)="PXRMUTL"
^XTV(8991,26,1,0)="^8991.01^2^2"
^XTV(8991,26,1,1,0)="3061010.1522"
^XTV(8991,26,1,1,1,0)="^8991.11^29^29"
^XTV(8991,26,1,1,1,1,0)=""
^XTV(8991,26,1,1,1,1,"DEL")="PXRMUTL ;EHR/DAOU/JLG - Utility Functions ;10/10/06  15:22"
^XTV(8991,26,1,1,1,2,0)=""
^XTV(8991,26,1,1,1,2,"DEL")=" ;;1.0t1;EHR VO UTILITIES;;JAN 7, 2005"
^XTV(8991,26,1,1,1,3,"INS",0)="^8991.12^2^2"
^XTV(8991,26,1,1,1,3,"INS",1,0)="PXRMUTL ;EHR/DAOU/JLG - Utility Functions ;10/10/06  16:26"
^XTV(8991,26,1,1,1,3,"INS",2,0)=" ;;1.0t1;EHR VO UTILITIES;**167**;JAN 7, 2005"
^XTV(8991,26,1,2,0)="3061010.1626"
^XTV(8991,26,1,2,1,0)="^8991.11^29^29"
^XTV(8991,26,1,2,1,1,0)="PXRMUTL ;EHR/DAOU/JLG - Utility Functions ;10/10/06  16:26"
^XTV(8991,26,1,2,1,2,0)=" ;;1.0t1;EHR VO UTILITIES;**167**;JAN 7, 2005"
^XTV(8991,26,1,2,1,3,0)=" ;"
^XTV(8991,26,1,2,1,4,0)="FNAME(DFN) ;Patient First name"
^XTV(8991,26,1,2,1,5,0)=" N FULNAME,FIRSTN"
^XTV(8991,26,1,2,1,6,0)=" S FULNAME=$$NAME^TIULO(DFN)"
^XTV(8991,26,1,2,1,7,0)=" S FIRSTN=$P($P(FULNAME,"","",2),"" "",1)"
^XTV(8991,26,1,2,1,8,0)=" I FIRSTN="""" S FIRSTN=""UNKNOWN"""
^XTV(8991,26,1,2,1,9,0)=" Q FIRSTN"
^XTV(8991,26,1,2,1,10,0)=" ;"
^XTV(8991,26,1,2,1,11,0)="BMI(DFN) ;Patient body mass index"
^XTV(8991,26,1,2,1,12,0)=" N PTWT,PTHT,BMI"
^XTV(8991,26,1,2,1,13,0)=" S PTWT=$$WEIGHT^TIULO(DFN)"
^XTV(8991,26,1,2,1,14,0)=" S PTHT=$$HEIGHT^TIULO(DFN)"
^XTV(8991,26,1,2,1,15,0)=" I PTWT,PTHT D"
^XTV(8991,26,1,2,1,16,0)=" .S BMI=703*(PTWT/(PTHT**2))+.5\1"
^XTV(8991,26,1,2,1,17,0)=" E  S BMI=""UNK"""
^XTV(8991,26,1,2,1,18,0)=" Q BMI"
^XTV(8991,26,1,2,1,19,0)=" ;"
^XTV(8991,26,1,2,1,20,0)="PATID(DFN) ;Patient id (either SSN or HRN)"
^XTV(8991,26,1,2,1,21,0)=" ;At this stage it returns SSN if it exits.  Will probably need to"
^XTV(8991,26,1,2,1,22,0)=" ;be modified to return HRN even if SSN exists."
^XTV(8991,26,1,2,1,23,0)=" N PATID"
^XTV(8991,26,1,2,1,24,0)=" S PATID=$$SSN^TIULO(DFN)"
^XTV(8991,26,1,2,1,25,0)=" I PATID[""SSN"" D"
^XTV(8991,26,1,2,1,26,0)=" .S PATID=$$HRN^AUPNPAT3(DFN,DUZ(2))"
^XTV(8991,26,1,2,1,27,0)=" .I PATID,$L(PATID)<7 S PATID=""HRN-""_PATID Q"
^XTV(8991,26,1,2,1,28,0)=" .S PATID=""UNKNOWN"""
^XTV(8991,26,1,2,1,29,0)=" Q PATID"
^XTV(8991,26,1,"B",3061010.1522,1)=""
^XTV(8991,26,1,"B",3061010.1626,2)=""
^XTV(8991,27,0)="PX1P167"
^XTV(8991,27,1,0)="^8991.01^1^1"
^XTV(8991,27,1,1,0)="3061010.1558"
^XTV(8991,27,1,1,1,0)="^8991.11^4^4"
^XTV(8991,27,1,1,1,1,0)="PX1P167 ; WV/CJS - PX*1*167 POST-INSTALL ;10/10/06  15:58"
^XTV(8991,27,1,1,1,2,0)=" ;;1.0;PCE PATIENT CARE ENCOUNTER;**167**;Aug 12, 1996"
^XTV(8991,27,1,1,1,3,0)=" S ^DD(9000010,0,""SCR"")=""I '$P(^(0),U,11),($P(^(0),U,9)!($D(APCDOVRR)!$D(VSIT)!($G(DUZ(""""AG""""))?1""""V""""0.1""""A"""")!(""""IE""""[$G(DUZ(""""AG"""")))))"""
^XTV(8991,27,1,1,1,4,0)=" Q"
^XTV(8991,27,1,"B",3061010.1558,1)=""
^XTV(8991,28,0)="DGLBPID"
^XTV(8991,28,1,0)="^8991.01^3^3"
^XTV(8991,28,1,1,0)="3061010.1625"
^XTV(8991,28,1,1,1,0)="^8991.11^47^47"
^XTV(8991,28,1,1,1,1,0)=""
^XTV(8991,28,1,1,1,1,"DEL")="DGLBPID ;DJW,TOAD; Health Record Number Identifier ;10/10/06  16:25"
^XTV(8991,28,1,1,1,2,"INS",0)="^8991.12^1^1"
^XTV(8991,28,1,1,1,2,"INS",1,0)="DGLBPID ;DJW,TOAD; Health Record Number Identifier ;10/18/06  21:06"
^XTV(8991,28,1,1,1,20,0)=""
^XTV(8991,28,1,1,1,20,"DEL")=" . S IHSID(""L"")=$J(IHSID,12) ; if we want to zero pad then $TR($J(IHSID(""L""),12),"" "",0)"
^XTV(8991,28,1,1,1,21,"INS",0)="^8991.12^1^1"
^XTV(8991,28,1,1,1,21,"INS",1,0)=" . S IHSID(""L"")=IHSID ; $J(IHSID,12) ; if we want to zero pad then $TR($J(IHSID(""L""),12),"" "",0)"
^XTV(8991,28,1,2,0)="3061018.2106"
^XTV(8991,28,1,2,1,0)="^8991.11^47^47"
^XTV(8991,28,1,2,1,1,0)=""
^XTV(8991,28,1,2,1,1,"DEL")="DGLBPID ;DJW,TOAD; Health Record Number Identifier ;10/18/06  21:06"
^XTV(8991,28,1,2,1,2,0)=""
^XTV(8991,28,1,2,1,2,"DEL")=" ;;5.3;Registration;**634**;Aug 13, 1993"
^XTV(8991,28,1,2,1,3,0)=""
^XTV(8991,28,1,2,1,3,"DEL")="LONGID ;"
^XTV(8991,28,1,2,1,4,"INS",0)="^8991.12^48^48"
^XTV(8991,28,1,2,1,4,"INS",1,0)="DGLBPID ;DJW,TOAD; Health Record Number Identifier ;12/26/06  11:01"
^XTV(8991,28,1,2,1,4,"INS",2,0)=" ;;5.3;Registration;**634**;Aug 13, 1993;Build 18"
^XTV(8991,28,1,2,1,4,"INS",3,0)=" Q"
^XTV(8991,28,1,2,1,4,"INS",4,0)=" ;"
^XTV(8991,28,1,2,1,4,"INS",5,0)=" ;"
^XTV(8991,28,1,2,1,4,"INS",6,0)="ID(DFN) ;GFT/VW  IA 10035"
^XTV(8991,28,1,2,1,4,"INS",7,0)=" N ID S ID=$P($G(^DPT(DFN,.36)),U,3) ;PRIMARY LONG ID"
^XTV(8991,28,1,2,1,4,"INS",8,0)=" I ID="""" S ID=$$HRN(DFN)"
^XTV(8991,28,1,2,1,4,"INS",9,0)=" I ID="""" S ID=$P($G(^DPT(DFN,0)),U,9) I ID]"""" S ID=$E(ID,1,3)_""-""_$E(ID,4,5)_""-""_$E(ID,6,99)"
^XTV(8991,28,1,2,1,4,"INS",10,0)=" I ID="""" D"
^XTV(8991,28,1,2,1,4,"INS",11,0)=" .N I F I=0:0 S I=$O(^AUPNPAT(DFN,41,I)) Q:'I  I $P($G(^(I,0)),U,5)="""" S ID=$P($G(^(0)),U,2) I ID]"""" S ID=ID_"" (""_$P($G(^DIC(4,I,0)),U,5)_"")"" Q"
^XTV(8991,28,1,2,1,4,"INS",12,0)=" I ID="""" S ID=""`""_DFN"
^XTV(8991,28,1,2,1,4,"INS",13,0)=" Q ID"
^XTV(8991,28,1,2,1,4,"INS",14,0)=" ;"
^XTV(8991,28,1,2,1,4,"INS",15,0)=" ;"
^XTV(8991,28,1,2,1,4,"INS",16,0)=" ;"
^XTV(8991,28,1,2,1,4,"INS",17,0)=" ;"
^XTV(8991,28,1,2,1,4,"INS",18,0)="HRN(DFN) ;LOOKUP HEALTH RECORD NUMBER"
^XTV(8991,28,1,2,1,4,"INS",19,0)=" I '$G(DUZ(2)) Q """""
^XTV(8991,28,1,2,1,4,"INS",20,0)=" Q $P($G(^AUPNPAT(DFN,41,DUZ(2),0)),U,2)"
^XTV(8991,28,1,2,1,4,"INS",21,0)=" ;"
^XTV(8991,28,1,2,1,4,"INS",22,0)=" ;"
^XTV(8991,28,1,2,1,4,"INS",23,0)="GOTIDQ(DFN) ;Do we have the needed number for this guy?"
^XTV(8991,28,1,2,1,4,"INS",24,0)=" N T S T=$$REQID(DFN)"
^XTV(8991,28,1,2,1,4,"INS",25,0)=" I T=""SSN"" Q $P(^DPT(DFN,0),U,9)]"""""
^XTV(8991,28,1,2,1,4,"INS",26,0)=" I T=""HRN"" Q:'$G(DUZ(2)) 0 Q $P($G(^AUPNPAT(DFN,41,DUZ(2),0)),U,2)]"""""
^XTV(8991,28,1,2,1,4,"INS",27,0)=" Q 1"
^XTV(8991,28,1,2,1,4,"INS",28,0)=" ;"
^XTV(8991,28,1,2,1,4,"INS",29,0)=" ;"
^XTV(8991,28,1,2,1,4,"INS",30,0)="REQID(DFN) ;WHICH IDENTIFICATION FORMAT IS REQUIRED?"
^XTV(8991,28,1,2,1,4,"INS",31,0)=" N TYPE S TYPE="""""
^XTV(8991,28,1,2,1,4,"INS",32,0)=" D:$G(DFN)"
^XTV(8991,28,1,2,1,4,"INS",33,0)=" .S TYPE=+$G(^DPT(DFN,.361)) I TYPE S TYPE=$P($G(^DIC(8,TYPE,0)),U,9) ;try PRIMARY ELIGIBILITY CODE"
^XTV(8991,28,1,2,1,4,"INS",34,0)=" .I TYPE="""" S TYPE=+$G(^DPT(DFN,""TYPE"")) I TYPE S TYPE=+$G(^DG(391,TYPE,8.2)) ;try patient TYPE"
^XTV(8991,28,1,2,1,4,"INS",35,0)=" I 'TYPE S TYPE=$G(DUZ(""AG"")),TYPE=$S(TYPE=""V"":1,1:2) ;or just assume it's HRN if not VA"
^XTV(8991,28,1,2,1,4,"INS",36,0)=" Q $P(""SSN^HRN"",U,TYPE)"
^XTV(8991,28,1,2,1,4,"INS",37,0)=" ;"
^XTV(8991,28,1,2,1,4,"INS",38,0)=" ;"
^XTV(8991,28,1,2,1,4,"INS",39,0)="IDCAP() ;Returns 3 characters: "" ID"" or ""SSN"""
^XTV(8991,28,1,2,1,4,"INS",40,0)=" I $G(DUZ(""AG""))=""E"" Q "" ID"""
^XTV(8991,28,1,2,1,4,"INS",41,0)=" Q ""SSN"""
^XTV(8991,28,1,2,1,4,"INS",42,0)=" ;"
^XTV(8991,28,1,2,1,4,"INS",43,0)=" ;"
^XTV(8991,28,1,2,1,4,"INS",44,0)=" ;"
^XTV(8991,28,1,2,1,4,"INS",45,0)=" ;"
^XTV(8991,28,1,2,1,4,"INS",46,0)=" ;"
^XTV(8991,28,1,2,1,4,"INS",47,0)=" ;"
^XTV(8991,28,1,2,1,4,"INS",48,0)="LONGID ;Called by ^DIC(8.2,2,""LONG"") (assumes DA(1) is DFN!)"
^XTV(8991,28,1,2,1,5,0)=""
^XTV(8991,28,1,2,1,5,"DEL")=" S X=$S($G(IHSID(""L""))'?.1""-"":IHSID(""L""),$G(SSNID(""L""))'?.1""-"":SSNID(""L""),$G(DFNID(""L""))'?.1""-"":DFNID(""L""),1:"""")"
^XTV(8991,28,1,2,1,6,0)=""
^XTV(8991,28,1,2,1,6,"DEL")=" I X="""" W 1/0  ;some LONGID must exist for a patient, else ERROR!"
^XTV(8991,28,1,2,1,7,"INS",0)="^8991.12^2^2"
^XTV(8991,28,1,2,1,7,"INS",1,0)=" S X=$S($G(IHSID(""L""))'?.""-"":IHSID(""L""),$G(SSNID(""L""))'?.""-"":SSNID(""L""),$G(DFNID(""L""))'?.""-"":DFNID(""L""),1:"""")"
^XTV(8991,28,1,2,1,7,"INS",2,0)=" ;I X="""" W 1/0  ;some LONGID must exist for a patient, else ERROR!"
^XTV(8991,28,1,2,1,8,0)=""
^XTV(8991,28,1,2,1,8,"DEL")="SHORTID ;"
^XTV(8991,28,1,2,1,10,"INS",0)="^8991.12^2^2"
^XTV(8991,28,1,2,1,10,"INS",1,0)=" ;"
^XTV(8991,28,1,2,1,10,"INS",2,0)="SHORTID ;Called by ^DIC(8.2,2,""SHORT"") (assumes DA(1) is DFN!)"
^XTV(8991,28,1,2,1,11,0)=""
^XTV(8991,28,1,2,1,11,"DEL")=" S X=$S($G(IHSID(""S""))'?.1""-"":IHSID(""S""),$G(SSNID(""S""))'?.1""-"":SSNID(""S""),$G(DFNID(""S""))'?.1""-"":DFNID(""S""),1:"""")"
^XTV(8991,28,1,2,1,12,0)=""
^XTV(8991,28,1,2,1,12,"DEL")=" I X="""" W 1/0  ;some SHORTID must exist for a patient, else ERROR!"
^XTV(8991,28,1,2,1,13,"INS",0)="^8991.12^2^2"
^XTV(8991,28,1,2,1,13,"INS",1,0)=" S X=$S($G(IHSID(""S""))'?.""-"":IHSID(""S""),$G(SSNID(""S""))'?.""-"":SSNID(""S""),$G(DFNID(""S""))'?.""-"":DFNID(""S""),1:"""")"
^XTV(8991,28,1,2,1,13,"INS",2,0)=" ;I X="""" W 1/0  ;some SHORTID must exist for a patient, else ERROR!"
^XTV(8991,28,1,2,1,14,"INS",0)="^8991.12^2^2"
^XTV(8991,28,1,2,1,14,"INS",1,0)=" ;"
^XTV(8991,28,1,2,1,14,"INS",2,0)=" ;"
^XTV(8991,28,1,2,1,35,0)=""
^XTV(8991,28,1,2,1,35,"DEL")=" S DFNID(""S"")=DFN,DFNID(""L"")=999_""-""_DFN S:$D(INSTITU(""STA#""))#2 DFNID(""L"")=INSTITU(""STA#"")_""-""_DFN"
^XTV(8991,28,1,2,1,36,"INS",0)="^8991.12^1^1"
^XTV(8991,28,1,2,1,36,"INS",1,0)=" S DFNID(""S"")=""`""_DFN,DFNID(""L"")=999_""-`""_DFN S:$D(INSTITU(""STA#""))#2 DFNID(""L"")=INSTITU(""STA#"")_""-`""_DFN"
^XTV(8991,28,1,2,1,46,0)=""
^XTV(8991,28,1,2,1,46,"DEL")=" K DFNID,SSNID ; kill because HRN is ""required"""
^XTV(8991,28,1,2,1,47,"INS",0)="^8991.12^1^1"
^XTV(8991,28,1,2,1,47,"INS",1,0)=" ;K DFNID,SSNID ; kill because HRN is ""required"""
^XTV(8991,28,1,2,1,48,"INS",0)="^8991.12^5^5"
^XTV(8991,28,1,2,1,48,"INS",1,0)=" ;"
^XTV(8991,28,1,2,1,48,"INS",2,0)="ENALL ;RE-INDEX PHONE NUMBER (KIDS POST-INSTALL DG*5.3*634)"
^XTV(8991,28,1,2,1,48,"INS",3,0)=" K ^DPT(""AZVWVOE"")"
^XTV(8991,28,1,2,1,48,"INS",4,0)=" N DIK S DIK=""^DPT("",DIK(1)="".131^251000"" D ENALL^DIK"
^XTV(8991,28,1,2,1,48,"INS",5,0)=" Q"
^XTV(8991,28,1,3,0)="3061226.1101"
^XTV(8991,28,1,3,1,0)="^8991.11^100^100"
^XTV(8991,28,1,3,1,1,0)="DGLBPID ;DJW,TOAD; Health Record Number Identifier ;12/26/06  11:01"
^XTV(8991,28,1,3,1,2,0)=" ;;5.3;Registration;**634**;Aug 13, 1993;Build 18"
^XTV(8991,28,1,3,1,3,0)=" Q"
^XTV(8991,28,1,3,1,4,0)=" ;"
^XTV(8991,28,1,3,1,5,0)=" ;"
^XTV(8991,28,1,3,1,6,0)="ID(DFN) ;GFT/VW  IA 10035"
^XTV(8991,28,1,3,1,7,0)=" N ID S ID=$P($G(^DPT(DFN,.36)),U,3) ;PRIMARY LONG ID"
^XTV(8991,28,1,3,1,8,0)=" I ID="""" S ID=$$HRN(DFN)"
^XTV(8991,28,1,3,1,9,0)=" I ID="""" S ID=$P($G(^DPT(DFN,0)),U,9) I ID]"""" S ID=$E(ID,1,3)_""-""_$E(ID,4,5)_""-""_$E(ID,6,99)"
^XTV(8991,28,1,3,1,10,0)=" I ID="""" D"
^XTV(8991,28,1,3,1,11,0)=" .N I F I=0:0 S I=$O(^AUPNPAT(DFN,41,I)) Q:'I  I $P($G(^(I,0)),U,5)="""" S ID=$P($G(^(0)),U,2) I ID]"""" S ID=ID_"" (""_$P($G(^DIC(4,I,0)),U,5)_"")"" Q"
^XTV(8991,28,1,3,1,12,0)=" I ID="""" S ID=""`""_DFN"
^XTV(8991,28,1,3,1,13,0)=" Q ID"
^XTV(8991,28,1,3,1,14,0)=" ;"
^XTV(8991,28,1,3,1,15,0)=" ;"
^XTV(8991,28,1,3,1,16,0)=" ;"
^XTV(8991,28,1,3,1,17,0)=" ;"
^XTV(8991,28,1,3,1,18,0)="HRN(DFN) ;LOOKUP HEALTH RECORD NUMBER"
^XTV(8991,28,1,3,1,19,0)=" I '$G(DUZ(2)) Q """""
^XTV(8991,28,1,3,1,20,0)=" Q $P($G(^AUPNPAT(DFN,41,DUZ(2),0)),U,2)"
^XTV(8991,28,1,3,1,21,0)=" ;"
^XTV(8991,28,1,3,1,22,0)=" ;"
^XTV(8991,28,1,3,1,23,0)="GOTIDQ(DFN) ;Do we have the needed number for this guy?"
^XTV(8991,28,1,3,1,24,0)=" N T S T=$$REQID(DFN)"
^XTV(8991,28,1,3,1,25,0)=" I T=""SSN"" Q $P(^DPT(DFN,0),U,9)]"""""
^XTV(8991,28,1,3,1,26,0)=" I T=""HRN"" Q:'$G(DUZ(2)) 0 Q $P($G(^AUPNPAT(DFN,41,DUZ(2),0)),U,2)]"""""
^XTV(8991,28,1,3,1,27,0)=" Q 1"
^XTV(8991,28,1,3,1,28,0)=" ;"
^XTV(8991,28,1,3,1,29,0)=" ;"
^XTV(8991,28,1,3,1,30,0)="REQID(DFN) ;WHICH IDENTIFICATION FORMAT IS REQUIRED?"
^XTV(8991,28,1,3,1,31,0)=" N TYPE S TYPE="""""
^XTV(8991,28,1,3,1,32,0)=" D:$G(DFN)"
^XTV(8991,28,1,3,1,33,0)=" .S TYPE=+$G(^DPT(DFN,.361)) I TYPE S TYPE=$P($G(^DIC(8,TYPE,0)),U,9) ;try PRIMARY ELIGIBILITY CODE"
^XTV(8991,28,1,3,1,34,0)=" .I TYPE="""" S TYPE=+$G(^DPT(DFN,""TYPE"")) I TYPE S TYPE=+$G(^DG(391,TYPE,8.2)) ;try patient TYPE"
^XTV(8991,28,1,3,1,35,0)=" I 'TYPE S TYPE=$G(DUZ(""AG"")),TYPE=$S(TYPE=""V"":1,1:2) ;or just assume it's HRN if not VA"
^XTV(8991,28,1,3,1,36,0)=" Q $P(""SSN^HRN"",U,TYPE)"
^XTV(8991,28,1,3,1,37,0)=" ;"
^XTV(8991,28,1,3,1,38,0)=" ;"
^XTV(8991,28,1,3,1,39,0)="IDCAP() ;Returns 3 characters: "" ID"" or ""SSN"""
^XTV(8991,28,1,3,1,40,0)=" I $G(DUZ(""AG""))=""E"" Q "" ID"""
^XTV(8991,28,1,3,1,41,0)=" Q ""SSN"""
^XTV(8991,28,1,3,1,42,0)=" ;"
^XTV(8991,28,1,3,1,43,0)=" ;"
^XTV(8991,28,1,3,1,44,0)=" ;"
^XTV(8991,28,1,3,1,45,0)=" ;"
^XTV(8991,28,1,3,1,46,0)=" ;"
^XTV(8991,28,1,3,1,47,0)=" ;"
^XTV(8991,28,1,3,1,48,0)="LONGID ;Called by ^DIC(8.2,2,""LONG"") (assumes DA(1) is DFN!)"
^XTV(8991,28,1,3,1,49,0)=" N INSTITU,DFN,DFNID,SSNID,IHSID D GETALL"
^XTV(8991,28,1,3,1,50,0)=" S X=$S($G(IHSID(""L""))'?.""-"":IHSID(""L""),$G(SSNID(""L""))'?.""-"":SSNID(""L""),$G(DFNID(""L""))'?.""-"":DFNID(""L""),1:"""")"
^XTV(8991,28,1,3,1,51,0)=" ;I X="""" W 1/0  ;some LONGID must exist for a patient, else ERROR!"
^XTV(8991,28,1,3,1,52,0)=" Q"
^XTV(8991,28,1,3,1,53,0)=" ;"
^XTV(8991,28,1,3,1,54,0)=" ;"
^XTV(8991,28,1,3,1,55,0)="SHORTID ;Called by ^DIC(8.2,2,""SHORT"") (assumes DA(1) is DFN!)"
^XTV(8991,28,1,3,1,56,0)=" N INSTITU,DFN,DFNID,SSNID,IHSID D GETALL"
^XTV(8991,28,1,3,1,57,0)=" S X=$S($G(IHSID(""S""))'?.""-"":IHSID(""S""),$G(SSNID(""S""))'?.""-"":SSNID(""S""),$G(DFNID(""S""))'?.""-"":DFNID(""S""),1:"""")"
^XTV(8991,28,1,3,1,58,0)=" ;I X="""" W 1/0  ;some SHORTID must exist for a patient, else ERROR!"
^XTV(8991,28,1,3,1,59,0)=" Q"
^XTV(8991,28,1,3,1,60,0)=" ;"
^XTV(8991,28,1,3,1,61,0)=" ;"
^XTV(8991,28,1,3,1,62,0)="IHSID ;"
^XTV(8991,28,1,3,1,63,0)=" ;given INSTITU (current institution #)"
^XTV(8991,28,1,3,1,64,0)=" ;get HEALTH RECORD NUMBER (Multiple 4101, 9000001.41) associated"
^XTV(8991,28,1,3,1,65,0)=" ;with the institution"
^XTV(8991,28,1,3,1,66,0)=" S IHSID=$P($G(^AUPNPAT(DFN,41,+INSTITU,0)),""^"",2)"
^XTV(8991,28,1,3,1,67,0)=" I IHSID'="""" D"
^XTV(8991,28,1,3,1,68,0)=" . S IHSID(""L"")=IHSID ; $J(IHSID,12) ; if we want to zero pad then $TR($J(IHSID(""L""),12),"" "",0)"
^XTV(8991,28,1,3,1,69,0)=" . S IHSID(""S"")=$TR(IHSID(""L""),$TR(IHSID(""L""),9876543210))"
^XTV(8991,28,1,3,1,70,0)=" . S IHSID(""S"")=$TR($J(IHSID(""S""),4),"" "",0)"
^XTV(8991,28,1,3,1,71,0)=" . S IHSID(""S"")=$E(IHSID(""S""),$L(IHSID(""S""))-3,$L(IHSID(""S"")))"
^XTV(8991,28,1,3,1,72,0)=" ;now return Health Record Number"
^XTV(8991,28,1,3,1,73,0)=" Q"
^XTV(8991,28,1,3,1,74,0)="DFNID S DFN=DA(1) ; IEN in patient file, with default institution from"
^XTV(8991,28,1,3,1,75,0)=" ;kernel system parameters file as prefix."
^XTV(8991,28,1,3,1,76,0)=" ;8989.3,217    DEFAULT INSTITUTION of #8989.3 -- KERNEL SYSTEM PARAMETERS FILE"
^XTV(8991,28,1,3,1,77,0)=" S INSTITU=$P($G(^XTV(8989.3,1,""XUS"")),U,17)"
^XTV(8991,28,1,3,1,78,0)=" ;150.9  VISIT TRACKING PARAMETERS :: DEFAULT INSTITUTION:"
^XTV(8991,28,1,3,1,79,0)=" I INSTITU="""",$P($G(^DIC(150.9,1,0)),U,4)'="""" S INSTITU=$P(^(0),U,4)"
^XTV(8991,28,1,3,1,80,0)=" ; if we have a medical record number in IHS PATIENT, for this"
^XTV(8991,28,1,3,1,81,0)=" I INSTITU'="""",$P($G(^DIC(4,+INSTITU,99)),U)'="""" S INSTITU(""STA#"")=$P(^(99),U)"
^XTV(8991,28,1,3,1,82,0)=" ; now put INSTITUtion STATION NUMBER as prefix to DFN as ""DFNID"""
^XTV(8991,28,1,3,1,83,0)=" S DFNID(""S"")=""`""_DFN,DFNID(""L"")=999_""-`""_DFN S:$D(INSTITU(""STA#""))#2 DFNID(""L"")=INSTITU(""STA#"")_""-`""_DFN"
^XTV(8991,28,1,3,1,84,0)=" Q"
^XTV(8991,28,1,3,1,85,0)="SSNID ;"
^XTV(8991,28,1,3,1,86,0)=" ;code scarfed from ^DIC(8.2,1,""LONG"") - retrieving the SSN"
^XTV(8991,28,1,3,1,87,0)=" N X"
^XTV(8991,28,1,3,1,88,0)=" S SSNID(""L"")="""" I $D(DFN),$D(^DPT(DFN,0)) S X=$P(^(0),U,9),SSNID(""L"")=$E(X,1,3)_""-""_$E(X,4,5)_""-""_$E(X,6,10)"
^XTV(8991,28,1,3,1,89,0)=" S SSNID(""S"")=$P(SSNID(""L""),""-"",3)"
^XTV(8991,28,1,3,1,90,0)=" Q"
^XTV(8991,28,1,3,1,91,0)="GETALL ;"
^XTV(8991,28,1,3,1,92,0)=" ;Utility Subroutine to Getall the variables"
^XTV(8991,28,1,3,1,93,0)=" D DFNID,IHSID,SSNID"
^XTV(8991,28,1,3,1,94,0)=" ;K DFNID,SSNID ; kill because HRN is ""required"""
^XTV(8991,28,1,3,1,95,0)=" Q"
^XTV(8991,28,1,3,1,96,0)=" ;"
^XTV(8991,28,1,3,1,97,0)="ENALL ;RE-INDEX PHONE NUMBER (KIDS POST-INSTALL DG*5.3*634)"
^XTV(8991,28,1,3,1,98,0)=" K ^DPT(""AZVWVOE"")"
^XTV(8991,28,1,3,1,99,0)=" N DIK S DIK=""^DPT("",DIK(1)="".131^251000"" D ENALL^DIK"
^XTV(8991,28,1,3,1,100,0)=" Q"
^XTV(8991,28,1,"B",3061010.1625,1)=""
^XTV(8991,28,1,"B",3061018.2106,2)=""
^XTV(8991,28,1,"B",3061226.1101,3)=""
^XTV(8991,29,0)="DGRPV"
^XTV(8991,29,1,0)="^8991.01^1^1"
^XTV(8991,29,1,1,0)="3061010.1828"
^XTV(8991,29,1,1,1,0)="^8991.11^122^122"
^XTV(8991,29,1,1,1,1,0)="DGRPV ;ALB/MRL,RTK,PJR,BRM - REGISTRATION DEFINE VARIABLES ON ENTRY ;10/10/06  18:28"
^XTV(8991,29,1,1,1,2,0)=" ;;5.3;Registration;**109,114,247,190,327,365,343,397,415,489,546,545,451,624,677,672,634**;Aug 13, 1993"
^XTV(8991,29,1,1,1,3,0)=" ;"
^XTV(8991,29,1,1,1,4,0)=" ;"
^XTV(8991,29,1,1,1,5,0)=" ;set up variables for registration screen processing"
^XTV(8991,29,1,1,1,6,0)=" ;"
^XTV(8991,29,1,1,1,7,0)=" ;DGRPVV   :string of 15 ones and zeros each character corresponding to"
^XTV(8991,29,1,1,1,8,0)=" ;          a particular screen (0 means allow edit, 1 means don't)"
^XTV(8991,29,1,1,1,9,0)=" ;"
^XTV(8991,29,1,1,1,10,0)=" ;DGRPVV(n):where n=screen number.  String of x ones and zeros where"
^XTV(8991,29,1,1,1,11,0)=" ;          x is the number of elements on screen n (0=edit, 1=don't)"
^XTV(8991,29,1,1,1,12,0)=" ;"
^XTV(8991,29,1,1,1,13,0)=" ;DGVI     :Turn on high intensity"
^XTV(8991,29,1,1,1,14,0)=" ;DGVO     :Turn off high intensity"
^XTV(8991,29,1,1,1,15,0)=" ;"
^XTV(8991,29,1,1,1,16,0)="EN D DT^DICRW I '$D(DVBGUI) D HOME^%ZIS"
^XTV(8991,29,1,1,1,17,0)=" S (DGVI,DGVO)="""""""""""" I $S('$D(IOST(0)):1,'$D(^DG(43,1,0)):1,'$P(^DG(43,1,0),""^"",36):1,$D(^DG(43,1,""TERM"",IOST(0))):1,1:0) G M ;goto M if not high intensity"
^XTV(8991,29,1,1,1,18,0)=" I $D(^%ZIS(2,IOST(0),7)) S I=^(7),X=$S($P(I,""^"",3)]"""":3,1:2) I $L($P(I,""^"",1)),$L($P(I,""^"",X)) S DGVI=$P(I,""^"",1),DGVO=$P(I,""^"",X)"
^XTV(8991,29,1,1,1,19,0)="M I $L(DGVI_DGVO)>4 S X=132 X ^%ZOSF(""RM"")"
^XTV(8991,29,1,1,1,20,0)=" S DGRPW=1,DGRPCM=0,DGRPU=""UNANSWERED"",DGRPNA=""NOT APPLICABLE"",DGRPV=$S($D(DGRPV):DGRPV,1:1)"
^XTV(8991,29,1,1,1,21,0)="SC7 S X=$S('$D(^DPT(DFN,""TYPE"")):0,1:+^(""TYPE"")) S:'$D(DGELVER) DGELVER=0"
^XTV(8991,29,1,1,1,22,0)=" S DGRPTYPE=$S($D(^DG(391,+X,0)):^(0),1:""""),(DGRPSC,DGRPSCE,DGRPSCE1)="""" S:'$D(DGELVER) DGELVER=0"
^XTV(8991,29,1,1,1,23,0)=" I DGRPTYPE'="""" S DGRPSC=$G(^DG(391,+X,""S"")),DGRPSCE=$G(^(""E"")),DGRPSCE1=$G(^(""E10""))"
^XTV(8991,29,1,1,1,24,0)=" ;"
^XTV(8991,29,1,1,1,25,0)=" S DGPH=$P($G(^DPT(DFN,.53)),U)  ;Purple Heart Indicator"
^XTV(8991,29,1,1,1,26,0)=" I $G(DGPRFLG)=1 D"
^XTV(8991,29,1,1,1,27,0)=" . S DGRPVV=""000001111111111"""
^XTV(8991,29,1,1,1,28,0)=" E  D"
^XTV(8991,29,1,1,1,29,0)=" . S DGRPVV=""000000000000000"""
^XTV(8991,29,1,1,1,30,0)=" S X=""5^3^5^2^3^17^4^2^10^2^4^5^5^2^1"""
^XTV(8991,29,1,1,1,31,0)=" ;"
^XTV(8991,29,1,1,1,32,0)=" ; ** VOE change 1 of 4: DAOU/WCJ 2/7/2005,VA/CJS,WV/TOAD 5/9/2006 **"
^XTV(8991,29,1,1,1,33,0)=" ;"
^XTV(8991,29,1,1,1,34,0)=" ; new line: if agency code is not VA, new section added to screen 3"
^XTV(8991,29,1,1,1,35,0)=" I $G(DUZ(""AG""))'=""V"" S $P(X,""^"",3)=""6"""
^XTV(8991,29,1,1,1,36,0)=" ;"
^XTV(8991,29,1,1,1,37,0)=" ; ** end of VOE change 1 **"
^XTV(8991,29,1,1,1,38,0)=" ;"
^XTV(8991,29,1,1,1,39,0)=" F I=1:1:15 S J=+$P(X,""^"",I),DGRPVV(I)=$S((I<12)!(I=15):$E(""00000000000000000"",1,J),1:$E(""11111111111111111"",1,J))"
^XTV(8991,29,1,1,1,40,0)=" S DGRPVV(1.1)=""00"""
^XTV(8991,29,1,1,1,41,0)=" S DGRPVV(2)=""00010"""
^XTV(8991,29,1,1,1,42,0)=" I $G(DGPH)]"""" S $E(DGRPVV(6),16)=1"
^XTV(8991,29,1,1,1,43,0)=" I $$GETSTAT^DGNTAPI1(DFN)>2,'$D(^XUSEC(""DGNT VERIFY"",DUZ)) D"
^XTV(8991,29,1,1,1,44,0)=" . S $E(DGRPVV(6),17)=1"
^XTV(8991,29,1,1,1,45,0)=" ;"
^XTV(8991,29,1,1,1,46,0)=" F I=3,6,8,9,10,11 S J=+$P(DGRPSC,""^"",I) I 'J S DGRPVV=$E(DGRPVV,0,I-1)_1_$E(DGRPVV,I+1,99)"
^XTV(8991,29,1,1,1,47,0)=" ;"
^XTV(8991,29,1,1,1,48,0)=" ;-- if patient type is TRICARE then turn off screens 2,4"
^XTV(8991,29,1,1,1,49,0)=" ;"
^XTV(8991,29,1,1,1,50,0)=" ;-- modified 08/20/2003 for NOIS Calls MAC-0400-61574 & AMA-0700-71769"
^XTV(8991,29,1,1,1,51,0)=" ;-- commented the line to allow screens 2 & 4 to display for Tricare"
^XTV(8991,29,1,1,1,52,0)=" ;I DGRPTYPE[""TRICARE"" F I=2,4 S J=+$P(DGRPSC,""^"",I) I 'J S DGRPVV=$E(DGRPVV,0,I-1)_1_$E(DGRPVV,I+1,99)"
^XTV(8991,29,1,1,1,53,0)=" ;"
^XTV(8991,29,1,1,1,54,0)=" ; ** VOE change 2 of 4: DAOU/WCJ 2/7/2005,VA/CJS,WV/TOAD 5/9/2006 **"
^XTV(8991,29,1,1,1,55,0)=" ;"
^XTV(8991,29,1,1,1,56,0)=" ; add lines: if agency code is not VA, change last screen to 14,"
^XTV(8991,29,1,1,1,57,0)=" ; and clear flag for screen 15 (it is VA-specific)"
^XTV(8991,29,1,1,1,58,0)=" I $G(DUZ(""AG""))'=""V"" D"
^XTV(8991,29,1,1,1,59,0)=" . S DGRPLAST=14"
^XTV(8991,29,1,1,1,60,0)=" . F I=15 S DGRPVV=$E(DGRPVV,0,I-1)_$S(I=15:"""",1:1)_$E(DGRPVV,I+1,99)"
^XTV(8991,29,1,1,1,61,0)=" ;"
^XTV(8991,29,1,1,1,62,0)=" ; ** end of VOE change 2 **"
^XTV(8991,29,1,1,1,63,0)=" ;"
^XTV(8991,29,1,1,1,64,0)=" F I=31:0 S I=$O(^DD(391,I)) Q:I=""""!(I>99)  I $D(^(I,0)),($E(^(0),1)'=""*""),'+$P(DGRPSCE,""^"",I) S X1=$E(I),X2=$E(I,2) I +X1 S DGRPVV(X1)=$E(DGRPVV(X1),0,X2-1)_1_$E(DGRPVV(X1),X2+1,99)"
^XTV(8991,29,1,1,1,65,0)=" I $G(^DPT(DFN,.35)),(^(.35)<+($E(DT,1,3)_""0000"")) S DGRPVV=$E(DGRPVV,0,7)_11_$E(DGRPVV,10,99)"
^XTV(8991,29,1,1,1,66,0)=" K DIRUT,DUOUT,DTOUT"
^XTV(8991,29,1,1,1,67,0)=" ;"
^XTV(8991,29,1,1,1,68,0)=" ;Fields are numbered screen_item and put in that piece position."
^XTV(8991,29,1,1,1,69,0)=" ;Because FM does not allow more than 100 pieces on a node, it was"
^XTV(8991,29,1,1,1,70,0)=" ;necessary to start a new node E10 for fields on screens 10 or higher."
^XTV(8991,29,1,1,1,71,0)=" ;In these instances, the piece position will be screen_item-100 so,"
^XTV(8991,29,1,1,1,72,0)=" ;for example, screen 11, item 2 would be field 112, but piece 12."
^XTV(8991,29,1,1,1,73,0)=" ;Items on screens <10 will be found on node E."
^XTV(8991,29,1,1,1,74,0)=" ;"
^XTV(8991,29,1,1,1,75,0)=" F I=100:0 S I=$O(^DD(391,I)) Q:I=""""!(I>150)  I $D(^(I,0)),($E(^(0),1)'=""*""),'+$P(DGRPSCE1,""^"",I-100) S X1=$E(I,1,2),X2=$E(I,3) I +X1 S DGRPVV(X1)=$E(DGRPVV(X1),0,X2-1)_1_$E(DGRPVV(X1),X2+1,99)"
^XTV(8991,29,1,1,1,76,0)=" ;"
^XTV(8991,29,1,1,1,77,0)=" I $S('($D(DUZ)#2):0,'$D(^XUSEC(""DG ELIGIBILITY"",DUZ)):0,1:1) G ELVER ;if user holds eligibility key, skip"
^XTV(8991,29,1,1,1,78,0)=" F I=.3,.32,.361 S DGRP(I)=$S($D(^DPT(DFN,I)):^(I),1:"""")"
^XTV(8991,29,1,1,1,79,0)=" S DGRPVV(10)=11 I $P(DGRP(.361),""^"",1)=""V"" S DGRPVV(7)=111,DGRPVV(1)=1_$E(DGRPVV(1),2,99) ;if elig verified, can't edit elig data, name, ssn, or dob"
^XTV(8991,29,1,1,1,80,0)=" ;"
^XTV(8991,29,1,1,1,81,0)=" ; ** VOE change 3 of 4: DAOU/WCJ 2/7/2005,VA/CJS,WV/TOAD 5/9/2006 **"
^XTV(8991,29,1,1,1,82,0)=" ;"
^XTV(8991,29,1,1,1,83,0)=" ; add line: if agency code is not VA, only edit one section of screen 7"
^XTV(8991,29,1,1,1,84,0)=" ; The rest is veteran specific."
^XTV(8991,29,1,1,1,85,0)=" I $G(DUZ(""AG""))'=""V"" S DGRPVV(7)=""1101"""
^XTV(8991,29,1,1,1,86,0)=" ;"
^XTV(8991,29,1,1,1,87,0)=" ; ** end of VOE change 3 **"
^XTV(8991,29,1,1,1,88,0)=" ;"
^XTV(8991,29,1,1,1,89,0)=" I $P(DGRP(.3),""^"",6)]"""" S DGRPVV(8)=11 ;if monetary ben. verified, can't edit income screening data"
^XTV(8991,29,1,1,1,90,0)=" I $P(DGRP(.32),""^"",2)]"""" S DGRPVV(6)=11111111111111111 ;if service data verified, can't edit service screen"
^XTV(8991,29,1,1,1,91,0)=" ;"
^XTV(8991,29,1,1,1,92,0)="ELVER ;set up variables for eligibility verification"
^XTV(8991,29,1,1,1,93,0)=" ;if elig ver option, only edit screens 1, 2, and 7 (and 6, 8, 9, 10,"
^XTV(8991,29,1,1,1,94,0)=" ;   and 11 if they're turned on)."
^XTV(8991,29,1,1,1,95,0)=" ;"
^XTV(8991,29,1,1,1,96,0)=" S DGRP(.361)=$G(^DPT(DFN,.361))"
^XTV(8991,29,1,1,1,97,0)=" I $P(DGRP(.361),U,3)=""H"" S DGRPVV(10)=10,DGRPVV(11)=1000"
^XTV(8991,29,1,1,1,98,0)=" I $P($G(DGRP(.361)),U)=""V"",($P(DGRP(.361),U,3)=""H"") S DGRPVV(6)=$E(DGRPVV(6),1,12)_1_$E(DGRPVV(6),14,99)"
^XTV(8991,29,1,1,1,99,0)=" S:'DGELVER DGRPLAST=$S($G(DGPRFLG)=1:5,1:15)"
^XTV(8991,29,1,1,1,100,0)=" ;"
^XTV(8991,29,1,1,1,101,0)=" ; ** VOE change 4 of 4: DAOU/WCJ 2/7/2005,VA/CJS,WV/TOAD 5/9/2006 **"
^XTV(8991,29,1,1,1,102,0)=" ;"
^XTV(8991,29,1,1,1,103,0)=" ; add line: if agency code is not VA, and last screen is set to 15, set"
^XTV(8991,29,1,1,1,104,0)=" ; it to 14 (it is VA-specific)"
^XTV(8991,29,1,1,1,105,0)=" I $G(DUZ(""AG""))'=""V"",DGRPLAST=15 S DGRPLAST=14"
^XTV(8991,29,1,1,1,106,0)=" ;"
^XTV(8991,29,1,1,1,107,0)=" ; ** end of VOE change 4 **"
^XTV(8991,29,1,1,1,108,0)=" ;"
^XTV(8991,29,1,1,1,109,0)=" I DGELVER S DGRPVV=""00111""_$E(DGRPVV,6,11)_""1111"" F I=1:1:11 S J=$E(DGRPVV,I) I 'J S DGRPLAST=I"
^XTV(8991,29,1,1,1,110,0)="Q K DGRPSC,DGRPSCE"
^XTV(8991,29,1,1,1,111,0)=" Q"
^XTV(8991,29,1,1,1,112,0)=" ;"
^XTV(8991,29,1,1,1,113,0)="WW ;Write number on screens for display and/or edit (Z=number)"
^XTV(8991,29,1,1,1,114,0)=" W:DGRPW ! S Z=$S(DGRPCM:Z,DGRPV:""<""_Z_"">"",$E(DGRPVV(DGRPS),Z):""<""_Z_"">"",1:""[""_Z_""]"")"
^XTV(8991,29,1,1,1,115,0)=" I DGRPCM!($E(Z)=""["") W @DGVI,Z,@DGVO"
^XTV(8991,29,1,1,1,116,0)=" I 'DGRPCM&($E(Z)'=""["") W Z"
^XTV(8991,29,1,1,1,117,0)=" Q"
^XTV(8991,29,1,1,1,118,0)=" ;"
^XTV(8991,29,1,1,1,119,0)="WW1 ;spacing for screen display (Z=item to print)"
^XTV(8991,29,1,1,1,120,0)=" F Z2=1:1:(Z1-$L(Z)) S Z=Z_"" """
^XTV(8991,29,1,1,1,121,0)=" W Z K Z2"
^XTV(8991,29,1,1,1,122,0)=" Q"
^XTV(8991,29,1,"B",3061010.1828,1)=""
^XTV(8991,30,0)="ZOSVONT"
^XTV(8991,30,1,0)="^8991.01^1^1"
^XTV(8991,30,1,1,0)="3061018.1833"
^XTV(8991,30,1,1,1,0)="^8991.11^152^152"
^XTV(8991,30,1,1,1,1,0)="%ZOSV ;SFISC/AC - $View commands for Open M for NT.  ;10/18/06  18:33"
^XTV(8991,30,1,1,1,2,0)=" ;;8.0;KERNEL;**34,94,107,118,136,215,293,284,385**;Jul 10, 1995;Build 3"
^XTV(8991,30,1,1,1,3,0)="ACTJ() ;# Active jobs"
^XTV(8991,30,1,1,1,4,0)=" N %,V,Y S V=$$VERSION()"
^XTV(8991,30,1,1,1,5,0)=" I V<5 D  Q Y"
^XTV(8991,30,1,1,1,6,0)=" . S %=0 F Y=0:1 S %=$ZJ(%) Q:%="""""
^XTV(8991,30,1,1,1,7,0)=" S Y=$system.License.LUConsumed()"
^XTV(8991,30,1,1,1,8,0)=" Q Y"
^XTV(8991,30,1,1,1,9,0)="AVJ() ;# available jobs"
^XTV(8991,30,1,1,1,10,0)=" N %,AVJ,ZOSV,port,t,x,v,maxpid,lmflim,$ET"
^XTV(8991,30,1,1,1,11,0)=" S v=+$$VERSION()"
^XTV(8991,30,1,1,1,12,0)=" ;Cache 3 and 4"
^XTV(8991,30,1,1,1,13,0)=" ;maxpid: from %SS"
^XTV(8991,30,1,1,1,14,0)=" I v<5 D  Q AVJ"
^XTV(8991,30,1,1,1,15,0)=" . S $ET="""",maxpid=$v($zu(40,2,118),-2,4)"
^XTV(8991,30,1,1,1,16,0)=" . X ""S ZOSV=$ZU(5),%=$ZU(5,""""%SYS"""") S lmflim=$$inquire^LMFCLI,%=$ZU(5,ZOSV)"" ;Get the license info"
^XTV(8991,30,1,1,1,17,0)=" . ;Add together the enterprise and division licenses avaliable"
^XTV(8991,30,1,1,1,18,0)=" . S x=$P(lmflim,"";"",2)+$P($P(lmflim,""|"",2),"";"",2)"
^XTV(8991,30,1,1,1,19,0)=" . S t=+lmflim+$P(lmflim,""|"",2) ;Check the license total"
^XTV(8991,30,1,1,1,20,0)=" . S AVJ=$S(t<maxpid:x,1:maxpid-$$ACTJ) ;Return the smaller of license or pid"
^XTV(8991,30,1,1,1,21,0)=" ;To get available jobs from Cache 5.0"
^XTV(8991,30,1,1,1,22,0)=" I v'<5 D  Q AVJ"
^XTV(8991,30,1,1,1,23,0)=" . X ""S ZOSV=$ZU(5),%=$ZU(5,""""%SYS"""") S AVJ=$system.License.LUAvailable(),%=$ZU(5,ZOSV)"""
^XTV(8991,30,1,1,1,24,0)=" ;Return fixed value not known version"
^XTV(8991,30,1,1,1,25,0)=" Q 15"
^XTV(8991,30,1,1,1,26,0)=" ; "
^XTV(8991,30,1,1,1,27,0)="PRIINQ() ; "
^XTV(8991,30,1,1,1,28,0)=" Q 8"
^XTV(8991,30,1,1,1,29,0)=" ; "
^XTV(8991,30,1,1,1,30,0)="UCI ;Current UCI"
^XTV(8991,30,1,1,1,31,0)=" S Y=$ZU(5)_"",""_^%ZOSF(""VOL"") Q"
^XTV(8991,30,1,1,1,32,0)=" ; "
^XTV(8991,30,1,1,1,33,0)="UCICHECK(X) ;Check if valid UCI"
^XTV(8991,30,1,1,1,34,0)=" N Y,%"
^XTV(8991,30,1,1,1,35,0)=" S %=$P(X,"","",1),Y=0 I $ZU(90,10,%) S Y=%"
^XTV(8991,30,1,1,1,36,0)=" Q Y"
^XTV(8991,30,1,1,1,37,0)=" ; "
^XTV(8991,30,1,1,1,38,0)="GETPEER() ;Get the PEER tcp/ip address"
^XTV(8991,30,1,1,1,39,0)=" N PEER,NL,$ET S NL="""",$ET=""S $EC=NL Q NL"",PEER="""""
^XTV(8991,30,1,1,1,40,0)=" I $$OS=""VMS"" S PEER=$ZF(""TRNLNM"",""VISTA$IP"")"
^XTV(8991,30,1,1,1,41,0)=" I '$L(PEER) S PEER=$ZU(111,0) S:$L(PEER) PEER=$A(PEER,1)_"".""_$A(PEER,2)_"".""_$A(PEER,3)_"".""_$A(PEER,4)"
^XTV(8991,30,1,1,1,42,0)=" Q PEER"
^XTV(8991,30,1,1,1,43,0)=" ; "
^XTV(8991,30,1,1,1,44,0)="SHARELIC(TYPE) ;See if can share a C/S license"
^XTV(8991,30,1,1,1,45,0)=" ;Type is 1 for C/S and 0 for Telnet"
^XTV(8991,30,1,1,1,46,0)=" N %,%N,%2,UID,%V,$ET S $ET=""S $EC="""""""" Q"",%V=$$VERSION()"
^XTV(8991,30,1,1,1,47,0)=" I %V<3.1 X:TYPE ""S %N=$ZU(5),%2=$ZU(5,""""%SYS""""),%2=$$GetLic^LMFCLI,%N=$ZU(5,%N)"" Q"
^XTV(8991,30,1,1,1,48,0)=" I %V<5 S:TYPE %=$$GetCSLic^%LICENSE S:'TYPE %=$$ShareLic^%LICENSE"
^XTV(8991,30,1,1,1,49,0)=" ;Per Sandy Waal 10/18/2003: With Cache' 5.0, your telnet and IP connections are now handled properly."
^XTV(8991,30,1,1,1,50,0)=" I %V'<5 S %V=%V"
^XTV(8991,30,1,1,1,51,0)=" S $EC="""""
^XTV(8991,30,1,1,1,52,0)=" Q "
^XTV(8991,30,1,1,1,53,0)="JOBPAR ;See if X points to a valid Job. Return its UCI."
^XTV(8991,30,1,1,1,54,0)=" N ZJ S Y="""",$ZT=""JOBX"""
^XTV(8991,30,1,1,1,55,0)=" Q:'$D(^$JOB(X))  S Y=$V(-1,X),Y=$P(Y,""^"",14)_"",""_^%ZOSF(""VOL"")"
^XTV(8991,30,1,1,1,56,0)="JOBX Q "
^XTV(8991,30,1,1,1,57,0)=" ; "
^XTV(8991,30,1,1,1,58,0)="NOLOG ; "
^XTV(8991,30,1,1,1,59,0)=" S Y=""$V(0,-2,4)\4096#2"" Q"
^XTV(8991,30,1,1,1,60,0)=" ; "
^XTV(8991,30,1,1,1,61,0)="PROGMODE() ;Check if in PROG mode"
^XTV(8991,30,1,1,1,62,0)=" Q $ZJ#2 "
^XTV(8991,30,1,1,1,63,0)=" ; "
^XTV(8991,30,1,1,1,64,0)="PRGMODE ; "
^XTV(8991,30,1,1,1,65,0)=" W ! S ZTPAC=$S('$D(^VA(200,+DUZ,.1)):"""",1:$P(^(.1),U,5)),XUVOL=^%ZOSF(""VOL"")"
^XTV(8991,30,1,1,1,66,0)=" S X="""" X ^%ZOSF(""EOFF"") R:ZTPAC]"""" !,""PAC: "",X:60 D LC^XUS X ^%ZOSF(""EON"") I X'=ZTPAC W ""??""_$C(7) Q"
^XTV(8991,30,1,1,1,67,0)=" S XMB=""XUPROGMODE"",XMB(1)=DUZ,XMB(2)=$I D ^XMB:$L($T(^XMB)) D BYE^XUSCLEAN K ZTPAC,X,XMB"
^XTV(8991,30,1,1,1,68,0)=" D UCI S XUCI=Y,XQZ=""PRGM^ZUA[MGR]"",XUSLNT=1 D DO^%XUCI D ^%PMODE U $I:(:""+B+C+R"") S $ZT="""" Q"
^XTV(8991,30,1,1,1,69,0)=" Q "
^XTV(8991,30,1,1,1,70,0)="LGR() S $ZT=""LGRX^%ZOSV"""
^XTV(8991,30,1,1,1,71,0)=" Q $ZR ;Last Global ref."
^XTV(8991,30,1,1,1,72,0)="LGRX Q """""
^XTV(8991,30,1,1,1,73,0)=" ; "
^XTV(8991,30,1,1,1,74,0)="EC() Q $ZE ;Error code"
^XTV(8991,30,1,1,1,75,0)=" ; "
^XTV(8991,30,1,1,1,76,0)="DOLRO ;SAVE ENTIRE SYMBOL TABLE IN LOCATION SPECIFIED BY X"
^XTV(8991,30,1,1,1,77,0)=" S Y=""%"" F %=0:0 S Y=$O(@Y) Q:Y=""""  S %=$D(@Y) S:%#2 @(X_""Y)=""_Y) I %>9 S %X=Y_""("",%Y=X_""Y,"" D %XY^%RCR"
^XTV(8991,30,1,1,1,78,0)=" Q "
^XTV(8991,30,1,1,1,79,0)=" ; "
^XTV(8991,30,1,1,1,80,0)="ORDER ;SAVE PART OF SYMBOL TABLE IN LOCATION SPECIFIED BY X"
^XTV(8991,30,1,1,1,81,0)=" S (Y,Y1)=$P(Y,""*"",1) I $D(@Y)=0 F %=0:0 S Y=$O(@Y) Q:Y=""""!(Y[Y1)"
^XTV(8991,30,1,1,1,82,0)=" Q:Y=""""  S %=$D(@Y) S:%#2 @(X_""Y)=""_Y) I %>9 S %X=Y_""("",%Y=X_""Y,"" D %XY^%RCR"
^XTV(8991,30,1,1,1,83,0)=" F %=0:0 S Y=$O(@Y) Q:Y=""""!(Y'[Y1)  S %=$D(@Y) S:%#2 @(X_""Y)=""_Y) I %>9 S %X=Y_""("",%Y=X_""Y,"" D %XY^%RCR"
^XTV(8991,30,1,1,1,84,0)=" K %,X,Y,Y1"
^XTV(8991,30,1,1,1,85,0)=" Q "
^XTV(8991,30,1,1,1,86,0)=" ; "
^XTV(8991,30,1,1,1,87,0)="PARSIZ ; "
^XTV(8991,30,1,1,1,88,0)=" S X=3"
^XTV(8991,30,1,1,1,89,0)=" Q "
^XTV(8991,30,1,1,1,90,0)=" ; "
^XTV(8991,30,1,1,1,91,0)="DEVOPN ;List of Devices opened"
^XTV(8991,30,1,1,1,92,0)=" ;Returns variable Y. Y=Devices owned separated by a comma"
^XTV(8991,30,1,1,1,93,0)=" Q "
^XTV(8991,30,1,1,1,94,0)="DEVOK ; "
^XTV(8991,30,1,1,1,95,0)=" S Y=0,X1=$G(X1) Q:X=2  Q:(X1=""HFS"")!(X1=""SPL"")!(X1=""MT"")!(X1=""CHAN"")  ;Quit w/ OK for HFS, Spool, MT, TCP/IP"
^XTV(8991,30,1,1,1,96,0)=" G:X1=""RES"" RESOK^%ZIS6"
^XTV(8991,30,1,1,1,97,0)=" N $ET S $ET=""D OPNERR Q"""
^XTV(8991,30,1,1,1,98,0)=" O X::$S($D(%ZISTO):%ZISTO,1:0) E  S Y=999 Q  ;G NOPN"
^XTV(8991,30,1,1,1,99,0)=" S Y=0 I '$D(%ZISCHK)!($G(%ZIS)[""T"") C X Q"
^XTV(8991,30,1,1,1,100,0)=" S:X]"""" IO(1,X)="""" Q"
^XTV(8991,30,1,1,1,101,0)=" Q "
^XTV(8991,30,1,1,1,102,0)="NOPN ; "
^XTV(8991,30,1,1,1,103,0)=" N ZJ S $ZT=""NJ"""
^XTV(8991,30,1,1,1,104,0)=" S ZJ="""" F %=0:0 S ZJ=$ZJ(ZJ) Q:'ZJ  D NOPN1 Q:'ZJ"
^XTV(8991,30,1,1,1,105,0)=" Q "
^XTV(8991,30,1,1,1,106,0)="NOPN1 S Y=$V(-1,ZJ) I $P(Y,""^"",3)[X_"",""!($P(Y,""^"",3)[X_""*,"") S Y=ZJ,ZJ="""" Q"
^XTV(8991,30,1,1,1,107,0)=" Q "
^XTV(8991,30,1,1,1,108,0)="NJ Q  ;NOJOB ERROR"
^XTV(8991,30,1,1,1,109,0)="OPNERR S $EC="""",Y=-1 Q"
^XTV(8991,30,1,1,1,110,0)=" ; "
^XTV(8991,30,1,1,1,111,0)="GETENV ;Get environment  (UCI^VOL^NODE^BOX:VOLUME)"
^XTV(8991,30,1,1,1,112,0)=" N %,%1 S %=$$VERSION,%1=$ZU(86),%1=$S(%<3.1:$P(%1,""*"",3),1:$P(%1,""*"",2))"
^XTV(8991,30,1,1,1,113,0)=" D UCI S Y=$P(Y,"","")_""^""_^%ZOSF(""VOL"")_""^""_$ZU(110)_""^""_^%ZOSF(""VOL"")_"":""_%1"
^XTV(8991,30,1,1,1,114,0)=" Q "
^XTV(8991,30,1,1,1,115,0)="VERSION(X) ;return Cache version, X=1 - return full name"
^XTV(8991,30,1,1,1,116,0)=" Q $S($G(X):$P($ZV,"")"")_"")"",1:$P($P($ZV,"") "",2),""(""))"
^XTV(8991,30,1,1,1,117,0)=" ; "
^XTV(8991,30,1,1,1,118,0)="OS() ;Return the OS NT, VMS, Unix"
^XTV(8991,30,1,1,1,119,0)=" Q $S($ZV[""VMS"":""VMS"",$ZV[""Windows"":""NT"",$ZV[""NT"":""NT"",$ZV[""UNIX"":""UNIX"",1:""UNK"")"
^XTV(8991,30,1,1,1,120,0)=" ; "
^XTV(8991,30,1,1,1,121,0)="SETNM(X) ;Set name, Fall into SETENV"
^XTV(8991,30,1,1,1,122,0)="SETENV ;Set environment"
^XTV(8991,30,1,1,1,123,0)=" N Q,$ET,$ES S $ET=""S $EC="""""""" Q"""
^XTV(8991,30,1,1,1,124,0)=" I $$OS=""VMS"" S Q=$ZF(""SETPRN"",$E(X,1,15))"
^XTV(8991,30,1,1,1,125,0)=" Q "
^XTV(8991,30,1,1,1,126,0)=" ;"
^XTV(8991,30,1,1,1,127,0)="SID() ;System ID Ver 1"
^XTV(8991,30,1,1,1,128,0)=" N J1,T S T=""~"""
^XTV(8991,30,1,1,1,129,0)=" S J1(1)=$ZU(86) ;Node specific"
^XTV(8991,30,1,1,1,130,0)=" S J1(2)=$ZU(5)_T_$ZU(12,"""") ;namespace~directory"
^XTV(8991,30,1,1,1,131,0)=" ; Q ""1~""_J1(1)_T_J1(2)"
^XTV(8991,30,1,1,1,132,0)=" Q ""1~""_J1(2)"
^XTV(8991,30,1,1,1,133,0)=" ;"
^XTV(8991,30,1,1,1,134,0)="HFSREW(IO,IOPAR) ;Rewind Host File."
^XTV(8991,30,1,1,1,135,0)=" S $ZT=""HFSRWERR"""
^XTV(8991,30,1,1,1,136,0)=" C IO O @(""""""""_IO_""""""""_$S(IOPAR]"""":"":""_IOPAR_"":1"",1:"":1"")) I '$T Q 0"
^XTV(8991,30,1,1,1,137,0)=" Q 1"
^XTV(8991,30,1,1,1,138,0)="HFSRWERR ;Error encountered"
^XTV(8991,30,1,1,1,139,0)=" Q 0"
^XTV(8991,30,1,1,1,140,0)="LOGRSRC(OPT,TYPE,STATUS) ;record resource usage in ^XTMP(""KMPR"""
^XTV(8991,30,1,1,1,141,0)=" Q:'$G(^%ZTSCH(""LOGRSRC""))  ; quit if RUM not turned on."
^XTV(8991,30,1,1,1,142,0)=" ; call to RUM routine."
^XTV(8991,30,1,1,1,143,0)=" D RU^%ZOSVKR($G(OPT),$G(TYPE),$G(STATUS))"
^XTV(8991,30,1,1,1,144,0)=" Q "
^XTV(8991,30,1,1,1,145,0)="SETTRM(X) ;Turn on specified terminators."
^XTV(8991,30,1,1,1,146,0)=" U $I:(:""+T"":X)"
^XTV(8991,30,1,1,1,147,0)=" Q 1"
^XTV(8991,30,1,1,1,148,0)=" ; "
^XTV(8991,30,1,1,1,149,0)="T0 ; start RT clock"
^XTV(8991,30,1,1,1,150,0)=" S XRT0=$H Q"
^XTV(8991,30,1,1,1,151,0)="T1 ; store RT datum"
^XTV(8991,30,1,1,1,152,0)=" S ^%ZRTL(3,XRTL,+$H,XRTN,$P($H,"","",2))=XRT0 K XRT0 Q"
^XTV(8991,30,1,"B",3061018.1833,1)=""
^XTV(8991,31,0)="ZTMGRSET"
^XTV(8991,31,1,0)="^8991.01^1^1"
^XTV(8991,31,1,1,0)="3061106.1507"
^XTV(8991,31,1,1,1,0)="^8991.11^190^190"
^XTV(8991,31,1,1,1,1,0)="ZTMGRSET ;SF/RWF,PUG/TOAD - SET UP THE MGR ACCOUNT FOR THE SYSTEM ;11/6/06  15:07"
^XTV(8991,31,1,1,1,2,0)=" ;;8.0;KERNEL;**34,36,69,94,121,127,136,191,275**;JUL 10, 1995;"
^XTV(8991,31,1,1,1,3,0)=" ;"
^XTV(8991,31,1,1,1,4,0)=" N %D,%S,I,OSMAX,U,X,X1,X2,Y,Z1,Z2,ZTOS,ZTMODE,SCR"
^XTV(8991,31,1,1,1,5,0)=" S ZTMODE=0"
^XTV(8991,31,1,1,1,6,0)="A W !!,""ZTMGRSET Version "",$P($T(+2),"";"",3),"" "",$P($T(+2),"";"",5)"
^XTV(8991,31,1,1,1,7,0)=" W !,""HELLO! I exist to assist you in correctly initializing the current account."""
^XTV(8991,31,1,1,1,8,0)=" I $D(^%ZOSF(""UCI"")) X ^%ZOSF(""UCI"") I Y'[""MG"" W $C(7),!!,""THIS MAY NOT BE THE MANAGER UCI."",!,"" I think it is "",Y,"". Should I continue anyway? N//"" R X:120 G A:""YNyn""'[$E(X) Q:""Nn""[$E(X)"
^XTV(8991,31,1,1,1,9,0)=" S ZTOS=$$OS() I ZTOS'>0 W !,""Can't determine the OS type. Exiting ZTMGRSET."" Q"
^XTV(8991,31,1,1,1,10,0)=" I ZTMODE D  I (PCNM<1)!(PCNM>999) W !,""Need a Patch number to load."" Q"
^XTV(8991,31,1,1,1,11,0)=" . R !!,""Patch number to load: "",PCNM:120 Q:(PCNM<1)!(PCNM>999)"
^XTV(8991,31,1,1,1,12,0)=" . S SCR=""I $P($T(+2^@X),"""";"""",5)?.E1P1""_$C(34)_PCNM_$C(34)_""1P.E"""
^XTV(8991,31,1,1,1,13,0)=" ;"
^XTV(8991,31,1,1,1,14,0)=" K ^%ZOSF(""MASTER""),^(""SIGNOFF"") ;Remove old nodes."
^XTV(8991,31,1,1,1,15,0)="DOIT W !!,""I will now rename a group of routines specific to your operating system."""
^XTV(8991,31,1,1,1,16,0)=" D @ZTOS,ALL,GLOBALS:'ZTMODE W !,""ALL DONE"""
^XTV(8991,31,1,1,1,17,0)=" Q"
^XTV(8991,31,1,1,1,18,0)=" ;"
^XTV(8991,31,1,1,1,19,0)="RELOAD ;Reload any patched routines"
^XTV(8991,31,1,1,1,20,0)=" N %D,%S,I,OSMAX,U,X,X1,X2,Y,Z1,Z2,ZTOS,ZTMODE,SCR"
^XTV(8991,31,1,1,1,21,0)=" S ZTMODE=1 G A"
^XTV(8991,31,1,1,1,22,0)=" Q"
^XTV(8991,31,1,1,1,23,0)=" ;"
^XTV(8991,31,1,1,1,24,0)="OS() ;Select the OS"
^XTV(8991,31,1,1,1,25,0)=" N Y,X1,X"
^XTV(8991,31,1,1,1,26,0)=" S U=""^"",SCR=""I 1"" F I=1:1:20 S X=$T(@I) Q:X=""""  S OSMAX=I"
^XTV(8991,31,1,1,1,27,0)="B S Y=0,ZTOS=0 I $D(^%ZOSF(""OS"")) D"
^XTV(8991,31,1,1,1,28,0)=" . S X1=$P(^%ZOSF(""OS""),U),ZTOS=$$OSNUM W !,""I think you are using "",X1"
^XTV(8991,31,1,1,1,29,0)=" W !,""Which MUMPS system should I install?"",!"
^XTV(8991,31,1,1,1,30,0)=" F I=1:1:OSMAX W !,I,"" = "",$P($T(@I),"";"",3)"
^XTV(8991,31,1,1,1,31,0)=" W !,""System: "" W:ZTOS ZTOS,""//"""
^XTV(8991,31,1,1,1,32,0)=" R X:300 S:X="""" X=ZTOS"
^XTV(8991,31,1,1,1,33,0)=" I X<1!(X>OSMAX) W !,""NOT A VALID CHOICE"" Q:X[U 0 G B"
^XTV(8991,31,1,1,1,34,0)=" Q X"
^XTV(8991,31,1,1,1,35,0)=" ;"
^XTV(8991,31,1,1,1,36,0)="OSNUM() ;Return the OS number"
^XTV(8991,31,1,1,1,37,0)=" N I,X1,X2,Y S Y=0,X1=$P($G(^%ZOSF(""OS"")),""^"")"
^XTV(8991,31,1,1,1,38,0)=" F I=1:1 S X2=$T(@I) Q:X2=""""  I X2[X1 S Y=I Q"
^XTV(8991,31,1,1,1,39,0)=" Q Y"
^XTV(8991,31,1,1,1,40,0)=" ;"
^XTV(8991,31,1,1,1,41,0)="ALL W !!,""Now to load routines common to all systems."""
^XTV(8991,31,1,1,1,42,0)=" D TM,ETRAP,DEV,OTHER,FM"
^XTV(8991,31,1,1,1,43,0)=" I ZTOS=7!(ZTOS=8) D"
^XTV(8991,31,1,1,1,44,0)=" . S ^%ZE=""D ^ZE"""
^XTV(8991,31,1,1,1,45,0)=" E  D  ;With ZLoad, ZSave, ZInsert"
^XTV(8991,31,1,1,1,46,0)=" . W !,""Installing ^%Z editor"""
^XTV(8991,31,1,1,1,47,0)=" . D ^ZTEDIT"
^XTV(8991,31,1,1,1,48,0)=" I 'ZTMODE W !,""Setting ^%ZIS('C')"" K ^%ZIS(""C"") S ^%ZIS(""C"")=""G ^%ZISC"""
^XTV(8991,31,1,1,1,49,0)=" Q"
^XTV(8991,31,1,1,1,50,0)=" ;"
^XTV(8991,31,1,1,1,51,0)="TM ;Taskman"
^XTV(8991,31,1,1,1,52,0)=" S %S=""ZTLOAD^ZTLOAD1^ZTLOAD2^ZTLOAD3^ZTLOAD4^ZTLOAD5^ZTLOAD6^ZTLOAD7"""
^XTV(8991,31,1,1,1,53,0)=" S %D=""%ZTLOAD^%ZTLOAD1^%ZTLOAD2^%ZTLOAD3^%ZTLOAD4^%ZTLOAD5^%ZTLOAD6^%ZTLOAD7"""
^XTV(8991,31,1,1,1,54,0)=" D MOVE"
^XTV(8991,31,1,1,1,55,0)=" S %S=""ZTM^ZTM0^ZTM1^ZTM2^ZTM3^ZTM4^ZTM5^ZTM6"""
^XTV(8991,31,1,1,1,56,0)=" S %D=""%ZTM^%ZTM0^%ZTM1^%ZTM2^%ZTM3^%ZTM4^%ZTM5^%ZTM6"""
^XTV(8991,31,1,1,1,57,0)=" D MOVE"
^XTV(8991,31,1,1,1,58,0)=" S %S=""ZTMS^ZTMS0^ZTMS1^ZTMS2^ZTMS3^ZTMS4^ZTMS5^ZTMS7^ZTMSH"""
^XTV(8991,31,1,1,1,59,0)=" ;I ZTOS=7!(ZTOS=8) S $P(%S,U,1)=""ZTMSGTM"""
^XTV(8991,31,1,1,1,60,0)=" S %D=""%ZTMS^%ZTMS0^%ZTMS1^%ZTMS2^%ZTMS3^%ZTMS4^%ZTMS5^%ZTMS7^%ZTMSH"""
^XTV(8991,31,1,1,1,61,0)=" D MOVE"
^XTV(8991,31,1,1,1,62,0)=" Q"
^XTV(8991,31,1,1,1,63,0)="FM ;Rename the FileMan routines"
^XTV(8991,31,1,1,1,64,0)=" I ZTMODE=1 Q  ;Only ask on full install"
^XTV(8991,31,1,1,1,65,0)=" R !,""Want to rename the FileMan routines: No//"",X:600 Q:""Yy""'[$E(X_""N"")"
^XTV(8991,31,1,1,1,66,0)=" S %S=""DIDT^DIDTC^DIRCR"",%D=""%DT^%DTC^%RCR"""
^XTV(8991,31,1,1,1,67,0)=" D MOVE"
^XTV(8991,31,1,1,1,68,0)=" Q"
^XTV(8991,31,1,1,1,69,0)=" ;"
^XTV(8991,31,1,1,1,70,0)="ETRAP ;Error Trap"
^XTV(8991,31,1,1,1,71,0)=" S %S=""ZTER^ZTER1"",%D=""%ZTER^%ZTER1"""
^XTV(8991,31,1,1,1,72,0)=" D MOVE"
^XTV(8991,31,1,1,1,73,0)=" Q"
^XTV(8991,31,1,1,1,74,0)="OTHER S %S=""ZTPP^ZTP1^ZTPTCH^ZTRDEL^ZTMOVE"""
^XTV(8991,31,1,1,1,75,0)=" S %D=""%ZTPP^%ZTP1^%ZTPTCH^%ZTRDEL^%ZTMOVE"""
^XTV(8991,31,1,1,1,76,0)=" D MOVE"
^XTV(8991,31,1,1,1,77,0)=" Q"
^XTV(8991,31,1,1,1,78,0)="DEV S %S=""ZIS^ZIS1^ZIS2^ZIS3^ZIS5^ZIS6^ZIS7^ZISC^ZISP^ZISS^ZISS1^ZISS2^ZISTCP^ZISUTL"""
^XTV(8991,31,1,1,1,79,0)=" S %D=""%ZIS^%ZIS1^%ZIS2^%ZIS3^%ZIS5^%ZIS6^%ZIS7^%ZISC^%ZISP^%ZISS^%ZISS1^%ZISS2^%ZISTCP^%ZISUTL"""
^XTV(8991,31,1,1,1,80,0)=" D MOVE"
^XTV(8991,31,1,1,1,81,0)=" Q"
^XTV(8991,31,1,1,1,82,0)="RUM ;Build the routines for Capacity Management (CM)"
^XTV(8991,31,1,1,1,83,0)=" S %S="""""
^XTV(8991,31,1,1,1,84,0)=" I ZTOS=1 S %S=""ZOSVKRV^ZOSVKSVE^ZOSVKSVS^ZOSVKSD"" ;DSM"
^XTV(8991,31,1,1,1,85,0)=" I ZTOS=2 S %S=""ZOSVKRM^ZOSVKSME^ZOSVKSMS^ZOSVKSD"" ;MSM"
^XTV(8991,31,1,1,1,86,0)=" I ZTOS=3 S %S=""ZOSVKRO^ZOSVKSOE^ZOSVKSOS^ZOSVKSD"" ;OpenM"
^XTV(8991,31,1,1,1,87,0)=" I ZTOS=7!(ZTOS=8) S %S=""ZOSVKRG^ZOSVKSGE^ZOSVKSGS^ZOSVKSD"" ;GT.M"
^XTV(8991,31,1,1,1,88,0)=" S %D=""%ZOSVKR^%ZOSVKSE^%ZOSVKSS^%ZOSVKSD"""
^XTV(8991,31,1,1,1,89,0)=" D MOVE"
^XTV(8991,31,1,1,1,90,0)=" Q"
^XTV(8991,31,1,1,1,91,0)="ZOSF(X) ;"
^XTV(8991,31,1,1,1,92,0)=" X SCR I $T W ! D @(U_X) W !"
^XTV(8991,31,1,1,1,93,0)=" Q"
^XTV(8991,31,1,1,1,94,0)="1 ;;VAX DSM(V6), VAX DSM(V7)"
^XTV(8991,31,1,1,1,95,0)=" S %S=""ZOSVVXD^ZTBKCVXD^ZIS4VXD^ZISFVXD^ZISHVXD^XUCIVXD^ZISETVXD"""
^XTV(8991,31,1,1,1,96,0)=" D DES,MOVE"
^XTV(8991,31,1,1,1,97,0)=" S %S=""ZOSV2VXD^ZTMDCL"",%D=""%ZOSV2^%ZTMDCL"""
^XTV(8991,31,1,1,1,98,0)=" D MOVE,RUM,ZOSF(""ZOSFVXD"")"
^XTV(8991,31,1,1,1,99,0)=" Q"
^XTV(8991,31,1,1,1,100,0)="2 ;;MSM-PC/PLUS, MSM for NT or UNIX"
^XTV(8991,31,1,1,1,101,0)=" W !,""- Use autostart to do ZTMB don't resave as STUSER."""
^XTV(8991,31,1,1,1,102,0)=" S %S=""ZOSVMSM^ZTBKCMSM^ZIS4MSM^ZISFMSM^ZISHMSM^XUCIMSM^ZISETMSM"""
^XTV(8991,31,1,1,1,103,0)=" D DES,MOVE"
^XTV(8991,31,1,1,1,104,0)=" S %S=""ZOSV2MSM"",%D=""%ZOSV2"""
^XTV(8991,31,1,1,1,105,0)=" D MOVE,RUM,ZOSF(""ZOSFMSM"")"
^XTV(8991,31,1,1,1,106,0)=" I $$VERSION^%ZOSV(1)[""UNIX"" S %S=""ZISHMSU"",%D=""%ZISH"" D MOVE"
^XTV(8991,31,1,1,1,107,0)=" Q"
^XTV(8991,31,1,1,1,108,0)="3 ;;OpenM for NT, Cache/NT, Cache/VMS"
^XTV(8991,31,1,1,1,109,0)=" S %S=""ZOSVONT^^ZIS4ONT^ZISFONT^ZISHONT^XUCIONT"""
^XTV(8991,31,1,1,1,110,0)=" D DES,MOVE"
^XTV(8991,31,1,1,1,111,0)=" S %S=""ZISTCPS"",%D=""%ZISTCPS"""
^XTV(8991,31,1,1,1,112,0)=" D MOVE,RUM,ZOSF(""ZOSFONT"")"
^XTV(8991,31,1,1,1,113,0)=" Q"
^XTV(8991,31,1,1,1,114,0)="4 ;;Datatree, DTM-PC, DT-MAX"
^XTV(8991,31,1,1,1,115,0)=" S %S=""ZOSVDTM^ZTBKCDTM^ZIS4DTM^ZISFDTM^ZISHDTM^XUCIDTM^ZISETDTM"""
^XTV(8991,31,1,1,1,116,0)=" D DES,MOVE"
^XTV(8991,31,1,1,1,117,0)=" S %S=""ZOSV1DTM^ZTMB"",%D=""%ZOSV1^%ustart"""
^XTV(8991,31,1,1,1,118,0)=" D MOVE,ZOSF(""ZOSFDTM"")"
^XTV(8991,31,1,1,1,119,0)=" Q"
^XTV(8991,31,1,1,1,120,0)="5 ;;MVX,ISM VAX"
^XTV(8991,31,1,1,1,121,0)=" S %S=""ZOSVMSQ^ZTBKCMSQ^ZIS4MSQ^ZISFMSQ^ZISHMSQ^XUCIMSQ^ZISETMSQ"""
^XTV(8991,31,1,1,1,122,0)=" D DES,MOVE"
^XTV(8991,31,1,1,1,123,0)=" S %S=""ZTMB"",%D=""ZSTU"""
^XTV(8991,31,1,1,1,124,0)=" D MOVE,ZOSF(""ZOSFMSQ"")"
^XTV(8991,31,1,1,1,125,0)=" Q"
^XTV(8991,31,1,1,1,126,0)="6 ;;ISM (UNIX, Open VMS)"
^XTV(8991,31,1,1,1,127,0)=" S %S=""ZOSVIS2^^ZIS4IS2^ZISFIS2^ZISHIS2^XUCIIS2^ZISETIS2"""
^XTV(8991,31,1,1,1,128,0)=" D DES,MOVE"
^XTV(8991,31,1,1,1,129,0)=" S %S=""ZTMB"",%D=""ZSTU"""
^XTV(8991,31,1,1,1,130,0)=" D MOVE,ZOSF(""ZOSFIS2"")"
^XTV(8991,31,1,1,1,131,0)=" Q"
^XTV(8991,31,1,1,1,132,0)="7 ;;GT.M (VMS)"
^XTV(8991,31,1,1,1,133,0)=" S %S=""ZOSVGTM^ZTBKCGTM^ZIS4GTM^ZISFGTM^ZISHGTM^XUCIGTM^ZISETGTM"""
^XTV(8991,31,1,1,1,134,0)=" D DES,MOVE"
^XTV(8991,31,1,1,1,135,0)=" S %S=""ZOSV2GTM^ZISTCPS"",%D=""%ZOSV2^%ZISTCPS"""
^XTV(8991,31,1,1,1,136,0)=" D MOVE,ZOSF(""ZOSFGTM"")"
^XTV(8991,31,1,1,1,137,0)=" Q"
^XTV(8991,31,1,1,1,138,0)="8 ;;GT.M (Unix)"
^XTV(8991,31,1,1,1,139,0)=" S %S=""ZOSVGUX^ZTBKCGUX^ZIS4GTM^ZISFGTM^ZISHGUX^XUCIGTM^ZISETGUX"""
^XTV(8991,31,1,1,1,140,0)=" D DES,MOVE"
^XTV(8991,31,1,1,1,141,0)=" S %S=""ZOSV2GTM^ZISTCPS"",%D=""%ZOSV2^%ZISTCPS"""
^XTV(8991,31,1,1,1,142,0)=" D MOVE,ZOSF(""ZOSFGUX"")"
^XTV(8991,31,1,1,1,143,0)=" Q"
^XTV(8991,31,1,1,1,144,0)="10 ;;NOT SUPPORTED"
^XTV(8991,31,1,1,1,145,0)=" Q"
^XTV(8991,31,1,1,1,146,0)="MOVE ; rename % routines"
^XTV(8991,31,1,1,1,147,0)=" N %,X,Y"
^XTV(8991,31,1,1,1,148,0)=" F %=1:1:$L(%D,""^"") D"
^XTV(8991,31,1,1,1,149,0)=" . S X=$P(%S,U,%) ; from"
^XTV(8991,31,1,1,1,150,0)=" . S Y=$P(%D,U,%) ; to"
^XTV(8991,31,1,1,1,151,0)=" . W !,""Routine: "",X"
^XTV(8991,31,1,1,1,152,0)=" . Q:X=""""  Q:Y=""""  I $T(^@X)=""""  W ?20,""  Missing"" Q"
^XTV(8991,31,1,1,1,153,0)=" . X SCR Q:'$T"
^XTV(8991,31,1,1,1,154,0)=" . W ?20,""  Loaded, """
^XTV(8991,31,1,1,1,155,0)=" . D COPY(X,Y)"
^XTV(8991,31,1,1,1,156,0)=" . W ?20,""Saved as "",Y"
^XTV(8991,31,1,1,1,157,0)=" Q"
^XTV(8991,31,1,1,1,158,0)=" ;"
^XTV(8991,31,1,1,1,159,0)="COPY(FROM,TO) ;"
^XTV(8991,31,1,1,1,160,0)=" I ZTOS'=7,ZTOS'=8 X ""ZL @FROM ZS @TO"" Q"
^XTV(8991,31,1,1,1,161,0)=" ;For GT.M below"
^XTV(8991,31,1,1,1,162,0)=" N PATH,COPY S PATH=$$R"
^XTV(8991,31,1,1,1,163,0)=" S FROM=PATH_FROM_"".m"""
^XTV(8991,31,1,1,1,164,0)=" S TO=PATH_$TR(TO,""%"",""_"")_"".m"""
^XTV(8991,31,1,1,1,165,0)=" S COPY=$S(ZTOS=7:""COPY"",1:""cp"")"
^XTV(8991,31,1,1,1,166,0)=" ZSYSTEM COPY_"" ""_FROM_"" ""_TO"
^XTV(8991,31,1,1,1,167,0)=" Q"
^XTV(8991,31,1,1,1,168,0)=" ;"
^XTV(8991,31,1,1,1,169,0)="R() ; routine directory for GT.M"
^XTV(8991,31,1,1,1,170,0)=" I ZTOS=7 Q $P($ZRO,"","")"
^XTV(8991,31,1,1,1,171,0)=" I ZTOS=8 Q $P($S($ZRO[""("":$P($P($ZRO,""("",2),"")""),1:$ZRO),"" "")_""/"""
^XTV(8991,31,1,1,1,172,0)=" E  Q """""
^XTV(8991,31,1,1,1,173,0)=" ;"
^XTV(8991,31,1,1,1,174,0)="DES S %D=""%ZOSV^%ZTBKC1^%ZIS4^%ZISF^%ZISH^%XUCI^ZISETUP"" Q"
^XTV(8991,31,1,1,1,175,0)=" ;"
^XTV(8991,31,1,1,1,176,0)="GLOBALS ;Set node zero of file #3.05 & #3.07"
^XTV(8991,31,1,1,1,177,0)=" W !!,""Now, I will check your % globals."""
^XTV(8991,31,1,1,1,178,0)=" W "".........."""
^XTV(8991,31,1,1,1,179,0)=" F %=""^%ZIS"",""^%ZISL"",""^%ZTER"",""^%ZUA"" S:'$D(@%) @%="""""
^XTV(8991,31,1,1,1,180,0)=" S:$D(^%ZTSK(0))[0 ^%ZTSK(-1)=100,^%ZTSCH="""""
^XTV(8991,31,1,1,1,181,0)=" S Z1=$G(^%ZTSK(-1),-1),Z2=$G(^%ZTSK(0))"
^XTV(8991,31,1,1,1,182,0)=" I Z1'=$P(Z2,""^"",3) S:Z1'>0 ^%ZTSK(-1)=+Z2 S ^%ZTSK(0)=""TASK'S^14.4^""_^%ZTSK(-1)"
^XTV(8991,31,1,1,1,183,0)=" S:$D(^%ZUA(3.05,0))[0 ^%ZUA(3.05,0)=""FAILED ACCESS ATTEMPTS LOG^3.05^^"""
^XTV(8991,31,1,1,1,184,0)=" S:$D(^%ZUA(3.07,0))[0 ^%ZUA(3.07,0)=""PROGRAMMER MODE LOG^3.07^^"""
^XTV(8991,31,1,1,1,185,0)=" Q"
^XTV(8991,31,1,1,1,186,0)="NAME ;Setup the static names for this system"
^XTV(8991,31,1,1,1,187,0)="MGR W !,""NAME OF MANAGER'S UCI,VOLUME SET: ""_^%ZOSF(""MGR"")_""// "" R X:$S($G(DTIME):DTIME,1:9999) I X]"""" X ^(""UCICHECK"") G MGR:0[Y S ^%ZOSF(""MGR"")=X"
^XTV(8991,31,1,1,1,188,0)="PROD W !,""PRODUCTION (SIGN-ON) UCI,VOLUME SET: ""_^%ZOSF(""PROD"")_""// "" R X:$S($G(DTIME):DTIME,1:9999) I X]"""" X ^(""UCICHECK"") G PROD:0[Y S ^%ZOSF(""PROD"")=X"
^XTV(8991,31,1,1,1,189,0)="VOL W !,""NAME OF VOLUME SET: ""_^%ZOSF(""VOL"")_""//"" R X:$S($G(DTIME):DTIME,1:9999) I X]"""" S:X?3U ^%ZOSF(""VOL"")=X I X'?3U W ""MUST BE 3 Upper case."" G VOL"
^XTV(8991,31,1,1,1,190,0)=" W ! Q"
^XTV(8991,31,1,"B",3061106.1507,1)=""
^XTV(8991,32,0)="DGRPU"
^XTV(8991,32,1,0)="^8991.01^1^1"
^XTV(8991,32,1,1,0)="3061225.1828"
^XTV(8991,32,1,1,1,0)="^8991.11^195^195"
^XTV(8991,32,1,1,1,1,0)="DGRPU ;ALB/MRL,TMK - REGISTRATION UTILITY ROUTINE ;12/25/06  18:28"
^XTV(8991,32,1,1,1,2,0)=" ;;5.3;Registration;**33,114,489,624,672,689,634**;Aug 13, 1993;Build 1"
^XTV(8991,32,1,1,1,3,0)="H ;Screen Header"
^XTV(8991,32,1,1,1,4,0)=" I DGRPS'=1.1 W @IOF S Z=$P($T(H1+DGRPS),"";;"",2)_"", SCREEN <""_DGRPS_"">""_$S($D(DGRPH):"" HELP"",1:""""),X=79-$L(Z)\2 D W"
^XTV(8991,32,1,1,1,5,0)=" I DGRPS=1.1 W @IOF S Z=""ADDITIONAL PATIENT DEMOGRAPHIC DATA, SCREEN <""_DGRPS_"">""_$S($D(DGRPH):"" HELP"",1:""""),X=79-$L(Z)\2 D W"
^XTV(8991,32,1,1,1,6,0)=" S X=$$SSNNM(DFN)"
^XTV(8991,32,1,1,1,7,0)=" I '$D(DGRPH) W !,X S X=$S($D(DGRPTYPE):$P(DGRPTYPE,""^"",1),1:""PATIENT TYPE UNKNOWN""),X1=79-$L(X) W ?X1,X"
^XTV(8991,32,1,1,1,8,0)=" S X="""",$P(X,""="",80)="""" W !,X Q"
^XTV(8991,32,1,1,1,9,0)=" Q"
^XTV(8991,32,1,1,1,10,0)=" ;"
^XTV(8991,32,1,1,1,11,0)="AL(DGLEN) ;DGLEN= Available length of line"
^XTV(8991,32,1,1,1,12,0)="A ;Format address(es)"
^XTV(8991,32,1,1,1,13,0)=" I '$D(DGLEN) N DGLEN S DGLEN=29"
^XTV(8991,32,1,1,1,14,0)=" N DGX"
^XTV(8991,32,1,1,1,15,0)=" F I=DGA1:1:DGA1+2 I $P(DGRP(DGAD),U,I)]"""" S DGA(DGA2)=$P(DGRP(DGAD),U,I),DGA2=DGA2+2"
^XTV(8991,32,1,1,1,16,0)=" I DGA2=1 S DGA(1)=""STREET ADDRESS UNKNOWN"",DGA2=DGA2+2"
^XTV(8991,32,1,1,1,17,0)=" S J=$S('$D(^DIC(5,+$P(DGRP(DGAD),U,DGA1+4),0)):"""",('$L($P(^(0),U,2))):$P(^(0),U,1),1:$P(^(0),U,2)),J(1)=$P(DGRP(DGAD),U,DGA1+3),J(2)=$P(DGRP(DGAD),U,DGA1+5),DGA(DGA2)=$S(J(1)]""""&(J]""""):J(1)_"",""_J,J(1)]"""":J(1),J]"""":J,1:""UNK. CITY/STATE"")"
^XTV(8991,32,1,1,1,18,0)=" I "".33^.34^.211^.331^.311^.25^.21""[DGAD D"
^XTV(8991,32,1,1,1,19,0)=" .F I=1:1:7 I $P("".33^.34^.211^.331^.311^.25^.21"",U,I)=DGAD S DGX=$P($G(^DPT(DFN,.22)),U,I)"
^XTV(8991,32,1,1,1,20,0)=" E  D"
^XTV(8991,32,1,1,1,21,0)=" .I DGAD=.141 S DGX=$P(DGRP(.141),U,6) Q"
^XTV(8991,32,1,1,1,22,0)=" .S DGX=$P(DGRP(DGAD),U,DGA1+11)"
^XTV(8991,32,1,1,1,23,0)=" S:$L(DGX)>5 DGX=$E(DGX,1,5)_""-""_$E(DGX,6,9)"
^XTV(8991,32,1,1,1,24,0)=" S DGA(DGA2)=$E($P(DGA(DGA2),"","",1),1,(DGLEN-($L(DGX)+4)))_$S($L($P(DGA(DGA2),"","",2)):"","",1:"""")_$P(DGA(DGA2),"","",2)_"" ""_DGX"
^XTV(8991,32,1,1,1,25,0)=" F I=0:0 S I=$O(DGA(I)) Q:'I  S DGA(I)=$E(DGA(I),1,DGLEN)"
^XTV(8991,32,1,1,1,26,0)=" K DGA1,I,J"
^XTV(8991,32,1,1,1,27,0)=" Q"
^XTV(8991,32,1,1,1,28,0)=" ;"
^XTV(8991,32,1,1,1,29,0)="W I IOST=""C-QUME"",$L(DGVI)'=2 W ?X,Z Q"
^XTV(8991,32,1,1,1,30,0)=" W ?X,@DGVI,Z,@DGVO"
^XTV(8991,32,1,1,1,31,0)=" Q"
^XTV(8991,32,1,1,1,32,0)=" ;"
^XTV(8991,32,1,1,1,33,0)="H1 ;"
^XTV(8991,32,1,1,1,34,0)=" ;;PATIENT DEMOGRAPHIC DATA"
^XTV(8991,32,1,1,1,35,0)=" ;;PATIENT DATA"
^XTV(8991,32,1,1,1,36,0)=" ;;EMERGENCY CONTACT DATA"
^XTV(8991,32,1,1,1,37,0)=" ;;APPLICANT/SPOUSE EMPLOYMENT DATA"
^XTV(8991,32,1,1,1,38,0)=" ;;INSURANCE DATA"
^XTV(8991,32,1,1,1,39,0)=" ;;MILITARY SERVICE DATA"
^XTV(8991,32,1,1,1,40,0)=" ;;ELIGIBILITY STATUS DATA"
^XTV(8991,32,1,1,1,41,0)=" ;;FAMILY DEMOGRAPHIC DATA"
^XTV(8991,32,1,1,1,42,0)=" ;;INCOME SCREENING DATA"
^XTV(8991,32,1,1,1,43,0)=" ;;INELIGIBLE/MISSING DATA"
^XTV(8991,32,1,1,1,44,0)=" ;;ELIGIBILITY VERIFICATION DATA"
^XTV(8991,32,1,1,1,45,0)=" ;;ADMISSION INFORMATION"
^XTV(8991,32,1,1,1,46,0)=" ;;APPLICATION INFORMATION"
^XTV(8991,32,1,1,1,47,0)=" ;;APPOINTMENT INFORMATION"
^XTV(8991,32,1,1,1,48,0)=" ;;SPONSOR DEMOGRAPHIC INFORMATION"
^XTV(8991,32,1,1,1,49,0)=" ;"
^XTV(8991,32,1,1,1,50,0)=" ;"
^XTV(8991,32,1,1,1,51,0)="INCOME(DFN,DGDT) ; compute income for veteran...if not in 408.21, pass back file 2 data"
^XTV(8991,32,1,1,1,52,0)=" ; (called by PTF)"
^XTV(8991,32,1,1,1,53,0)=" ;"
^XTV(8991,32,1,1,1,54,0)=" ;"
^XTV(8991,32,1,1,1,55,0)=" ;  Input:  DFN as IEN of PATIENT file"
^XTV(8991,32,1,1,1,56,0)=" ;          DGDT as date to return income as of"
^XTV(8991,32,1,1,1,57,0)=" ;"
^XTV(8991,32,1,1,1,58,0)=" ; Output:  total income (computed function)"
^XTV(8991,32,1,1,1,59,0)=" ;          (from 408.21 if available...otherwise from file 2)"
^XTV(8991,32,1,1,1,60,0)=" ;"
^XTV(8991,32,1,1,1,61,0)=" ;"
^XTV(8991,32,1,1,1,62,0)=" N DGDEP,DGINC,DGREL,DGTOT,DGX,I S DGTOT=0"
^XTV(8991,32,1,1,1,63,0)=" D ALL^DGMTU21(DFN,""V"",DGDT,""I"")"
^XTV(8991,32,1,1,1,64,0)=" S DGX=$G(^DGMT(408.21,+$G(DGINC(""V"")),0)) I DGX]"""" F I=8:1:17 S DGTOT=DGTOT+$P(DGX,""^"",I)"
^XTV(8991,32,1,1,1,65,0)=" I DGX']"""" S DGTOT=$P($G(^DPT(DFN,.362)),U,20)"
^XTV(8991,32,1,1,1,66,0)=" Q DGTOT"
^XTV(8991,32,1,1,1,67,0)=" ;"
^XTV(8991,32,1,1,1,68,0)=" ;"
^XTV(8991,32,1,1,1,69,0)="MTCOMP(DFN,DGDT) ; is current means test OR COPAY complete?"
^XTV(8991,32,1,1,1,70,0)=" ;"
^XTV(8991,32,1,1,1,71,0)=" ;  Input:  DFN as IEN of PATIENT file"
^XTV(8991,32,1,1,1,72,0)=" ;          DGDT as 'as of' date"
^XTV(8991,32,1,1,1,73,0)=" ;"
^XTV(8991,32,1,1,1,74,0)=" ; Output:  1 if means test/COPAY for year prior to DT passed is complete"
^XTV(8991,32,1,1,1,75,0)=" ;          0 otherwise"
^XTV(8991,32,1,1,1,76,0)=" ;          DGMTYPT 1=MT;2=CP;0=NONE"
^XTV(8991,32,1,1,1,77,0)=" ;"
^XTV(8991,32,1,1,1,78,0)=" N COMP,MT,X,YR"
^XTV(8991,32,1,1,1,79,0)=" S YR=$$LYR^DGMTSCU1(DGDT),MT=$$LST^DGMTCOU1(DFN,DGDT)"
^XTV(8991,32,1,1,1,80,0)=" S DGMTYPT=+$P(MT,U,5)"
^XTV(8991,32,1,1,1,81,0)=" S COMP=1"
^XTV(8991,32,1,1,1,82,0)=" I DGMTYPT=1 D  ;MT"
^XTV(8991,32,1,1,1,83,0)=" .I $P(MT,""^"",4)']""""!(""^R^N^""[(""^""_$P(MT,""^"",4)_""^"")) S COMP=0"
^XTV(8991,32,1,1,1,84,0)=" I DGMTYPT=2 D  ;CP"
^XTV(8991,32,1,1,1,85,0)=" .I $P(MT,""^"",4)']""""!(""^I^L^""[(""^""_$P(MT,""^"",4)_""^"")) S COMP=0"
^XTV(8991,32,1,1,1,86,0)=" S X=+$P(MT,""^"",2) I ($E(X,1,3)-1)*10000<YR S COMP=0"
^XTV(8991,32,1,1,1,87,0)=" Q COMP"
^XTV(8991,32,1,1,1,88,0)=" ;"
^XTV(8991,32,1,1,1,89,0)="HLP1010 ;* This is called by the Executable Help for Patient field #1010.159"
^XTV(8991,32,1,1,1,90,0)=" ;   (APPOINTMENT REQUEST ON 1010EZ)"
^XTV(8991,32,1,1,1,91,0)=" W !!,""    Enter a 'Y' if the veteran applicant has requested an"""
^XTV(8991,32,1,1,1,92,0)=" W !,""    appointment with a VA doctor or provider and wants to be"""
^XTV(8991,32,1,1,1,93,0)=" W !,""    seen as soon as one becomes available  Enter a 'N'"""
^XTV(8991,32,1,1,1,94,0)=" W !,""    if the veteran applicant has not requested an appointment."""
^XTV(8991,32,1,1,1,95,0)=" W !!,""    This question may ONLY be entered ONCE for the veteran."""
^XTV(8991,32,1,1,1,96,0)=" W !,""    The answer to this question CANNOT be changed after the"""
^XTV(8991,32,1,1,1,97,0)=" W !,""    initial entry."",!"
^XTV(8991,32,1,1,1,98,0)=" Q"
^XTV(8991,32,1,1,1,99,0)=" ;"
^XTV(8991,32,1,1,1,100,0)="HLPCS ; * This is called by the Executable Help for Income Relation field #.1"
^XTV(8991,32,1,1,1,101,0)=" Q:X=""?"""
^XTV(8991,32,1,1,1,102,0)=" N DIR,DGRDVAR"
^XTV(8991,32,1,1,1,103,0)=" W !?8,""Enter in this field a Yes or No to indicate whether the veteran"""
^XTV(8991,32,1,1,1,104,0)=" W !?8,""contributed any dollar amount to the child's support last calendar"""
^XTV(8991,32,1,1,1,105,0)=" W !?8,""year.  The contributions do not have to be in regular set amounts."""
^XTV(8991,32,1,1,1,106,0)=" W !?8,""For example, a veteran who paid a child's school tuition or"""
^XTV(8991,32,1,1,1,107,0)=" W !?8,""medical bills would be contributing to the child's support."",!"
^XTV(8991,32,1,1,1,108,0)=" W !,""Enter RETURN to continue:"" R DGRDVAR:DTIME W !"
^XTV(8991,32,1,1,1,109,0)=" Q"
^XTV(8991,32,1,1,1,110,0)=" ;"
^XTV(8991,32,1,1,1,111,0)="HLP1823 ;*This is called by the Executable Help for Patient Relation field #.18"
^XTV(8991,32,1,1,1,112,0)=" N DIR,DGRDVAR"
^XTV(8991,32,1,1,1,113,0)=" W !?7,""Enter 'Y' if the child is currently 18 to 23 years old and the child"""
^XTV(8991,32,1,1,1,114,0)=" W !?7,""attended school last calendar year.  Enter 'N' if the child is currently"""
^XTV(8991,32,1,1,1,115,0)=" W !?7,""18 to 23 years old but the child did not attend school last calendar"""
^XTV(8991,32,1,1,1,116,0)=" W !?7,""year.  Enter 'N' if the child is not currently 18 to 23 years old."",!"
^XTV(8991,32,1,1,1,117,0)=" I $G(DA) W !,""Enter RETURN to continue:"" R DGRDVAR:DTIME W !"
^XTV(8991,32,1,1,1,118,0)=" Q"
^XTV(8991,32,1,1,1,119,0)=" ;"
^XTV(8991,32,1,1,1,120,0)="HLPMLDS ;* This is called by the Executable Help for Patient field #.362"
^XTV(8991,32,1,1,1,121,0)=" ;   (DISABILITY RET. FROM MILITARY?)"
^XTV(8991,32,1,1,1,122,0)=" N X,Y,DIR"
^XTV(8991,32,1,1,1,123,0)=" W !!,""  Enter '0' or 'NO' if the veteran:"""
^XTV(8991,32,1,1,1,124,0)=" W !,""    -- Is NOT retired from the military OR"""
^XTV(8991,32,1,1,1,125,0)=" W !,""    -- Is retired from the military due to length of service AND"""
^XTV(8991,32,1,1,1,126,0)=" W !,""       does NOT have a disability confirmed by the Military Branch"""
^XTV(8991,32,1,1,1,127,0)=" W !,""       to have been incurred in or aggravated while on active duty."""
^XTV(8991,32,1,1,1,128,0)=" W !!,""  Enter '1' or 'YES, RECEIVING MILITARY RETIREMENT' if the veteran:"""
^XTV(8991,32,1,1,1,129,0)=" W !,""    -- Is confirmed by the Military Branch to have been discharged"""
^XTV(8991,32,1,1,1,130,0)=" W !,""       or released due to a disability incurred in or aggravated"""
^XTV(8991,32,1,1,1,131,0)=" W !,""       while on active duty AND"""
^XTV(8991,32,1,1,1,132,0)=" W !,""       -- Has NOT filed a claim for VA compensation benefits OR"""
^XTV(8991,32,1,1,1,133,0)=" W !,""       -- Has been rated by the VA to be NSC OR"""
^XTV(8991,32,1,1,1,134,0)=" W !,""       -- Has been rated by the VA to have noncompensable 0%"""
^XTV(8991,32,1,1,1,135,0)=" W !,""          SC conditions."""
^XTV(8991,32,1,1,1,136,0)=" S DIR(0)=""E"" D ^DIR Q:+Y<1"
^XTV(8991,32,1,1,1,137,0)=" W !!,""  Enter '2' or 'YES, RECEIVING MILITARY RETIREMENT IN LIEU OF VA"""
^XTV(8991,32,1,1,1,138,0)=" W !,""                COMPENSATION' if the veteran:"""
^XTV(8991,32,1,1,1,139,0)=" W !,""       -- Is confirmed by the Military Branch to have been discharged"""
^XTV(8991,32,1,1,1,140,0)=" W !,""          or released due to a disability incurred in or aggravated"""
^XTV(8991,32,1,1,1,141,0)=" W !,""          while on active duty AND"""
^XTV(8991,32,1,1,1,142,0)=" W !,""       -- Is receiving military disability retirement pay AND"""
^XTV(8991,32,1,1,1,143,0)=" W !,""       -- Has been rated by VA to have compensable SC conditions"""
^XTV(8991,32,1,1,1,144,0)=" W !,""          but is NOT receiving compensation from the VA"""
^XTV(8991,32,1,1,1,145,0)=" W !!,""          Once eligibility has been verified, this field will no longer"""
^XTV(8991,32,1,1,1,146,0)=" W !,""          be editable to any user who does not hold the designated security"""
^XTV(8991,32,1,1,1,147,0)=" W !,""          key."""
^XTV(8991,32,1,1,1,148,0)=" Q"
^XTV(8991,32,1,1,1,149,0)="HLP3602 ;help text for field .3602, Rec'ing Disability in Lieu of VA Comp"
^XTV(8991,32,1,1,1,150,0)=" W !,""     Enter 'Y' if this veteran applicant is receiving disability"""
^XTV(8991,32,1,1,1,151,0)=" W !,""     retirement pay from the Military instead of VA compensation."""
^XTV(8991,32,1,1,1,152,0)=" W !,""     Enter 'N' if this veteran applicant is not receiving disability"""
^XTV(8991,32,1,1,1,153,0)=" W !,""     retirement pay from the Military instead of VA compensation."""
^XTV(8991,32,1,1,1,154,0)=" W !,""     Once eligibility has been verified by HEC this field will no longer """
^XTV(8991,32,1,1,1,155,0)=" W !,""     be editable by VistA users. Send updates and/or requests to HEC."""
^XTV(8991,32,1,1,1,156,0)=" Q"
^XTV(8991,32,1,1,1,157,0)="HLP3603 ;help text for field .3603, Discharge Due to LOD Disability"
^XTV(8991,32,1,1,1,158,0)=" W !,""     Enter 'Y' if this veteran applicant was discharged from the"""
^XTV(8991,32,1,1,1,159,0)=" W !,""     military for a disability incurred or aggravated in the line """
^XTV(8991,32,1,1,1,160,0)=" W !,""     of duty.  Enter 'N' if this veteran applicant was not discharged"""
^XTV(8991,32,1,1,1,161,0)=" W !,""     from the military for a disability incurred or aggravated in the"""
^XTV(8991,32,1,1,1,162,0)=" W !,""     line of duty. Once eligibility has been verified by HEC this field"""
^XTV(8991,32,1,1,1,163,0)=" W !,""     will no longer be editable by VistA users. Send updates and/or requests"""
^XTV(8991,32,1,1,1,164,0)=" W !,""     to HEC."""
^XTV(8991,32,1,1,1,165,0)=" Q"
^XTV(8991,32,1,1,1,166,0)="SSNNM(DFN) ; SSN and name on first line of screen"
^XTV(8991,32,1,1,1,167,0)=" ;"
^XTV(8991,32,1,1,1,168,0)=" ; ** start of VOE change: DAOU/JLG 2/1/2005,VA/CJS,WV/TOAD 5/9/2006 **"
^XTV(8991,32,1,1,1,169,0)=" ;"
^XTV(8991,32,1,1,1,170,0)=" ; Change code so it will display HRN if SSN is null"
^XTV(8991,32,1,1,1,171,0)=" ;"
^XTV(8991,32,1,1,1,172,0)=" ; before:"
^XTV(8991,32,1,1,1,173,0)=" ;"
^XTV(8991,32,1,1,1,174,0)=" ; N X,SSN"
^XTV(8991,32,1,1,1,175,0)=" ; S X=$S($D(^DPT(+DFN,0)):^(0),1:""""),SSN=$P(X,""^"",9),SSN=$E(SSN,1,3)_""-""_$E(SSN,4,5)_""-""_$E(SSN,6,10)"
^XTV(8991,32,1,1,1,176,0)=" ;"
^XTV(8991,32,1,1,1,177,0)=" ; after:"
^XTV(8991,32,1,1,1,178,0)=" ;"
^XTV(8991,32,1,1,1,179,0)=" ; Social Security Number field (.09) in Patient file (2)"
^XTV(8991,32,1,1,1,180,0)=" N X,SSN,HRN"
^XTV(8991,32,1,1,1,181,0)=" S X=$S($D(^DPT(+DFN,0)):^(0),1:""""),SSN=$P(X,""^"",9)"
^XTV(8991,32,1,1,1,182,0)=" I SSN S SSN=$E(SSN,1,3)_""-""_$E(SSN,4,5)_""-""_$E(SSN,6,10)"
^XTV(8991,32,1,1,1,183,0)=" ;"
^XTV(8991,32,1,1,1,184,0)="ID S SSN=$$ID^DGLBPID(DFN) ;**GFT/VW"
^XTV(8991,32,1,1,1,185,0)=" ; for IHS or EHR, replace SSN with HRN"
^XTV(8991,32,1,1,1,186,0)=" I $G(DUZ(""AG""))'=""V"" D"
^XTV(8991,32,1,1,1,187,0)=" . Q:SSN]"""""
^XTV(8991,32,1,1,1,188,0)=" . S HRN=$$HRN^AUPNPAT3(+DFN,DUZ(2))"
^XTV(8991,32,1,1,1,189,0)=" . I HRN S SSN=""HRN-""_HRN"
^XTV(8991,32,1,1,1,190,0)=" ;"
^XTV(8991,32,1,1,1,191,0)=" ; ** end of VOE change **"
^XTV(8991,32,1,1,1,192,0)=" ;"
^XTV(8991,32,1,1,1,193,0)=" S X=$P(X,U)_""; ""_SSN"
^XTV(8991,32,1,1,1,194,0)=" Q X"
^XTV(8991,32,1,1,1,195,0)=" ;"
^XTV(8991,32,1,"B",3061225.1828,1)=""
^XTV(8991,33,0)="AUPNLK1"
^XTV(8991,33,1,0)="^8991.01^2^2"
^XTV(8991,33,1,1,0)="3061226.1044"
^XTV(8991,33,1,1,1,0)="^8991.11^130^130"
^XTV(8991,33,1,1,1,1,0)=""
^XTV(8991,33,1,1,1,1,"DEL")="AUPNLK1 ; IHS/CMI/LAB - IHS PATIENT LOOKUP CHECK XREFS ;12/26/06  10:44"
^XTV(8991,33,1,1,1,2,0)=""
^XTV(8991,33,1,1,1,2,"DEL")=" ;;99.1;IHS DICTIONARIES (PATIENT);**167**;MAR 09, 1999;Build 18"
^XTV(8991,33,1,1,1,3,"INS",0)="^8991.12^2^2"
^XTV(8991,33,1,1,1,3,"INS",1,0)="AUPNLK1 ; IHS/CMI/LAB - IHS PATIENT LOOKUP CHECK XREFS ;12/26/06  10:52"
^XTV(8991,33,1,1,1,3,"INS",2,0)=" ;;1.0;PCE PATIENT CARE ENCOUNTER;**167**;Aug 12, 1996;Build 18"
^XTV(8991,33,1,2,0)="3061226.1052"
^XTV(8991,33,1,2,1,0)="^8991.11^130^130"
^XTV(8991,33,1,2,1,1,0)="AUPNLK1 ; IHS/CMI/LAB - IHS PATIENT LOOKUP CHECK XREFS ;12/26/06  10:52"
^XTV(8991,33,1,2,1,2,0)=" ;;1.0;PCE PATIENT CARE ENCOUNTER;**167**;Aug 12, 1996;Build 18"
^XTV(8991,33,1,2,1,3,0)=" ;'Modified' MAS Patient Look-up Check Cross-References June 1987"
^XTV(8991,33,1,2,1,4,0)=" ;"
^XTV(8991,33,1,2,1,5,0)=" ; Upon exiting this routine AUPDFN will exist as follows:"
^XTV(8991,33,1,2,1,6,0)=" ;        AUPDFN = 0 means no hits"
^XTV(8991,33,1,2,1,7,0)=" ;        AUPDFN < 0 means hits but no selection"
^XTV(8991,33,1,2,1,8,0)=" ;        AUPDFN > 0 means selection made"
^XTV(8991,33,1,2,1,9,0)=" ;"
^XTV(8991,33,1,2,1,10,0)="START ;"
^XTV(8991,33,1,2,1,11,0)=" D INIT ;                    Fix up AUPX & set up xrefs"
^XTV(8991,33,1,2,1,12,0)=" D SEARCH ;                  Search xrefs"
^XTV(8991,33,1,2,1,13,0)=" D EOJ ;                     Cleanup"
^XTV(8991,33,1,2,1,14,0)=" Q"
^XTV(8991,33,1,2,1,15,0)=" ; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -"
^XTV(8991,33,1,2,1,16,0)=" ;"
^XTV(8991,33,1,2,1,17,0)="SEARCH ; SEARCH XREFS"
^XTV(8991,33,1,2,1,18,0)=" F AUPLP=1:1 S AUPREF=$P(AUPREFS,"","",AUPLP) Q:AUPREF=""""!(AUPDFN)  D"
^XTV(8991,33,1,2,1,19,0)=" .I AUPREF=""ADOB"" S AUPVAL=AUPDT"
^XTV(8991,33,1,2,1,20,0)=" .E  I AUPREF=""AZVWVOE"" S AUPVAL=$E($TR(AUPX,""ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz!@#$%^&*()-_=+[]{}<>,./?:;'\|""),1,30)"
^XTV(8991,33,1,2,1,21,0)=" .E  S AUPVAL=AUPX"
^XTV(8991,33,1,2,1,22,0)=" .D IHSVAL I 'AUPDFN,AUPREF=""B"" D IHSB I 'AUPDFN D IHSCHK"
^XTV(8991,33,1,2,1,23,0)=" I 'AUPDFN S:AUPCNT=1&($D(AUPIFNS(AUPCNT))) AUPDFN=+AUPIFNS(AUPCNT) S AUP(""NOPRT^"")="""" D PRTAUP^AUPNLKUT:'AUPDFN&(AUPCNT>AUPNUM)&(DIC(0)[""E"") K AUP(""NOPRT^"") I 'AUPDFN,$D(AUPSEL),AUPSEL="""" S AUPX="""",AUPDFN=-1"
^XTV(8991,33,1,2,1,24,0)=" Q"
^XTV(8991,33,1,2,1,25,0)=" ; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -"
^XTV(8991,33,1,2,1,26,0)=" ;"
^XTV(8991,33,1,2,1,27,0)="IHSB ; CHECK TRANSPOSED OR MISSING FIRST/MIDDLE"
^XTV(8991,33,1,2,1,28,0)=" Q:AUPX'?1A.E1"","".E"
^XTV(8991,33,1,2,1,29,0)=" S AUPNML=$P(AUPX,"","",1),AUPNMF=$P($P(AUPX,"","",2),"" "",1),AUPNMM=$P($P(AUPX,"","",2),"" "",2)"
^XTV(8991,33,1,2,1,30,0)=" Q:AUPNMF="""""
^XTV(8991,33,1,2,1,31,0)=" I AUPNMF?.E1P.E S X=AUPNMF D PUNC S AUPNMF=X"
^XTV(8991,33,1,2,1,32,0)=" I AUPNMM?.E1P.E S X=AUPNMM D PUNC S AUPNMM=X"
^XTV(8991,33,1,2,1,33,0)=" S AUPBX=AUPNML"
^XTV(8991,33,1,2,1,34,0)=" F AUPBI=0:0 Q:AUPDFN  S AUPBX=$O(^DPT(""B"",AUPBX)) Q:$P($P(AUPBX,"","",1),"" "",1)'=AUPNML  S AUPBY=$P(AUPBX,"","",2) D IHSB2 I Y F Y=0:0 S Y=$O(^DPT(""B"",AUPBX,Y)) Q:'Y  I '$D(AUPS(Y)) S AUPVAL=AUPBX,AUPNICK(Y)="""" D SETAUP^AUPNLKUT Q:AUPDFN"
^XTV(8991,33,1,2,1,35,0)=" K AUPBI,AUPBX,AUPBY"
^XTV(8991,33,1,2,1,36,0)=" Q"
^XTV(8991,33,1,2,1,37,0)=" ;"
^XTV(8991,33,1,2,1,38,0)="PUNC ;"
^XTV(8991,33,1,2,1,39,0)=" F I=1:1:$L(X) I $E(X,I)?1P S X=$E(X,1,I-1)_$E(X,I+1,99)"
^XTV(8991,33,1,2,1,40,0)=" Q"
^XTV(8991,33,1,2,1,41,0)=" ;"
^XTV(8991,33,1,2,1,42,0)="IHSB2 ;"
^XTV(8991,33,1,2,1,43,0)=" S Y=0"
^XTV(8991,33,1,2,1,44,0)=" I "" ""_$P(AUPBY,"" "",2)[("" ""_AUPNMF),"" ""_$P(AUPBY,"" "",1)[("" ""_AUPNMM) S Y=1 Q"
^XTV(8991,33,1,2,1,45,0)=" I "" ""_$P(AUPBY,"" "",1)[("" ""_AUPNMF),"" ""_$P(AUPBY,"" "",2)[("" ""_AUPNMM) S Y=1 Q"
^XTV(8991,33,1,2,1,46,0)=" Q"
^XTV(8991,33,1,2,1,47,0)=" ;"
^XTV(8991,33,1,2,1,48,0)="IHSCHK ; CHECK NICKNAMES AND LAST NAME FOR MISPELLING"
^XTV(8991,33,1,2,1,49,0)=" Q:AUPX'?1A.E1"","".E"
^XTV(8991,33,1,2,1,50,0)=" S AUPNMCVN=3"
^XTV(8991,33,1,2,1,51,0)=" D IHSCHK4"
^XTV(8991,33,1,2,1,52,0)=" Q:AUPDFN"
^XTV(8991,33,1,2,1,53,0)=" S AUPNMCHK(""AUPX"")=AUPX"
^XTV(8991,33,1,2,1,54,0)=" S AUPNMCHK(""LAST"")=$P(AUPX,"","",1)"
^XTV(8991,33,1,2,1,55,0)=" I $D(^APMM(98,""B"",AUPNMCHK(""LAST""))) F AUPNMCHK(""EN"")=0:0 S AUPNMCHK(""EN"")=$O(^APMM(98,""B"",AUPNMCHK(""LAST""),AUPNMCHK(""EN""))) Q:AUPNMCHK(""EN"")=""""  D IHSCHK2 Q:AUPDFN"
^XTV(8991,33,1,2,1,56,0)=" S AUPX=AUPNMCHK(""AUPX"")"
^XTV(8991,33,1,2,1,57,0)=" K AUPNMCHK,AUPNMCVN"
^XTV(8991,33,1,2,1,58,0)=" Q"
^XTV(8991,33,1,2,1,59,0)=" ;"
^XTV(8991,33,1,2,1,60,0)="IHSCHK2 ;"
^XTV(8991,33,1,2,1,61,0)=" K AUPNMCHK(""TBL"")"
^XTV(8991,33,1,2,1,62,0)=" S AUPNMCHK(""TBL"",$P(^APMM(98,AUPNMCHK(""EN""),0),U,1))="""""
^XTV(8991,33,1,2,1,63,0)=" F AUPL=0:0 S AUPL=$O(^APMM(98,AUPNMCHK(""EN""),""F"",AUPL)) Q:AUPL'=+AUPL  S AUPNMCHK(""TBL"",$P(^APMM(98,AUPNMCHK(""EN""),""F"",AUPL,0),U,1))="""""
^XTV(8991,33,1,2,1,64,0)=" K AUPNMCHK(""TBL"",$P(AUPNMCHK(""AUPX""),U,1))"
^XTV(8991,33,1,2,1,65,0)=" S AUPNMCHK(""NLAST"")="""" F AUPL=0:0 S AUPNMCHK(""NLAST"")=$O(AUPNMCHK(""TBL"",AUPNMCHK(""NLAST""))) Q:AUPNMCHK(""NLAST"")=""""  D IHSCHK3 Q:AUPDFN"
^XTV(8991,33,1,2,1,66,0)=" Q"
^XTV(8991,33,1,2,1,67,0)=" ;"
^XTV(8991,33,1,2,1,68,0)="IHSCHK3 ;"
^XTV(8991,33,1,2,1,69,0)=" S $P(AUPX,"","",1)=AUPNMCHK(""NLAST""),AUPVAL=AUPX"
^XTV(8991,33,1,2,1,70,0)=" S AUPNMCVN=3"
^XTV(8991,33,1,2,1,71,0)=" D IHSVAL"
^XTV(8991,33,1,2,1,72,0)=" Q:AUPDFN"
^XTV(8991,33,1,2,1,73,0)=" D IHSCHK4"
^XTV(8991,33,1,2,1,74,0)=" Q"
^XTV(8991,33,1,2,1,75,0)=" ;"
^XTV(8991,33,1,2,1,76,0)="IHSCHK4 ; CHECK FIRST & MIDDLE NAMES FOR NICK NAMES"
^XTV(8991,33,1,2,1,77,0)=" S AUPNML=$P(AUPX,"","",1),AUPNMF=$P($P(AUPX,"","",2),"" "",1),AUPNMM=$P($P(AUPX,"","",2),"" "",2)"
^XTV(8991,33,1,2,1,78,0)=" Q:AUPNMF="""""
^XTV(8991,33,1,2,1,79,0)=" I $D(^APMM(99,""B"",AUPNMF)) S AUPNMCVN=1 F AUPNMCV=0:0 S AUPNMCV=$O(^APMM(99,""B"",AUPNMF,AUPNMCV)) Q:AUPNMCV=""""  D IHSNMCV Q:AUPDFN"
^XTV(8991,33,1,2,1,80,0)=" K AUPNMCV,AUPNMCVT"
^XTV(8991,33,1,2,1,81,0)=" Q:AUPDFN"
^XTV(8991,33,1,2,1,82,0)=" I AUPNMM'="""",$D(^APMM(99,""B"",AUPNMM)) S AUPNMCVN=2 F AUPNMCV=0:0 S AUPNMCV=$O(^APMM(99,""B"",AUPNMM,AUPNMCV)) Q:AUPNMCV=""""  D IHSNMCV Q:AUPDFN"
^XTV(8991,33,1,2,1,83,0)=" K AUPNMCV,AUPNMCVN,AUPNMCVT"
^XTV(8991,33,1,2,1,84,0)=" Q:AUPDFN"
^XTV(8991,33,1,2,1,85,0)=" K AUPNML,AUPNMF,AUPNMM"
^XTV(8991,33,1,2,1,86,0)=" Q"
^XTV(8991,33,1,2,1,87,0)=" ;"
^XTV(8991,33,1,2,1,88,0)="IHSNMCV ; CHECK NICK NAMES"
^XTV(8991,33,1,2,1,89,0)=" K AUPNMCVT"
^XTV(8991,33,1,2,1,90,0)=" S AUPNMCVT($P(^APMM(99,AUPNMCV,0),U,1))="""""
^XTV(8991,33,1,2,1,91,0)=" F AUPL=0:0 S AUPL=$O(^APMM(99,AUPNMCV,""F"",AUPL)) Q:AUPL'=+AUPL  S AUPNMCVT($P(^APMM(99,AUPNMCV,""F"",AUPL,0),U,1))="""""
^XTV(8991,33,1,2,1,92,0)=" K AUPNMCVT($S(AUPNMCVN=1:AUPNMF,1:AUPNMM))"
^XTV(8991,33,1,2,1,93,0)=" S AUPNMCVI="""" F AUPL=0:0 S AUPNMCVI=$O(AUPNMCVT(AUPNMCVI)) Q:AUPNMCVI=""""!(AUPDFN)  S AUPVAL=AUPNML_"",""_$S(AUPNMCVN=1:AUPNMCVI,1:AUPNMF)_$S(AUPNMCVN=1&(AUPNMM'=""""):"" ""_AUPNMM,AUPNMCVN=2:"" ""_AUPNMCVI,1:"""") D IHSNMCV2"
^XTV(8991,33,1,2,1,94,0)=" K AUPNMCVI"
^XTV(8991,33,1,2,1,95,0)=" Q"
^XTV(8991,33,1,2,1,96,0)=" ;"
^XTV(8991,33,1,2,1,97,0)="IHSNMCV2 ;"
^XTV(8991,33,1,2,1,98,0)=" S AUPNMCVX=AUPX,AUPX=AUPVAL"
^XTV(8991,33,1,2,1,99,0)=" D IHSVAL"
^XTV(8991,33,1,2,1,100,0)=" S AUPX=AUPNMCVX"
^XTV(8991,33,1,2,1,101,0)=" K AUPNMCVX"
^XTV(8991,33,1,2,1,102,0)=" Q"
^XTV(8991,33,1,2,1,103,0)=" ;"
^XTV(8991,33,1,2,1,104,0)="IHSVAL ;"
^XTV(8991,33,1,2,1,105,0)=" I $D(^DPT(AUPREF,AUPVAL))&(DIC(0)[""X"") D CHKIFN Q"
^XTV(8991,33,1,2,1,106,0)=" D:$D(^DPT(AUPREF,AUPVAL)) CHKIFN"
^XTV(8991,33,1,2,1,107,0)=" D:DIC(0)'[""X"" CHKVAL"
^XTV(8991,33,1,2,1,108,0)=" Q"
^XTV(8991,33,1,2,1,109,0)=" ; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -"
^XTV(8991,33,1,2,1,110,0)=" ;"
^XTV(8991,33,1,2,1,111,0)="CHKVAL ;"
^XTV(8991,33,1,2,1,112,0)=" S AUPVAL=$S($D(AUPNMCVN):AUPVAL,AUPREF=""ADOB"":AUPDT,AUPX?.N:AUPX_"" "",1:AUPX) S:$E(AUPVAL,$L(AUPVAL))=""."" AUPVAL=$E(AUPVAL,1,$L(AUPVAL)-1)"
^XTV(8991,33,1,2,1,113,0)=" F AUPLP1=0:0 S AUPVAL=$O(^DPT(AUPREF,AUPVAL)) Q:AUPVAL=""""!(AUPDFN)!($P(AUPVAL,$S($E(AUPX,$L(AUPX))=""."":$E(AUPX,1,$L(AUPX)-1),1:AUPX))'="""")  D CHKIFN"
^XTV(8991,33,1,2,1,114,0)=" Q"
^XTV(8991,33,1,2,1,115,0)=" ;"
^XTV(8991,33,1,2,1,116,0)="CHKIFN ;"
^XTV(8991,33,1,2,1,117,0)=" F AUPIFN=0:0 S AUPIFN=$O(^DPT(AUPREF,AUPVAL,AUPIFN)) Q:'AUPIFN!(AUPDFN)  S Y=AUPIFN D SETAUP^AUPNLKUT I $S<1000 F AUPI=1:1:AUPNUM-5 Q:'$D(AUPIFNS(AUPI))  K AUPIFNS(AUPI) S AUPBEG=AUPI"
^XTV(8991,33,1,2,1,118,0)=" Q"
^XTV(8991,33,1,2,1,119,0)=" ;"
^XTV(8991,33,1,2,1,120,0)=" ; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -"
^XTV(8991,33,1,2,1,121,0)=" ;"
^XTV(8991,33,1,2,1,122,0)="INIT ; INITIALIZATION - FIX UP AUPX AND SET UP XREFS"
^XTV(8991,33,1,2,1,123,0)=" D ^AUPNLK1I"
^XTV(8991,33,1,2,1,124,0)=" Q"
^XTV(8991,33,1,2,1,125,0)=" ;"
^XTV(8991,33,1,2,1,126,0)=" ; - - - - - - - - - - - - - - - - - - - - - - - - - - - - -"
^XTV(8991,33,1,2,1,127,0)=" ;"
^XTV(8991,33,1,2,1,128,0)="EOJ ;"
^XTV(8991,33,1,2,1,129,0)=" K AUPBEG,AUPDT,AUPI,AUPIFN,AUPIFNS,AUPLP,AUPLK1,AUPNMCHK,AUPNMCV,AUPNMCVN,AUPNMCVT,AUPNMF,AUPNML,AUPNMM,AUPNUM,AUPREF,AUPREFS,AUPVAL"
^XTV(8991,33,1,2,1,130,0)=" Q"
^XTV(8991,33,1,"B",3061226.1044,1)=""
^XTV(8991,33,1,"B",3061226.1052,2)=""
^XTV(8991,34,0)="AUPNLK2"
^XTV(8991,34,1,0)="^8991.01^2^2"
^XTV(8991,34,1,1,0)="3061226.1045"
^XTV(8991,34,1,1,1,0)="^8991.11^100^100"
^XTV(8991,34,1,1,1,1,0)=""
^XTV(8991,34,1,1,1,1,"DEL")="AUPNLK2 ; IHS/CMI/LAB - IHS PATIENT LOOKUP ADD NEW PATIENT ;12/26/06  10:45"
^XTV(8991,34,1,1,1,2,0)=""
^XTV(8991,34,1,1,1,2,"DEL")=" ;;99.1;IHS DICTIONARIES (PATIENT);**167**;MAR 09, 1999;Build 18"
^XTV(8991,34,1,1,1,3,"INS",0)="^8991.12^2^2"
^XTV(8991,34,1,1,1,3,"INS",1,0)="AUPNLK2 ; IHS/CMI/LAB - IHS PATIENT LOOKUP ADD NEW PATIENT ;12/26/06  10:52"
^XTV(8991,34,1,1,1,3,"INS",2,0)=" ;;1.0;PCE PATIENT CARE ENCOUNTER;**167**;Aug 12, 1996;Build 18"
^XTV(8991,34,1,2,0)="3061226.1052"
^XTV(8991,34,1,2,1,0)="^8991.11^100^100"
^XTV(8991,34,1,2,1,1,0)="AUPNLK2 ; IHS/CMI/LAB - IHS PATIENT LOOKUP ADD NEW PATIENT ;12/26/06  10:52"
^XTV(8991,34,1,2,1,2,0)=" ;;1.0;PCE PATIENT CARE ENCOUNTER;**167**;Aug 12, 1996;Build 18"
^XTV(8991,34,1,2,1,3,0)=" ;'Modified' MAS Patient Look-up Add New Patient, June 1987"
^XTV(8991,34,1,2,1,4,0)=" ;"
^XTV(8991,34,1,2,1,5,0)=" ; Upon exiting this routine AUPDFN will be set as follows:"
^XTV(8991,34,1,2,1,6,0)=" ;"
^XTV(8991,34,1,2,1,7,0)=" ;          AUPDFN >0 means patient added and AUPDFN is the DFN"
^XTV(8991,34,1,2,1,8,0)=" ;          AUPDFN <0 means patient not added"
^XTV(8991,34,1,2,1,9,0)=" ;"
^XTV(8991,34,1,2,1,10,0)=" ; AUPQF2 values have the following meaning:"
^XTV(8991,34,1,2,1,11,0)=" ;"
^XTV(8991,34,1,2,1,12,0)=" ;       0 = Initial state"
^XTV(8991,34,1,2,1,13,0)=" ;       1 = Primary error"
^XTV(8991,34,1,2,1,14,0)=" ;       2 = Name edit error"
^XTV(8991,34,1,2,1,15,0)=" ;       3 = Operator said no"
^XTV(8991,34,1,2,1,16,0)=" ;       4 = Identifier failure"
^XTV(8991,34,1,2,1,17,0)=" ;       5 = No add from dupe checker"
^XTV(8991,34,1,2,1,18,0)=" ;       6 = Add failed"
^XTV(8991,34,1,2,1,19,0)=" ;"
^XTV(8991,34,1,2,1,20,0)="START ;"
^XTV(8991,34,1,2,1,21,0)=" D INIT ;                      Initialization"
^XTV(8991,34,1,2,1,22,0)=" I AUPQF2 D EOJ Q"
^XTV(8991,34,1,2,1,23,0)=" D EDIT ;                      Edit the name"
^XTV(8991,34,1,2,1,24,0)=" I AUPQF2 D EOJ Q"
^XTV(8991,34,1,2,1,25,0)=" K AUPLID"
^XTV(8991,34,1,2,1,26,0)=" I DIC(0)[""E"" D TALK ;         Ask if add, get identifiers, check dupes"
^XTV(8991,34,1,2,1,27,0)=" I AUPQF2 D EOJ Q"
^XTV(8991,34,1,2,1,28,0)=" D ADDPAT ;                    Add patient"
^XTV(8991,34,1,2,1,29,0)=" I AUPQF2 D EOJ Q"
^XTV(8991,34,1,2,1,30,0)=" D EOJ"
^XTV(8991,34,1,2,1,31,0)=" Q"
^XTV(8991,34,1,2,1,32,0)=" ; - - - - - - - - - - - - - - - - - - - - - - - - - - - - -"
^XTV(8991,34,1,2,1,33,0)=" ;"
^XTV(8991,34,1,2,1,34,0)="EDIT ; EXTERNAL ENTRY POINT - EDIT NAME"
^XTV(8991,34,1,2,1,35,0)=" S X=AUPX"
^XTV(8991,34,1,2,1,36,0)=" X $P(^DD(2,.01,0),U,5,99)"
^XTV(8991,34,1,2,1,37,0)=" I '$D(X) S AUPQF2=2 W:DIC(0)[""Q"" *7,"" ??"" Q"
^XTV(8991,34,1,2,1,38,0)=" Q"
^XTV(8991,34,1,2,1,39,0)=" ; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -"
^XTV(8991,34,1,2,1,40,0)=" ;"
^XTV(8991,34,1,2,1,41,0)="TALK ; EXTERNAL ENTERY POINT - TALK TO OPERATOR"
^XTV(8991,34,1,2,1,42,0)=" D ^AUPNLK2B"
^XTV(8991,34,1,2,1,43,0)=" Q"
^XTV(8991,34,1,2,1,44,0)=" ; - - - - - - - - - - - - - - - - - - - - - - - - - - - - -"
^XTV(8991,34,1,2,1,45,0)=" ;"
^XTV(8991,34,1,2,1,46,0)="ADDPAT ; ADD PATIENT"
^XTV(8991,34,1,2,1,47,0)=" I $D(AUPLID),DIC(0)[""E"" W !!?3,""Please enter the following additional information:"",!?3"
^XTV(8991,34,1,2,1,48,0)=" K DD,DO S X=AUPX S:$D(AUP(""DR"")) DIC(""DR"")=AUP(""DR"") D FILE^DICN S DIC(""W"")=AUPDICW K:$D(AUP(""DR"")) DIC(""DR"") S AUPDFN=Y"
^XTV(8991,34,1,2,1,49,0)=" I +AUPDFN>0 L +^DPT(+AUPDFN):10 D IHSPAT L -^DPT(+AUPDFN) Q:AUPQF2"
^XTV(8991,34,1,2,1,50,0)=" Q:$T(GOTIDQ^DGLBPID)="""""
^XTV(8991,34,1,2,1,51,0)=" N DFN S DFN=+AUPDFN"
^XTV(8991,34,1,2,1,52,0)=" Q:$$GOTIDQ^DGLBPID(DFN)"
^XTV(8991,34,1,2,1,53,0)=" I $$REQID^DGLBPID(DFN)=""HRN"" D"
^XTV(8991,34,1,2,1,54,0)=" .D HRN^MPIFAG1"
^XTV(8991,34,1,2,1,55,0)=" I $$REQID^DGLBPID(DFN)=""SSN"" D"
^XTV(8991,34,1,2,1,56,0)=" .N DIE,DR,DA S DA=DFN,DIE=2,DR=.09 D ^DIE"
^XTV(8991,34,1,2,1,57,0)=" I '$$GOTIDQ^DGLBPID(DFN) D  S AUPQF2=6"
^XTV(8991,34,1,2,1,58,0)=" .N DA,DIK,DIC S DIK=""^DPT("",DA=DFN D ^DIK W !,""PATIENT DELETED BECAUSE YOU DIDN'T ENTER "",$$REQID^DGLBPID(DFN),!!"
^XTV(8991,34,1,2,1,59,0)=" Q"
^XTV(8991,34,1,2,1,60,0)=" ;"
^XTV(8991,34,1,2,1,61,0)=" ;"
^XTV(8991,34,1,2,1,62,0)=" ;"
^XTV(8991,34,1,2,1,63,0)=" ;"
^XTV(8991,34,1,2,1,64,0)="IHSPAT ; ADD PATIENT TO 9000001"
^XTV(8991,34,1,2,1,65,0)=" K DD,D0"
^XTV(8991,34,1,2,1,66,0)=" F AUPV=""DINUM"",""DIC"",""DIC(""""DR"""")"",""DIC(0)"",""DLAYGO"" S:$D(@AUPV) AUPRCR(AUPV)=@AUPV"
^XTV(8991,34,1,2,1,67,0)=" S X=+AUPDFN,DINUM=X,DIC=""^AUPNPAT("",DIC(0)=""L"",DLAYGO=9000001,DIC(""DR"")="".02////""_DT_"";.11////""_DUZ D FILE^DICN L +^DPT(+AUPDFN):10 S DIC(""W"")=AUPDICW I Y<0 D IHSPATE"
^XTV(8991,34,1,2,1,68,0)=" K DINUM,DIC(""DR""),DIC(0),DLAYGO S AUPV="""" F AUPL=0:0 S AUPV=$O(AUPRCR(AUPV)) Q:AUPV=""""  S @AUPV=AUPRCR(AUPV)"
^XTV(8991,34,1,2,1,69,0)=" K AUPRCR,AUPV"
^XTV(8991,34,1,2,1,70,0)=" Q"
^XTV(8991,34,1,2,1,71,0)=" ;"
^XTV(8991,34,1,2,1,72,0)="IHSPATE ; ERROR ADDING TO 9000001"
^XTV(8991,34,1,2,1,73,0)=" W:AUPRCR(""DIC(0)"")[""Q"" !!?3,""Adding patient to ^AUPNPAT failed.  Patient being removed from ^DPT also."",!"
^XTV(8991,34,1,2,1,74,0)=" S DA=+AUPDFN,DIK=""^DPT("" D ^DIK K DA,DIK"
^XTV(8991,34,1,2,1,75,0)=" S AUPQF2=6"
^XTV(8991,34,1,2,1,76,0)=" Q"
^XTV(8991,34,1,2,1,77,0)=" ;"
^XTV(8991,34,1,2,1,78,0)=" ; - - - - - - - - - - - - - - - - - - - - - - - - - - - - -"
^XTV(8991,34,1,2,1,79,0)=" ;"
^XTV(8991,34,1,2,1,80,0)="INIT ; EXTERNAL ENTRY POINT - INITIALIZATION"
^XTV(8991,34,1,2,1,81,0)=" S AUPQF2=0"
^XTV(8991,34,1,2,1,82,0)=" I '$D(DUZ(0)) W:DIC(0)[""Q"" !?3,*7,""Unable to Add Patient. Your Fileman Access Code is undefined."" S AUPQF2=1 Q"
^XTV(8991,34,1,2,1,83,0)=" D ACCESS K I,X"
^XTV(8991,34,1,2,1,84,0)=" Q:AUPQF2"
^XTV(8991,34,1,2,1,85,0)=" S:'($D(DUZ)#2) DUZ=0 S:DUZ="""" DUZ=0"
^XTV(8991,34,1,2,1,86,0)=" ;  Next line edited to remove reference to file #3; RED"
^XTV(8991,34,1,2,1,87,0)=" I '$D(^VA(200,DUZ)) W:DIC(0)[""Q"" !?3,*7,""Unable to Add Patient.  DUZ is not a valid user."" S AUPQF2=1 Q"
^XTV(8991,34,1,2,1,88,0)=" Q"
^XTV(8991,34,1,2,1,89,0)=" ;"
^XTV(8991,34,1,2,1,90,0)="ACCESS ; CHECK FILEMAN ACCESS"
^XTV(8991,34,1,2,1,91,0)=" S X=$S(AUPDIC=""^DPT("":2,1:9000001)"
^XTV(8991,34,1,2,1,92,0)=" I $S($D(DLAYGO):X-DLAYGO,1:1),DUZ(0)'[""@"",$D(^DIC(X,0,""LAYGO"")) S X=^(""LAYGO"") X ""F I=1:1 I DUZ(0)[$E(X,I) Q"" I I>$L(DUZ(0)) W:DIC(0)[""Q"" !?3,*7,""Unable to Add Patient.  You do not have Add authority."" S AUPQF2=1 Q"
^XTV(8991,34,1,2,1,93,0)=" Q"
^XTV(8991,34,1,2,1,94,0)=" ;"
^XTV(8991,34,1,2,1,95,0)=" ; - - - - - - - - - - - - - - - - - - - - - - - - - - - - -"
^XTV(8991,34,1,2,1,96,0)=" ;"
^XTV(8991,34,1,2,1,97,0)="EOJ ; EXTERNAL ENTRY POINT"
^XTV(8991,34,1,2,1,98,0)=" S:AUPQF2 AUPDFN=-1"
^XTV(8991,34,1,2,1,99,0)=" K AUPGID,AUPID,AUPID0,AUPIDS,AUPLID,AUP(""DR""),AUPQF2,AUPRCR,AUPSET,AUPV"
^XTV(8991,34,1,2,1,100,0)=" Q"
^XTV(8991,34,1,"B",3061226.1045,1)=""
^XTV(8991,34,1,"B",3061226.1052,2)=""
^XTV(8991,35,0)="AUPNLKI"
^XTV(8991,35,1,0)="^8991.01^1^1"
^XTV(8991,35,1,1,0)="3061226.1045"
^XTV(8991,35,1,1,1,0)="^8991.11^39^39"
^XTV(8991,35,1,1,1,1,0)="AUPNLKI ; IHS/CMI/LAB - IHS PATIENT LOOKUP, MAIN ROUTINE INITIALIZATION ;12/26/06  10:45"
^XTV(8991,35,1,1,1,2,0)=" ;;1.0;PCE PATIENT CARE ENCOUNTER;**167**;Aug 12, 1996;Build 18"
^XTV(8991,35,1,1,1,3,0)=" ;patch 5 fm v22"
^XTV(8991,35,1,1,1,4,0)=" ;"
^XTV(8991,35,1,1,1,5,0)="START ; INITIALIZATION"
^XTV(8991,35,1,1,1,6,0)=" S AUPQF=0,AUPDIC=DIC"
^XTV(8991,35,1,1,1,7,0)=" K AUPX,AUPDFN"
^XTV(8991,35,1,1,1,8,0)=" ;"
^XTV(8991,35,1,1,1,9,0)=" I '$D(DIC(0)) S AUPQF=1 Q"
^XTV(8991,35,1,1,1,10,0)=" I DIC(0)'[""A""&('$D(X)) S AUPQF=1 Q"
^XTV(8991,35,1,1,1,11,0)=" I '$D(^DD(""VERSION"")) D:DIC(0)[""E"" EN^DDIOL(""Unable to proceed. Fileman version node ^DD(""""VERSION"""") is undefined."","""",""!!?3"") S AUPQF=1 Q"
^XTV(8991,35,1,1,1,12,0)=" I ^DD(""VERSION"")<17.2 D:DIC(0)[""E"" EN^DDIOL(""Unable to proceed.  Fileman version must be at least 17.2."","""",""!!?3"") S AUPQF=1 Q"
^XTV(8991,35,1,1,1,13,0)=" I '$D(^DPT(0)) D:DIC(0)[""E"" EN^DDIOL(""Unable to proceed.  0th node of ^DPT missing."","""",""!!?3"") S AUPQF=1 Q"
^XTV(8991,35,1,1,1,14,0)=" I '$D(^AUPNPAT(0)) D:DIC(0)[""E"" EN^DDIOL(""Unable to proceed.  0th node of ^AUPNPAT missing."","""",""!!?3"") S AUPQF=1 Q"
^XTV(8991,35,1,1,1,15,0)=" I '$D(DUZ(2)) D:DIC(0)[""E"" EN^DDIOL(""Unable to proceed.  DUZ(2) is undefined."","""",""!!?3"") S AUPQF=1 Q"
^XTV(8991,35,1,1,1,16,0)=" I '$G(DUZ(2)) D:DIC(0)[""E"" EN^DDIOL(""Unable to proceed.  DUZ(2) is NULL."","""",""!!?3"") S AUPQF=1 Q"
^XTV(8991,35,1,1,1,17,0)=" I DUZ(2),'$D(^DIC(4,DUZ(2))) D:DIC(0)[""E"" EN^DDIOL(""Unable to proceed.  DUZ(2) is not a valid Location."","""",""!!?3"") S AUPQF=1 Q"
^XTV(8991,35,1,1,1,18,0)=" ;D:$D(AUPNLK(""ALL"")) SET^AUPNLKZ ; Undocumented feature (UGH!)"
^XTV(8991,35,1,1,1,19,0)=" ;"
^XTV(8991,35,1,1,1,20,0)=" ; - - - - - CHART # SCREEN - - - - -"
^XTV(8991,35,1,1,1,21,0)=" S:$D(DIC(""S""))#2 AUPDICS=DIC(""S"")"
^XTV(8991,35,1,1,1,22,0)="NOTALL I '$G(AUPNLK(""ALL"")) D SETDICS ;**GFT/VW"
^XTV(8991,35,1,1,1,23,0)=" ; - - - - - SETUP DIC(""W"") - - - - -"
^XTV(8991,35,1,1,1,24,0)=" ; ** AUPNLKW overrides identifiers.  Must be set & killed by caller **"
^XTV(8991,35,1,1,1,25,0)=" K DUOUT,DTOUT S DIC=""^DPT("" D DO^DIC1 S DIC(""W"")=$S($D(DIC(""W"")):DIC(""W""),1:"""") S:DIC(""W"")=""W """"   """" D ^AUPNLKID""!(DIC(""W"")="""") DIC(""W"")=$S($D(AUPNLKW):AUPNLKW,1:""D ^AUPNLKID"")"
^XTV(8991,35,1,1,1,26,0)=" K AUPNLK(""DICW"")"
^XTV(8991,35,1,1,1,27,0)=" S:$L(DIC(""W""))>110 AUPNLK(""DICW"")=DIC(""W"")"
^XTV(8991,35,1,1,1,28,0)=" S DIC(""W"")=""D IHSDUPE^AUPNLKID ""_$S($D(AUPNLK(""DICW"")):""X AUPNLK(""""DICW"""")"",1:DIC(""W""))"
^XTV(8991,35,1,1,1,29,0)=" S DIC(""W"")=DIC(""W"")_"" N DA,X S DA=Y X $P(^DD(2,.081,0),U,5,99) D:$G(X) EN^DDIOL(""""<Unresolved potential duplicate>"""","""""""",""""!?10"""") W @(""""$E(""""_DIC_""""Y,0),0)"""")"" ;**GFT/VW"
^XTV(8991,35,1,1,1,30,0)=" S DIC(""W"")=DIC(""W"")_"" I $D(AUPMAPY) S Y=AUPMAPY K AUPMAPY"""
^XTV(8991,35,1,1,1,31,0)=" S AUPDICW=DIC(""W"")"
^XTV(8991,35,1,1,1,32,0)=" Q"
^XTV(8991,35,1,1,1,33,0)=" ;"
^XTV(8991,35,1,1,1,34,0)="SETDICS ;SET DIC(""S"") NODES"
^XTV(8991,35,1,1,1,35,0)=" ;S DIC(""S"",""IHSORIG"")=$S($D(DIC(""S"")):DIC(""S""),1:""I 1"")"
^XTV(8991,35,1,1,1,36,0)=" S AUPNORIG=$S($D(DIC(""S"")):DIC(""S""),1:""I 1"")  ;IHS/ANMC/CLS 09/13/2000 fm v22"
^XTV(8991,35,1,1,1,37,0)=" ;S DIC(""S"",""IHSLOOK"")=""I $D(^AUPNPAT(Y,41,DUZ(2),0))""_$S('$D(AUPNLK(""INAC"")):"",""_""$P(^(0),U,3)="""""""""",1:""""),DIC(""S"")=""X DIC(""""S"""",""""IHSORIG"""") I $T X DIC(""""S"""",""""IHSLOOK"""")"""
^XTV(8991,35,1,1,1,38,0)=" S AUPNLOOK=""I $D(^AUPNPAT(Y,41,DUZ(2),0))""_$S('$D(AUPNLK(""INAC"")):"",""_""$P(^(0),U,3)="""""""""",1:""""),DIC(""S"")=""X AUPNORIG I $T X AUPNLOOK""  ;IHS/ANMC/CLS 09/13/2000 fm v22"
^XTV(8991,35,1,1,1,39,0)=" Q"
^XTV(8991,35,1,"B",3061226.1045,1)=""
^XTV(8991,36,0)="AUPNLKID"
^XTV(8991,36,1,0)="^8991.01^2^2"
^XTV(8991,36,1,1,0)="3061226.1047"
^XTV(8991,36,1,1,1,0)="^8991.11^46^46"
^XTV(8991,36,1,1,1,1,0)=""
^XTV(8991,36,1,1,1,1,"DEL")="AUPNLKID ; IHS/CMI/LAB - IHS IDENTIFIERS FOR FILE 2 ;12/26/06  10:47"
^XTV(8991,36,1,1,1,2,0)=""
^XTV(8991,36,1,1,1,2,"DEL")=" ;;1.0;PCE PATIENT CARE ENCOUNTER;**167**;JUN 13, 2003;Build 18"
^XTV(8991,36,1,1,1,3,"INS",0)="^8991.12^2^2"
^XTV(8991,36,1,1,1,3,"INS",1,0)="AUPNLKID ; IHS/CMI/LAB - IHS IDENTIFIERS FOR FILE 2 ;12/26/06  10:53"
^XTV(8991,36,1,1,1,3,"INS",2,0)=" ;;1.0;PCE PATIENT CARE ENCOUNTER;**167**;Aug 12, 1996"
^XTV(8991,36,1,2,0)="3061226.1053"
^XTV(8991,36,1,2,1,0)="^8991.11^46^46"
^XTV(8991,36,1,2,1,1,0)="AUPNLKID ; IHS/CMI/LAB - IHS IDENTIFIERS FOR FILE 2 ;12/26/06  10:53"
^XTV(8991,36,1,2,1,2,0)=" ;;1.0;PCE PATIENT CARE ENCOUNTER;**167**;Aug 12, 1996"
^XTV(8991,36,1,2,1,3,0)=" ;"
^XTV(8991,36,1,2,1,4,0)="START ; EXTERNAL ENTRY POINT - "
^XTV(8991,36,1,2,1,5,0)=" D:$X>43 EN^DDIOL("""","""",""!"") ;Y2000"
^XTV(8991,36,1,2,1,6,0)=" ; VALUE OF THE NAKED INDICATOR TO BE PROVIDED BY CALLING ROUTINE"
^XTV(8991,36,1,2,1,7,0)=" ;I $D(DIQUIET) S ^TMP(""DILIST"",$J,""IHS"",DICOUNT)=$P(^(0),U,2)_"" ""_$E($P(^(0),U,3),4,5)_""-""_$E($P(^(0),U,3),6,7)_""-""_$E($P(^(0),U,3),2,3)_"" ""_$J($P(^(0),U,9),9) ;IHS/ANMC/LJF 8/7/97 added for Kernel Broker calls-see ^XWBFM ;Y2000"
^XTV(8991,36,1,2,1,8,0)=" I $D(DIQUIET) S ^TMP(""DILIST"",$J,""IHS"",DICOUNT)=$P(^(0),U,2)_"" ""_$E($P(^(0),U,3),4,5)_""-""_$E($P(^(0),U,3),6,7)_""-""_(1700+$E($P(^(0),U,3),1,3))_"" ""_$J($P(^(0),U,9),9) ;Y2000"
^XTV(8991,36,1,2,1,9,0)=" ;K AUPNA I '$D(DIQUIET) NEW % S %=$P(^(0),U,2)_"" ""_$E($P(^(0),U,3),4,5)_""-""_$E($P(^(0),U,3),6,7)_""-""_$E($P(^(0),U,3),2,3)_"" ""_$J($P(^(0),U,9),9) S AUPNA(1)=%,AUPNA(1,""F"")=""?45"" ;Y2000 commented out and replaced with line below "
^XTV(8991,36,1,2,1,10,0)=" K AUPNA I '$D(DIQUIET) NEW % S %=$P(^(0),U,2)_"" ""_$E($P(^(0),U,3),4,5)_""-""_$E($P(^(0),U,3),6,7)_""-""_(1700+$E($P(^(0),U,3),1,3))_"" ""_$J($P(^(0),U,9),9) S AUPNA(1)=%,AUPNA(1,""F"")=""?43"" ;Y2000 - display 4 digit year"
^XTV(8991,36,1,2,1,11,0)=" ;end Y2K for display of  4 digit DOB"
^XTV(8991,36,1,2,1,12,0)=" I '$D(DIQUIET) S AUPNA(1)=$$CWAD(Y)_AUPNA(1),AUPNA(1,""F"")=""?37"""
^XTV(8991,36,1,2,1,13,0)="NOTALL I '$G(AUPNLK(""ALL"")),$G(DUZ(2)),'$D(DIQUIET),$D(^AUPNPAT(Y,41,DUZ(2),0)) NEW % S %="" ""_$J($P(^AUTTLOC(DUZ(2),0),U,7),4)_"" ""_$P(^AUPNPAT(Y,41,DUZ(2),0),U,2) S AUPNA(1)=AUPNA(1)_"" ""_%"
^XTV(8991,36,1,2,1,14,0)="ALL I $G(AUPNLK(""ALL"")),$D(^AUPNPAT(Y,41)) D CHARTS"
^XTV(8991,36,1,2,1,15,0)=" S:$D(DDS) DDSID=1 D EN^DDIOL(.AUPNA) K AUPNA,DDSID"
^XTV(8991,36,1,2,1,16,0)=" I @(DIC_""Y,0)"") ; reset the naked"
^XTV(8991,36,1,2,1,17,0)=" Q"
^XTV(8991,36,1,2,1,18,0)=" ;"
^XTV(8991,36,1,2,1,19,0)="CHARTS ;"
^XTV(8991,36,1,2,1,20,0)=" N C,%,TAB S AUPNLKF=0"
^XTV(8991,36,1,2,1,21,0)=" S C=1 F AUPNLKI=0:1 S AUPNLKF=$O(^AUPNPAT(Y,41,AUPNLKF)) Q:AUPNLKF'=+AUPNLKF  D"
^XTV(8991,36,1,2,1,22,0)=" .I AUPNLKI S C=C+1"
^XTV(8991,36,1,2,1,23,0)=" .S %=$J($P(^AUTTLOC(AUPNLKF,0),U,7),4)_"" ""_$P(^AUPNPAT(Y,41,AUPNLKF,0),U,2)_$S($P(^(0),U,3)="""":"""",1:""(""_$P(^(0),U,5)_"")"")"
^XTV(8991,36,1,2,1,24,0)=" .S TAB=66 I $L($G(AUPNA(C)))+$L(%)>42 S C=C+1,TAB=79-$L(%)"
^XTV(8991,36,1,2,1,25,0)=" .S:'$D(AUPNA(C)) AUPNA(C)="""""
^XTV(8991,36,1,2,1,26,0)=" .S AUPNA(C)=AUPNA(C)_"" ""_% S:'$D(AUPNA(C,""F"")) AUPNA(C,""F"")=""!?""_TAB"
^XTV(8991,36,1,2,1,27,0)=" K AUPNLKF,AUPNLKI"
^XTV(8991,36,1,2,1,28,0)=" Q"
^XTV(8991,36,1,2,1,29,0)=" ;"
^XTV(8991,36,1,2,1,30,0)=" ;"
^XTV(8991,36,1,2,1,31,0)=" ;"
^XTV(8991,36,1,2,1,32,0)=" ;"
^XTV(8991,36,1,2,1,33,0)="IHSDUPE ; EXTERNAL ENTRY PONT - FOLLOW MERGE CHAIN"
^XTV(8991,36,1,2,1,34,0)=" ; VALUE OF THE NAKED INDICATOR TO BE PROVIDED BY CALLING ROUTINE"
^XTV(8991,36,1,2,1,35,0)=" F AUPLKL=0:0 Q:'$P(^(0),U,19)  S AUPMAP=$P(^(0),U,19) D EN^DDIOL(""<Merged to ""_$P(^DPT(AUPMAP,0),U,1)_"">"","""",""!?10"") ; Will abort if no ^DPT entry"
^XTV(8991,36,1,2,1,36,0)=" K AUPLKL"
^XTV(8991,36,1,2,1,37,0)=" I $D(AUPMAP) S AUPMAPY=Y,Y=AUPMAP K AUPMAP"
^XTV(8991,36,1,2,1,38,0)=" I @(DIC_""Y,0)"") ; reset the naked"
^XTV(8991,36,1,2,1,39,0)=" Q"
^XTV(8991,36,1,2,1,40,0)=" ;"
^XTV(8991,36,1,2,1,41,0)="CWAD(Y) ; -- returns cwad initials;IHS/ANMC/LJF 5/26/98"
^XTV(8991,36,1,2,1,42,0)=" NEW X,DFN,GMRPCWAD"
^XTV(8991,36,1,2,1,43,0)=" S X=""GMRPNOR1"" X ^%ZOSF(""TEST"") I '$T Q ""       """
^XTV(8991,36,1,2,1,44,0)=" S X=$$CWAD^GMRPNOR1(+Y) I '$L(X) Q ""       """
^XTV(8991,36,1,2,1,45,0)=" S X=""<""_X_"">"",X=$E(X_""    "",1,7)"
^XTV(8991,36,1,2,1,46,0)=" Q X"
^XTV(8991,36,1,"B",3061226.1047,1)=""
^XTV(8991,36,1,"B",3061226.1053,2)=""
^XTV(8991,37,0)="AUPNLKUT"
^XTV(8991,37,1,0)="^8991.01^3^3"
^XTV(8991,37,1,1,0)="3061226.1048"
^XTV(8991,37,1,1,1,0)="^8991.11^28^28"
^XTV(8991,37,1,1,1,1,0)=""
^XTV(8991,37,1,1,1,1,"DEL")="AUPNLKUT ; IHS/CMI/LAB - IHS PATIENT LOOKUP, COMMON FUNCTIONS ;12/26/06  10:48"
^XTV(8991,37,1,1,1,2,0)=""
^XTV(8991,37,1,1,1,2,"DEL")=" ;;1.0;PCE PATIENT CARE ENCOUNTER;**167**;MAR 09, 1999;Build 18"
^XTV(8991,37,1,1,1,3,"INS",0)="^8991.12^2^2"
^XTV(8991,37,1,1,1,3,"INS",1,0)="AUPNLKUT ; IHS/CMI/LAB - IHS PATIENT LOOKUP, COMMON FUNCTIONS ;12/26/06  10:54"
^XTV(8991,37,1,1,1,3,"INS",2,0)=" ;;1.0;PCE PATIENT CARE ENCOUNTER;**167**;Aug 12, 1996"
^XTV(8991,37,1,2,0)="3061226.1054"
^XTV(8991,37,1,2,1,0)="^8991.11^28^28"
^XTV(8991,37,1,2,1,1,0)=""
^XTV(8991,37,1,2,1,1,"DEL")="AUPNLKUT ; IHS/CMI/LAB - IHS PATIENT LOOKUP, COMMON FUNCTIONS ;12/26/06  10:54"
^XTV(8991,37,1,2,1,2,"INS",0)="^8991.12^1^1"
^XTV(8991,37,1,2,1,2,"INS",1,0)="AUPNLKUT ; IHS/CMI/LAB - IHS PATIENT LOOKUP, COMMON FUNCTIONS ;12/26/06  11:02"
^XTV(8991,37,1,2,1,22,0)=""
^XTV(8991,37,1,2,1,22,"DEL")=" ;"
^XTV(8991,37,1,2,1,23,0)=""
^XTV(8991,37,1,2,1,23,"DEL")=" ;"
^XTV(8991,37,1,2,1,24,0)=""
^XTV(8991,37,1,2,1,24,"DEL")=" ;"
^XTV(8991,37,1,2,1,25,0)=""
^XTV(8991,37,1,2,1,25,"DEL")="ENALL ;RE-INDEX PHONE NUMBER (KIDS POST-INSTALL)"
^XTV(8991,37,1,2,1,26,0)=""
^XTV(8991,37,1,2,1,26,"DEL")=" K ^DPT(""AZVWVOE"")"
^XTV(8991,37,1,2,1,27,0)=""
^XTV(8991,37,1,2,1,27,"DEL")=" N DIK S DIK=""^DPT("",DIK(1)="".131^251000"" D ENALL^DIK"
^XTV(8991,37,1,2,1,28,0)=""
^XTV(8991,37,1,2,1,28,"DEL")=" Q"
^XTV(8991,37,1,3,0)="3061226.1102"
^XTV(8991,37,1,3,1,0)="^8991.11^21^21"
^XTV(8991,37,1,3,1,1,0)="AUPNLKUT ; IHS/CMI/LAB - IHS PATIENT LOOKUP, COMMON FUNCTIONS ;12/26/06  11:02"
^XTV(8991,37,1,3,1,2,0)=" ;;1.0;PCE PATIENT CARE ENCOUNTER;**167**;Aug 12, 1996"
^XTV(8991,37,1,3,1,3,0)=" ;"
^XTV(8991,37,1,3,1,4,0)=" ; - - - - - - - - - - - - - - - - - - - - - - - - - - - - -"
^XTV(8991,37,1,3,1,5,0)=" ;"
^XTV(8991,37,1,3,1,6,0)="SETAUP ; EP -EXTERNAL ENTRY POINT"
^XTV(8991,37,1,3,1,7,0)=" Q:'$D(^DPT(Y,0))!($D(AUPS(Y))&(DIC(0)'[""C""))"
^XTV(8991,37,1,3,1,8,0)=" S X=AUPX I 1 X:$D(DIC(""S"")) DIC(""S"") Q:'$T  ;X:($D(DO(""SCR""))) DO(""SCR"") Q:'$T  ; ** ignore master screen **"
^XTV(8991,37,1,3,1,9,0)=" S AUPCNT=AUPCNT+1,AUPLNE=$S($D(DDS):3,1:5),AUPS(Y)=$P(^DPT(Y,0),U)_U_$S($D(AUPVAL):AUPVAL,1:AUPX),AUPIFNS(AUPCNT)=Y S:$D(AUPNMCVN) AUPNICK(Y)="""" I '(AUPCNT#AUPLNE),DIC(0)[""E"" D PRTAUP"
^XTV(8991,37,1,3,1,10,0)=" K AUPLNE"
^XTV(8991,37,1,3,1,11,0)=" Q"
^XTV(8991,37,1,3,1,12,0)=" ; - - - - - - - - - - - - - - - - - - - - - - - - - - - - -"
^XTV(8991,37,1,3,1,13,0)=" ;"
^XTV(8991,37,1,3,1,14,0)="PRTAUP ; EP - EXTERNAL ENTRY POINT"
^XTV(8991,37,1,3,1,15,0)=" F AUPNUM=AUPNUM+1:1:AUPCNT S (AUPIFN,Y)=+AUPIFNS(AUPNUM) D"
^XTV(8991,37,1,3,1,16,0)=" .N AUPNL I $P(AUPS(AUPIFN),U)'=$P(AUPS(AUPIFN),U,2) S AUPNL=$P(AUPS(AUPIFN),U,2) I $G(AUPX),AUPNL=$G(AUPDT),AUPNL?7N S AUPNL=AUPX ;ECHO DOB CORRECTLY"
^XTV(8991,37,1,3,1,17,0)=" .D EN^DDIOL(AUPNUM_""  ""_$G(AUPNL)_""  ""_$P(AUPS(AUPIFN),U),"""",""!?3"")"
^XTV(8991,37,1,3,1,18,0)=" .X:$D(^DPT(AUPIFN,0)) DIC(""W"")"
^XTV(8991,37,1,3,1,19,0)=" D:'$D(AUP(""NOPRT^"")) EN^DDIOL(""ENTER '^' TO STOP, OR"","""",""!"") D EN^DDIOL(""CHOOSE ""_AUPBEG_""-""_AUPNUM_"": "","""",""!"") R X:DTIME S:X?.E1C.E X=""^"" S AUPSEL=X S:'$T AUPSEL=AUPX,DTOUT=1 Q:AUPSEL="""""
^XTV(8991,37,1,3,1,20,0)=" S AUPDFN=$S(AUPSEL'?.ANP!($L(AUPSEL)>30):-1,'$D(AUPIFNS(AUPSEL)):-1,$D(AUPS(+AUPIFNS(AUPSEL))):+AUPIFNS(AUPSEL),1:-1),AUPX=$S(AUPDFN<0:AUPSEL,1:AUPX)"
^XTV(8991,37,1,3,1,21,0)=" Q"
^XTV(8991,37,1,"B",3061226.1048,1)=""
^XTV(8991,37,1,"B",3061226.1054,2)=""
^XTV(8991,37,1,"B",3061226.1102,3)=""
^XTV(8991,38,0)="DBAFOIA"
^XTV(8991,38,1,0)="^8991.01^1^1"
^XTV(8991,38,1,1,0)="3061226.183"
^XTV(8991,38,1,1,1,0)="^8991.11^294^294"
^XTV(8991,38,1,1,1,1,0)="DBAFOIA ; ;12/26/06  18:30"
^XTV(8991,38,1,1,1,2,0)=" ;;2.0;"
^XTV(8991,38,1,1,1,3,0)=" D ZAPFOIA ; Zap non-foia stuff"
^XTV(8991,38,1,1,1,4,0)=" Q"
^XTV(8991,38,1,1,1,5,0)=" ;"
^XTV(8991,38,1,1,1,6,0)=" ;In Platinum account:"
^XTV(8991,38,1,1,1,7,0)=" ;"
^XTV(8991,38,1,1,1,8,0)=" ;Preparation sequence:"
^XTV(8991,38,1,1,1,9,0)=" ;From Platinum account -"
^XTV(8991,38,1,1,1,10,0)=" ; use %RO"
^XTV(8991,38,1,1,1,11,0)=" ;  select *, %Z*.INT, %DT*.INT, %RCR.INT, %XUCI.INT, 'CJS*.*.*, '%ZC*, '%ZD*, '%ZHALT.*.*, '%ZL*.*.*,'%ZE*.*.*,'%ZF*.*.*,'%ZG*.*.*,'%ZS*.*.*,'%ZW*.*.*"
^XTV(8991,38,1,1,1,12,0)=" ;  w Exporer:  *;%Z*.INT;%DT*.INT;%RCR.INT;%XUCI.INT;'CJS*.*.*;'%ZHALT.*.*;'%ZL*.*.*"
^XTV(8991,38,1,1,1,13,0)=" ; use %GOF"
^XTV(8991,38,1,1,1,14,0)=" ;  select *, 'ERRORS, 'ROUTINE, 'mtemp, 'mtemp1, 'rOBJ, '%Z*, 'Cache*, 'UTILITY, 'TMP, 'XTMP"
^XTV(8991,38,1,1,1,15,0)=" ;"
^XTV(8991,38,1,1,1,16,0)=" ; Check/Fix DD links"
^XTV(8991,38,1,1,1,17,0)=" ; D ^%ZZGCTRL on ^XPD(0) to identify control characters to eliminate"
^XTV(8991,38,1,1,1,18,0)=" ;Save all routines (-ZZAPFOIA) & EXCLUDE:"
^XTV(8991,38,1,1,1,19,0)=" ;*"
^XTV(8991,38,1,1,1,20,0)=" ;'%*"
^XTV(8991,38,1,1,1,21,0)=" ;'XUCI*"
^XTV(8991,38,1,1,1,22,0)=" ;'ZI*"
^XTV(8991,38,1,1,1,23,0)=" ;'ZO*"
^XTV(8991,38,1,1,1,24,0)=" ;  'ZT* <-- HAND REMOVE THESE BUT KEEP THESE: ZTMB, ZTMCHK, ZTMCHK1, ZTMKU, ZTMON, ZTMON1"
^XTV(8991,38,1,1,1,25,0)=" ;'ZU"
^XTV(8991,38,1,1,1,26,0)=" ;'ZZ*"
^XTV(8991,38,1,1,1,27,0)=" ;   cut & paste:"
^XTV(8991,38,1,1,1,28,0)=" ;   *;'%*;'XUCI*;'ZI*;'ZO*;'ZU;'ZZ*;'CJS* ... then 'ZT's by hand"
^XTV(8991,38,1,1,1,29,0)=" ; save to VAH.rtn in MSM format."
^XTV(8991,38,1,1,1,30,0)=" ;"
^XTV(8991,38,1,1,1,31,0)=" ;and globals (-ICD0, -ICD9, -LEX*, -PSNDF, -PSPPI, -RGED, -TMP, -XTMP, -XUTL, -UTILITY) to non-FOIA files"
^XTV(8991,38,1,1,1,32,0)=" ;(can use ^%GOMSM with paramers: ""WNV"")"
^XTV(8991,38,1,1,1,33,0)=" ;'%Z*"
^XTV(8991,38,1,1,1,34,0)=" ;'mtemp*"
^XTV(8991,38,1,1,1,35,0)=" ;'ERRORS"
^XTV(8991,38,1,1,1,36,0)=" ;'ROUTINE"
^XTV(8991,38,1,1,1,37,0)=" ;'rOBJ"
^XTV(8991,38,1,1,1,38,0)=" ;   cut & paste:"
^XTV(8991,38,1,1,1,39,0)=" ;   *;'%Z*;'mtemp*;'ERRORS;'ROUTINE;'rOBJ;'ICD0;'ICD9;'LEX*;'PSNDF;'PSPPI;'RGED;'TMP;'XTMP;'XUTL;'UTILITY"
^XTV(8991,38,1,1,1,40,0)=" ;  save to VAH.gbl in MSM format."
^XTV(8991,38,1,1,1,41,0)=" ;  for non-FOIA Platinum set"
^XTV(8991,38,1,1,1,42,0)=" ;"
^XTV(8991,38,1,1,1,43,0)=" ;"
^XTV(8991,38,1,1,1,44,0)=" ; For Krn8.mgr"
^XTV(8991,38,1,1,1,45,0)=" ;  save %DT*.INT, %RCR.INT, %XUCI.INT, %Z*.INT"
^XTV(8991,38,1,1,1,46,0)=" ;   (-%ZC* if MSM, '%ZHALT, '%ZD* and '%ZL* if Cache), Z*.INT, 'ZU*.INT, XUCI*.INT"
^XTV(8991,38,1,1,1,47,0)=" ;   cut & paste:"
^XTV(8991,38,1,1,1,48,0)=" ;     %DT*.INT;%RCR.INT;%XUCI.INT;%Z*.INT;XUCI*.INT;Z*.INT;'%ZHALT.INT;'ZU*.INT;'ZZAPFOIA.INT"
^XTV(8991,38,1,1,1,49,0)=" ;  to Krn8.mgr \VistA\Software\Kernel"
^XTV(8991,38,1,1,1,50,0)=" ;"
^XTV(8991,38,1,1,1,51,0)=" ;For KIDS8.RTN save the following to VistA\Software\Kernel\:"
^XTV(8991,38,1,1,1,52,0)=" ; XLFDT"
^XTV(8991,38,1,1,1,53,0)=" ; XLFDT1"
^XTV(8991,38,1,1,1,54,0)=" ; XLFDT2"
^XTV(8991,38,1,1,1,55,0)=" ; XLFDT3"
^XTV(8991,38,1,1,1,56,0)=" ; XLFDT4"
^XTV(8991,38,1,1,1,57,0)=" ; XPD*"
^XTV(8991,38,1,1,1,58,0)=" ; ..."
^XTV(8991,38,1,1,1,59,0)=" ; XQDATE"
^XTV(8991,38,1,1,1,60,0)=" ; XQH"
^XTV(8991,38,1,1,1,61,0)=" ; XQOO"
^XTV(8991,38,1,1,1,62,0)=" ; XQOO1"
^XTV(8991,38,1,1,1,63,0)=" ; XQOO2"
^XTV(8991,38,1,1,1,64,0)=" ; XQOO3"
^XTV(8991,38,1,1,1,65,0)=" ;"
^XTV(8991,38,1,1,1,66,0)=" ; Test import into D:\MSMPC\Platinum.msm"
^XTV(8991,38,1,1,1,67,0)=" ; Copy Platinum.msm to desk PC E:\MSMPC\"
^XTV(8991,38,1,1,1,68,0)=" ; In E:\MSMPC\"
^XTV(8991,38,1,1,1,69,0)=" ; load FOIA XUSHSH* & D ^ZZAPFOIA"
^XTV(8991,38,1,1,1,70,0)=" ; Check/Fix DD links"
^XTV(8991,38,1,1,1,71,0)=" ; Save all routines (-ZZAPFOIA) & EXCLUDE:"
^XTV(8991,38,1,1,1,72,0)=" ;'XUCI*"
^XTV(8991,38,1,1,1,73,0)=" ;'ZI*"
^XTV(8991,38,1,1,1,74,0)=" ;'ZO*"
^XTV(8991,38,1,1,1,75,0)=" ;  'ZT* <-- HAND REMOVE THESE BUT KEEP THESE: ZTMB, ZTMCHK, ZTMCHK1, ZTMKU, ZTMON, ZTMON1"
^XTV(8991,38,1,1,1,76,0)=" ;'ZU"
^XTV(8991,38,1,1,1,77,0)=" ;'ZZ*"
^XTV(8991,38,1,1,1,78,0)=" ;   cut & paste:"
^XTV(8991,38,1,1,1,79,0)=" ;   *;'%*;'XUCI*;'ZI*;'ZO*;'ZU;'ZZ* ... then 'ZT's by hand"
^XTV(8991,38,1,1,1,80,0)=" ; save to FOIAVAH.rtn in MSM format to VistA\Software\"
^XTV(8991,38,1,1,1,81,0)=" ; and all globals (-ICD0, -ICD9, -LEX*, -PSNDF, -PSPPI, -TMP, -XTMP, -XUTL, -UTILITY) to FOIA files"
^XTV(8991,38,1,1,1,82,0)=" ;'%Z*"
^XTV(8991,38,1,1,1,83,0)=" ;'mtemp*"
^XTV(8991,38,1,1,1,84,0)=" ;'ERRORS"
^XTV(8991,38,1,1,1,85,0)=" ;'ROUTINE"
^XTV(8991,38,1,1,1,86,0)=" ;'rOBJ"
^XTV(8991,38,1,1,1,87,0)=" ; to FOIAVAH.GBL in MSM format to VistA\Software\"
^XTV(8991,38,1,1,1,88,0)=" ;"
^XTV(8991,38,1,1,1,89,0)=" ; Test import of FOIA into D:\MSM\"
^XTV(8991,38,1,1,1,90,0)=" ; recopy D:\MSMPC\Platinum.msm to E:\MSMPC\"
^XTV(8991,38,1,1,1,91,0)=" ;"
^XTV(8991,38,1,1,1,92,0)=" ; make builds, & test each:"
^XTV(8991,38,1,1,1,93,0)=" ; Save DI*, DD*, DM* to FM22.rtn"
^XTV(8991,38,1,1,1,94,0)=" ; save builds for Kernel_8_FOIA.kid, Ktk7_3.kid, Mail_7_1.kid,"
^XTV(8991,38,1,1,1,95,0)=" ;  also HL_1_6.kid, VALM_1.kid, XWB_1_1.kid"
^XTV(8991,38,1,1,1,96,0)=" ; use COMPARE builds for KERNEL, TOOLKIT, & MAILMAN respectively, rollup patches first"
^XTV(8991,38,1,1,1,97,0)=" ;  check for straglers at ^XPD(9.6,D0,4,D1,2,0)"
^XTV(8991,38,1,1,1,98,0)=" ; D0=1013,1030,4380,1049,1796, D1="""" and load FOIA XUSHSH* first"
^XTV(8991,38,1,1,1,99,0)=" ;  to VistA\Software\Kernel\"
^XTV(8991,38,1,1,1,100,0)=" ;"
^XTV(8991,38,1,1,1,101,0)=" ;"
^XTV(8991,38,1,1,1,102,0)=" ; Do import test and review of Kernel builds into E:\Cachesys\mgr\vah\cache.dat 288M ""VAH"""
^XTV(8991,38,1,1,1,103,0)=" ;"
^XTV(8991,38,1,1,1,104,0)=" ; Recopy 440M MSM file from notebook to desk PC"
^XTV(8991,38,1,1,1,105,0)=" ; Recopy 400M Cache file from notebook to desk PC"
^XTV(8991,38,1,1,1,106,0)=" ; edit Readme files"
^XTV(8991,38,1,1,1,107,0)=" ; ZIP and exchange new copies"
^XTV(8991,38,1,1,1,108,0)=" ;"
^XTV(8991,38,1,1,1,109,0)=" ;Protection RWD for %ZUA, %ZIS, %ZTER, %ZISL, %ZTSK, %ZUT, %ZTSCH"
^XTV(8991,38,1,1,1,110,0)=" ;edit Taskman Site Parameters"
^XTV(8991,38,1,1,1,111,0)=" ; Example for MSM with two volume sets"
^XTV(8991,38,1,1,1,112,0)=" ; Select UCI ASSOCIATION FROM UCI:"
^XTV(8991,38,1,1,1,113,0)=" ; NUMBER: 1                               FROM UCI: VAH"
^XTV(8991,38,1,1,1,114,0)=" ;   FROM VOLUME SET (FREE TEXT): TIS      FROM VOLUME SET: TIS"
^XTV(8991,38,1,1,1,115,0)=" ; NUMBER: 2                               FROM UCI: MGR"
^XTV(8991,38,1,1,1,116,0)=" ;   FROM VOLUME SET (FREE TEXT): CJS      FROM VOLUME SET: CJS"
^XTV(8991,38,1,1,1,117,0)=" ; "
^XTV(8991,38,1,1,1,118,0)=" ; Select VOLUME SET:"
^XTV(8991,38,1,1,1,119,0)=" ; VOLUME SET: CJS                         INHIBIT LOGONS?: NO"
^XTV(8991,38,1,1,1,120,0)=" ;   LINK ACCESS?: YES                     OUT OF SERVICE?: NO"
^XTV(8991,38,1,1,1,121,0)=" ;   REQUIRED VOLUME SET?: YES             TASKMAN FILES UCI: MGR"
^XTV(8991,38,1,1,1,122,0)=" ;   DAYS TO KEEP OLD TASKS: 4             TYPE: GENERAL PURPOSE VOLUME SET"
^XTV(8991,38,1,1,1,123,0)=" ;   SIGNON/PRODUCTION VOLUME SET: No"
^XTV(8991,38,1,1,1,124,0)=" ; VOLUME SET: TIS                         INHIBIT LOGONS?: NO"
^XTV(8991,38,1,1,1,125,0)=" ;   LINK ACCESS?: YES                     OUT OF SERVICE?: NO"
^XTV(8991,38,1,1,1,126,0)=" ;   REQUIRED VOLUME SET?: YES             TASKMAN FILES UCI: MGR"
^XTV(8991,38,1,1,1,127,0)=" ;   TASKMAN FILES VOLUME SET: CJS         DAYS TO KEEP OLD TASKS: 4"
^XTV(8991,38,1,1,1,128,0)=" ;   TYPE: GENERAL PURPOSE VOLUME SET      SIGNON/PRODUCTION VOLUME SET: Yes"
^XTV(8991,38,1,1,1,129,0)=" ; "
^XTV(8991,38,1,1,1,130,0)=" ; Select TASKMAN SITE PARAMETERS BOX-VOLUME PAIR:"
^XTV(8991,38,1,1,1,131,0)=" ; BOX-VOLUME PAIR: CJS                    LOG TASKS?: NO"
^XTV(8991,38,1,1,1,132,0)=" ;   DEFAULT TASK PRIORITY: 4              SUBMANAGER RETENTION TIME: 10"
^XTV(8991,38,1,1,1,133,0)=" ;   TASKMAN JOB LIMIT: 8                  TASKMAN HANG BETWEEN NEW JOBS: 1"
^XTV(8991,38,1,1,1,134,0)=" ;   MODE OF TASKMAN: GENERAL PROCESSOR    OUT OF SERVICE: NO"
^XTV(8991,38,1,1,1,135,0)=" ; BOX-VOLUME PAIR: TIS                    LOG TASKS?: NO"
^XTV(8991,38,1,1,1,136,0)=" ;   DEFAULT TASK PRIORITY: 4              SUBMANAGER RETENTION TIME: 10"
^XTV(8991,38,1,1,1,137,0)=" ;   TASKMAN JOB LIMIT: 8                  TASKMAN HANG BETWEEN NEW JOBS: 1"
^XTV(8991,38,1,1,1,138,0)=" ;   MODE OF TASKMAN: GENERAL PROCESSOR    OUT OF SERVICE: NO"
^XTV(8991,38,1,1,1,139,0)=" ; "
^XTV(8991,38,1,1,1,140,0)=" ; Check ^%ZOSF(""MGR"") to match $ZU(0) from MGR account."
^XTV(8991,38,1,1,1,141,0)=" ;"
^XTV(8991,38,1,1,1,142,0)="ZAPFOIA S U=""^"" I $D(DTIME)=0 D ^XUP"
^XTV(8991,38,1,1,1,143,0)="INTRO W !,?10,""This program allows you to remove the following elements for non-FOIA"""
^XTV(8991,38,1,1,1,144,0)=" w !,?5,""packages:  DDs, options, templates, list manager templates, help frames,"""
^XTV(8991,38,1,1,1,145,0)=" w !,?5,""bulletins, protocols, security keys, functions, routines, entries in the"""
^XTV(8991,38,1,1,1,146,0)=" w !,?5,""package file, and clean up dangling pointers in the option and help frame"""
^XTV(8991,38,1,1,1,147,0)=" w !,?5,""files."""
^XTV(8991,38,1,1,1,148,0)="ZAPMGR ;SCRUB % GLOBALS"
^XTV(8991,38,1,1,1,149,0)="ERRLOG ;"
^XTV(8991,38,1,1,1,150,0)=" K ^%ZTER(1)"
^XTV(8991,38,1,1,1,151,0)=" S ^%ZTER(1,0)=""ERROR LOG^3.075"""
^XTV(8991,38,1,1,1,152,0)="TASKMAN ;"
^XTV(8991,38,1,1,1,153,0)=" K ^%ZTSK"
^XTV(8991,38,1,1,1,154,0)=" S ^%ZTSK(0)=""TASKS^14.4"""
^XTV(8991,38,1,1,1,155,0)=" K ^%ZTSCH(""ER"")"
^XTV(8991,38,1,1,1,156,0)=" S ^%ZTSCH(""ER"")="""""
^XTV(8991,38,1,1,1,157,0)="GETNMSP ;"
^XTV(8991,38,1,1,1,158,0)=" S I=0 F  S I=I+1,T=$T(NONFOIA+I),ZZNMSP=$P(T,"";"",3),STARTNO=$P(T,"";"",4),ENDNO=$P(T,"";"",5),DIU(0)=""DT"" Q:ZZNMSP=""""  D NMSPLOOP"
^XTV(8991,38,1,1,1,159,0)=" ; REMOVE IVM RELATED IB ENTRY"
^XTV(8991,38,1,1,1,160,0)=" ; S DIK=""^DIC(19,"",DA=$O(^DIC(19,""B"",""IB OUTPUT IVM BILLING ACTIVITY"","""")) I DA D ^DIK"
^XTV(8991,38,1,1,1,161,0)=" ; REMOVE DIETETICS VENDOR ENTRY(S)"
^XTV(8991,38,1,1,1,162,0)=" ; S DIK=""^FH(113.2,"",DA=0 F  S DA=$O(^FH(113.2,DA)) Q:DA'>0  D ^DIK"
^XTV(8991,38,1,1,1,163,0)=" ; REMOVE DANGLING OPTION SCHEDULING ENTRIES"
^XTV(8991,38,1,1,1,164,0)=" S DIK=""^DIC(19.2,"",DA=0 F  S DA=$O(^DIC(19.2,DA)) Q:DA'>0  I '$D(^DIC(19,+$P($G(^DIC(19.2,DA,0)),U),0)) D ^DIK"
^XTV(8991,38,1,1,1,165,0)="DGLPTRS ;"
^XTV(8991,38,1,1,1,166,0)=" S %=1,XQFL=""OPTION"" D REMOVE^XQ3"
^XTV(8991,38,1,1,1,167,0)=" ; REMOVE COPYRIGHTED CPT FILES' DATA"
^XTV(8991,38,1,1,1,168,0)=" K ^ICPT S ^ICPT(0)=""CPT^81I"""
^XTV(8991,38,1,1,1,169,0)=" K ^DIC(81.1) S ^DIC(81.1,0)=""CPT CATEGORY^81.1"",^(0,""GL"")=""^DIC(81.1,"""
^XTV(8991,38,1,1,1,170,0)=" K ^DIC(81.3) S ^DIC(81.3,0)=""CPT MODIFIER^81.3I"",^(0,""GL"")=""^DIC(81.3,"""
^XTV(8991,38,1,1,1,171,0)=" S %=$P(^DD(757.02,1,0),U,2) I %'=""RF"" W !,""757.02,1 has changed"" Q"
^XTV(8991,38,1,1,1,172,0)=" S $P(^DD(757.02,1,0),U,2)=""F"""
^XTV(8991,38,1,1,1,173,0)=" S %=$P(^DD(757.02,2,0),U,2) I %'=""RP757.03'"" W !,""757.02,2 has changed"" Q"
^XTV(8991,38,1,1,1,174,0)=" S $P(^DD(757.02,2,0),U,2)=""P757.03'"""
^XTV(8991,38,1,1,1,175,0)=" S DA=0,DIE=757.02,DR=""1///@;2///@"""
^XTV(8991,38,1,1,1,176,0)=" F  S DA=$O(^LEX(757.02,DA)) Q:DA'>0  D"
^XTV(8991,38,1,1,1,177,0)=" . S %=$P($G(^LEX(757.02,DA,0)),U,3)"
^XTV(8991,38,1,1,1,178,0)=" . I %=3!(%=4) D ^DIE"
^XTV(8991,38,1,1,1,179,0)=" . Q"
^XTV(8991,38,1,1,1,180,0)=" S $P(^DD(757.02,1,0),U,2)=""RF"""
^XTV(8991,38,1,1,1,181,0)=" S $P(^DD(757.02,2,0),U,2)=""RP757.03'"""
^XTV(8991,38,1,1,1,182,0)=" ; REMOVE COPYRIGHTED MED INSTRUCTIONS"
^XTV(8991,38,1,1,1,183,0)=" K ^PS(50.621) S ^PS(50.621,0)=""PMI-ENGLISH^50.621"""
^XTV(8991,38,1,1,1,184,0)=" K ^PS(50.622) S ^PS(50.622,0)=""PMI-SPANISH^50.622"""
^XTV(8991,38,1,1,1,185,0)=" K ^PS(50.623) S ^PS(50.623,0)=""PMI MAP-ENGLISH^50.623"""
^XTV(8991,38,1,1,1,186,0)=" K ^PS(50.624) S ^PS(50.624,0)=""PMI MAP-SPANISH^50.624"""
^XTV(8991,38,1,1,1,187,0)=" K ^PS(50.625) S ^PS(50.625,0)=""WARNING LABEL-ENGLISH^50.625"""
^XTV(8991,38,1,1,1,188,0)=" K ^PS(50.626) S ^PS(50.626,0)=""WARNING LABEL-SPANISH^50.626"""
^XTV(8991,38,1,1,1,189,0)=" K ^PS(50.627) S ^PS(50.627,0)=""WARNING LABEL MAP^50.627"""
^XTV(8991,38,1,1,1,190,0)=" S %I=0 F  S %I=$O(^PSNDF(50.68,%I)) Q:%I'>0  S $P(^PSNDF(50.68,%I,1),""^"",5,7)=""^^"""
^XTV(8991,38,1,1,1,191,0)=" Q"
^XTV(8991,38,1,1,1,192,0)="DELRTN ;"
^XTV(8991,38,1,1,1,193,0)=" K ^UTILITY($J)"
^XTV(8991,38,1,1,1,194,0)=" F %RS=""DENTV*"",""DSI*"",""VEJD*"" D ADDSEL"
^XTV(8991,38,1,1,1,195,0)=" W ! S %N="""""
^XTV(8991,38,1,1,1,196,0)=" F %I=1:1 S %N=$O(^UTILITY($J,%N)) Q:%N=""""  W ?%I-1#8*10,%N W:(%I#8)=0 ! X ""ZR  ZS @%N"""
^XTV(8991,38,1,1,1,197,0)=" D DELRTN^XPDR ;REBUILD ROUTINE FILE"
^XTV(8991,38,1,1,1,198,0)="ANDGBLS ;DOMAIN, MESSAGE STATS, MH non-FOIA"
^XTV(8991,38,1,1,1,199,0)=" S DIK=""^YTT(601,"",YS=0 F  S YS=$O(^YTT(601,YS)) Q:YS'>0  I $L($P($G(^YTT(601,YS,0)),""^"",6)) S DA=YS D ^DIK"
^XTV(8991,38,1,1,1,200,0)=" ; S DIK=""^HL(771,"",DA=$O(^HL(771,""B"",""IVM"","""")) I DA D ^DIK"
^XTV(8991,38,1,1,1,201,0)=" ; S DIK=""^HL(770,"",DA=$O(^HL(770,""B"",""IVM CENTER"","""")) I DA D ^DIK"
^XTV(8991,38,1,1,1,202,0)=" ;"
^XTV(8991,38,1,1,1,203,0)="USER ;"
^XTV(8991,38,1,1,1,204,0)=" W !,""Cleaning up User info"",!"
^XTV(8991,38,1,1,1,205,0)=" S U=""^"",IOF=""#"""
^XTV(8991,38,1,1,1,206,0)=" F I=1,2,3 D"
^XTV(8991,38,1,1,1,207,0)=" . S $P(^VA(200,I,0),U,3)="""",$P(^(.1),U,1,2)=""^"""
^XTV(8991,38,1,1,1,208,0)=" . K ^VA(200,I,""VOLD"")"
^XTV(8991,38,1,1,1,209,0)=" K ^VA(200,""AOLD""),^VA(200,""A"")"
^XTV(8991,38,1,1,1,210,0)=" K ^DISV"
^XTV(8991,38,1,1,1,211,0)="MAIL ;"
^XTV(8991,38,1,1,1,212,0)=" S DIK=""^%ZTER(1,"",YS=0 F  S YS=$O(^%ZTER(1,YS)) Q:YS'>0  S DA=YS D ^DIK"
^XTV(8991,38,1,1,1,213,0)=" S DIK=""^XUSEC(0,"",YS=0 F  S YS=$O(^XUSEC(0,YS)) Q:YS'>0  S DA=YS D ^DIK"
^XTV(8991,38,1,1,1,214,0)=" S DIK=""^XMB(3.7,.5,2,"",YS=1,DA(1)=.5 F  S YS=$O(^XMB(3.7,.5,2,YS)) Q:YS'>0  S DA=YS D ^DIK"
^XTV(8991,38,1,1,1,215,0)=" S DIKYB=""^XMB(3.7,.5,2,"",DA(2)=.5 F YB=.5,.95,1 S DIK=DIKYB_YB_"",1,"",YS=0,DA(1)=YB F  S YS=$O(^XMB(3.7,.5,2,YB,1,YS)) Q:YS'>0  S DA=YS D ^DIK"
^XTV(8991,38,1,1,1,216,0)=" S DIK=""^XMBS(4.2999,"",YS=0 F  S YS=$O(^XMBS(4.2999,YS)) Q:YS'>0  S DA=YS D ^DIK"
^XTV(8991,38,1,1,1,217,0)=" K ^XMB(3.9)"
^XTV(8991,38,1,1,1,218,0)=" S ^XMB(3.9,0)=""MESSAGE^3.9s"""
^XTV(8991,38,1,1,1,219,0)=" D CHKFILES^XMUT4"
^XTV(8991,38,1,1,1,220,0)=" W !,""Don't forget to copy in HASH.RTN"""
^XTV(8991,38,1,1,1,221,0)=" W !,""And edit GO+1^XMRONT, replace 10001 with 25 which restores the value as exported."""
^XTV(8991,38,1,1,1,222,0)=" W !,""DONE"""
^XTV(8991,38,1,1,1,223,0)=" K ZI,ZNODE,ZZNMSP,DIU,DIU(0),STARTNO,ENDNO,ZZDATA,DIK,ZX"
^XTV(8991,38,1,1,1,224,0)=" Q"
^XTV(8991,38,1,1,1,225,0)="NONFOIA ;"
^XTV(8991,38,1,1,1,226,0)=" ;;VEJD;19600;19699.9999"
^XTV(8991,38,1,1,1,227,0)=" ;;DSI;;-1"
^XTV(8991,38,1,1,1,228,0)=" ;;DENTV;228;228.9999"
^XTV(8991,38,1,1,1,229,0)=" ;;"
^XTV(8991,38,1,1,1,230,0)="NMSPLOOP N I W !,""Deleting: "",ZZNMSP F ZI=STARTNO-.000000001:0 S ZI=$O(^DIC(ZI)) Q:ZI>ENDNO  S DIU=^DIC(ZI,0,""GL"") W !,DIU D EN^DIU2"
^XTV(8991,38,1,1,1,231,0)="DELBULL ;"
^XTV(8991,38,1,1,1,232,0)=" W !!,""Deleting bulletins..."",!"
^XTV(8991,38,1,1,1,233,0)=" S DIK=""^XMB(3.6,"" F ZI=0:0 S ZI=$O(^XMB(3.6,ZI)) Q:ZI'?.N  S ZNODE=^XMB(3.6,ZI,0) I $E(($P(ZNODE,U,1)),1,$L(ZZNMSP))[ZZNMSP S DA=ZI W !,$P(ZNODE,U,1) D ^DIK"
^XTV(8991,38,1,1,1,234,0)=" W !!,""Bulletins deleted."""
^XTV(8991,38,1,1,1,235,0)=" W !!,""Deleting mail groups..."",!"
^XTV(8991,38,1,1,1,236,0)=" S DIK=""^XMB(3.8,"" F ZI=0:0 S ZI=$O(^XMB(3.8,ZI)) Q:ZI'?.N  S ZNODE=^XMB(3.8,ZI,0) I $E(($P(ZNODE,U,1)),1,$L(ZZNMSP))[ZZNMSP S DA=ZI W !,$P(ZNODE,U,1) D ^DIK"
^XTV(8991,38,1,1,1,237,0)=" W !!,""Mail Groups deleted."""
^XTV(8991,38,1,1,1,238,0)="DELOPTS ;"
^XTV(8991,38,1,1,1,239,0)=" W !!,""Deleting options..."",!"
^XTV(8991,38,1,1,1,240,0)=" S DIK=""^DIC(19,"" F ZI=0:0 S ZI=$O(^DIC(19,ZI)) Q:ZI'?.N!(ZI="""")  I $D(^DIC(19,ZI,0)) S ZNODE=^DIC(19,ZI,0) I $E(($P(ZNODE,U,1)),1,$L(ZZNMSP))[ZZNMSP S DA=ZI W !,$P(ZNODE,U,1) D ^DIK"
^XTV(8991,38,1,1,1,241,0)=" W !!,""Options deleted."""
^XTV(8991,38,1,1,1,242,0)="DELHELP ;"
^XTV(8991,38,1,1,1,243,0)=" W !!,""Deleting HELP FRAMES..."",!"
^XTV(8991,38,1,1,1,244,0)=" S DIK=""^DIC(9.2,"" F ZI=0:0 S ZI=$O(^DIC(9.2,ZI)) Q:ZI'?.N!(ZI="""")  I $D(^DIC(9.2,ZI,0)) S ZNODE=^DIC(9.2,ZI,0) I $E(($P(ZNODE,U,1)),1,$L(ZZNMSP))[ZZNMSP S DA=ZI W !,$P(ZNODE,U,1) D ^DIK"
^XTV(8991,38,1,1,1,245,0)=" W !!,""HELP FRAMES deleted."""
^XTV(8991,38,1,1,1,246,0)="DGLHPTR ;"
^XTV(8991,38,1,1,1,247,0)=" S %=0,XQFL=""HELP FRAME"" D REMOVE^XQ3"
^XTV(8991,38,1,1,1,248,0)="DELTEMP ;"
^XTV(8991,38,1,1,1,249,0)=" W !!,""Deleting LIST MANAGER TEMPLATES..."",!"
^XTV(8991,38,1,1,1,250,0)=" S DIK=""^SD(409.61,"" F ZI=0:0 S ZI=$O(^SD(409.61,ZI)) Q:ZI'?.N!(ZI="""")  I $D(^SD(409.61,ZI,0)) S ZNODE=^SD(409.61,ZI,0) I $E(($P(ZNODE,U,1)),1,$L(ZZNMSP))[ZZNMSP S DA=ZI W !,$P(ZNODE,U,1) D ^DIK"
^XTV(8991,38,1,1,1,251,0)=" W !!,""LIST MANAGER TEMPLATES deleted."""
^XTV(8991,38,1,1,1,252,0)="DELPROT ;"
^XTV(8991,38,1,1,1,253,0)=" W !!,""Deleting protocols..."",!"
^XTV(8991,38,1,1,1,254,0)=" S DIK=""^ORD(101,"" F ZI=0:0 S ZI=$O(^ORD(101,ZI)) Q:ZI'?.N!(ZI="""")  I $D(^ORD(101,ZI,0)) S ZNODE=^ORD(101,ZI,0) I $E(($P(ZNODE,U,1)),1,$L(ZZNMSP))[ZZNMSP S DA=ZI W !,$P(ZNODE,U,1) D ^DIK"
^XTV(8991,38,1,1,1,255,0)=" W !!,""Protocols deleted."""
^XTV(8991,38,1,1,1,256,0)="DELFUNC ;"
^XTV(8991,38,1,1,1,257,0)=" W !!,""Deleting functions..."",!"
^XTV(8991,38,1,1,1,258,0)=" S DIK=""^DD(""""FUNC"""","" F ZI=0:0 S ZI=$O(^DD(""FUNC"",ZI)) Q:ZI<0!(ZI'?.N)  S ZNODE=^DD(""FUNC"",ZI,0) I $E(($P(ZNODE,U,1)),1,$L(ZZNMSP))[ZZNMSP S DA=ZI W !,$P(ZNODE,U,1) D ^DIK"
^XTV(8991,38,1,1,1,259,0)=" W !!,""Functions deleted."""
^XTV(8991,38,1,1,1,260,0)="DELKEYS ;"
^XTV(8991,38,1,1,1,261,0)=" W !!,""Deleting security keys..."",!"
^XTV(8991,38,1,1,1,262,0)=" S DIK=""^DIC(19.1,"" F ZI=0:0 S ZI=$O(^DIC(19.1,ZI)) Q:ZI'?.N  S ZNODE=^DIC(19.1,ZI,0) I $E(($P(ZNODE,U,1)),1,$L(ZZNMSP))[ZZNMSP S DA=ZI W !,$P(ZNODE,U,1) D ^DIK"
^XTV(8991,38,1,1,1,263,0)=" W !!,""Security keys deleted."""
^XTV(8991,38,1,1,1,264,0)="DELBUILD ;"
^XTV(8991,38,1,1,1,265,0)=" W !!,""Deleting Builds..."",!"
^XTV(8991,38,1,1,1,266,0)=" S DIK=""^XPD(9.6,"" F ZI=0:0 S ZI=$O(^XPD(9.6,ZI)) Q:ZI'?.N  S ZNODE=^XPD(9.6,ZI,0) I $E(($P(ZNODE,U,1)),1,$L(ZZNMSP))[ZZNMSP!($P($G(^DIC(9.4,+$P(ZNODE,U,2),0)),U,2)=ZZNMSP) S DA=ZI W !,$P(ZNODE,U,1) D ^DIK"
^XTV(8991,38,1,1,1,267,0)=" W !!,""Builds deleted."""
^XTV(8991,38,1,1,1,268,0)="DELINSTL ;"
^XTV(8991,38,1,1,1,269,0)=" W !!,""Deleting Installs..."",!"
^XTV(8991,38,1,1,1,270,0)=" S DIK=""^XPD(9.7,"" F ZI=0:0 S ZI=$O(^XPD(9.7,ZI)) Q:ZI'?.N  S ZNODE=^XPD(9.7,ZI,0) I $E(($P(ZNODE,U,1)),1,$L(ZZNMSP))[ZZNMSP!($P($G(^DIC(9.4,+$P(ZNODE,U,2),0)),U,2)=ZZNMSP) S DA=ZI W !,$P(ZNODE,U,1) D ^DIK"
^XTV(8991,38,1,1,1,271,0)=" W !!,""Installs deleted."""
^XTV(8991,38,1,1,1,272,0)="DELPKG ;"
^XTV(8991,38,1,1,1,273,0)=" W !!,""Deleting Packages..."",!"
^XTV(8991,38,1,1,1,274,0)=" S DIK=""^DIC(9.4,"" F ZI=0:0 S ZI=$O(^DIC(9.4,ZI)) Q:ZI'?.N  S ZNODE=^DIC(9.4,ZI,0) I $E(($P(ZNODE,U,2)),1,$L(ZZNMSP))[ZZNMSP S DA=ZI W !,$P(ZNODE,U,1) D ^DIK"
^XTV(8991,38,1,1,1,275,0)=" W !!,""Packages deleted."""
^XTV(8991,38,1,1,1,276,0)=" Q"
^XTV(8991,38,1,1,1,277,0)=" ;"
^XTV(8991,38,1,1,1,278,0)="ADDSEL ;"
^XTV(8991,38,1,1,1,279,0)=" S A=%RS,%OS=$S($E(^%ZOSF(""OS""),1,5)=""OpenM"":1,1:0)"
^XTV(8991,38,1,1,1,280,0)=" S A=$E(A,1,$L(A)-1),B=A D SING,MULT ;wild pattern"
^XTV(8991,38,1,1,1,281,0)=" Q"
^XTV(8991,38,1,1,1,282,0)="SING I A]"""",$$TESTROU(A) S B=A G S ;routine exists"
^XTV(8991,38,1,1,1,283,0)=" Q  ;routine does not exist"
^XTV(8991,38,1,1,1,284,0)="TESTROU(A) ;"
^XTV(8991,38,1,1,1,285,0)=" I %OS=1 Q $D(^ROUTINE(A))"
^XTV(8991,38,1,1,1,286,0)=" Q $D(^ (A))"
^XTV(8991,38,1,1,1,287,0)="S Q:$D(^UTILITY($J,B))  S ^(B)="""" Q  ;adding & not there"
^XTV(8991,38,1,1,1,288,0)=" Q  ;shouldn't get to this point"
^XTV(8991,38,1,1,1,289,0)="MULT I B="""" S B=0 ;A and B are the root pattern for the matches"
^XTV(8991,38,1,1,1,290,0)="MULT1 S B=$$ROU(B) Q:B=""""  Q:$E(B,1,$L(A))'=A"
^XTV(8991,38,1,1,1,291,0)=" D S G MULT1 ;add one routine and continue"
^XTV(8991,38,1,1,1,292,0)="ROU(B) ;"
^XTV(8991,38,1,1,1,293,0)=" I %OS=1 Q $O(^ROUTINE(B))"
^XTV(8991,38,1,1,1,294,0)=" Q $O(^ (B))"
^XTV(8991,38,1,"B",3061226.183,1)=""
^XTV(8991,39,0)="XQOR"
^XTV(8991,39,1,0)="^8991.01^2^2"
^XTV(8991,39,1,1,0)="3070118.2235"
^XTV(8991,39,1,1,1,0)="^8991.11^49^49"
^XTV(8991,39,1,1,1,1,0)=""
^XTV(8991,39,1,1,1,1,"DEL")="XQOR ; SLC/KCM - Prepare to Unwind Options ;1/18/07  22:35"
^XTV(8991,39,1,1,1,2,0)=""
^XTV(8991,39,1,1,1,2,"DEL")=" ;;8.0;KERNEL;**48,56,437**;Jul 10, 1995 LOCAL VWSD 11/23/06;Build 4"
^XTV(8991,39,1,1,1,3,"INS",0)="^8991.12^18^18"
^XTV(8991,39,1,1,1,3,"INS",1,0)="XQOR ; SLC/KCM - Prepare to Unwind Options ;1/23/07  15:37"
^XTV(8991,39,1,1,1,3,"INS",2,0)=" ;;8.0;KERNEL;**48,56,437**;Jul 10, 1995"
^XTV(8991,39,1,1,1,3,"INS",3,0)=" ; Modified from FOIA VISTA,"
^XTV(8991,39,1,1,1,3,"INS",4,0)=" ; Copyright (C) 2007 WorldVistA"
^XTV(8991,39,1,1,1,3,"INS",5,0)=" ;"
^XTV(8991,39,1,1,1,3,"INS",6,0)=" ; This program is free software; you can redistribute it and/or modify"
^XTV(8991,39,1,1,1,3,"INS",7,0)=" ; it under the terms of the GNU General Public License as published by"
^XTV(8991,39,1,1,1,3,"INS",8,0)=" ; the Free Software Foundation; either version 2 of the License, or"
^XTV(8991,39,1,1,1,3,"INS",9,0)=" ; (at your option) any later version."
^XTV(8991,39,1,1,1,3,"INS",10,0)=" ;"
^XTV(8991,39,1,1,1,3,"INS",11,0)=" ; This program is distributed in the hope that it will be useful,"
^XTV(8991,39,1,1,1,3,"INS",12,0)=" ; but WITHOUT ANY WARRANTY; without even the implied warranty of"
^XTV(8991,39,1,1,1,3,"INS",13,0)=" ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the"
^XTV(8991,39,1,1,1,3,"INS",14,0)=" ; GNU General Public License for more details."
^XTV(8991,39,1,1,1,3,"INS",15,0)=" ;"
^XTV(8991,39,1,1,1,3,"INS",16,0)=" ; You should have received a copy of the GNU General Public License"
^XTV(8991,39,1,1,1,3,"INS",17,0)=" ; along with this program; if not, write to the Free Software"
^XTV(8991,39,1,1,1,3,"INS",18,0)=" ; Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA"
^XTV(8991,39,1,2,0)="3070123.1537"
^XTV(8991,39,1,2,1,0)="^8991.11^65^65"
^XTV(8991,39,1,2,1,1,0)="XQOR ; SLC/KCM - Prepare to Unwind Options ;1/23/07  15:37"
^XTV(8991,39,1,2,1,2,0)=" ;;8.0;KERNEL;**48,56,437**;Jul 10, 1995"
^XTV(8991,39,1,2,1,3,0)=" ; Modified from FOIA VISTA,"
^XTV(8991,39,1,2,1,4,0)=" ; Copyright (C) 2007 WorldVistA"
^XTV(8991,39,1,2,1,5,0)=" ;"
^XTV(8991,39,1,2,1,6,0)=" ; This program is free software; you can redistribute it and/or modify"
^XTV(8991,39,1,2,1,7,0)=" ; it under the terms of the GNU General Public License as published by"
^XTV(8991,39,1,2,1,8,0)=" ; the Free Software Foundation; either version 2 of the License, or"
^XTV(8991,39,1,2,1,9,0)=" ; (at your option) any later version."
^XTV(8991,39,1,2,1,10,0)=" ;"
^XTV(8991,39,1,2,1,11,0)=" ; This program is distributed in the hope that it will be useful,"
^XTV(8991,39,1,2,1,12,0)=" ; but WITHOUT ANY WARRANTY; without even the implied warranty of"
^XTV(8991,39,1,2,1,13,0)=" ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the"
^XTV(8991,39,1,2,1,14,0)=" ; GNU General Public License for more details."
^XTV(8991,39,1,2,1,15,0)=" ;"
^XTV(8991,39,1,2,1,16,0)=" ; You should have received a copy of the GNU General Public License"
^XTV(8991,39,1,2,1,17,0)=" ; along with this program; if not, write to the Free Software"
^XTV(8991,39,1,2,1,18,0)=" ; Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA"
^XTV(8991,39,1,2,1,19,0)=" S DIC=19,DIC(0)=""AEMQ"" D ^DIC K DIC Q:Y<0  S X=+Y_"";DIC(19,"""
^XTV(8991,39,1,2,1,20,0)="EN ;Process options/protocols from top"
^XTV(8991,39,1,2,1,21,0)=" ;From: Anywhere  Entry: X,{DIC,XQORFLG}  Exit: none"
^XTV(8991,39,1,2,1,22,0)=" Q:$D(X)[0  K XQORPOP,XQORQUIT"
^XTV(8991,39,1,2,1,23,0)=" I '$D(XQORS) S XQORS=0 K ^TMP(""XQORS"",$J)"
^XTV(8991,39,1,2,1,24,0)=" S XQORS=XQORS+1 ;push"
^XTV(8991,39,1,2,1,25,0)=" I $D(XQOR(""HIJACK"")) S X=XQOR(""HIJACK""),DIC=101 K XQOR(""HIJACK"")"
^XTV(8991,39,1,2,1,26,0)=" I X?1.N1"";ORD(101,""!(X?1.N1"";DIC(19,"") S ^TMP(""XQORS"",$J,XQORS,""REF"")=""^""_$P(X,"";"",2)_+X_"","",^TMP(""XQORS"",$J,XQORS,""VPT"")=X"
^XTV(8991,39,1,2,1,27,0)=" E  S:$D(DIC)[0 DIC=19 S DIC(0)=""N"" D ^DIC S:Y>0 ^TMP(""XQORS"",$J,XQORS,""REF"")=DIC_+Y_"","",^TMP(""XQORS"",$J,XQORS,""VPT"")=+Y_"";""_$P(DIC,""^"",2) K DIC G:Y<0 EX"
^XTV(8991,39,1,2,1,28,0)=" S XQORNEST(XQORS)=^TMP(""XQORS"",$J,XQORS,""VPT""),XQORNEST=XQORS"
^XTV(8991,39,1,2,1,29,0)=" G:'$D(@(^TMP(""XQORS"",$J,XQORS,""REF"")_""0)"")) EX S ^TMP(""XQORS"",$J,XQORS,""FLG"")=$P(^(0),""^"",4)_""^^"" G:$P(^TMP(""XQORS"",$J,XQORS,""FLG""),""^"")'?1A EX"
^XTV(8991,39,1,2,1,30,0)=" ; LOCAL MOD VWSD SILENTMODE ECHO SDAM EVENTS (VARIABLE XQSDVWSI)"
^XTV(8991,39,1,2,1,31,0)=" I $L($P(@(^TMP(""XQORS"",$J,XQORS,""REF"")_""0)""),""^"",3)) W:'$D(XQSDVWSI) !!,$P(^(0),""^"",3),! D READ^XQOR4 G EX"
^XTV(8991,39,1,2,1,32,0)=" ;I $L($P(@(^TMP(""XQORS"",$J,XQORS,""REF"")_""0)""),""^"",3)) W !!,$P(^(0),""^"",3),! D READ^XQOR4 G EX"
^XTV(8991,39,1,2,1,33,0)=" ;END LOCAL MODE"
^XTV(8991,39,1,2,1,34,0)=" D C19^XQOR4 G:Y<0 EX"
^XTV(8991,39,1,2,1,35,0)=" S ^TMP(""XQORS"",$J,0,""FILE"")="";""_$P(^TMP(""XQORS"",$J,XQORS,""VPT""),"";"",2),^TMP(""XQORS"",$J,XQORS,""INP"")="""""
^XTV(8991,39,1,2,1,36,0)=" I XQORS>1,$D(^TMP(""XQORS"",$J,XQORS-1,""ITM"")),$D(^TMP(""XQORS"",$J,XQORS-1,""ITM"",^TMP(""XQORS"",$J,XQORS-1,""ITM""),""IN"")) S ^TMP(""XQORS"",$J,XQORS,""INP"")=^TMP(""XQORS"",$J,XQORS-1,""ITM"",^TMP(""XQORS"",$J,XQORS-1,""ITM""),""IN"")"
^XTV(8991,39,1,2,1,37,0)=" I XQORS>1,$D(XQORFLG(""PI"")) K XQORFLG(""PI"") S ^TMP(""XQORS"",$J,XQORS,""INP"")=^TMP(""XQORS"",$J,XQORS-1,""INP"")"
^XTV(8991,39,1,2,1,38,0)=" S XQORNOD=^TMP(""XQORS"",$J,XQORS,""VPT""),XQORNOD(0)=^TMP(""XQORS"",$J,XQORS,""INP"")"
^XTV(8991,39,1,2,1,39,0)=" I XQORS>1,$D(^TMP(""XQORS"",$J,XQORS-1,""FLG"")) S X=^TMP(""XQORS"",$J,XQORS-1,""FLG""),$P(^TMP(""XQORS"",$J,XQORS,""FLG""),""^"",3)=$S($L($P(X,""^"",5)):$P(X,""^"",5),1:$P(X,""^"",3))"
^XTV(8991,39,1,2,1,40,0)=" I ^TMP(""XQORS"",$J,0,""FILE"")="";ORD(101,"",$D(@(^TMP(""XQORS"",$J,XQORS,""REF"")_""4)"")) S:$P(^(4),""^"",3)=""Y"" $P(^TMP(""XQORS"",$J,XQORS,""FLG""),""^"",2)=1"
^XTV(8991,39,1,2,1,41,0)=" I ^TMP(""XQORS"",$J,0,""FILE"")="";DIC(19,"",$P(^TMP(""XQORS"",$J,XQORS,""FLG""),""^"")=""M"" S $P(^TMP(""XQORS"",$J,XQORS,""FLG""),""^"",2)=1"
^XTV(8991,39,1,2,1,42,0)=" I $D(XQORFLG) S:$D(XQORFLG(""PS"")) $P(^TMP(""XQORS"",$J,XQORS,""FLG""),""^"",2)=+XQORFLG(""PS"") S:$D(XQORFLG(""SH"")) $P(^TMP(""XQORS"",$J,XQORS,""FLG""),""^"",3)=+XQORFLG(""SH"") K XQORFLG"
^XTV(8991,39,1,2,1,43,0)=" I $D(ORITMO) S $P(^TMP(""XQORS"",$J,XQORS,""FLG""),""^"",6)=1 K ORITMO G REDO^XQOR1"
^XTV(8991,39,1,2,1,44,0)=" I $P(^TMP(""XQORS"",$J,XQORS,""FLG""),""^"")=""D"" N XQORDLG"
^XTV(8991,39,1,2,1,45,0)=" G LOOP^XQOR1"
^XTV(8991,39,1,2,1,46,0)="EX K XQORNEST(XQORS),XQORFLG,XQORNOD,XQORY,^TMP(""XQORS"",$J,XQORS) S XQORS=XQORS-1,XQORNEST=XQORS ;pop"
^XTV(8991,39,1,2,1,47,0)=" I XQORS=0 K XQORNEST,XQORS,^TMP(""XQORS"",$J),XQORSPEW"
^XTV(8991,39,1,2,1,48,0)=" Q"
^XTV(8991,39,1,2,1,49,0)="EN1 ;Process items on option/protocol only (i.e., skip initial actions)"
^XTV(8991,39,1,2,1,50,0)=" ;From: Anywhere  Entry: X,DIC  Exit: none"
^XTV(8991,39,1,2,1,51,0)=" S ORITMO=1 G EN"
^XTV(8991,39,1,2,1,52,0)=" Q"
^XTV(8991,39,1,2,1,53,0)="XQ ;From: Menuman  Entry: XQOR  Exit: XQOR"
^XTV(8991,39,1,2,1,54,0)=" S X=+XQOR_"";DIC(19,"" I $D(^DD(19,0,""VR"")),^(""VR"")<5.9 G EN"
^XTV(8991,39,1,2,1,55,0)=" G EN1"
^XTV(8991,39,1,2,1,56,0)="MSG(X,XQORMSG) ;Event point for HL7 messages"
^XTV(8991,39,1,2,1,57,0)=" N DIC S DIC=101"
^XTV(8991,39,1,2,1,58,0)=" I '$D(XQORHSTK) N XQORHSTK S XQORHSTK=-1 K ^TMP(""XQORHSTK"",$J)"
^XTV(8991,39,1,2,1,59,0)=" S XQORHSTK=XQORHSTK+1"
^XTV(8991,39,1,2,1,60,0)=" K ^TMP(""XQORHSTK"",$J,XQORHSTK) M ^TMP(""XQORHSTK"",$J,XQORHSTK)=XQORMSG"
^XTV(8991,39,1,2,1,61,0)=" D EN^XQOR"
^XTV(8991,39,1,2,1,62,0)=" S XQORHSTK=XQORHSTK-1"
^XTV(8991,39,1,2,1,63,0)=" I XQORHSTK>-1 K XQORMSG M XQORMSG=^TMP(""XQORHSTK"",$J,XQORHSTK)"
^XTV(8991,39,1,2,1,64,0)=" I XQORHSTK=-1 K ^TMP(""XQORHSTK"",$J)"
^XTV(8991,39,1,2,1,65,0)=" Q"
^XTV(8991,39,1,"B",3070118.2235,1)=""
^XTV(8991,39,1,"B",3070123.1537,2)=""
^XTV(8991,40,0)="XQOR4"
^XTV(8991,40,1,0)="^8991.01^2^2"
^XTV(8991,40,1,1,0)="3070118.2236"
^XTV(8991,40,1,1,1,0)="^8991.11^31^31"
^XTV(8991,40,1,1,1,1,0)=""
^XTV(8991,40,1,1,1,1,"DEL")="XQOR4 ; SLC/KCM - Process ""^^"" jump ;1/18/07  22:36"
^XTV(8991,40,1,1,1,2,0)=""
^XTV(8991,40,1,1,1,2,"DEL")=" ;;8.0;KERNEL;**56,62,437**;Jul 10, 1995 LOCAL 11/23/06 VWSD UPDATES SILENT MODE ;Build 4"
^XTV(8991,40,1,1,1,3,"INS",0)="^8991.12^18^18"
^XTV(8991,40,1,1,1,3,"INS",1,0)="XQOR4 ; SLC/KCM - Process ""^^"" jump ;1/23/07  15:36"
^XTV(8991,40,1,1,1,3,"INS",2,0)=" ;;8.0;KERNEL;**56,62,437**;Jul 10, 1995"
^XTV(8991,40,1,1,1,3,"INS",3,0)=" ; Modified from FOIA VISTA,"
^XTV(8991,40,1,1,1,3,"INS",4,0)=" ; Copyright (C) 2007 WorldVistA"
^XTV(8991,40,1,1,1,3,"INS",5,0)=" ;"
^XTV(8991,40,1,1,1,3,"INS",6,0)=" ; This program is free software; you can redistribute it and/or modify"
^XTV(8991,40,1,1,1,3,"INS",7,0)=" ; it under the terms of the GNU General Public License as published by"
^XTV(8991,40,1,1,1,3,"INS",8,0)=" ; the Free Software Foundation; either version 2 of the License, or"
^XTV(8991,40,1,1,1,3,"INS",9,0)=" ; (at your option) any later version."
^XTV(8991,40,1,1,1,3,"INS",10,0)=" ;"
^XTV(8991,40,1,1,1,3,"INS",11,0)=" ; This program is distributed in the hope that it will be useful,"
^XTV(8991,40,1,1,1,3,"INS",12,0)=" ; but WITHOUT ANY WARRANTY; without even the implied warranty of"
^XTV(8991,40,1,1,1,3,"INS",13,0)=" ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the"
^XTV(8991,40,1,1,1,3,"INS",14,0)=" ; GNU General Public License for more details."
^XTV(8991,40,1,1,1,3,"INS",15,0)=" ;"
^XTV(8991,40,1,1,1,3,"INS",16,0)=" ; You should have received a copy of the GNU General Public License"
^XTV(8991,40,1,1,1,3,"INS",17,0)=" ; along with this program; if not, write to the Free Software"
^XTV(8991,40,1,1,1,3,"INS",18,0)=" ; Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA"
^XTV(8991,40,1,2,0)="3070123.1536"
^XTV(8991,40,1,2,1,0)="^8991.11^47^47"
^XTV(8991,40,1,2,1,1,0)="XQOR4 ; SLC/KCM - Process ""^^"" jump ;1/23/07  15:36"
^XTV(8991,40,1,2,1,2,0)=" ;;8.0;KERNEL;**56,62,437**;Jul 10, 1995"
^XTV(8991,40,1,2,1,3,0)=" ; Modified from FOIA VISTA,"
^XTV(8991,40,1,2,1,4,0)=" ; Copyright (C) 2007 WorldVistA"
^XTV(8991,40,1,2,1,5,0)=" ;"
^XTV(8991,40,1,2,1,6,0)=" ; This program is free software; you can redistribute it and/or modify"
^XTV(8991,40,1,2,1,7,0)=" ; it under the terms of the GNU General Public License as published by"
^XTV(8991,40,1,2,1,8,0)=" ; the Free Software Foundation; either version 2 of the License, or"
^XTV(8991,40,1,2,1,9,0)=" ; (at your option) any later version."
^XTV(8991,40,1,2,1,10,0)=" ;"
^XTV(8991,40,1,2,1,11,0)=" ; This program is distributed in the hope that it will be useful,"
^XTV(8991,40,1,2,1,12,0)=" ; but WITHOUT ANY WARRANTY; without even the implied warranty of"
^XTV(8991,40,1,2,1,13,0)=" ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the"
^XTV(8991,40,1,2,1,14,0)=" ; GNU General Public License for more details."
^XTV(8991,40,1,2,1,15,0)=" ;"
^XTV(8991,40,1,2,1,16,0)=" ; You should have received a copy of the GNU General Public License"
^XTV(8991,40,1,2,1,17,0)=" ; along with this program; if not, write to the Free Software"
^XTV(8991,40,1,2,1,18,0)=" ; Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA"
^XTV(8991,40,1,2,1,19,0)="DJMP ;From: STAK^XQOR1"
^XTV(8991,40,1,2,1,20,0)=" Q:'$D(^TMP(""XQORS"",$J,XQORS,""ITM"",^TMP(""XQORS"",$J,XQORS,""ITM""),""IN""))"
^XTV(8991,40,1,2,1,21,0)=" I $D(VALMCC) N XQORLMGR S XQORLMGR="""" D FULL^VALM1 ; List Mgr Running?"
^XTV(8991,40,1,2,1,22,0)=" S X=^TMP(""XQORS"",$J,XQORS,""ITM"",^TMP(""XQORS"",$J,XQORS,""ITM""),""IN"")"
^XTV(8991,40,1,2,1,23,0)=" I '$L($P(X,""^"",3)) W !!,""For entry """"^^"",$P(X,""^"",4),"""""" -"""
^XTV(8991,40,1,2,1,24,0)=" S X=$P(X,""^"",4,99) D EAT^XQORM1 ;Q:$E(X,1,2)'=""^^"""
^XTV(8991,40,1,2,1,25,0)=" S X=$P(X,""="",1),D=""K.ORWARD"",DIC=""^ORD(101,"",DIC(0)=""SE"" D IX^DIC K DIC,D"
^XTV(8991,40,1,2,1,26,0)=" I Y<0!('$D(^ORD(101,+Y,0))) W:(X'[""^"")&(X'[""?"") !!,"">>>  "",X,"" not found or selected.  No action taken."" D:(X'[""^"")&(X'[""?"") READ S X="""" G DJMPX"
^XTV(8991,40,1,2,1,27,0)=" S ORNSV=+Y"
^XTV(8991,40,1,2,1,28,0)=" K X F I=1:1:XQORS I $P(^TMP(""XQORS"",$J,XQORS,""VPT""),"";"",2)=""ORD(101,"",$D(^ORD(101,+^TMP(""XQORS"",$J,XQORS,""VPT""),21)) D DJMP1"
^XTV(8991,40,1,2,1,29,0)=" S X="""" F I=0:0 S X=$O(X(X)) Q:X=""""  N @X"
^XTV(8991,40,1,2,1,30,0)=" S X=ORNSV_"";ORD(101,"" K ORNSV"
^XTV(8991,40,1,2,1,31,0)=" D EN^XQOR"
^XTV(8991,40,1,2,1,32,0)="DJMPX I $D(XQORLMGR) S VALMBCK=""R""                       ; Refresh List Mgr"
^XTV(8991,40,1,2,1,33,0)=" Q"
^XTV(8991,40,1,2,1,34,0)="DJMP1 F J=0:0 S J=$O(^ORD(101,+^TMP(""XQORS"",$J,XQORS,""VPT""),21,J)) Q:J'>0  I $D(^ORD(101,+^TMP(""XQORS"",$J,XQORS,""VPT""),21,J,0)) S X=^(0) I X?1A.ANP!(X?1""%"".ANP) S X(X)="""""
^XTV(8991,40,1,2,1,35,0)=" Q"
^XTV(8991,40,1,2,1,36,0)="SHDR ;Display sub-header"
^XTV(8991,40,1,2,1,37,0)=" Q:'$D(@(^TMP(""XQORS"",$J,XQORS,""REF"")_""0)""))  S X=$P(^(0),""^"",2) W:X'?1."" "" !!?(36-($L(X)\2)),""--- ""_X_"" ---"""
^XTV(8991,40,1,2,1,38,0)=" Q"
^XTV(8991,40,1,2,1,39,0)=" ;VWSD LOCAL MOD STARTED HERE, XQ SILENT MODE . VARIABLE XQSDVWSI"
^XTV(8991,40,1,2,1,40,0)="READ I '$D(XQSDVWSI) W !,""Press RETURN to continue: "" R X:$S($D(DTIME):DTIME,1:300)"
^XTV(8991,40,1,2,1,41,0)=" ;READ W !,""Press RETURN to continue: "" R X:$S($D(DTIME):DTIME,1:300)"
^XTV(8991,40,1,2,1,42,0)=" ;END LOCAL MOD"
^XTV(8991,40,1,2,1,43,0)=" Q"
^XTV(8991,40,1,2,1,44,0)="C19 N X0 S X0=@(^TMP(""XQORS"",$J,XQORS,""REF"")_""0)""),X=$P(X0,""^"",6) I $L(X),'$D(^XUSEC(X,DUZ)) W !!,""This option ""_$P(X0,""^"")_"" is locked."",! D READ S Y=-1 Q"
^XTV(8991,40,1,2,1,45,0)=" S ORNSV=$P(X0,""^"",9),X=""NOW"",%DT=""T"" D ^%DT S X=$P(Y,""."",2) I X>$P(ORNSV,""-""),X<$P(ORNSV,""-"",2) W !!,""Not Available: "",ORNSV,! K ORNSV D READ S Y=-1 Q"
^XTV(8991,40,1,2,1,46,0)=" K ORNSV I ""QMOXALDT""'[$P(^TMP(""XQORS"",$J,XQORS,""FLG""),""^"") W !!,""This option type not supported by 'unwinder' routines."",! D READ S Y=-1 Q"
^XTV(8991,40,1,2,1,47,0)=" S Y=1 Q"
^XTV(8991,40,1,"B",3070118.2236,1)=""
^XTV(8991,40,1,"B",3070123.1536,2)=""
^XTV(8991,41,0)="XUS"
^XTV(8991,41,1,0)="^8991.01^1^1"
^XTV(8991,41,1,1,0)="3070118.2236"
^XTV(8991,41,1,1,1,0)="^8991.11^158^158"
^XTV(8991,41,1,1,1,1,0)="XUS ;SFISC/STAFF - SIGNON ;1/18/07  22:36"
^XTV(8991,41,1,1,1,2,0)=" ;;8.0;KERNEL;**16,26,49,59,149,180,265,337,419,437**;Jul 10, 1995;Build 5"
^XTV(8991,41,1,1,1,3,0)=" ;Sign-on message numbers are 30810.51 to 30810.99"
^XTV(8991,41,1,1,1,4,0)=" S U=""^"" D INTRO^XUS1A()"
^XTV(8991,41,1,1,1,5,0)=" K  K ^XUTL(""ZISPARAM"",$I)"
^XTV(8991,41,1,1,1,6,0)=" S U=""^"",XQXFLG(""GUI"")=""^"""
^XTV(8991,41,1,1,1,7,0)=" W ! S $Y=0 D SET1(1) I POP S XUM=3 G NO ;Sets DUZ(""LANG"")"
^XTV(8991,41,1,1,1,8,0)=" S XUSTMP(51)=$$EZBLD^DIALOG(30810.51),XUSTMP(52)=$$EZBLD^DIALOG(30810.52)"
^XTV(8991,41,1,1,1,9,0)=" W !!,""Volume set: "",$P(XUENV,U,4),""  UCI: "",XUCI,""  Device: "",$I W:$S('$D(IO(""ZIO"")):0,1:$I'=IO(""ZIO"")) "" ("",IO(""ZIO""),"")"" W !"
^XTV(8991,41,1,1,1,10,0)="RESTART ;"
^XTV(8991,41,1,1,1,11,0)=" S XUM=$$SET2 G:XUM NO"
^XTV(8991,41,1,1,1,12,0)=" I $P(XU1,U,2)]"""" S XUM=$$DEVPAS() I XUM G H:XUM<0,NO"
^XTV(8991,41,1,1,1,13,0)=" ;S PGM=$P(XOPT,U,8),XUA=$P(PGM,""["",1) I XUA]"""" X XUEON G NEXT^XUS1"
^XTV(8991,41,1,1,1,14,0)="A S (XUSER(0),XUSER(1),XQUR)="""""
^XTV(8991,41,1,1,1,15,0)=" ;Check for locked IP/device."
^XTV(8991,41,1,1,1,16,0)=" I $$LKCHECK^XUSTZIP() S XUM=7,XUFAC=$P(XOPT,U,2),XUHALT=1 G NO"
^XTV(8991,41,1,1,1,17,0)=" ;Auto Sign-on check"
^XTV(8991,41,1,1,1,18,0)=" S X=$$AUTOXUS^XUS1B() I X>0 S DUZ=X D USER(DUZ) W !!,"">> Auto Sign-on: "",$P(XUSER(0),U),"" <<<"",! G B"
^XTV(8991,41,1,1,1,19,0)=" X XUEOFF S AV=$$ASKAV() X XUEON I AV=""^;^"" G H ;Get out"
^XTV(8991,41,1,1,1,20,0)=" I AV[""MAIL-BOX"",AV["";XMR"" S (XUA,PGM)=""XMR"",XMCHAN=$P($P(AV,"";""),"" "",2),DUZ=.5 G XMR^XUSCLEAN"
^XTV(8991,41,1,1,1,21,0)=" S XQUR=$P(AV,"";"",3)"
^XTV(8991,41,1,1,1,22,0)=" S DUZ=$$CHECKAV(AV) K AV"
^XTV(8991,41,1,1,1,23,0)=" S XUM=$$UVALID() G:XUM NO"
^XTV(8991,41,1,1,1,24,0)="B K XUF,%1 S XUF=0 X XUEON"
^XTV(8991,41,1,1,1,25,0)=" I DUZ D USER^XUS1 G:XUM NO"
^XTV(8991,41,1,1,1,26,0)=" I DUZ D SEC^XUS3:($D(^%ZIS(1,XUDEV,""TIME""))!$D(^(95))) G:XUM NO"
^XTV(8991,41,1,1,1,27,0)=" G NO:'DUZ"
^XTV(8991,41,1,1,1,28,0)=" S DTIME=$P(XOPT,U,10),X=$S(DUZ(""BUF""):"""",1:""NO-"")_""TYPE-AHEAD"" X:$D(^%ZOSF(X)) ^(X)"
^XTV(8991,41,1,1,1,29,0)=" D TT^XUS3:$G(XUTT)"
^XTV(8991,41,1,1,1,30,0)=" D CLRFAC^XUS3($G(IO(""IP"")))"
^XTV(8991,41,1,1,1,31,0)="PGM ;"
^XTV(8991,41,1,1,1,32,0)=" S Y=+$G(^%ZIS(1,XUDEV,201)) I Y>0,$$CHK S XQY=Y G OK"
^XTV(8991,41,1,1,1,33,0)=" S Y=+$G(^VA(200,DUZ,201)) I Y>0,$$CHK S XQY=Y G OK"
^XTV(8991,41,1,1,1,34,0)=" I $D(DUZ(""ASH"")) S Y=$O(^DIC(19,""B"",""XU NOP MENU"",0)) I Y>0 S XQY=Y G OK ;rwf 403"
^XTV(8991,41,1,1,1,35,0)=" S XUM=16"
^XTV(8991,41,1,1,1,36,0)=" G NO"
^XTV(8991,41,1,1,1,37,0)=" ;"
^XTV(8991,41,1,1,1,38,0)="OK D CHEK^XQ83"
^XTV(8991,41,1,1,1,39,0)=" S (XUA,PGM)=""XQ"""
^XTV(8991,41,1,1,1,40,0)=" G NEXT^XUS1"
^XTV(8991,41,1,1,1,41,0)=" ;"
^XTV(8991,41,1,1,1,42,0)="CHK() ;Check that option exeist and LOCK"
^XTV(8991,41,1,1,1,43,0)=" I $D(^DIC(19,Y,0)),$S($P(^(0),U,6)="""":1,1:$D(^XUSEC($P(^(0),U,6),DUZ))) Q 1"
^XTV(8991,41,1,1,1,44,0)=" Q 0"
^XTV(8991,41,1,1,1,45,0)=" ;"
^XTV(8991,41,1,1,1,46,0)="LC S X=$$UP(X)"
^XTV(8991,41,1,1,1,47,0)=" Q"
^XTV(8991,41,1,1,1,48,0)="UP(%) Q $TR(%,""abcdefghijklmnopqrstuvwxyz"",""ABCDEFGHIJKLMNOPQRSTUVWXYZ"")"
^XTV(8991,41,1,1,1,49,0)=" ;"
^XTV(8991,41,1,1,1,50,0)="FAC ;Failed access"
^XTV(8991,41,1,1,1,51,0)=" S:'DUZ XUF(.1)=$E(%1)"
^XTV(8991,41,1,1,1,52,0)=" S:XUF=2 XUF(.2)=XUF(.2)+1,XUF(XUF(.2))=%1 S %1="""" Q"
^XTV(8991,41,1,1,1,53,0)=" Q"
^XTV(8991,41,1,1,1,54,0)="NO ;Tell why didn't get on"
^XTV(8991,41,1,1,1,55,0)=" S X=$$NO^XUS3() G RESTART:'X ;fall into exit"
^XTV(8991,41,1,1,1,56,0)="H ;Exit point for all applications"
^XTV(8991,41,1,1,1,57,0)="C ;CLOSE"
^XTV(8991,41,1,1,1,58,0)=" G ^XUSCLEAN"
^XTV(8991,41,1,1,1,59,0)=" ;"
^XTV(8991,41,1,1,1,60,0)="ON X ^%ZOSF(""EON"") Q"
^XTV(8991,41,1,1,1,61,0)=" ;"
^XTV(8991,41,1,1,1,62,0)="ASKAV(PRE) ;Ask and return Access;Verify code, Turn off echo before calling"
^XTV(8991,41,1,1,1,63,0)=" N X,Y S PRE=$G(PRE)"
^XTV(8991,41,1,1,1,64,0)=" F  W !,PRE,XUSTMP(51) S X=$$ACCEPT S:X=""^"" X=""^;^"" Q:$L(X)"
^XTV(8991,41,1,1,1,65,0)=" S X=$TR(X,$C(9),"";"") ;Convert TAB to ; to match GUI."
^XTV(8991,41,1,1,1,66,0)=" I $P(X,"" "")=""MAIL-BOX"" S X=X_"";XMR"""
^XTV(8991,41,1,1,1,67,0)=" I $E(X,1,7)=""~~TOK~~"" Q X ;Use CCOW token"
^XTV(8991,41,1,1,1,68,0)=" I '$L($P(X,"";"",2)) W !,PRE,XUSTMP(52) S Y=$$ACCEPT S:Y=""^"" X=""^;"" S $P(X,"";"",2)=Y"
^XTV(8991,41,1,1,1,69,0)=" Q X"
^XTV(8991,41,1,1,1,70,0)=" ;"
^XTV(8991,41,1,1,1,71,0)=" ;Timeout used by XUSTZ call."
^XTV(8991,41,1,1,1,72,0)="ACCEPT(TO) ;Read A/V and echo '*' char."
^XTV(8991,41,1,1,1,73,0)=" ;Have the Read write to flush the buffer on some systems"
^XTV(8991,41,1,1,1,74,0)=" N C,A,E K DUOUT S A="""",TO=$G(TO,60),E=0"
^XTV(8991,41,1,1,1,75,0)=" F  D  Q:E"
^XTV(8991,41,1,1,1,76,0)=" . R """",*C:TO S:('$T) DUOUT=1 S:('$T)!(C=94) A=""^"""
^XTV(8991,41,1,1,1,77,0)=" . I (A=""^"")!(C=13)!($L(A)>60) S E=1 Q"
^XTV(8991,41,1,1,1,78,0)=" . I C=127 Q:'$L(A)  S A=$E(A,1,$L(A)-1) W $C(8,32,8) Q"
^XTV(8991,41,1,1,1,79,0)=" . S A=A_$C(C) W *42"
^XTV(8991,41,1,1,1,80,0)=" . Q"
^XTV(8991,41,1,1,1,81,0)=" Q A"
^XTV(8991,41,1,1,1,82,0)=" ; "
^XTV(8991,41,1,1,1,83,0)="CHECKAV(X1) ;Check A/V code return DUZ or Zero. (Called from XUSRB)"
^XTV(8991,41,1,1,1,84,0)=" N %,%1,X,Y,IEN,DA,DIK"
^XTV(8991,41,1,1,1,85,0)=" S IEN=0"
^XTV(8991,41,1,1,1,86,0)=" ;Start CCOW"
^XTV(8991,41,1,1,1,87,0)=" I $E(X1,1,7)=""~~TOK~~"" D  Q:IEN>0 IEN"
^XTV(8991,41,1,1,1,88,0)=" . I $E(X1,8,9)=""~1"" S IEN=$$CHKASH^XUSRB4($E(X1,8,255))"
^XTV(8991,41,1,1,1,89,0)=" . I $E(X1,8,9)=""~2"" S IEN=$$CHKCCOW^XUSRB4($E(X1,8,255))"
^XTV(8991,41,1,1,1,90,0)=" . Q"
^XTV(8991,41,1,1,1,91,0)=" ;End CCOW"
^XTV(8991,41,1,1,1,92,0)=" S:$P(^XTV(8989.3,1,0),U,8)'=""E"" X1=$$UP(X1) S:X1["":"" XUTT=1,X1=$TR(X1,"":"") ; Allow case sensitive for VOE"
^XTV(8991,41,1,1,1,93,0)=" S X=$P(X1,"";"") Q:X=""^"" -1 S:XUF %1=""Access: ""_X"
^XTV(8991,41,1,1,1,94,0)=" Q:X'?1.20ANP 0"
^XTV(8991,41,1,1,1,95,0)=" S X=$$EN^XUSHSH($$UP(X)) I '$D(^VA(200,""A"",X)) D LBAV Q 0 ; Case insensitive for Access Code for VOE"
^XTV(8991,41,1,1,1,96,0)=" S %1="""",IEN=$O(^VA(200,""A"",X,0)),XUF(.3)=IEN D USER(IEN)"
^XTV(8991,41,1,1,1,97,0)=" S X=$P(X1,"";"",2) S:XUF %1=""Verify: ""_X S X=$$EN^XUSHSH(X)"
^XTV(8991,41,1,1,1,98,0)=" I $P(XUSER(1),""^"",2)'=X D LBAV Q 0"
^XTV(8991,41,1,1,1,99,0)=" I $G(XUFAC(1)) S DIK=""^XUSEC(4,"",DA=XUFAC(1) D ^DIK"
^XTV(8991,41,1,1,1,100,0)=" Q IEN"
^XTV(8991,41,1,1,1,101,0)="LBAV ;Log Bad AV"
^XTV(8991,41,1,1,1,102,0)=" D:XUF FAC"
^XTV(8991,41,1,1,1,103,0)=" I IEN S X=$P($G(^VA(200,IEN,1.1)),U,2)+1,$P(^(1.1),""^"",2)=X"
^XTV(8991,41,1,1,1,104,0)=" Q"
^XTV(8991,41,1,1,1,105,0)=" ;"
^XTV(8991,41,1,1,1,106,0)="USER(IX) ;Build XUSER"
^XTV(8991,41,1,1,1,107,0)=" S XUSER(0)=$G(^VA(200,+IX,0)),XUSER(1)=$G(^(.1)),XUSER(1.1)=$G(^(1.1))"
^XTV(8991,41,1,1,1,108,0)=" Q"
^XTV(8991,41,1,1,1,109,0)=" ;"
^XTV(8991,41,1,1,1,110,0)="XUVOL ;Setup XUENV, XUCI,XQVOL,XUVOL"
^XTV(8991,41,1,1,1,111,0)=" S U=""^"" D GETENV^%ZOSV S XUENV=Y,XUCI=$P(Y,U,1),XQVOL=$P(Y,U,2)"
^XTV(8991,41,1,1,1,112,0)=" S X=$O(^XTV(8989.3,1,4,""B"",XQVOL,0)),XUVOL=$S(X>0:^XTV(8989.3,1,4,X,0),1:XQVOL_""^y^1"")"
^XTV(8991,41,1,1,1,113,0)=" Q"
^XTV(8991,41,1,1,1,114,0)=" ;"
^XTV(8991,41,1,1,1,115,0)="XOPT ;Setup initial XOPT"
^XTV(8991,41,1,1,1,116,0)=" S XOPT=$S($D(^XTV(8989.3,1,""XUS"")):^(""XUS""),1:"""")"
^XTV(8991,41,1,1,1,117,0)=" F I=2:1:15 I $P(XOPT,U,I)="""" S $P(XOPT,U,I)=$P(""^5^900^1^1^^^^1^300^^^^N^90"",U,I)"
^XTV(8991,41,1,1,1,118,0)=" Q"
^XTV(8991,41,1,1,1,119,0)=" ;"
^XTV(8991,41,1,1,1,120,0)="SET1(FLAG) ;Setup parameters (also called from XUSRB)"
^XTV(8991,41,1,1,1,121,0)=" N %"
^XTV(8991,41,1,1,1,122,0)=" S U=""^"",XUEON=^%ZOSF(""EON""),XUEOFF=^(""EOFF"")"
^XTV(8991,41,1,1,1,123,0)=" D XUVOL,XOPT S DUZ(""LANG"")=$P(XOPT,U,7) S:$P(XUVOL,U,6)=""y"" XRTL=XUCI_"",""_XQVOL"
^XTV(8991,41,1,1,1,124,0)=" K ^XUTL(""XQ"",$J) S XUF=0,XUDEV=0,DUZ=0,DUZ(0)=""@"",IOS=0,ION="""""
^XTV(8991,41,1,1,1,125,0)=" I FLAG S %ZIS=""L"",IOP=""HOME"" D ^%ZIS Q:POP"
^XTV(8991,41,1,1,1,126,0)=" S XUDEV=IOS,XUIOP=ION D:$D(XRTL) T0^%ZOSV"
^XTV(8991,41,1,1,1,127,0)=" D GETFAC^XUS3($G(IO(""IP"")))"
^XTV(8991,41,1,1,1,128,0)=" S %=$P(XOPT,U,14)"
^XTV(8991,41,1,1,1,129,0)=" I ""N""'[% D"
^XTV(8991,41,1,1,1,130,0)=" . S XUF=(%[""R"")+1,XUF(.1)="""",XUF(.2)=0,XUF(.3)=0"
^XTV(8991,41,1,1,1,131,0)=" . I %[""D"" S:$D(^XTV(8989.3,1,4.33,""B"",XUDEV))[0 XUF=0"
^XTV(8991,41,1,1,1,132,0)=" Q"
^XTV(8991,41,1,1,1,133,0)="SET2() ;EF. Return error code (also called from XUSRB)"
^XTV(8991,41,1,1,1,134,0)=" N %,X"
^XTV(8991,41,1,1,1,135,0)=" S XUNOW=$$HTFM^XLFDT($H),DT=$P(XUNOW,""."")"
^XTV(8991,41,1,1,1,136,0)=" K DUZ,XUSER"
^XTV(8991,41,1,1,1,137,0)=" S (DUZ,DUZ(2))=0,(DUZ(0),DUZ(""AG""),XUSER(0),XUSER(1),XUTT,%UCI)="""""
^XTV(8991,41,1,1,1,138,0)=" S %=$$INHIBIT^XUSRB() I %>0 Q %"
^XTV(8991,41,1,1,1,139,0)=" S X=$G(^%ZIS(1,XUDEV,""XUS"")),XU1=$G(^(1))"
^XTV(8991,41,1,1,1,140,0)=" I $L(X) F I=1:1:15 I $L($P(X,U,I)) S $P(XOPT,U,I)=$P(X,U,I)"
^XTV(8991,41,1,1,1,141,0)=" S DTIME=600"
^XTV(8991,41,1,1,1,142,0)=" I '$P(XOPT,U,11),$D(^%ZIS(1,XUDEV,90)),^(90)>2800000,^(90)'>DT Q 8"
^XTV(8991,41,1,1,1,143,0)=" I $D(XRT0) S XRTN=""XUS"" D T1^%ZOSV"
^XTV(8991,41,1,1,1,144,0)=" Q 0"
^XTV(8991,41,1,1,1,145,0)=" ;"
^XTV(8991,41,1,1,1,146,0)="UVALID() ;EF. Is it valid for this user to sign on?"
^XTV(8991,41,1,1,1,147,0)=" I DUZ'>0 Q 4"
^XTV(8991,41,1,1,1,148,0)=" I $P(XUSER(1.1),U,5),$P(XUSER(1.1),U,5)>XUNOW S XUM(0)=$$FMTE^XLFDT($P(XUSER(1.1),U,5),""2PM"") Q 18 ;User locked until"
^XTV(8991,41,1,1,1,149,0)=" I $P(XUSER(0),U,11),$P(XUSER(0),U,11)'>DT Q 11 ;Access Terminated"
^XTV(8991,41,1,1,1,150,0)=" I $P(XUSER(0),U,7) Q 5 ;Disuser flag set"
^XTV(8991,41,1,1,1,151,0)=" I '$L($P(XUSER(1),U,2)) Q 21 ;419"
^XTV(8991,41,1,1,1,152,0)=" Q 0"
^XTV(8991,41,1,1,1,153,0)=" ;"
^XTV(8991,41,1,1,1,154,0)="DEVPAS() ;EF. Ask device password"
^XTV(8991,41,1,1,1,155,0)=" X XUEOFF W !,""DEVICE PASSWORD: "" R X:60 X XUEON"
^XTV(8991,41,1,1,1,156,0)=" S X=$E(X,1,30) S:'$T X=""^"" D LC Q:X[""^"" -1 I $P(XU1,U,2)'=X S:XUF %1=""Device: ""_X D:XUF FAC Q 6"
^XTV(8991,41,1,1,1,157,0)=" Q 0"
^XTV(8991,41,1,1,1,158,0)=" ;"
^XTV(8991,41,1,"B",3070118.2236,1)=""
^XTV(8991,42,0)="ORWPT"
^XTV(8991,42,1,0)="^8991.01^1^1"
^XTV(8991,42,1,1,0)="3070118.2237"
^XTV(8991,42,1,1,1,0)="^8991.11^281^281"
^XTV(8991,42,1,1,1,1,0)="ORWPT ; SLC/KCM/REV - Patient Lookup Functions ;1/18/07  22:37"
^XTV(8991,42,1,1,1,2,0)=" ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,132,149,206,187,190,215,269**;Dec 17, 1997 LOCAL ;Build 12"
^XTV(8991,42,1,1,1,3,0)=" ;;VOE VWPT PACKAGE ENHANCEMENT UPDATES ADDED 11/14/06"
^XTV(8991,42,1,1,1,4,0)=" ;"
^XTV(8991,42,1,1,1,5,0)=" ; Ref. to ^UTILITY via IA 10061"
^XTV(8991,42,1,1,1,6,0)=" ;"
^XTV(8991,42,1,1,1,7,0)=" Q "
^XTV(8991,42,1,1,1,8,0)="IDINFO(REC,DFN) ; Return identifying information for a patient"
^XTV(8991,42,1,1,1,9,0)=" ;VWPT BELOW ADD HRN AND ALT HRN"
^XTV(8991,42,1,1,1,10,0)=" ; PID^DOB^SEX^VET^SC%^WARD^RM-BED^NAME^HRN^ALTHRN"
^XTV(8991,42,1,1,1,11,0)=" ; PID^DOB^SEX^VET^SC%^WARD^RM-BED^NAME"
^XTV(8991,42,1,1,1,12,0)=" N X0,X1,X101,X3,XV  ; name/dob/sex/ssn, ward, room-bed, sc%, vet"
^XTV(8991,42,1,1,1,13,0)=" S X0=$G(^DPT(DFN,0)),X1=$G(^(.1)),X101=$G(^(.101)),X3=$G(^(.3)),XV=$G(^(""VET""))"
^XTV(8991,42,1,1,1,14,0)=" ;VWPT ENHANCED"
^XTV(8991,42,1,1,1,15,0)=" N HRN,ID"
^XTV(8991,42,1,1,1,16,0)=" S HRN=$$HRN^DGLBPID(DFN)"
^XTV(8991,42,1,1,1,17,0)=" S ID=$$ID^DGLBPID(DFN)"
^XTV(8991,42,1,1,1,18,0)=" I (ID=HRN)&(HRN'="""") D"
^XTV(8991,42,1,1,1,19,0)=" .S REC=U_$$DOB^DPTLK1(DFN,2)_U_$P(X0,U,2)_U_$P(XV,U)_U_$P(X3,U,2)_U_$P(X1,U)_U_$P(X101,U)_U_$P(X0,U)_U_$$HRNRET(DFN)_U_$$ALTHRN(DFN) ;DG249"
^XTV(8991,42,1,1,1,20,0)=" E  D"
^XTV(8991,42,1,1,1,21,0)=" .S REC=$$ID^DGLBPID(DFN)_U_$$DOB^DPTLK1(DFN,2)_U_$P(X0,U,2)_U_$P(XV,U)_U_$P(X3,U,2)_U_$P(X1,U)_U_$P(X101,U)_U_$P(X0,U)_U_$$HRNRET(DFN)_U_$$ALTHRN(DFN) ;DG249"
^XTV(8991,42,1,1,1,22,0)=" ;S REC=$$SSN^DPTLK1(DFN)_U_$$DOB^DPTLK1(DFN,2)_U_$P(X0,U,2)_U_$P(XV,U)_U_$P(X3,U,2)_U_$P(X1,U)_U_$P(X101,U)_U_$P(X0,U) ;DG249"
^XTV(8991,42,1,1,1,23,0)=" ;END VWPT"
^XTV(8991,42,1,1,1,24,0)=" Q"
^XTV(8991,42,1,1,1,25,0)=" ;VWPT RETURN HRN .CHECK FOR ""sensitive"" patients"
^XTV(8991,42,1,1,1,26,0)="HRNRET(DFN) ;"
^XTV(8991,42,1,1,1,27,0)=" N IRET"
^XTV(8991,42,1,1,1,28,0)=" S IRET=$$HRN^DGLBPID(DFN) ;$$HRN^VWVOEDPT(DFN)"
^XTV(8991,42,1,1,1,29,0)=" ;I (IRET'="""")&$$SCREEN^DPTLK1(DFN) Q ""*SENSITIVE*""  ;""HRN SENSITIVE"""
^XTV(8991,42,1,1,1,30,0)=" I (IRET'="""") Q ""'""_IRET_""'"" ;""HRN:""_""'""_IRET_""'"""
^XTV(8991,42,1,1,1,31,0)=" Q """""
^XTV(8991,42,1,1,1,32,0)=" ; END VWPT"
^XTV(8991,42,1,1,1,33,0)="PTINQ(REF,DFN) ; Return formatted pt inquiry report"
^XTV(8991,42,1,1,1,34,0)=" K ^TMP(""ORDATA"",$J,1)"
^XTV(8991,42,1,1,1,35,0)=" D DGINQ^ORCXPND1(DFN)"
^XTV(8991,42,1,1,1,36,0)=" S REF=$NA(^TMP(""ORDATA"",$J,1))"
^XTV(8991,42,1,1,1,37,0)=" Q"
^XTV(8991,42,1,1,1,38,0)="SCDIS(LST,DFN) ; Return service connected % and rated disabilities"
^XTV(8991,42,1,1,1,39,0)=" N VAEL,VAERR,I,ILST,DIS,SC,X"
^XTV(8991,42,1,1,1,40,0)=" D ELIG^VADPT"
^XTV(8991,42,1,1,1,41,0)=" S LST(1)=""Service Connected: ""_$S(+VAEL(3):$P(VAEL(3),U,2)_""%"",1:""NO"")"
^XTV(8991,42,1,1,1,42,0)=" I 'VAEL(4),'$P($G(^DG(391,+VAEL(6),0)),U,2) S LST(2)=""NOT A VETERAN."" Q"
^XTV(8991,42,1,1,1,43,0)=" S I=0,ILST=1 F  S I=$O(^DPT(DFN,.372,I)) Q:'I  S X=^(I,0) D"
^XTV(8991,42,1,1,1,44,0)=" . S DIS=$P($G(^DIC(31,+X,0)),U) Q:DIS="""""
^XTV(8991,42,1,1,1,45,0)=" . S SC=$S($P(X,U,3):""SC"",$P(X,U,3)']"""":""not specified"",1:""NSC"")"
^XTV(8991,42,1,1,1,46,0)=" . S ILST=ILST+1,LST(ILST)=DIS_"" (""_$P(X,U,2)_""% ""_SC_"")"""
^XTV(8991,42,1,1,1,47,0)=" I ILST=1 S LST(2)=""Rated Disabilities: NONE STATED"""
^XTV(8991,42,1,1,1,48,0)=" Q"
^XTV(8991,42,1,1,1,49,0)="SHOW ; temporary - show patient inquiry screen"
^XTV(8991,42,1,1,1,50,0)=" N I,Y,DIC S DIC=2,DIC(0)=""AEMQ"" D ^DIC Q:'Y"
^XTV(8991,42,1,1,1,51,0)=" K ^TMP(""ORDATA"",$J,1)"
^XTV(8991,42,1,1,1,52,0)=" D DGINQ^ORCXPND1(+Y)"
^XTV(8991,42,1,1,1,53,0)=" S I=0 F  S I=$O(^TMP(""ORDATA"",$J,1,I)) Q:'I  W !,^(I)"
^XTV(8991,42,1,1,1,54,0)=" K ^TMP(""ORDATA"",$J,1)"
^XTV(8991,42,1,1,1,55,0)=" Q"
^XTV(8991,42,1,1,1,56,0)="SELCHK(REC,DFN) ; Check for sensitive pt"
^XTV(8991,42,1,1,1,57,0)=" ; SENSITIVE"
^XTV(8991,42,1,1,1,58,0)=" S REC=$$EN1^ORQPT2(DFN)"
^XTV(8991,42,1,1,1,59,0)=" Q"
^XTV(8991,42,1,1,1,60,0)="DIEDON(VAL,DFN) ; Check for a date of death"
^XTV(8991,42,1,1,1,61,0)=" S VAL=+$G(^DPT(DFN,.35))"
^XTV(8991,42,1,1,1,62,0)=" Q"
^XTV(8991,42,1,1,1,63,0)="SELECT(REC,DFN) ; Selects patient & returns key information"
^XTV(8991,42,1,1,1,64,0)=" ;  1    2   3   4    5      6    7    8       9       10      11  12"
^XTV(8991,42,1,1,1,65,0)=" ; NAME^SEX^DOB^SSN^LOCIEN^LOCNM^RMBD^CWAD^SENSITIVE^ADMITTED^CONV^SC^"
^XTV(8991,42,1,1,1,66,0)=" ;VWPT HRN , ALTERNATE HRN"
^XTV(8991,42,1,1,1,67,0)=" ; 13  14  15  16  17  18"
^XTV(8991,42,1,1,1,68,0)=" ; SC%^ICN^AGE^TS^HRN^AltHRN"
^XTV(8991,42,1,1,1,69,0)=" ; ;"
^XTV(8991,42,1,1,1,70,0)=" ; ;end vwpt"
^XTV(8991,42,1,1,1,71,0)=" ;"
^XTV(8991,42,1,1,1,72,0)=" ;"
^XTV(8991,42,1,1,1,73,0)=" ; for CCOW (RV - 2/27/03)  name=""-1"", location=error message"
^XTV(8991,42,1,1,1,74,0)=" I '$D(^DPT(DFN,0)) S REC=""-1^^^^^Patient is unknown to CPRS."" Q"
^XTV(8991,42,1,1,1,75,0)=" ;"
^XTV(8991,42,1,1,1,76,0)=" N X,ID,HRN"
^XTV(8991,42,1,1,1,77,0)=" K ^TMP(""ORWPCE"",$J) ; delete PCE 'cache' when switching patients"
^XTV(8991,42,1,1,1,78,0)=" ;VWPT NEW LOGIC . 4TH PIECE BELOW REPLACE $P(X,U,9)=SSN WITH ID AS $$ID^DGLBPID(DFN)"
^XTV(8991,42,1,1,1,79,0)=" ; THEN IF THIS VALUE = HRN AND BOTH '="""" THEN PUT SINGLE QUOTES"
^XTV(8991,42,1,1,1,80,0)=" ; AROUND 4TH PIECE AS THIS IS SAME AS HRN."
^XTV(8991,42,1,1,1,81,0)=" S ID=$$ID^DGLBPID(DFN) S HRN=$$HRN^DGLBPID(DFN)"
^XTV(8991,42,1,1,1,82,0)=" I (ID=HRN)&(HRN'="""") S ID=""'""_ID_""'"""
^XTV(8991,42,1,1,1,83,0)=" ;"
^XTV(8991,42,1,1,1,84,0)=" ;VWPT LINE BELOW WITH ID SUBSTITUTED FOR 9TH PIECE OF X "
^XTV(8991,42,1,1,1,85,0)=" S X=^DPT(DFN,0),REC=$P(X,U,1,3)_U_ID_U_U_$G(^(.1))_U_$G(^(.101))"
^XTV(8991,42,1,1,1,86,0)=" S X=$P(REC,U,6) I $L(X) S $P(REC,U,5)=+$G(^DIC(42,+$O(^DIC(42,""B"",X,0)),44))"
^XTV(8991,42,1,1,1,87,0)=" S $P(REC,U,8)=$$CWAD^ORQPT2(DFN)_U_$$EN1^ORQPT2(DFN)"
^XTV(8991,42,1,1,1,88,0)=" ; I $P(REC,U,9) D EN2^ORQPT2(DFN)  ;update DG security log ; DG249"
^XTV(8991,42,1,1,1,89,0)=" S X=$G(^DPT(DFN,.105)) I X S $P(REC,U,10)=$P($G(^DGPM(X,0)),U)"
^XTV(8991,42,1,1,1,90,0)=" S:'$D(IOST) IOST=""P-OTHER"""
^XTV(8991,42,1,1,1,91,0)=" S $P(REC,U,11)=$$OTF^OR3CONV(DFN,1)"
^XTV(8991,42,1,1,1,92,0)=" D ELIG^VADPT S $P(REC,U,12)=$G(VAEL(3)) ;two pieces: SC^SC%"
^XTV(8991,42,1,1,1,93,0)=" I $L($T(GETICN^MPIF001)) S X=+$$GETICN^MPIF001(DFN) S:X>0 $P(REC,U,14)=X"
^XTV(8991,42,1,1,1,94,0)=" S $P(REC,U,15)=$$AGE(DFN,$P(REC,U,3))"
^XTV(8991,42,1,1,1,95,0)=" S $P(REC,U,16)=+$G(^DPT(DFN,.103)) ; treating specialty"
^XTV(8991,42,1,1,1,96,0)=" ;VWPT  GET HRN AND ALTERNATE HRN"
^XTV(8991,42,1,1,1,97,0)=" S $P(REC,U,17)=""'""_$$HRN^DGLBPID(DFN)_""'"" ;$$HRN^VWVOEDPT(DFN)"
^XTV(8991,42,1,1,1,98,0)=" S $P(REC,U,18)=$$ALTHRN(DFN)"
^XTV(8991,42,1,1,1,99,0)=" K VAEL,VAERR ;VADPT call to kill?"
^XTV(8991,42,1,1,1,100,0)=" S ^DISV(DUZ,""^DPT("")=DFN"
^XTV(8991,42,1,1,1,101,0)=" Q"
^XTV(8991,42,1,1,1,102,0)=" ;VWPT GET ALT HRN"
^XTV(8991,42,1,1,1,103,0)="ALTHRN(DFN) ;"
^XTV(8991,42,1,1,1,104,0)=" Q """""
^XTV(8991,42,1,1,1,105,0)=" ;"
^XTV(8991,42,1,1,1,106,0)=" ;END VWPT"
^XTV(8991,42,1,1,1,107,0)="SHARE(VAL,IP,HWND,DFN) ; Set global to share DFN with other applications"
^XTV(8991,42,1,1,1,108,0)=" K ^TMP(""ORWCHART"",$J),^TMP(""ORECALL"",$J),^TMP(""ORWORD"",$J)"
^XTV(8991,42,1,1,1,109,0)=" K ^TMP(""ORWDXMQ"",$J)"
^XTV(8991,42,1,1,1,110,0)=" S ^TMP(""ORWCHART"",$J,IP,HWND)=DFN"
^XTV(8991,42,1,1,1,111,0)=" Q"
^XTV(8991,42,1,1,1,112,0)="BYWARD(LST,WARD) ; Return a list of patients in a ward"
^XTV(8991,42,1,1,1,113,0)=" N ILST,DFN"
^XTV(8991,42,1,1,1,114,0)=" I +$G(WARD)<1 S LST(1)=""^No ward identified"" Q"
^XTV(8991,42,1,1,1,115,0)=" S (ILST,DFN)=0"
^XTV(8991,42,1,1,1,116,0)=" S WARD=$P(^DIC(42,WARD,0),""^"")   ;DBIA #36"
^XTV(8991,42,1,1,1,117,0)=" F  S DFN=$O(^DPT(""CN"",WARD,DFN)) Q:DFN'>0  D"
^XTV(8991,42,1,1,1,118,0)=" . S ILST=ILST+1,LST(ILST)=+DFN_U_$P(^DPT(+DFN,0),U)_U_$G(^DPT(+DFN,.101))"
^XTV(8991,42,1,1,1,119,0)=" I ILST<1 S LST(1)=""^No patients found."""
^XTV(8991,42,1,1,1,120,0)=" Q"
^XTV(8991,42,1,1,1,121,0)="LAST5(LST,ID) ; Return a list of patients matching A9999 identifiers"
^XTV(8991,42,1,1,1,122,0)=" N I,IEN,XREF"
^XTV(8991,42,1,1,1,123,0)=" S (I,IEN)=0,XREF=$S($L(ID)=5:""BS5"",1:""BS"")"
^XTV(8991,42,1,1,1,124,0)=" F  S IEN=$O(^DPT(XREF,ID,IEN)) Q:'IEN  D"
^XTV(8991,42,1,1,1,125,0)=" . S I=I+1,LST(I)=IEN_U_$P(^DPT(IEN,0),U)_U_$$DOB^DPTLK1(IEN,2)_U_$$ID^DGLBPID(IEN) ;$$SSN^DPTLK1(IEN)  ; DG249"
^XTV(8991,42,1,1,1,126,0)=" Q"
^XTV(8991,42,1,1,1,127,0)=" ;"
^XTV(8991,42,1,1,1,128,0)="LAST5RPL(LST,ID) ; ; Return list matching A9999 id's, but from RPL only."
^XTV(8991,42,1,1,1,129,0)=" N ORRPL,ORCNT,ORPT,ORPIEN"
^XTV(8991,42,1,1,1,130,0)=" ; IA ____ allows read access to NEW PERSON file node 101:"
^XTV(8991,42,1,1,1,131,0)=" S ORRPL=$G(^VA(200,DUZ,101))"
^XTV(8991,42,1,1,1,132,0)=" S ORRPL=$P(ORRPL,U,2)"
^XTV(8991,42,1,1,1,133,0)=" I (('ORRPL)!(ORRPL="""")) S LST(0)="""" Q"
^XTV(8991,42,1,1,1,134,0)=" ;"
^XTV(8991,42,1,1,1,135,0)=" S (ORCNT,ORPT)=0"
^XTV(8991,42,1,1,1,136,0)=" F  S ORPT=$O(^OR(100.21,ORRPL,10,ORPT)) Q:'ORPT  D"
^XTV(8991,42,1,1,1,137,0)=" .S ORPIEN=+$G(^OR(100.21,ORRPL,10,ORPT,0))"
^XTV(8991,42,1,1,1,138,0)=" .I ((ORPIEN<0)!(ORPIEN="""")) Q"
^XTV(8991,42,1,1,1,139,0)=" .S ORCNT=ORCNT+1"
^XTV(8991,42,1,1,1,140,0)=" .S LST(ORCNT)=ORPIEN_U_$P(^DPT(ORPIEN,0),U)_U_$$DOB^DPTLK1(ORPIEN,2)_U_$$ID^DGLBPID(ORPIEN) ;$$SSN^DPTLK1(ORPIEN) ; DG249."
^XTV(8991,42,1,1,1,141,0)=" ;"
^XTV(8991,42,1,1,1,142,0)=" Q"
^XTV(8991,42,1,1,1,143,0)=" ;"
^XTV(8991,42,1,1,1,144,0)="FULLSSN(LST,ID) ; Return a list of patients matching full SSN entered"
^XTV(8991,42,1,1,1,145,0)=" N I,IEN"
^XTV(8991,42,1,1,1,146,0)=" S (I,IEN)=0"
^XTV(8991,42,1,1,1,147,0)=" F  S IEN=$O(^DPT(""SSN"",ID,IEN)) Q:'IEN  D"
^XTV(8991,42,1,1,1,148,0)=" . S I=I+1,LST(I)=IEN_U_$P(^DPT(IEN,0),U)_U_$$DOB^DPTLK1(IEN,2)_U_$$ID^DGLBPID(IEN) ;$$SSN^DPTLK1(IEN)  ; DG249"
^XTV(8991,42,1,1,1,149,0)=" Q"
^XTV(8991,42,1,1,1,150,0)=" ;"
^XTV(8991,42,1,1,1,151,0)="FSSNRPL(LST,ID) ; Return list matching Full SSN, but from RPL only."
^XTV(8991,42,1,1,1,152,0)=" N ORRPL,ORCNT,ORPT,ORLPT,ORPIEN"
^XTV(8991,42,1,1,1,153,0)=" ; IA ____ allows read access to NEW PERSON file node 101:"
^XTV(8991,42,1,1,1,154,0)=" S ORRPL=$G(^VA(200,DUZ,101))"
^XTV(8991,42,1,1,1,155,0)=" S ORRPL=$P(ORRPL,U,2)"
^XTV(8991,42,1,1,1,156,0)=" I (('ORRPL)!(ORRPL="""")) S LST(0)="""" Q"
^XTV(8991,42,1,1,1,157,0)=" ;"
^XTV(8991,42,1,1,1,158,0)=" S (ORCNT,ORPT)=0"
^XTV(8991,42,1,1,1,159,0)=" F  S ORPT=$O(^DPT(""SSN"",ID,ORPT)) Q:'ORPT  D"
^XTV(8991,42,1,1,1,160,0)=" .S ORLPT=0"
^XTV(8991,42,1,1,1,161,0)=" .F  S ORLPT=$O(^OR(100.21,ORRPL,10,ORLPT)) Q:'ORLPT  D"
^XTV(8991,42,1,1,1,162,0)=" ..S ORPIEN=+$G(^OR(100.21,ORRPL,10,ORLPT,0))"
^XTV(8991,42,1,1,1,163,0)=" ..I ((ORPIEN<0)!(ORPIEN="""")) Q"
^XTV(8991,42,1,1,1,164,0)=" ..I (ORPIEN'=ORPT) Q"
^XTV(8991,42,1,1,1,165,0)=" ..S ORCNT=ORCNT+1"
^XTV(8991,42,1,1,1,166,0)=" ..S LST(ORCNT)=ORPIEN_U_$P(^DPT(ORPIEN,0),U)_U_$$DOB^DPTLK1(ORPIEN,2)_U_$$ID^DGLBPID(ORPIEN) ;SSN^DPTLK1(ORPIEN) ; DG249."
^XTV(8991,42,1,1,1,167,0)=" ;"
^XTV(8991,42,1,1,1,168,0)=" Q"
^XTV(8991,42,1,1,1,169,0)=" ;"
^XTV(8991,42,1,1,1,170,0)="TOP(LST) ; Return top for all patients list (last selected for now)"
^XTV(8991,42,1,1,1,171,0)=" N IEN"
^XTV(8991,42,1,1,1,172,0)=" S IEN=$G(^DISV(DUZ,""^DPT(""))"
^XTV(8991,42,1,1,1,173,0)=" I IEN S LST(1)=IEN_U_$P($G(^DPT(IEN,0)),U)"
^XTV(8991,42,1,1,1,174,0)=" Q"
^XTV(8991,42,1,1,1,175,0)="ENCTITL(REC,DFN,LOC,PROV) ; Return external values for encounter"
^XTV(8991,42,1,1,1,176,0)=" ; LOCNAME^LOCABBR^ROOMBED^PROVNAME"
^XTV(8991,42,1,1,1,177,0)=" S $P(REC,U,1)=$P($G(^SC(+LOC,0)),U,1,2)"
^XTV(8991,42,1,1,1,178,0)=" S $P(REC,U,3)=$P($G(^DPT(DFN,.101)),U)"
^XTV(8991,42,1,1,1,179,0)=" S $P(REC,U,4)=$P($G(^VA(200,+PROV,0)),U)"
^XTV(8991,42,1,1,1,180,0)=" Q"
^XTV(8991,42,1,1,1,181,0)="LISTALL(Y,FROM,DIR) ; Return a bolus of patient names.  From is either Name or IEN^Name."
^XTV(8991,42,1,1,1,182,0)=" N I,IEN,CNT,FROMIEN,ORIDNAME S CNT=44,I=0,FROMIEN=0"
^XTV(8991,42,1,1,1,183,0)=" I $P(FROM,U,2)'="""" S FROMIEN=$P(FROM,U,1),FROM=$O(^DPT(""B"",$P(FROM,U,2)),-DIR)"
^XTV(8991,42,1,1,1,184,0)=" F  S FROM=$O(^DPT(""B"",FROM),DIR) Q:FROM=""""  D  Q:I=CNT"
^XTV(8991,42,1,1,1,185,0)=" . S IEN=FROMIEN,FROMIEN=0 F  S IEN=$O(^DPT(""B"",FROM,IEN)) Q:'IEN  D  Q:I=CNT"
^XTV(8991,42,1,1,1,186,0)=" . . S ORIDNAME="""""
^XTV(8991,42,1,1,1,187,0)=" . . S ORIDNAME=$G(^DPT(IEN,0)) ; Get zero node name."
^XTV(8991,42,1,1,1,188,0)=" . . ; S X1=$G(^DPT(IEN,.1))_"" ""_$G(^DPT(IEN,.101))"
^XTV(8991,42,1,1,1,189,0)=" . . S I=I+1 S Y(I)=IEN_U_FROM_U_U_U_U_$P(ORIDNAME,U) ;_""^""_X ; _""^""_X1  ;""   (""_X_"")"""
^XTV(8991,42,1,1,1,190,0)=" Q"
^XTV(8991,42,1,1,1,191,0)="APPTLST(LST,DFN) ; return a list of appointments"
^XTV(8991,42,1,1,1,192,0)=" ; APPTTIME^LOCIEN^LOCNAME^EXTSTATUS"
^XTV(8991,42,1,1,1,193,0)=" N ERR,ERRMSG,VASD,VAERR K ^UTILITY(""VASD"",$J)  ;IA 10061"
^XTV(8991,42,1,1,1,194,0)=" S VASD(""F"")=$$HTFM^XLFDT($H-30,1)"
^XTV(8991,42,1,1,1,195,0)=" S VASD(""T"")=$$HTFM^XLFDT($H+1,1)_"".2359"""
^XTV(8991,42,1,1,1,196,0)=" S VASD(""W"")=""123456789"""
^XTV(8991,42,1,1,1,197,0)=" D SDA^ORQRY01(.ERR,.ERRMSG)"
^XTV(8991,42,1,1,1,198,0)=" I ERR K ^UTILITY(""VASD"",$J) K LST S LST(1)=ERRMSG Q"
^XTV(8991,42,1,1,1,199,0)=" S I=0 F  S I=$O(^UTILITY(""VASD"",$J,I)) Q:'I  D"
^XTV(8991,42,1,1,1,200,0)=" . S LST(I)=$P(^UTILITY(""VASD"",$J,I,""I""),U,1,2)_U_$P(^(""E""),U,2,3)"
^XTV(8991,42,1,1,1,201,0)=" K ^UTILITY(""VASD"",$J)"
^XTV(8991,42,1,1,1,202,0)=" Q"
^XTV(8991,42,1,1,1,203,0)="ADMITLST(LST,DFN) ; return a list of admissions"
^XTV(8991,42,1,1,1,204,0)=" ; MOVETIME^LOCIEN^LOCNAME^TYPE"
^XTV(8991,42,1,1,1,205,0)=" N TIM,MOV,X0,Y,MTIM,XTYP,XLOC,HLOC,ILST S ILST=0"
^XTV(8991,42,1,1,1,206,0)=" S TIM="""" F  S TIM=$O(^DGPM(""ATID1"",DFN,TIM)) Q:TIM'>0  D"
^XTV(8991,42,1,1,1,207,0)=" . S MOV=0  F  S MOV=$O(^DGPM(""ATID1"",DFN,TIM,MOV)) Q:MOV'>0  D"
^XTV(8991,42,1,1,1,208,0)=" . . N VSTR,TIUDA"
^XTV(8991,42,1,1,1,209,0)=" . . S X0=$G(^DGPM(MOV,0)) I X0']"""" Q"
^XTV(8991,42,1,1,1,210,0)=" . . S MTIM=$P(X0,U)"
^XTV(8991,42,1,1,1,211,0)=" . . S XTYP=$P($G(^DG(405.1,+$P(X0,U,4),0)),U,1)"
^XTV(8991,42,1,1,1,212,0)=" . . S XLOC=$P($G(^DIC(42,+$P(X0,U,6),0)),U,1),HLOC=+$G(^(44))"
^XTV(8991,42,1,1,1,213,0)=" . . S VSTR=HLOC_"";""_MTIM_"";H"",TIUDA=$$HASDS^TIULX(DFN,VSTR)"
^XTV(8991,42,1,1,1,214,0)=" . . S ILST=ILST+1,LST(ILST)=MTIM_U_HLOC_U_XLOC_U_XTYP_U_MOV_U_TIUDA"
^XTV(8991,42,1,1,1,215,0)=" Q"
^XTV(8991,42,1,1,1,216,0)="CLINRNG(LST) ; return date ranges for clinic appointments"
^XTV(8991,42,1,1,1,217,0)=" S LST(1)=""T;T^Today"""
^XTV(8991,42,1,1,1,218,0)=" S LST(2)=""T+1;T+1^Tomorrow"""
^XTV(8991,42,1,1,1,219,0)=" S LST(3)=""T-1;T-1^Yesterday"""
^XTV(8991,42,1,1,1,220,0)=" S LST(4)=""T-7;T^Past Week"""
^XTV(8991,42,1,1,1,221,0)=" S LST(5)=""T-31;T^Past Month"""
^XTV(8991,42,1,1,1,222,0)=" S LST(6)=""S^Specify Date Range..."""
^XTV(8991,42,1,1,1,223,0)=" Q"
^XTV(8991,42,1,1,1,224,0)=" ;"
^XTV(8991,42,1,1,1,225,0)=" N %,%H,X,SUNDAY,START"
^XTV(8991,42,1,1,1,226,0)=" S LST(1)=DT_"";""_DT_""^Today"",X=$$HTFM^XLFDT($H+1,1)"
^XTV(8991,42,1,1,1,227,0)=" S LST(2)=X_"";""_X_""^Tomorrow"""
^XTV(8991,42,1,1,1,228,0)=" S X=+$H F  Q:X#7=3  S X=X-1                        ; $H#7=3 is Sunday"
^XTV(8991,42,1,1,1,229,0)=" S LST(3)=$$HTFM^XLFDT(X)_"";""_$$HTFM^XLFDT(X+6)_""^This Week"""
^XTV(8991,42,1,1,1,230,0)=" S LST(4)=$$HTFM^XLFDT(X+7)_"";""_$$HTFM^XLFDT(X+13)_""^Next Week"""
^XTV(8991,42,1,1,1,231,0)=" S LST(5)=$E(DT,1,5)_""01;""_$E(DT,1,5)_""31^This Month"""
^XTV(8991,42,1,1,1,232,0)=" S X=$E(DT,4,5)+1 S:X=13 X=1 S X=$E(DT,1,3)_$TR($J(X,2),"" "",0)"
^XTV(8991,42,1,1,1,233,0)=" S LST(6)=X_""01;""_X_""31^Next Month"""
^XTV(8991,42,1,1,1,234,0)=" S LST(7)=""^Specify Dates"""
^XTV(8991,42,1,1,1,235,0)=" Q"
^XTV(8991,42,1,1,1,236,0)="DFLTSRC(VAL) ; return default patient list source (T, W, C, P, S)"
^XTV(8991,42,1,1,1,237,0)=" N SRV S SRV=+$G(^VA(200,DUZ,5))"
^XTV(8991,42,1,1,1,238,0)=" S VAL=$$GET^XPAR(""ALL^SRV.`""_SRV,""ORLP DEFAULT LIST SOURCE"")"
^XTV(8991,42,1,1,1,239,0)=" Q"
^XTV(8991,42,1,1,1,240,0)="SAVDFLT(OK,X) ; save new default patient list settings (X=type^ien^sdt;edt)"
^XTV(8991,42,1,1,1,241,0)=" G SAVDFLT^ORWPT1"
^XTV(8991,42,1,1,1,242,0)=" ;"
^XTV(8991,42,1,1,1,243,0)="DISCHRG(Y,DFN,ADMITDT) ; Get discharge movement information"
^XTV(8991,42,1,1,1,244,0)=" N VAIP"
^XTV(8991,42,1,1,1,245,0)=" I +$G(ADMITDT)=0 S Y=DT Q"
^XTV(8991,42,1,1,1,246,0)=" S VAIP(""D"")=ADMITDT D 52^VADPT"
^XTV(8991,42,1,1,1,247,0)=" I +VAIP(17)=0 S Y=DT Q"
^XTV(8991,42,1,1,1,248,0)=" S Y=+VAIP(17,1)"
^XTV(8991,42,1,1,1,249,0)=" Q"
^XTV(8991,42,1,1,1,250,0)="CWAD(Y,DFN) ;  returns CWAD flags for a patient"
^XTV(8991,42,1,1,1,251,0)=" S Y=$$CWAD^ORQPT2(DFN)"
^XTV(8991,42,1,1,1,252,0)=" Q"
^XTV(8991,42,1,1,1,253,0)="LEGACY(ORLST,DFN) ; return message if data on the legacy system"
^XTV(8991,42,1,1,1,254,0)=" ; ORLST(0)=1 if data,  ORLST(n)=display message if data"
^XTV(8991,42,1,1,1,255,0)=" S ORLST(0)=0"
^XTV(8991,42,1,1,1,256,0)=" I $L($T(HXDATA^A7RDPAGU)) D"
^XTV(8991,42,1,1,1,257,0)=" . D HXDATA^A7RDPAGU(.ORLST,DFN)"
^XTV(8991,42,1,1,1,258,0)=" . I $O(ORLST(0)) S ORLST(0)=1"
^XTV(8991,42,1,1,1,259,0)=" Q"
^XTV(8991,42,1,1,1,260,0)="INPLOC(REC,DFN) ; Return a patient's current location"
^XTV(8991,42,1,1,1,261,0)=" N X"
^XTV(8991,42,1,1,1,262,0)=" S X=$G(^DPT(DFN,.102)),REC=0"
^XTV(8991,42,1,1,1,263,0)=" I X S X=$P($G(^DGPM(X,0)),U,6)"
^XTV(8991,42,1,1,1,264,0)=" I X S REC=+$G(^DIC(42,X,44))"
^XTV(8991,42,1,1,1,265,0)=" I X S $P(REC,U,2)=$P($G(^DIC(42,X,0)),U,1)"
^XTV(8991,42,1,1,1,266,0)=" I X S X=$P($G(^DIC(42,X,0)),U,3)"
^XTV(8991,42,1,1,1,267,0)=" S $P(REC,U,3)=X"
^XTV(8991,42,1,1,1,268,0)=" Q"
^XTV(8991,42,1,1,1,269,0)="AGE(DFN,BEG) ; returns age based on date of birth and date of death (or DT)"
^XTV(8991,42,1,1,1,270,0)=" N END,X"
^XTV(8991,42,1,1,1,271,0)=" S END=+$G(^DPT(DFN,.35)),END=$S(END:END,1:DT)"
^XTV(8991,42,1,1,1,272,0)=" S X=$E(END,1,3)-$E(BEG,1,3)-($E(END,4,7)<$E(BEG,4,7))"
^XTV(8991,42,1,1,1,273,0)=" Q X"
^XTV(8991,42,1,1,1,274,0)="ROK(X) ; Routine OK (in UCI) (NDBI)"
^XTV(8991,42,1,1,1,275,0)=" S X=$G(X) Q:'$L(X) 0  Q:$L(X)>8 0  X ^%ZOSF(""TEST"") Q:$T 1  Q 0"
^XTV(8991,42,1,1,1,276,0)=" ;"
^XTV(8991,42,1,1,1,277,0)=" ;NDBI(X) ; National Database Integration site 1 = yes  0 = no"
^XTV(8991,42,1,1,1,278,0)=" ; N R,G S X=""A7RDUP"" X ^%ZOSF(""TEST"") S R=$T,G=$S($D(^A7RCP):1,1:0),X=R+G,X=$S(X=2:1,1:0) Q X"
^XTV(8991,42,1,1,1,279,0)=" ;"
^XTV(8991,42,1,1,1,280,0)=" "
^XTV(8991,42,1,1,1,281,0)=" "
^XTV(8991,42,1,"B",3070118.2237,1)=""
^XTV(8991,43,0)="ORWPT2"
^XTV(8991,43,1,0)="^8991.01^1^1"
^XTV(8991,43,1,1,0)="3070118.2238"
^XTV(8991,43,1,1,1,0)="^8991.11^164^164"
^XTV(8991,43,1,1,1,1,0)="ORWPT2 ; VOE//GT/GOW REV - Patient Lookup Functions ;1/18/07  22:38"
^XTV(8991,43,1,1,1,2,0)=" ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,132,149,206,187,190,215,269**;Dec 17, 1997 LOCAL ;Build 12"
^XTV(8991,43,1,1,1,3,0)=" ;;VOE VWPT PACKAGE ENHANCEMENT UPDATES ADDED 11/14/06"
^XTV(8991,43,1,1,1,4,0)=" ;GFT PATIENT LOOKUP' RPC CALLS HERE FOR GENERAL PATIENT LOOKUP"
^XTV(8991,43,1,1,1,5,0)=" ; Ref. to ^UTILITY via IA 10061"
^XTV(8991,43,1,1,1,6,0)=" ;"
^XTV(8991,43,1,1,1,7,0)=" Q"
^XTV(8991,43,1,1,1,8,0)=" ;VWVOEDPT ;GFT  VOE PATIENT LOOKUP;6OCT2006"
^XTV(8991,43,1,1,1,9,0)=" ;;5.3;Registration;VWVF VOE LOCAL"
^XTV(8991,43,1,1,1,10,0)=" ;"
^XTV(8991,43,1,1,1,11,0)=" ;;Q"
^XTV(8991,43,1,1,1,12,0)=" ; "
^XTV(8991,43,1,1,1,13,0)="LOOKUP(LST,X1) ;'GFT PATIENT LOOKUP' RPC CALLS HERE FOR GENERAL PATIENT LOOKUP"
^XTV(8991,43,1,1,1,14,0)=" K LST"
^XTV(8991,43,1,1,1,15,0)=" N GFTI,I,X,ILEN,IEN2,IENN,TAB,ILENP,X3,IEND,CR,XX"
^XTV(8991,43,1,1,1,16,0)=" N IRET"
^XTV(8991,43,1,1,1,17,0)=" S X=X1"
^XTV(8991,43,1,1,1,18,0)=" I X="""" Q"
^XTV(8991,43,1,1,1,19,0)=" S IEND=0"
^XTV(8991,43,1,1,1,20,0)=" ;UPPERCASE IT"
^XTV(8991,43,1,1,1,21,0)=" X ""F %=1:1:$L(X) S:$E(X,%)?1L X=$E(X,0,%-1)_$C($A(X,%)-32)_$E(X,%+1,999)"""
^XTV(8991,43,1,1,1,22,0)=" S ILEN=$L(X)"
^XTV(8991,43,1,1,1,23,0)=" ;CHECK INPUT  TAB POSTION 20, 25, 30 WITH PRECEDING TRAILING BLANKS"
^XTV(8991,43,1,1,1,24,0)=" ;CHECK FOR INITITAL LOOKUP BY DFN AS !DFN"
^XTV(8991,43,1,1,1,25,0)=" ;CHECK FOR LOOKUP BY DFN AS 3 TAB POSITION FOR CLICKING AFTER PREVIOUS LOOKUP"
^XTV(8991,43,1,1,1,26,0)=" S TAB=$C(9)"
^XTV(8991,43,1,1,1,27,0)=" S X3=$P(X,TAB,3)"
^XTV(8991,43,1,1,1,28,0)=" I X3'="""" D"
^XTV(8991,43,1,1,1,29,0)=" .S X=X3"
^XTV(8991,43,1,1,1,30,0)=" .S ILENP=$L(X)"
^XTV(8991,43,1,1,1,31,0)=" .S X=$E(X,2,ILENP) ;TAKEOUT !"
^XTV(8991,43,1,1,1,32,0)=" .S U=""^"",(GFTI,I)=0"
^XTV(8991,43,1,1,1,33,0)=" .D LISTPOPD(X)"
^XTV(8991,43,1,1,1,34,0)=" .S IEND=1"
^XTV(8991,43,1,1,1,35,0)=" E  D"
^XTV(8991,43,1,1,1,36,0)=" .S X=$P(X,TAB,1)"
^XTV(8991,43,1,1,1,37,0)=" I IEND=1 Q"
^XTV(8991,43,1,1,1,38,0)=" ;I $E(X1,1,1)=""!"" D"
^XTV(8991,43,1,1,1,39,0)=" ;.I ILEN'=1 S X=$E(X1,2,ILEN)"
^XTV(8991,43,1,1,1,40,0)=" ;.;"
^XTV(8991,43,1,1,1,41,0)=" ;.S IEND=1"
^XTV(8991,43,1,1,1,42,0)=" ;I IEND=1 Q"
^XTV(8991,43,1,1,1,43,0)=" I $E(X1,1,1)=""'"" D"
^XTV(8991,43,1,1,1,44,0)=" .I ILEN'=1 S X=$E(X1,2,ILEN)"
^XTV(8991,43,1,1,1,45,0)=" .;CHECK FOR ENDING ""'"""
^XTV(8991,43,1,1,1,46,0)=" .S CR=$C(13)"
^XTV(8991,43,1,1,1,47,0)=" .I $E(X1,ILEN,ILEN)'=""'"" S IEND=1"
^XTV(8991,43,1,1,1,48,0)=" .S X=$P(X,""'"",1)"
^XTV(8991,43,1,1,1,49,0)=" S U=""^"",(GFTI,I)=0"
^XTV(8991,43,1,1,1,50,0)=" I IEND=1 Q"
^XTV(8991,43,1,1,1,51,0)=" S XX=X    ; NO CR FOR HRN"
^XTV(8991,43,1,1,1,52,0)=" F  S IRET=$$CHKX(X) Q:IRET'=1  S I=$O(^AUPNPAT(""D"",X,I)) Q:'I  I X=$$HRN^DGLBPID(I) D LISTPOPH(I)  ;I X=$P($$HRN^DGLBPID(I),""#"",2"
^XTV(8991,43,1,1,1,53,0)=" Q:GFTI"
^XTV(8991,43,1,1,1,54,0)=" ;G OVETT"
^XTV(8991,43,1,1,1,55,0)=" ;Q:ILEN<4"
^XTV(8991,43,1,1,1,56,0)=" ;"
^XTV(8991,43,1,1,1,57,0)=" S X=XX"
^XTV(8991,43,1,1,1,58,0)=" ;NOW CHECK FOR B CROSS REFERENCE"
^XTV(8991,43,1,1,1,59,0)=" D FIND^DIC(2,,,""MPC"",X,,""B"") ; ^SSN^BS5"")"
^XTV(8991,43,1,1,1,60,0)=" F I=0:0 S I=$O(^TMP(""DILIST"",$J,I)) Q:'I  D LISTPOPB(+^(I,0))"
^XTV(8991,43,1,1,1,61,0)=" ;W !,""$J="",$J"
^XTV(8991,43,1,1,1,62,0)=" ;K ^TMP(""DILIST"",$J)"
^XTV(8991,43,1,1,1,63,0)=" Q:GFTI>0"
^XTV(8991,43,1,1,1,64,0)="OVETT ;"
^XTV(8991,43,1,1,1,65,0)=" Q:ILEN<4  ;USE ADOB LOOKUP XXX-"
^XTV(8991,43,1,1,1,66,0)=" D FIND^DIC(2,,,""MPC"",X,,""ADOB^B"") ;^SSN^BS5"")"
^XTV(8991,43,1,1,1,67,0)=" ;D FIND^DIC(2,,,""MPC"",X,,""B^ADOB"") ;^SSN^BS5"")"
^XTV(8991,43,1,1,1,68,0)=" ;D FIND^DIC(2,,,""MPC"",X,,""B^ADOB^SSN^BS5^AZVWVOE"")"
^XTV(8991,43,1,1,1,69,0)=" ;D FIND^DIC(2,,,""MPC"",X,,""B^ADOB^SSN^BS5^ZVW2"")"
^XTV(8991,43,1,1,1,70,0)=" F I=0:0 S I=$O(^TMP(""DILIST"",$J,I)) Q:'I  D LISTPOP(+^(I,0),X1)"
^XTV(8991,43,1,1,1,71,0)=" ;W !,""$J="",$J"
^XTV(8991,43,1,1,1,72,0)=" K ^TMP(""DILIST"",$J)"
^XTV(8991,43,1,1,1,73,0)=" Q:GFTI>0"
^XTV(8991,43,1,1,1,74,0)=" ;TRY PHONE # WITH TRANSLATE"
^XTV(8991,43,1,1,1,75,0)=" Q:ILEN<6"
^XTV(8991,43,1,1,1,76,0)=" S X=$E($TR(X,""ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz!@#$%^&*()-_=+[]{}<>,./?:;'\|""),1,30)"
^XTV(8991,43,1,1,1,77,0)=" D FIND^DIC(2,,,""MPC"",X,,""AZVWVOE^B"") ;^SSN^BS5"")"
^XTV(8991,43,1,1,1,78,0)=" ;D FIND^DIC(2,,,""MPC"",X,,""B^AZVWVOE"") ;^SSN^BS5"")"
^XTV(8991,43,1,1,1,79,0)=" F I=0:0 S I=$O(^TMP(""DILIST"",$J,I)) Q:'I  D LISTPOPP(+^(I,0),X1)"
^XTV(8991,43,1,1,1,80,0)=" ;W !,""$J="",$J"
^XTV(8991,43,1,1,1,81,0)=" K ^TMP(""DILIST"",$J)"
^XTV(8991,43,1,1,1,82,0)=" Q"
^XTV(8991,43,1,1,1,83,0)="CHKX(X) ;CHECK TO SEE IF LEGITIMATE HRN EXISTS FOR IHS PATIENT HRN"
^XTV(8991,43,1,1,1,84,0)=" N IDX,ILENM1,IFLAG"
^XTV(8991,43,1,1,1,85,0)=" S IFLAG=0"
^XTV(8991,43,1,1,1,86,0)=" S IDX=X"
^XTV(8991,43,1,1,1,87,0)=" ;TO SEE blank char inserts"
^XTV(8991,43,1,1,1,88,0)=" S ILENM1=$L(X)-1"
^XTV(8991,43,1,1,1,89,0)=" I ILENM1>0 D"
^XTV(8991,43,1,1,1,90,0)="  .S IDX=$E(X,1,ILENM1)"
^XTV(8991,43,1,1,1,91,0)=" E  D"
^XTV(8991,43,1,1,1,92,0)=" .S IDX="""""
^XTV(8991,43,1,1,1,93,0)=" F  S IDX=$O(^AUPNPAT(""D"",IDX)) Q:(IDX="""")!(IFLAG=1)  D"
^XTV(8991,43,1,1,1,94,0)=" . I IDX=X S IFLAG=1"
^XTV(8991,43,1,1,1,95,0)=" Q IFLAG"
^XTV(8991,43,1,1,1,96,0)="CHKXB(X1) ;CHECK TO SEE IF PATIENT NAME ENTERED TO ALLOW LOOKUP EVEN FOR SENSITIVE PATIENT"
^XTV(8991,43,1,1,1,97,0)=" N IDX,ILENM1,IFLAG,X"
^XTV(8991,43,1,1,1,98,0)=" S IFLAG=0"
^XTV(8991,43,1,1,1,99,0)=" S X=X1"
^XTV(8991,43,1,1,1,100,0)=" ;CONVERT UPPER CASE"
^XTV(8991,43,1,1,1,101,0)=" X ""F %=1:1:$L(X) S:$E(X,%)?1L X=$E(X,0,%-1)_$C($A(X,%)-32)_$E(X,%+1,999)"""
^XTV(8991,43,1,1,1,102,0)=" S IDX=X"
^XTV(8991,43,1,1,1,103,0)=" ;S ^TMP(""WELCH1"")=X"
^XTV(8991,43,1,1,1,104,0)=" ;TO SEE blank char inserts"
^XTV(8991,43,1,1,1,105,0)=" S ILENM1=$L(X)-1"
^XTV(8991,43,1,1,1,106,0)=" I ILENM1>0 D"
^XTV(8991,43,1,1,1,107,0)="  .S IDX=$E(X,1,ILENM1)"
^XTV(8991,43,1,1,1,108,0)=" E  D"
^XTV(8991,43,1,1,1,109,0)=" .S IDX="""""
^XTV(8991,43,1,1,1,110,0)=" F  S IDX=$O(^DPT(""B"",IDX)) Q:(IDX="""")!(IFLAG=1)  D"
^XTV(8991,43,1,1,1,111,0)=" . I IDX=X S IFLAG=1"
^XTV(8991,43,1,1,1,112,0)=" Q IFLAG"
^XTV(8991,43,1,1,1,113,0)="LISTPOPB(DFN) ;PATIENT NAME B X-REF"
^XTV(8991,43,1,1,1,114,0)=" N IEN"
^XTV(8991,43,1,1,1,115,0)=" N HRN,PHONE,X"
^XTV(8991,43,1,1,1,116,0)=" ;S X=$P(X1,"" "",1)"
^XTV(8991,43,1,1,1,117,0)=" ;S IEN=$$CHKXB(X1) ;ALLOW INPUT BY NAME ON CLICK"
^XTV(8991,43,1,1,1,118,0)=" ;Q:IEN=1"
^XTV(8991,43,1,1,1,119,0)=" Q:($$SCREEN^DPTLK1(DFN))  ;SCREEN FOR VIP"
^XTV(8991,43,1,1,1,120,0)=" Q:GFTI=-1  I GFTI>500 K LST S GFTI=-1 ;WE RETURN 500 VALUES MAX"
^XTV(8991,43,1,1,1,121,0)=" S PHONE=$P($G(^DPT(DFN,.13)),U),HRN=$$HRN^DGLBPID(DFN)"
^XTV(8991,43,1,1,1,122,0)=" S GFTI=GFTI+1,LST(GFTI)=DFN_U_$P(^DPT(DFN,0),U)_U_$$DOB^DPTLK1(DFN,2)_TAB_""!""_DFN_U_$$ID^DGLBPID(DFN)_U_""'""_HRN_""'""_U_PHONE"
^XTV(8991,43,1,1,1,123,0)=" ;S GFTI=GFTI+1,LST(GFTI)=DFN_U_$P(^DPT(DFN,0),U)_U_$$FMTE^XLFDT($P(^(0),U,3))_TAB_""!""_DFN_U_$$ID^DGLBPID(DFN)_U_""'""_HRN_""'""_U_PHONE"
^XTV(8991,43,1,1,1,124,0)=" Q"
^XTV(8991,43,1,1,1,125,0)="LISTPOP(DFN,X1) ;DOB"
^XTV(8991,43,1,1,1,126,0)=" N IEN"
^XTV(8991,43,1,1,1,127,0)=" N HRN,PHONE,X"
^XTV(8991,43,1,1,1,128,0)=" ;S X=$P(X1,"" "",1)"
^XTV(8991,43,1,1,1,129,0)=" S IEN=$$CHKXB(X1) ;ALLOW INPUT BY NAME ON CLICK"
^XTV(8991,43,1,1,1,130,0)=" ;Q:IEN=1"
^XTV(8991,43,1,1,1,131,0)=" Q:($$SCREEN^DPTLK1(DFN))&(IEN=0)  ;SCREEN FOR VIP"
^XTV(8991,43,1,1,1,132,0)=" Q:GFTI=-1  I GFTI>500 K LST S GFTI=-1 ;WE RETURN 500 VALUES MAX"
^XTV(8991,43,1,1,1,133,0)=" S PHONE=$P($G(^DPT(DFN,.13)),U),HRN=$$HRN^DGLBPID(DFN)"
^XTV(8991,43,1,1,1,134,0)=" S GFTI=GFTI+1,LST(GFTI)=DFN_U_$P(^DPT(DFN,0),U)_U_$$DOB^DPTLK1(DFN,2)_TAB_""!""_DFN_U_$$ID^DGLBPID(DFN)_U_""'""_HRN_""'""_U_PHONE"
^XTV(8991,43,1,1,1,135,0)=" Q"
^XTV(8991,43,1,1,1,136,0)="LISTPOPP(DFN,X1) ;PHONE #"
^XTV(8991,43,1,1,1,137,0)=" N IEN"
^XTV(8991,43,1,1,1,138,0)=" N HRN,PHONE,X"
^XTV(8991,43,1,1,1,139,0)=" ;S X=$P(X1,"" "",1)"
^XTV(8991,43,1,1,1,140,0)=" S IEN=$$CHKXB(X1) ;ALLOW INPUT BY NAME ON CLICK"
^XTV(8991,43,1,1,1,141,0)=" ;Q:IEN=1"
^XTV(8991,43,1,1,1,142,0)=" Q:($$SCREEN^DPTLK1(DFN))&(IEN=0)  ;SCREEN FOR VIP"
^XTV(8991,43,1,1,1,143,0)=" Q:GFTI=-1  I GFTI>500 K LST S GFTI=-1 ;WE RETURN 500 VALUES MAX"
^XTV(8991,43,1,1,1,144,0)=" S PHONE=$P($G(^DPT(DFN,.13)),U),HRN=$$HRN^DGLBPID(DFN)"
^XTV(8991,43,1,1,1,145,0)=" S GFTI=GFTI+1,LST(GFTI)=DFN_U_$P(^DPT(DFN,0),U)_U_PHONE_TAB_""!""_DFN_U_$$ID^DGLBPID(DFN)_U_""'""_HRN_""'""_U_PHONE"
^XTV(8991,43,1,1,1,146,0)=" Q"
^XTV(8991,43,1,1,1,147,0)=" ;"
^XTV(8991,43,1,1,1,148,0)="LISTPOPH(DFN) ;Q:$$SCREEN^DPTLK1(DFN)  ;SCREEN FOR VIP FOR HRN "
^XTV(8991,43,1,1,1,149,0)=" N HRN,PHONE"
^XTV(8991,43,1,1,1,150,0)=" Q:GFTI=-1  I GFTI>500 K LST S GFTI=-1 ;WE RETURN 500 VALUES MAX"
^XTV(8991,43,1,1,1,151,0)=" S PHONE=$P($G(^DPT(DFN,.13)),U),HRN=$$HRN^DGLBPID(DFN)"
^XTV(8991,43,1,1,1,152,0)=" S GFTI=GFTI+1,LST(GFTI)=DFN_U_$P(^DPT(DFN,0),U)_U_""'""_HRN_""'""_TAB_""!""_DFN_U_$$FMTE^XLFDT($P(^(0),U,3))_U_$$ID^DGLBPID(DFN)_U_""'""_HRN_""'""_U_PHONE"
^XTV(8991,43,1,1,1,153,0)=" Q"
^XTV(8991,43,1,1,1,154,0)="LISTPOPD(DFN) ;"
^XTV(8991,43,1,1,1,155,0)=" N IEN"
^XTV(8991,43,1,1,1,156,0)=" N HRN,PHONE,X"
^XTV(8991,43,1,1,1,157,0)=" ;NO SCREEN FOR VIP"
^XTV(8991,43,1,1,1,158,0)=" Q:GFTI=-1  I GFTI>500 K LST S GFTI=-1 ;WE RETURN 500 VALUES MAX"
^XTV(8991,43,1,1,1,159,0)=" S PHONE=$P($G(^DPT(DFN,.13)),U),HRN=$$HRN^DGLBPID(DFN)"
^XTV(8991,43,1,1,1,160,0)=" S GFTI=GFTI+1,LST(GFTI)=DFN_U_$P(^DPT(DFN,0),U)_U_$$DOB^DPTLK1(DFN,2)_TAB_""!""_DFN_U_$$ID^DGLBPID(DFN)_U_""'""_HRN_""'""_U_PHONE"
^XTV(8991,43,1,1,1,161,0)=" ;S GFTI=GFTI+1,LST(GFTI)=DFN_U_$P(^DPT(DFN,0),U)_U_$$FMTE^XLFDT($P(^(0),U,3))_TAB_""!""_DFN_U_$$ID^DGLBPID(DFN)_U_""'""_HRN_""'""_U_PHONE"
^XTV(8991,43,1,1,1,162,0)=" Q"
^XTV(8991,43,1,1,1,163,0)=" ;"
^XTV(8991,43,1,1,1,164,0)=" "
^XTV(8991,43,1,"B",3070118.2238,1)=""
^XTV(8991,44,0)="ORWPT3"
^XTV(8991,44,1,0)="^8991.01^1^1"
^XTV(8991,44,1,1,0)="3070118.2238"
^XTV(8991,44,1,1,1,0)="^8991.11^143^143"
^XTV(8991,44,1,1,1,1,0)="ORWPT3 ; VOE/GOW /REV - Patient Lookup Functions ;1/18/07  22:38"
^XTV(8991,44,1,1,1,2,0)=" ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,132,149,206,187,190,215,269**;Dec 17, 1997 LOCAL ;Build 12"
^XTV(8991,44,1,1,1,3,0)=" ;;VOE VWPT PACKAGE ENHANCEMENT UPDATES ADDED WITH ""OTHER"" RADIOBUTTON LOOKUPS FOR DOB AND PHONE NO 11/14/06"
^XTV(8991,44,1,1,1,4,0)=" ;"
^XTV(8991,44,1,1,1,5,0)=" ; Ref. to ^UTILITY via IA 10061"
^XTV(8991,44,1,1,1,6,0)=" ;"
^XTV(8991,44,1,1,1,7,0)=" Q "
^XTV(8991,44,1,1,1,8,0)=" ;NDBI(X) ; National Database Integration site 1 = yes  0 = no"
^XTV(8991,44,1,1,1,9,0)=" ; N R,G S X=""A7RDUP"" X ^%ZOSF(""TEST"") S R=$T,G=$S($D(^A7RCP):1,1:0),X=R+G,X=$S(X=2:1,1:0) Q X"
^XTV(8991,44,1,1,1,10,0)=" ;"
^XTV(8991,44,1,1,1,11,0)=" ;VWPT ENHANCEMENTS folow for ""other"" RADIO BUTTONlookup"
^XTV(8991,44,1,1,1,12,0)="OTHER(LST,IDIN,OTHER) ; RADIO BUTTON Return a list of patients matching other ID identifier"
^XTV(8991,44,1,1,1,13,0)=" N I,ID,IEN,ILENX,XREF,IDM1,ILEN1,ILNM1,ILENM1,IDD1,IPAST1,IDXX,IDSS,IDD2,LEN1,IFDN,IDX,IDS,DATEF,ILEN1,IPAST,ZVW,TEMP,IVAL,IVAR1,IFIND,IFDNS,IVAR,ARRAY,ERRARRAY,IENS"
^XTV(8991,44,1,1,1,14,0)=" N IEN2,IENN,TAB,IX"
^XTV(8991,44,1,1,1,15,0)=" N ILENP,X3,IEND,IDXS"
^XTV(8991,44,1,1,1,16,0)=" ;IF IDIN="""" RETURN"
^XTV(8991,44,1,1,1,17,0)=" I IDIN="""" Q"
^XTV(8991,44,1,1,1,18,0)=" S (I,IEN,IEND)=0"
^XTV(8991,44,1,1,1,19,0)=" S ID=IDIN"
^XTV(8991,44,1,1,1,20,0)=" S X=ID"
^XTV(8991,44,1,1,1,21,0)=" S ILENX=$L(X)"
^XTV(8991,44,1,1,1,22,0)=" ;REMOVES TABS"
^XTV(8991,44,1,1,1,23,0)=" ;CHECK INPUT  TAB POSTION 20, 25, 30 WITH PRECEDING TRAILING BLANKS"
^XTV(8991,44,1,1,1,24,0)=" S TAB=$C(9)"
^XTV(8991,44,1,1,1,25,0)=" S IX=$P(X,TAB,3) ; WAS 2ND POS"
^XTV(8991,44,1,1,1,26,0)=" I IX'="""" D"
^XTV(8991,44,1,1,1,27,0)=" .S ILENP=$L(IX)"
^XTV(8991,44,1,1,1,28,0)=" .S X=$E(IX,2,ILENP) ; JUMP OVER !"
^XTV(8991,44,1,1,1,29,0)=" .S LST(1)=X_U_$P(^DPT(X,0),U)_U_$$DOB^DPTLK1(X,2)_TAB_""!""_X_U_$$ID^DGLBPID(X) ; $$SSN^DPTLK1_U_IVAL  ; RETURN OTHER AS 5TH PIECE "
^XTV(8991,44,1,1,1,30,0)=" .;"
^XTV(8991,44,1,1,1,31,0)=" .S IEND=1"
^XTV(8991,44,1,1,1,32,0)=" E  D"
^XTV(8991,44,1,1,1,33,0)=" .;JUST UPPER CASE IT"
^XTV(8991,44,1,1,1,34,0)=" .;UPPERCASE IT"
^XTV(8991,44,1,1,1,35,0)=" .X ""F %=1:1:$L(X) S:$E(X,%)?1L X=$E(X,0,%-1)_$C($A(X,%)-32)_$E(X,%+1,999)"""
^XTV(8991,44,1,1,1,36,0)=" I IEND=1 Q"
^XTV(8991,44,1,1,1,37,0)=" S ID=X"
^XTV(8991,44,1,1,1,38,0)=" ;OTHER IS FIELD NAME "
^XTV(8991,44,1,1,1,39,0)=" ;GET THE FIELD NUMBER"
^XTV(8991,44,1,1,1,40,0)=" S IFDN=0"
^XTV(8991,44,1,1,1,41,0)=" S IFDN=$O(^DD(2,""B"",OTHER,IFDN))"
^XTV(8991,44,1,1,1,42,0)=" I IFDN="""" Q"
^XTV(8991,44,1,1,1,43,0)=" ;FOR NOW JUST USE ONE OF TWO CROSS-REFERENCES , "
^XTV(8991,44,1,1,1,44,0)=" ;ONE FOR DOB AS ADOB AND THE OTHER FOR PHONE # AS AZVWVOE"
^XTV(8991,44,1,1,1,45,0)=" I OTHER=""DATE OF BIRTH"" S ICREF=""ADOB"""
^XTV(8991,44,1,1,1,46,0)=" I OTHER=""PHONE NUMBER [RESIDENCE]"" D"
^XTV(8991,44,1,1,1,47,0)=" .S ICREF=""AZVWVOE"""
^XTV(8991,44,1,1,1,48,0)=" .S ID=$E($TR(ID,""ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz!@#$%^&*()-_=+[]{}<>,./?:;'\|""),1,30)"
^XTV(8991,44,1,1,1,49,0)=" I ICREF=""AZVWVOE"" I ILENX<7 Q"
^XTV(8991,44,1,1,1,50,0)=" G OVER"
^XTV(8991,44,1,1,1,51,0)=" ;FIND ZVW* CROSS REFERENCE"
^XTV(8991,44,1,1,1,52,0)=" S TEMP=0"
^XTV(8991,44,1,1,1,53,0)=" S ICREF=0"
^XTV(8991,44,1,1,1,54,0)=" F  S TEMP=$O(^DD(2,IFDN,1,TEMP)) Q:(TEMP="""")!(ICREF'=0)  D"
^XTV(8991,44,1,1,1,55,0)=" . S IVAR=$G(^DD(2,IFDN,1,TEMP,0))"
^XTV(8991,44,1,1,1,56,0)=" . S IVAR1=$P(IVAR,""^"",2)"
^XTV(8991,44,1,1,1,57,0)=" . I $E(IVAR1,1,3)[""ZVW"" S ICREF=IVAR1"
^XTV(8991,44,1,1,1,58,0)=" . ;I IVAR1[""ZVW"" S ICREF=IVAR1"
^XTV(8991,44,1,1,1,59,0)=" I (ICREF="""")!(ICREF=0) Q"
^XTV(8991,44,1,1,1,60,0)="OVER ;"
^XTV(8991,44,1,1,1,61,0)=" ;W !,""ICREF="",ICREF"
^XTV(8991,44,1,1,1,62,0)=" S IDX=ID"
^XTV(8991,44,1,1,1,63,0)=" ;TO SEE blank char inserts"
^XTV(8991,44,1,1,1,64,0)=" S ILENM1=$L(ID)-1"
^XTV(8991,44,1,1,1,65,0)=" I ILENM1>0 D"
^XTV(8991,44,1,1,1,66,0)=" .;S IDLC=$E(ID,1,ILENM1)"
^XTV(8991,44,1,1,1,67,0)=" .S IDX=$E(ID,1,ILENM1) S IDXS=IDX"
^XTV(8991,44,1,1,1,68,0)=" E  D"
^XTV(8991,44,1,1,1,69,0)=" .S IDX="""" S IDXS=IDX"
^XTV(8991,44,1,1,1,70,0)=" Q:ILENX<4"_$C(9)_";USE PHONE NUMBER LOOKUP XXX-"
^XTV(8991,44,1,1,1,71,0)=" ;HOWEVER ID DATE OR DATE/TIME FIELD CONVERT ID TO"
^XTV(8991,44,1,1,1,72,0)=" ;INTERNAL TIME"
^XTV(8991,44,1,1,1,73,0)=" S DATEF=$P($G(^DD(2,IFDN,0)),""^"",2)"
^XTV(8991,44,1,1,1,74,0)=" ;W !,""DATEF="",DATEF"
^XTV(8991,44,1,1,1,75,0)=" I DATEF[""D"" D"
^XTV(8991,44,1,1,1,76,0)=" .;NEW BELOW"
^XTV(8991,44,1,1,1,77,0)=" .;I $$ISNUM(ID) S IDX=IDXS S IDS=ID Q"
^XTV(8991,44,1,1,1,78,0)=" .S X=ID D ^%DT S IDX=Y S IDS=Y"
^XTV(8991,44,1,1,1,79,0)=" .I Y'=-1 D"
^XTV(8991,44,1,1,1,80,0)=" . . S ILNM1=$L(IDX)-1"
^XTV(8991,44,1,1,1,81,0)=" . . S IDX=$E(IDX,1,ILNM1)"
^XTV(8991,44,1,1,1,82,0)=" . . ;W !,""IDX="",IDX,""IDS="",IDS"
^XTV(8991,44,1,1,1,83,0)=" S IPAST=0"
^XTV(8991,44,1,1,1,84,0)=" S IPAST1=0"
^XTV(8991,44,1,1,1,85,0)=" S ILEN1=$L(ID)"
^XTV(8991,44,1,1,1,86,0)=" F  S IDX=$O(^DPT(ICREF,IDX)) Q:(IDX="""")!(IPAST1=1)  D"
^XTV(8991,44,1,1,1,87,0)=" . S IEN=0"
^XTV(8991,44,1,1,1,88,0)=" . ;EXTRA TO GET TRAILING SPACES"
^XTV(8991,44,1,1,1,89,0)=" . I DATEF'[""D"" D"
^XTV(8991,44,1,1,1,90,0)=" . . S IDD1=$E(IDX,1,ILEN1) I $L(IDD1)< ILEN1 Q"
^XTV(8991,44,1,1,1,91,0)=" . F  S IEN=$O(^DPT(ICREF,IDX,IEN)) Q:IEN=""""  D"
^XTV(8991,44,1,1,1,92,0)=" . . S IPAST=0"
^XTV(8991,44,1,1,1,93,0)=" . . ;W !,""IDX="",IDX,"" IDS="",IDS"
^XTV(8991,44,1,1,1,94,0)=" . .I DATEF[""D"" D"
^XTV(8991,44,1,1,1,95,0)=" . . .;CHECK FOR MONTH ONLY"
^XTV(8991,44,1,1,1,96,0)=" . . .I $E(IDS,6,7)=""00"" D"
^XTV(8991,44,1,1,1,97,0)=" . . . .S IDXX=$E(IDX,1,5) S IDSS=$E(IDS,1,5)"
^XTV(8991,44,1,1,1,98,0)=" . . . .;W !,""IDXX="",IDXX,"" IDSS="",IDSS"
^XTV(8991,44,1,1,1,99,0)=" . . . .I IDXX'=IDSS S IPAST=1"
^XTV(8991,44,1,1,1,100,0)=" . . . .I IDXX>IDSS S IPAST1=1 Q"
^XTV(8991,44,1,1,1,101,0)=" . . . .I IPAST=1 Q"
^XTV(8991,44,1,1,1,102,0)=" . . .E  D"
^XTV(8991,44,1,1,1,103,0)=" . . . .;W !,""IDX="",IDX"
^XTV(8991,44,1,1,1,104,0)=" . . . .I IDX'=IDS S IPAST=1"
^XTV(8991,44,1,1,1,105,0)=" . . . .I IDX>IDS S IPAST1=1 Q"
^XTV(8991,44,1,1,1,106,0)=" . . . .I IPAST=1 Q"
^XTV(8991,44,1,1,1,107,0)=" . .E  D"
^XTV(8991,44,1,1,1,108,0)=" . . .S IDD1=$E(IDX,1,ILEN1) S IDD2=$E(ID,1,ILEN1)"
^XTV(8991,44,1,1,1,109,0)=" . . .;W !,""IDD1="",IDD1 W !,""IDD2="",IDD2"
^XTV(8991,44,1,1,1,110,0)=" . . .I $$ISNUM(IDD2)&$$ISNUM(IDD1) D"
^XTV(8991,44,1,1,1,111,0)=" . . . .I IDD1'=IDD2 S IPAST=1 "
^XTV(8991,44,1,1,1,112,0)=" . . . .I IDD1>IDD2 S IPAST1=1 Q"
^XTV(8991,44,1,1,1,113,0)=" . . . .I IPAST=1 Q"
^XTV(8991,44,1,1,1,114,0)=" . . . .;"
^XTV(8991,44,1,1,1,115,0)=" . . . .;"
^XTV(8991,44,1,1,1,116,0)=" . . .E  D"
^XTV(8991,44,1,1,1,117,0)=" . . . .;"
^XTV(8991,44,1,1,1,118,0)=" . . . .I IDD1'=IDD2 S IPAST=1"
^XTV(8991,44,1,1,1,119,0)=" . . . .I IDD1]IDD2 S IPAST1=1 Q"
^XTV(8991,44,1,1,1,120,0)=" . . . .I IPAST=1 Q"
^XTV(8991,44,1,1,1,121,0)=" . .I IPAST=1 Q"
^XTV(8991,44,1,1,1,122,0)=" . .;S ILEN=$L(ID)"
^XTV(8991,44,1,1,1,123,0)=" . .;S IENS=IEN_"","""
^XTV(8991,44,1,1,1,124,0)=" . .;K ARRAY,ERRARRAY"
^XTV(8991,44,1,1,1,125,0)=" . .;S IFDNS=""""""""_IFDN_"""""""""
^XTV(8991,44,1,1,1,126,0)=" . .;D GETS^DIQ(2,IENS,IFDNS,"""",""ARRAY"",""ERRARRAY"")"
^XTV(8991,44,1,1,1,127,0)=" . .;S IVAL=$G(ARRAY(2,IENS,IFDN))"
^XTV(8991,44,1,1,1,128,0)=" . .I DATEF[""D"" D"
^XTV(8991,44,1,1,1,129,0)=" . . .S Y=IDX S X=IDX D DD^%DT S IVAL=Y"
^XTV(8991,44,1,1,1,130,0)=" . .E  D"
^XTV(8991,44,1,1,1,131,0)=" . . .S IVAL=IDX"
^XTV(8991,44,1,1,1,132,0)=" . .S I=I+1"
^XTV(8991,44,1,1,1,133,0)=" . .;I (OTHER[""PHONE"")&$$SCREEN^DPTLK1(IEN) Q"
^XTV(8991,44,1,1,1,134,0)=" . .I $$SCREEN^DPTLK1(IEN) Q"
^XTV(8991,44,1,1,1,135,0)=" . .;IVAL IS NOT HRN NOW"
^XTV(8991,44,1,1,1,136,0)=" . .S LST(I)=IEN_U_$P(^DPT(IEN,0),U)_U_IVAL_TAB_""!""_IEN_U_$$DOB^DPTLK1(IEN,2)_U_$$ID^DGLBPID(IEN) ; _U_IVAL  ; RETURN OTHER AS 5TH PIECE "
^XTV(8991,44,1,1,1,137,0)=" . .;S LST(I)=IEN_U_$P(^DPT(IEN,0),U)_U_$$DOB^DPTLK1(IEN,2)_U_$$SSN^DPTLK1(IEN)"
^XTV(8991,44,1,1,1,138,0)="Q"
^XTV(8991,44,1,1,1,139,0)="ISNUM(XA) ;"
^XTV(8991,44,1,1,1,140,0)=" I XA=+XA Q 1"
^XTV(8991,44,1,1,1,141,0)=" Q 0"
^XTV(8991,44,1,1,1,142,0)=" "
^XTV(8991,44,1,1,1,143,0)=" "
^XTV(8991,44,1,"B",3070118.2238,1)=""
^XTV(8991,45,0)="SDPFSS"
^XTV(8991,45,1,0)="^8991.01^1^1"
^XTV(8991,45,1,1,0)="3070118.2239"
^XTV(8991,45,1,1,1,0)="^8991.11^146^146"
^XTV(8991,45,1,1,1,1,0)="SDPFSS ;ALB/SCK - Patient Financial Services System  ;1/18/07  22:39"
^XTV(8991,45,1,1,1,2,0)=" ;;5.3;Scheduling;**430,502**;Aug 13, 1993  ;Build 4"
^XTV(8991,45,1,1,1,3,0)=" ;"
^XTV(8991,45,1,1,1,4,0)=" Q"
^XTV(8991,45,1,1,1,5,0)=" ;"
^XTV(8991,45,1,1,1,6,0)="EVENT ; Entry point for PFSS Protocol event.  This procedure will manage the IBB event actions."
^XTV(8991,45,1,1,1,7,0)=" ;"
^XTV(8991,45,1,1,1,8,0)=" N SDEVENT,SDTEST,SDBEFORE,SDAFTER,SDMSG,SDARRAY,SDCNT,SDPRV,SDERR,SDERRMSG,SDNODE,SDOK"
^XTV(8991,45,1,1,1,9,0)=" N IBBDFN,IBBAPLR,IBBEVENT,IBBPV1,IBBPV2,IBBARFN"
^XTV(8991,45,1,1,1,10,0)=" ;"
^XTV(8991,45,1,1,1,11,0)=" ; Check conditions before proceeding"
^XTV(8991,45,1,1,1,12,0)=" Q:'$G(DFN)"
^XTV(8991,45,1,1,1,13,0)=" ; VWSD LOCAL MOD HERE SDVWNVAI VARIABLE, SEE DEFINITION AT VWSD LOCAL MOD BELOW"
^XTV(8991,45,1,1,1,14,0)=" I $D(SDVWNVAI) G OVER"
^XTV(8991,45,1,1,1,15,0)=" Q:'$$CHECK"
^XTV(8991,45,1,1,1,16,0)="OVER ;"
^XTV(8991,45,1,1,1,17,0)=" ;END LOCAL MOD"
^XTV(8991,45,1,1,1,18,0)=" Q:$$TESTPAT^VADPT(DFN)"
^XTV(8991,45,1,1,1,19,0)=" ;VWSD LOCAl MOD"
^XTV(8991,45,1,1,1,20,0)=" ; Call the ICN API to generate an ICN if one does not exist for the patient."
^XTV(8991,45,1,1,1,21,0)=" ;VWSD SDVWNVAI VARIABLE -LOCAL MOD FOR disabling the need for ICN or use of other ICN system for non-VA system"
^XTV(8991,45,1,1,1,22,0)=" S SDOK=$$ICNLC^MPIF001(DFN)"
^XTV(8991,45,1,1,1,23,0)=" I $D(SDVWNVAI) G OVER1"
^XTV(8991,45,1,1,1,24,0)=" I (SDOK<0) D"
^XTV(8991,45,1,1,1,25,0)=" . D ERRMSG^SDPFSS2(SDOK)"
^XTV(8991,45,1,1,1,26,0)=" ;"
^XTV(8991,45,1,1,1,27,0)="OVER1 ;"
^XTV(8991,45,1,1,1,28,0)=" ;END LOCAL MOD"
^XTV(8991,45,1,1,1,29,0)=" ; Get event type"
^XTV(8991,45,1,1,1,30,0)=" S SDEVENT=$S($D(SDAMEVT):$$GET1^DIQ(409.66,SDAMEVT,.01),1:""OTHER"")"
^XTV(8991,45,1,1,1,31,0)=" I SDEVENT=""CHECK-OUT"",+$G(SDPFSFLG) S SDEVENT=""DELETE CO"""
^XTV(8991,45,1,1,1,32,0)=" ;"
^XTV(8991,45,1,1,1,33,0)=" S SDBEFORE=$P($G(SDATA(""BEFORE"",""STATUS"")),U,3)"
^XTV(8991,45,1,1,1,34,0)=" S SDAFTER=$P($G(SDATA(""AFTER"",""STATUS"")),U,3)"
^XTV(8991,45,1,1,1,35,0)=" ;"
^XTV(8991,45,1,1,1,36,0)=" I SDEVENT=""CHECK-IN"" D"
^XTV(8991,45,1,1,1,37,0)=" . I SDBEFORE=""ACT REQ/CHECKED IN""&(SDAFTER[""NO ACTION TAKEN"") S SDEVENT=""DELETE CI"""
^XTV(8991,45,1,1,1,38,0)=" ;"
^XTV(8991,45,1,1,1,39,0)=" I SDEVENT=""NO-SHOW"" D"
^XTV(8991,45,1,1,1,40,0)=" . I SDBEFORE=""NO-SHOW""&(SDAFTER[""NO ACTION TAKEN"") S SDEVENT=""DELETE NS"""
^XTV(8991,45,1,1,1,41,0)=" ;"
^XTV(8991,45,1,1,1,42,0)=" S IBBDFN=DFN"
^XTV(8991,45,1,1,1,43,0)=" S IBBAPLR="""""
^XTV(8991,45,1,1,1,44,0)=" S IBBEVENT=$$GETEVT^SDPFSS2(SDEVENT)"
^XTV(8991,45,1,1,1,45,0)=" ;"
^XTV(8991,45,1,1,1,46,0)=" ; Call the Scheduling Appointment Data API to retrieve appointment data"
^XTV(8991,45,1,1,1,47,0)=" K ^TMP($J,""SDAMA301"")"
^XTV(8991,45,1,1,1,48,0)=" S SDARRAY(1)=$G(SDT)_"";""_$G(SDT)"
^XTV(8991,45,1,1,1,49,0)=" S SDARRAY(2)=$G(SDCL)"
^XTV(8991,45,1,1,1,50,0)=" S SDARRAY(4)=$G(DFN)"
^XTV(8991,45,1,1,1,51,0)=" S SDARRAY(""FLDS"")=""1;2;3;8;9;10;11;13;14;15;16;17;18"""
^XTV(8991,45,1,1,1,52,0)=" S SDCNT=$$SDAPI^SDAMA301(.SDARRAY)"
^XTV(8991,45,1,1,1,53,0)=" ;"
^XTV(8991,45,1,1,1,54,0)=" ; check for any errors in the TMP global"
^XTV(8991,45,1,1,1,55,0)=" I SDCNT<0 D"
^XTV(8991,45,1,1,1,56,0)=" . S SDERR=$O(^TMP($J,""SDAMA301"",0))"
^XTV(8991,45,1,1,1,57,0)=" . I SDERR D"
^XTV(8991,45,1,1,1,58,0)=" . . S SDERRMSG=^TMP($J,""SDAMA301"",SDERR)"
^XTV(8991,45,1,1,1,59,0)=" . . S SDERR=SDERR_""^""_SDERRMSG"
^XTV(8991,45,1,1,1,60,0)=" . E  D"
^XTV(8991,45,1,1,1,61,0)=" . . S SDERR=""-1^Undefined error returned by SDAPI"""
^XTV(8991,45,1,1,1,62,0)=" . D ERRMSG^SDPFSS2(SDERR)"
^XTV(8991,45,1,1,1,63,0)=" . ; Null out the data global for further processing"
^XTV(8991,45,1,1,1,64,0)=" . S ^TMP($J,""SDAMA301"",DFN,SDCL,SDT)="""""
^XTV(8991,45,1,1,1,65,0)=" ;"
^XTV(8991,45,1,1,1,66,0)=" I SDCNT=0 D"
^XTV(8991,45,1,1,1,67,0)=" . S SDERR=""-1^No appointments were returned by SDAPI""_""^""_DFN_""^""_SDT_""^""_SDCL"
^XTV(8991,45,1,1,1,68,0)=" . D ERRMSG^SDPFSS2(SDERR)"
^XTV(8991,45,1,1,1,69,0)=" ;"
^XTV(8991,45,1,1,1,70,0)=" ; Build data arrays for PFSS Account API"
^XTV(8991,45,1,1,1,71,0)=" S SDNODE=$G(^TMP($J,""SDAMA301"",DFN,SDCL,SDT))"
^XTV(8991,45,1,1,1,72,0)=" S IBBPV1(2)=""O"""
^XTV(8991,45,1,1,1,73,0)=" S IBBPV1(3)=SDCL"
^XTV(8991,45,1,1,1,74,0)=" S IBBPV1(4)=+$P(SDNODE,U,10)"
^XTV(8991,45,1,1,1,75,0)=" S IBBPV1(10)=+$P(SDNODE,U,18)"
^XTV(8991,45,1,1,1,76,0)=" S IBBPV1(18)=$P($P(SDNODE,U,13),"";"",1)"
^XTV(8991,45,1,1,1,77,0)=" S IBBPV1(51)=$P(SDNODE,U,15)"
^XTV(8991,45,1,1,1,78,0)=" S IBBPV1(25)=$S(SDEVENT=""DELETE CI"":"""",1:$P(SDNODE,U,9))"
^XTV(8991,45,1,1,1,79,0)=" S IBBPV1(41)=$P($P(SDNODE,U,14),"";"",1)"
^XTV(8991,45,1,1,1,80,0)=" I ""A05,A38""[IBBEVENT"
^XTV(8991,45,1,1,1,81,0)=" E  S IBBPV1(44)=SDT"
^XTV(8991,45,1,1,1,82,0)=" ;"
^XTV(8991,45,1,1,1,83,0)=" S IBBPV2(7)=$P($P(SDNODE,U,8),"";"",1)"
^XTV(8991,45,1,1,1,84,0)=" I ""A05,A38""[IBBEVENT S IBBPV2(8)=SDT"
^XTV(8991,45,1,1,1,85,0)=" S IBBPV2(24)=$P($P(SDNODE,U,3),"";"",1)"
^XTV(8991,45,1,1,1,86,0)=" S IBBPV2(46)=$P(SDNODE,U,16)"
^XTV(8991,45,1,1,1,87,0)=" ;"
^XTV(8991,45,1,1,1,88,0)=" I SDEVENT=""CHECK-OUT"" D"
^XTV(8991,45,1,1,1,89,0)=" . S SDPRV=$$ENCPRV^SDPFSS2(DFN,$G(SDVSIT))"
^XTV(8991,45,1,1,1,90,0)=" . S IBBPV1(45)=$P(SDNODE,U,11)"
^XTV(8991,45,1,1,1,91,0)=" I +$G(SDPRV)'>0 S SDPRV=$$DEFPRV^SDPFSS2(SDCL)"
^XTV(8991,45,1,1,1,92,0)=" ;"
^XTV(8991,45,1,1,1,93,0)=" I SDEVENT=""DELETE CO"" S IBBPV1(45)="""",SDPRV="""""
^XTV(8991,45,1,1,1,94,0)=" S IBBPV1(7)=$P($G(SDPRV),U,1)"
^XTV(8991,45,1,1,1,95,0)=" ;"
^XTV(8991,45,1,1,1,96,0)=" S IBBARFN=$S(SDEVENT=""MAKE"":"""",1:$$GETARN^SDPFSS2(SDT,DFN,SDCL))"
^XTV(8991,45,1,1,1,97,0)="B1 ; Call the Get Account API and retrieve the account number reference"
^XTV(8991,45,1,1,1,98,0)=" S SDANR=$$GETACCT^IBBAPI(IBBDFN,IBBARFN,IBBEVENT,IBBAPLR,.IBBPV1,.IBBPV2)"
^XTV(8991,45,1,1,1,99,0)=" ;"
^XTV(8991,45,1,1,1,100,0)=" ;  If this is a ""Make"" appt., then create a new entry in the Appointment Acct. No. Reference File"
^XTV(8991,45,1,1,1,101,0)=" I SDEVENT=""MAKE"",+$G(SDANR)>0 D"
^XTV(8991,45,1,1,1,102,0)=" . S SDOK=$$FILE(DFN,SDT,SDCL,SDANR)"
^XTV(8991,45,1,1,1,103,0)=" . I 'SDOK D"
^XTV(8991,45,1,1,1,104,0)=" . . S SDERRMSG=$S($P($G(SDOK),U,2)]"""":$P($G(SDOK),U,2),1:""Unable to File Account Number Reference"")"
^XTV(8991,45,1,1,1,105,0)=" . . D ERRMSG^SDPFSS2(SDERRMSG)"
^XTV(8991,45,1,1,1,106,0)=" K ^TMP($J,""SDAMA301"")"
^XTV(8991,45,1,1,1,107,0)=" Q"
^XTV(8991,45,1,1,1,108,0)=" ;"
^XTV(8991,45,1,1,1,109,0)="CHECK() ; Check routine for unit testing to allow for on/off PFSS Switch"
^XTV(8991,45,1,1,1,110,0)=" N RSLT,X"
^XTV(8991,45,1,1,1,111,0)=" ;"
^XTV(8991,45,1,1,1,112,0)=" ; Check if the PFSS Switch Status API call is installed"
^XTV(8991,45,1,1,1,113,0)=" ; If it is, then return the status of the switch, otherwise"
^XTV(8991,45,1,1,1,114,0)=" ; return 0"
^XTV(8991,45,1,1,1,115,0)=" I $T(SWSTAT^IBBAPI)'="""" S RSLT=+$$SWSTAT^IBBAPI"
^XTV(8991,45,1,1,1,116,0)=" Q +$G(RSLT)"
^XTV(8991,45,1,1,1,117,0)=" ;"
^XTV(8991,45,1,1,1,118,0)="FILE(DFN,SDT,SDCLN,SDANR) ;  Procedure to validate and load appointment information and account number reference into file #409.55"
^XTV(8991,45,1,1,1,119,0)=" ;"
^XTV(8991,45,1,1,1,120,0)=" ; Input"
^XTV(8991,45,1,1,1,121,0)=" ;    DFN    - Patient IEN in File #2"
^XTV(8991,45,1,1,1,122,0)=" ;    SDT    - Appointment Date/Time in Fileman format"
^XTV(8991,45,1,1,1,123,0)=" ;    SDCLN  - Clinic IEN in Hospital Location File, #44"
^XTV(8991,45,1,1,1,124,0)=" ;    SDANR  - Account Number Reference from IBB"
^XTV(8991,45,1,1,1,125,0)=" ;"
^XTV(8991,45,1,1,1,126,0)=" ; Output"
^XTV(8991,45,1,1,1,127,0)=" ;    1 - If entry successfully created"
^XTV(8991,45,1,1,1,128,0)=" ;   -1^error message - if load is unsuccessful"
^XTV(8991,45,1,1,1,129,0)=" ;"
^XTV(8991,45,1,1,1,130,0)=" N FDA,FDAIEN,ERR"
^XTV(8991,45,1,1,1,131,0)=" ;"
^XTV(8991,45,1,1,1,132,0)=" I '$G(DFN) S ERR=""-1^MISSING DFN"" G FILEQ"
^XTV(8991,45,1,1,1,133,0)=" I '$D(^DPT(DFN)) S ERR=""-1^INVALID PATIENT ENTRY"" G FILEQ"
^XTV(8991,45,1,1,1,134,0)=" I '$G(SDT) S ERR=""-1^MISSING APPOINTMENT DATE/TIME"" G FILEQ"
^XTV(8991,45,1,1,1,135,0)=" I '$G(SDCLN) S ERR=""-1^MISSING CLINIC LOCATION"" G FILEQ"
^XTV(8991,45,1,1,1,136,0)=" I '$D(^SC(SDCLN)) S ERR=""-1^INVALID HOSPITAL LOCATION ENTRY"" G FILEQ"
^XTV(8991,45,1,1,1,137,0)=" I '$G(SDANR) S ERR=""-1^No Account Number Reference provided"" G FILEQ"
^XTV(8991,45,1,1,1,138,0)=" ;"
^XTV(8991,45,1,1,1,139,0)=" S FDA(1,409.55,""+1,"",.01)=SDT"
^XTV(8991,45,1,1,1,140,0)=" S FDA(1,409.55,""+1,"",.02)=DFN"
^XTV(8991,45,1,1,1,141,0)=" S FDA(1,409.55,""+1,"",.03)=SDCLN"
^XTV(8991,45,1,1,1,142,0)=" S FDA(1,409.55,""+1,"",.04)=SDANR"
^XTV(8991,45,1,1,1,143,0)=" D UPDATE^DIE("""",""FDA(1)"",""FDAIEN"",""ERR"")"
^XTV(8991,45,1,1,1,144,0)=" ;"
^XTV(8991,45,1,1,1,145,0)=" I '$D(ERR) S ERR=1"
^XTV(8991,45,1,1,1,146,0)="FILEQ Q $G(ERR)"
^XTV(8991,45,1,"B",3070118.2239,1)=""
^XTV(8991,46,0)="SDVWAPP"
^XTV(8991,46,1,0)="^8991.01^2^2"
^XTV(8991,46,1,1,0)="3070118.2241"
^XTV(8991,46,1,1,1,0)="^8991.11^123^123"
^XTV(8991,46,1,1,1,1,0)=""
^XTV(8991,46,1,1,1,1,"DEL")="SDVWAPP ; VWSD VOE APP FOR SDAPI AND MAKE APPOINTMENT RPC routines ;1/18/07  22:41"
^XTV(8991,46,1,1,1,2,"INS",0)="^8991.12^1^1"
^XTV(8991,46,1,1,1,2,"INS",1,0)="SDVWAPP ;VOE/GW - VWSD VOE APP FOR SDAPI AND MAKE APPOINTMENT RPC routines ;1/18/07  22:45"
^XTV(8991,46,1,2,0)="3070118.2245"
^XTV(8991,46,1,2,1,0)="^8991.11^123^123"
^XTV(8991,46,1,2,1,1,0)="SDVWAPP ;VOE/GW - VWSD VOE APP FOR SDAPI AND MAKE APPOINTMENT RPC routines ;1/18/07  22:45"
^XTV(8991,46,1,2,1,2,0)=" ;;5.3;Scheduling;**502**;Aug 13, 1993"
^XTV(8991,46,1,2,1,3,0)="SDAPI(RESULTS,SDARRAY) ;;"
^XTV(8991,46,1,2,1,4,0)=" ; SDAPI APP TEST PROGRAM ( RETURN LIST OF APPOINTMENTS)"
^XTV(8991,46,1,2,1,5,0)=" ;"
^XTV(8991,46,1,2,1,6,0)=" N FIRST,SSN,SDDATE,SDLOCATE,PATIENTN,SSNPATN,AJJ3VIS,SDARRAY2,COUNTER "
^XTV(8991,46,1,2,1,7,0)=" N MSGCTRL,IER,RETURN,ORDRSORT,SSN,SDLOCATE,SDDATE,SDCOUNT,ACKCODE"
^XTV(8991,46,1,2,1,8,0)=" S MSGCTRL=0"
^XTV(8991,46,1,2,1,9,0)=" ;;;;S SDARRAY(1)=""Nov 6,2006;Nov 9,2006"""
^XTV(8991,46,1,2,1,10,0)="    I $G(SDARRAY(1))="""" S RESULTS(0)=""UNDEFINED DATE RANGE ELEMENT"" Q"
^XTV(8991,46,1,2,1,11,0)=" ;;;;;;S SDARRAY(3)=""R;I"" "
^XTV(8991,46,1,2,1,12,0)=" I $G(SDARRAY(3))="""" S RESULTS(0)=""UNDEFINED ELEMENT 3 = ""_""R;I"" Q"
^XTV(8991,46,1,2,1,13,0)=" ;;;;;;S SDARRAY(2)=""VWVOE RADIOLOGY CLINIC"" ;EXTERNAL NAME"
^XTV(8991,46,1,2,1,14,0)=" I ($G(SDARRAY(2))="""")&($G(SDARRAY(4))="""") S RESULTS(0)=""UNDEFINED ELEMENTS 2 AND 4 TOGETHER"" Q"
^XTV(8991,46,1,2,1,15,0)=" ;AS WELL AS S SDARRAY(4)=""100001298"" ;EXTERNAL PATIENT ID AS SSN"
^XTV(8991,46,1,2,1,16,0)=" ;;;;;;S SDARRAY(""MAX"")=3 "
^XTV(8991,46,1,2,1,17,0)=" I $G(SDARRAY(""MAX""))="""" S RESULTS(0)=""UNDEFINED MAX RETURN ELEMENT"" Q"_$C(9)
^XTV(8991,46,1,2,1,18,0)=" ;;;;;;;S SDARRAY(""FLDS"")=""1;2;3"""
^XTV(8991,46,1,2,1,19,0)=" I $G(SDARRAY(""FLDS""))="""" S RESULTS(0)=""UNDEFINED FLDS ELEMENT"" Q"
^XTV(8991,46,1,2,1,20,0)=" S RESULTS(0)=""UP TO HERE SDAPI"""
^XTV(8991,46,1,2,1,21,0)=" ;Q"
^XTV(8991,46,1,2,1,22,0)=" S IER=$$TRNSDAPI^SDVWHLEX(.SDARRAY,.MSGCTRL)"
^XTV(8991,46,1,2,1,23,0)=" I (IER=""OK"")&(MSGCTRL'=0) D"
^XTV(8991,46,1,2,1,24,0)=" .S AJJ3CNT=0"
^XTV(8991,46,1,2,1,25,0)="CHKAGAIN .I AJJ3CNT>8 Q"
^XTV(8991,46,1,2,1,26,0)=" .I $D(^XTMP(MSGCTRL,""RETURN""))=0 H 3 S AJJ3CNT=AJJ3CNT+1 G CHKAGAIN"
^XTV(8991,46,1,2,1,27,0)=" .;W !,""HERE"""
^XTV(8991,46,1,2,1,28,0)=" .S RETURN=^XTMP(MSGCTRL,""RETURN"") ; THIS INCLUDES ACK CODE AS AA OR AE"
^XTV(8991,46,1,2,1,29,0)=" .S ACKCODE=$P(RETURN,""^"",1)"
^XTV(8991,46,1,2,1,30,0)=" .I ACKCODE=""OK"" D"
^XTV(8991,46,1,2,1,31,0)=" ..;"
^XTV(8991,46,1,2,1,32,0)=" ..S ORDRSORT=$P(RETURN,""^"",2)"
^XTV(8991,46,1,2,1,33,0)=" ..S SDCOUNT=$P(RETURN,""^"",3)"
^XTV(8991,46,1,2,1,34,0)=" ..I SDCOUNT>0 D"
^XTV(8991,46,1,2,1,35,0)=" ...D"
^XTV(8991,46,1,2,1,36,0)=" ....I $E(ORDRSORT,1,1)=""P"" D"
^XTV(8991,46,1,2,1,37,0)=" .....S AJJ3VIS=0"
^XTV(8991,46,1,2,1,38,0)=" .....F  S AJJ3VIS=$O(^XTMP(MSGCTRL,""SDAMA301"",AJJ3VIS)) Q:AJJ3VIS=""""  D"
^XTV(8991,46,1,2,1,39,0)=" ......S SDARRAY2=^XTMP(MSGCTRL,""SDAMA301"",AJJ3VIS)"
^XTV(8991,46,1,2,1,40,0)=" ......S SSNPATN=$P(SDARRAY2,""^"",1)"
^XTV(8991,46,1,2,1,41,0)=" ......S SDLOCATE=$P(SDARRAY2,""^"",2)"
^XTV(8991,46,1,2,1,42,0)=" ......S SDDATE=$P(SDARRAY2,""^"",3)"
^XTV(8991,46,1,2,1,43,0)=" ......S FIRST=SSNPATN_""^""_SDLOCATE_""^""_SDDATE_""^"""
^XTV(8991,46,1,2,1,44,0)=" ......S SDARRAY2=$P(SDARRAY2,FIRST,2)"
^XTV(8991,46,1,2,1,45,0)=" ......S PATIENTN=$P(SSNPATN,""#"",2)"
^XTV(8991,46,1,2,1,46,0)=" ......S SSN=$P(SSNPATN,""#"",1)"
^XTV(8991,46,1,2,1,47,0)=" ......S COUNTER=(AJJ3VIS-1)*2 "
^XTV(8991,46,1,2,1,48,0)=" ......S RESULTS(COUNTER+1)=""APPT/UNSCHED VISIT, PATIENT=""_PATIENTN_"" SSN=""_SSN_"" HOSP LOCATION=""_SDLOCATE_"" DATE/TIME=""_SDDATE "
^XTV(8991,46,1,2,1,49,0)=" ......S RESULTS(COUNTER+2)=""                   DATA FIELDS=""_SDARRAY2 "
^XTV(8991,46,1,2,1,50,0)=" ....I $E(ORDRSORT,1,1)=""C"" D"
^XTV(8991,46,1,2,1,51,0)=" .....S AJJ3VIS=0"
^XTV(8991,46,1,2,1,52,0)=" .....F  S AJJ3VIS=$O(^XTMP(MSGCTRL,""SDAMA301"",AJJ3VIS)) Q:AJJ3VIS=""""  D"
^XTV(8991,46,1,2,1,53,0)=" ......S SDARRAY2=^XTMP(MSGCTRL,""SDAMA301"",AJJ3VIS)"
^XTV(8991,46,1,2,1,54,0)=" ......S SSNPATN=$P(SDARRAY2,""^"",2)"
^XTV(8991,46,1,2,1,55,0)=" ......S SDLOCATE=$P(SDARRAY2,""^"",1)"
^XTV(8991,46,1,2,1,56,0)=" ......S SDDATE=$P(SDARRAY2,""^"",3)"
^XTV(8991,46,1,2,1,57,0)=" ......S FIRST=SDLOCATE_""^""_SSNPATN_""^""_SDDATE_""^"""
^XTV(8991,46,1,2,1,58,0)=" ......S SDARRAY2=$P(SDARRAY2,FIRST,2)"
^XTV(8991,46,1,2,1,59,0)=" ......S PATIENTN=$P(SSNPATN,""#"",2)"
^XTV(8991,46,1,2,1,60,0)=" ......S SSN=$P(SSNPATN,""#"",1) "
^XTV(8991,46,1,2,1,61,0)=" ......S COUNTER=(AJJ3VIS-1)*2 "
^XTV(8991,46,1,2,1,62,0)=" ......S RESULTS(COUNTER+1)=""APPT/UNSCHED VISIT, HOSP LOCATION=""_SDLOCATE_"" PATIENT=""_PATIENTN_"" SSN=""_SSN_"" DATE/TIME=""_SDDATE "
^XTV(8991,46,1,2,1,63,0)=" ......S RESULTS(COUNTER+2)=""                   DATA FIELDS=""_SDARRAY2"
^XTV(8991,46,1,2,1,64,0)=" ..E  D"
^XTV(8991,46,1,2,1,65,0)=" ...S RESULTS(1)=""SDCOUNT=""_SDCOUNT  ;LOOK AT ERRORS IN API CALL, ETC"
^XTV(8991,46,1,2,1,66,0)=" E  D"
^XTV(8991,46,1,2,1,67,0)=" . S RESULTS(1)=RETURN ; APP ACK CODE=""AE"". SOME OTHER ERRORS IN TRANSMISSION IN OTHER PIECES OF RETURN"
^XTV(8991,46,1,2,1,68,0)=" S RESULTS(0)=""MSGCTRL=""_MSGCTRL ;;;;;;;;;W !,""MSGCTRL="",MSGCTRL"
^XTV(8991,46,1,2,1,69,0)=" Q"_$C(9)
^XTV(8991,46,1,2,1,70,0)="MKPI(RESULTS,SDARRAY1) ;"_$C(9)_";"
^XTV(8991,46,1,2,1,71,0)=" ;MAKE Appointment APP TEST PROGRAM"
^XTV(8991,46,1,2,1,72,0)=" ;"
^XTV(8991,46,1,2,1,73,0)=" N MSGCTRL,IER,RETURN,DUZ1"
^XTV(8991,46,1,2,1,74,0)=" N PATIENTN,SSN,SD1,SC,STYP,OUTIN,SDVWNVAI,X,Y,X2,ACKCODE,SDARRAY"
^XTV(8991,46,1,2,1,75,0)=" N AJJ3CNT"
^XTV(8991,46,1,2,1,76,0)=" N VXSDNVAI"
^XTV(8991,46,1,2,1,77,0)=" S MSGCTRL=0  ;"
^XTV(8991,46,1,2,1,78,0)=" ;N DFN(SSN AND PATIENT NAME INSTEAD),SD1,SC(HOSP LOCATION (CLINIC) EXT FORMAT NAME INSTEAD,STYP,"
^XTV(8991,46,1,2,1,79,0)=" ;N SDARRAY (DATE/TIMES IN EXTERNAL FORMAT),IER"
^XTV(8991,46,1,2,1,80,0)=" I $G(SDARRAY1(""PATIENTN""))="""" S RESULTS(0)=""NO DEFINED PATIENTN ELEMENT"" Q"
^XTV(8991,46,1,2,1,81,0)=" S PATIENTN=SDARRAY1(""PATIENTN"") ; S PATIENTN=""ZZ PATIENT,TEST ONE"""
^XTV(8991,46,1,2,1,82,0)="    S SDVWNVAI=""D""  ; NON-VA TESTING HERE WITH DISABLING THE NEED FOR ICN"
^XTV(8991,46,1,2,1,83,0)=" I $G(SDARRAY1(""SSN""))="""" S RESULTS(0)=""NO DEFINED SSN ELEMENT"" Q"
^XTV(8991,46,1,2,1,84,0)=" S SSN=SDARRAY1(""SSN"")  ; S SSN=100001298 ; DFN=1 NON TEST PATRIENT FOR PFSS EVENT GENERATION"
^XTV(8991,46,1,2,1,85,0)=" I $G(SDARRAY1(""SD1""))="""" S RESULTS(0)=""NO DEFINED SD1 APPT DATE ELEMENT"""
^XTV(8991,46,1,2,1,86,0)=" S SD1=SDARRAY1(""SD1"")  ; S SD1=""JAN 24,2007@11:30"" ; SD1=3070123.1130  "
^XTV(8991,46,1,2,1,87,0)=" ;S X=SD1 D ^%DT S SD1=Y"
^XTV(8991,46,1,2,1,88,0)=" I $G(SDARRAY1(""SC""))="""" S RESULTS(0)=""NO DEFINED APPOINTMENT CLINIC ELEMENT"" Q"
^XTV(8991,46,1,2,1,89,0)=" S SC=SDARRAY1(""SC"")   ; ""VWVOE RADIOLOGY CLINIC"" ; S SC=3 "
^XTV(8991,46,1,2,1,90,0)=" S STYP=3  ;SCHEDULED APPT"
^XTV(8991,46,1,2,1,91,0)=" S OUTIN=""O"" ;for outpatient clinic"
^XTV(8991,46,1,2,1,92,0)=" ;"
^XTV(8991,46,1,2,1,93,0)=" D NOW^%DTC S X2=X\1 S Y=X2 D DD^%DT S SDARRAY(""DATE NOW"")=Y"
^XTV(8991,46,1,2,1,94,0)=" ;D NOW^%DTC S X2=X\1 S Y=X2 D DD^%DT S SDARRAY(""DATE NOW"")=Y"
^XTV(8991,46,1,2,1,95,0)=" S SDARRAY(""APPT TYPE"")=9"
^XTV(8991,46,1,2,1,96,0)="    S SDARRAY(""SCHED_REQ_TYPE"")=""O"" ;'OTHER THAN NEXT AVAIABLE"
^XTV(8991,46,1,2,1,97,0)="    S SDARRAY(""NEXT APPT IND"")=0 ;0 FOR NO"
^XTV(8991,46,1,2,1,98,0)="    S SDARRAY(""FOLLOWUP VISIT INDICATOR"")=0  ; 0 FOR NO"
^XTV(8991,46,1,2,1,99,0)=" ;CHECK FOR DUZ IN SDARRAY1(""DUZ"") FOR DATA ENTRY CLERK"
^XTV(8991,46,1,2,1,100,0)=" I $G(SDARRAY1(""DUZ""))="""" S RESULTS(0)=""NO DUZ ELEMENT RETURNED"" Q"
^XTV(8991,46,1,2,1,101,0)=" S DUZ1=SDARRAY1(""DUZ"")"
^XTV(8991,46,1,2,1,102,0)=" ;GET NAME FOR DUZ IN NEW PERSON FILE"
^XTV(8991,46,1,2,1,103,0)=" S SDARRAY(""DATA ENTRY CLERK"")=$P($G(^VA(200,DUZ1,0)),""^"",1)"
^XTV(8991,46,1,2,1,104,0)="    ;;;;;;;;;S SDARRAY(""DATA ENTRY CLERK"")=""SCHLEHUBER,CAMERON"" ; PERSON ON MACHINE MAKING APPT REMOTELY"
^XTV(8991,46,1,2,1,105,0)="    ;THEN PARAMETERS CONVERTED TO INTERNAL VALUE"
^XTV(8991,46,1,2,1,106,0)="    S RESULTS(0)=""UP TO HERE MAKE APPT"""
^XTV(8991,46,1,2,1,107,0)=" ;Q"
^XTV(8991,46,1,2,1,108,0)=" S IER=$$TRNSMKPI^SDVWHLEX(PATIENTN,SSN,SD1,SC,STYP,.SDARRAY,OUTIN,.MSGCTRL,SDVWNVAI)"
^XTV(8991,46,1,2,1,109,0)=" ;SDVWNVAI AS LAST PARAMETER PASSED"
^XTV(8991,46,1,2,1,110,0)=" I (IER=""OK"")&(MSGCTRL'=0) D"
^XTV(8991,46,1,2,1,111,0)=" .S AJJ3CNT=0"
^XTV(8991,46,1,2,1,112,0)="CHKGAIN .I AJJ3CNT>8 Q"
^XTV(8991,46,1,2,1,113,0)=" .I $D(^XTMP(MSGCTRL,""RETURN""))=0 H 3 S AJJ3CNT=AJJ3CNT+1 G CHKGAIN"
^XTV(8991,46,1,2,1,114,0)=" .S RETURN=^XTMP(MSGCTRL,""RETURN"") ; THIS INCLUDES ACK CODE AS AA OR AE"
^XTV(8991,46,1,2,1,115,0)=" .S ACKCODE=$P(RETURN,""^"",1)"
^XTV(8991,46,1,2,1,116,0)=" .I ACKCODE=""AA"" D"
^XTV(8991,46,1,2,1,117,0)=" ..S RESULTS(1)=ACKCODE_"" MAKE APPT GOOD RETURN"""
^XTV(8991,46,1,2,1,118,0)=" .E  D"
^XTV(8991,46,1,2,1,119,0)=" ..;ACKCODE=""AE"". LOOK AT SOME OTHER ERRORS IN TRNSMISSION IN OTHER PIECES OF RETURN"
^XTV(8991,46,1,2,1,120,0)=" ..S RESULTS(1)=ACKCODE_"" RETURN=""_RETURN"
^XTV(8991,46,1,2,1,121,0)=" S RESULTS(0)=""MSGCTRL=""_MSGCTRL"
^XTV(8991,46,1,2,1,122,0)=" Q"
^XTV(8991,46,1,2,1,123,0)=" "
^XTV(8991,46,1,"B",3070118.2241,1)=""
^XTV(8991,46,1,"B",3070118.2245,2)=""
^XTV(8991,47,0)="SDVWHLEX"
^XTV(8991,47,1,0)="^8991.01^2^2"
^XTV(8991,47,1,1,0)="3070118.2242"
^XTV(8991,47,1,1,1,0)="^8991.11^626^626"
^XTV(8991,47,1,1,1,1,0)=""
^XTV(8991,47,1,1,1,1,"DEL")="SDVWHLEX ;ENHANCED HL7 TRANSMIT DRIVERS FOR SDAPI and MAKE AN APPOINTMENT REQUEST 11/18/06 ;1/18/07  22:42"
^XTV(8991,47,1,1,1,2,"INS",0)="^8991.12^1^1"
^XTV(8991,47,1,1,1,2,"INS",1,0)="SDVWHLEX ;VOE/GW - ENHANCED HL7 TRANSMIT DRIVERS FOR SDAPI and MAKE AN APPOINTMENT REQUEST 11/18/06 ;1/18/07  22:45"
^XTV(8991,47,1,2,0)="3070118.2245"
^XTV(8991,47,1,2,1,0)="^8991.11^626^626"
^XTV(8991,47,1,2,1,1,0)="SDVWHLEX ;VOE/GW - ENHANCED HL7 TRANSMIT DRIVERS FOR SDAPI and MAKE AN APPOINTMENT REQUEST 11/18/06 ;1/18/07  22:45"
^XTV(8991,47,1,2,1,2,0)=" ;;5.3;Scheduling;**502**;Aug 13, 1993"
^XTV(8991,47,1,2,1,3,0)="TRNSDAPI(SDARRAY,MSGCTRL) ;;;;;;Build 4"
^XTV(8991,47,1,2,1,4,0)=" N APPARMS,HLSTATS,ERROR,SEG,WHO"
^XTV(8991,47,1,2,1,5,0)=" N HLMSTATE,ERROR,INDEX,CONSTRUCT,IFLAG,X,Y,INTE,ERR"
^XTV(8991,47,1,2,1,6,0)=" ;"
^XTV(8991,47,1,2,1,7,0)=" ;"
^XTV(8991,47,1,2,1,8,0)=" ;HL7 TRANSMIT DRIVER FOR"
^XTV(8991,47,1,2,1,9,0)=" ;REQUEST SDAPI LIST OF APPOINTMENTS USING VWSDAPI CALLUP PARAMETERS"
^XTV(8991,47,1,2,1,10,0)=" ;"
^XTV(8991,47,1,2,1,11,0)=" ;"
^XTV(8991,47,1,2,1,12,0)=" ;HOWEVER, DATE/TIMES ARE EXTERNAL FORM,PATIENT SSN OR OTHER LOOKUP ID INSTEAD OF PATIENT DFN "
^XTV(8991,47,1,2,1,13,0)=" ;( FOR PARTIENTS IN FILE 2)"
^XTV(8991,47,1,2,1,14,0)=" ;AND LOCATION (CLINIC) ( IN FILE 44) EXTERNAL NAMES INSTEAD OF INTERNAL IEN.ALSO FOR DATA ENTRY CLERK, EXTERNAL"
^XTV(8991,47,1,2,1,15,0)=" ;FORMAT (IN FILE 200 NEW PERSON FILE)"
^XTV(8991,47,1,2,1,16,0)=" ;"
^XTV(8991,47,1,2,1,17,0)=" ;INPUT : MSGCTRL PASSED BY REFERENCE TO RECEIVE THIS BACK AFTER TRANSMITTING"
^XTV(8991,47,1,2,1,18,0)=" ;       SDARRAY"
^XTV(8991,47,1,2,1,19,0)=" ;        "
^XTV(8991,47,1,2,1,20,0)=" ;EXAMPLE ANALOGOUS CALL: "_$C(9)_"        S SDARRAY(1)=""Nov 10,2006;Nov 14,2006"""
^XTV(8991,47,1,2,1,21,0)=" ;"_$C(9,9,9,9,9)_"S SDARRAY(3)=""R;I"" "
^XTV(8991,47,1,2,1,22,0)=" ;"_$C(9,9,9,9,9)_"S SDARRAY(2)=""HOSPLOC"" EXTERNAL NAME"
^XTV(8991,47,1,2,1,23,0)=" ;"_$C(9,9,9,9,9)_"S SDARRAY(4)=100001234 ;SSN OR OTHER LOOKUP ID INSTEAD OF DFN ;ZZ PATIENT,TEST ONE"
^XTV(8991,47,1,2,1,24,0)=" ;"_$C(9,9,9,9,9)_"S SDARRAY(""MAX"")=3 "
^XTV(8991,47,1,2,1,25,0)=" ;"_$C(9,9,9,9,9)_"S SDARRAY(""FLDS"")=""1;2;3"" "
^XTV(8991,47,1,2,1,26,0)=" ;"_$C(9,9,9,9,9)_"$$SDAPI^SDAMA301(.SDARRAY)"
^XTV(8991,47,1,2,1,27,0)=" ;"_$C(9,9,9,9,9)
^XTV(8991,47,1,2,1,28,0)=" ;                                      (PASSED ARRAYS WITH NUMERIC INFO W/O QUOTES AND NON-NUMERIC ENCLOSED WITH QUOTES)"
^XTV(8991,47,1,2,1,29,0)=" ;OUTPUT : "
^XTV(8991,47,1,2,1,30,0)=" ;    RETURN"
^XTV(8991,47,1,2,1,31,0)=" ;        IER=""OK"""
^XTV(8991,47,1,2,1,32,0)=" ;           =""NEW MESSAGE ERROR"""
^XTV(8991,47,1,2,1,33,0)=" ;           =""QRD"" ERROR"
^XTV(8991,47,1,2,1,34,0)=" ;           =""QRF"" ERROR"
^XTV(8991,47,1,2,1,35,0)=" ;           =""NTE""_INDEX"
^XTV(8991,47,1,2,1,36,0)=" ;           =ERROR VALUE"
^XTV(8991,47,1,2,1,37,0)=" ;           "
^XTV(8991,47,1,2,1,38,0)=" ;BUILD PARAMETERS"
^XTV(8991,47,1,2,1,39,0)=" S APPARMS(""COUNTRY"")=""USA"""
^XTV(8991,47,1,2,1,40,0)=" S APPARMS(""FIELD SEPARATOR"")=""|"""
^XTV(8991,47,1,2,1,41,0)=" S APPARMS(""ENCODING CHARACTERS"")=""^~\&"""
^XTV(8991,47,1,2,1,42,0)=" S APPARMS(""VERSION"")=2.4"
^XTV(8991,47,1,2,1,43,0)=" S APPARMS(""MESSAGE TYPE"")=""ADT"""
^XTV(8991,47,1,2,1,44,0)=" S APPARMS(""EVENT"")=""A19"" ; PATIENT INQUIRY"
^XTV(8991,47,1,2,1,45,0)=" ;"
^XTV(8991,47,1,2,1,46,0)=" ;;CREATE NEW MESSAGE"
^XTV(8991,47,1,2,1,47,0)=" ;;"
^XTV(8991,47,1,2,1,48,0)=" ;"
^XTV(8991,47,1,2,1,49,0)=" S ERR="""""
^XTV(8991,47,1,2,1,50,0)=" S ERROR="""""
^XTV(8991,47,1,2,1,51,0)=" I '$$NEWMSG^HLOAPI(.APPARMS,.HLMSTATE,.ERROR) Q ""NEW MESSAGE ERROR"" "
^XTV(8991,47,1,2,1,52,0)=" ;"
^XTV(8991,47,1,2,1,53,0)=" ; "
^XTV(8991,47,1,2,1,54,0)=" ;"
^XTV(8991,47,1,2,1,55,0)=" ;Use message control ID in MSH segment for sync flag later in returned application ack "
^XTV(8991,47,1,2,1,56,0)=" ;"
^XTV(8991,47,1,2,1,57,0)=" ;;CREATE SEGMENT"
^XTV(8991,47,1,2,1,58,0)=" ;"
^XTV(8991,47,1,2,1,59,0)=" D SET^HLOAPI(.SEG,""QRD"",0)"
^XTV(8991,47,1,2,1,60,0)=" D SET^HLOAPI(.SEG,$$HLDATE^HLFNC($$NOW^XLFDT(),""TS""),1)"
^XTV(8991,47,1,2,1,61,0)=" ;"
^XTV(8991,47,1,2,1,62,0)=" ;; ADD SEGMENT"
^XTV(8991,47,1,2,1,63,0)=" I '$$ADDSEG^HLOAPI(.HLMSTATE,.SEG) S ERR=""QRD"""_$C(9)
^XTV(8991,47,1,2,1,64,0)=" ;CREATE SEGMENT"
^XTV(8991,47,1,2,1,65,0)=" ;"
^XTV(8991,47,1,2,1,66,0)=" D SET^HLOAPI(.SEG,""QRF"",0)"
^XTV(8991,47,1,2,1,67,0)=" S X=$P(SDARRAY(1),"";"",1) D ^%DT S INTE=Y  ;EXT TO FM INTERNAL"
^XTV(8991,47,1,2,1,68,0)=" D SET^HLOAPI(.SEG,$$HLDATE^HLFNC(INTE,""TS""),2) ;WHEN START DATE"
^XTV(8991,47,1,2,1,69,0)=" S X=$P(SDARRAY(1),"";"",2) D ^%DT S INTE=Y  ;EXT TO FM INTERNAL"
^XTV(8991,47,1,2,1,70,0)=" D SET^HLOAPI(.SEG,$$HLDATE^HLFNC(INTE,""TS""),3) ;WHEN END DATE"
^XTV(8991,47,1,2,1,71,0)=" D SET^HLOAPI(.SEG,""SCHED"",6) ;WHICH DATE/TIME QUALIFIER"
^XTV(8991,47,1,2,1,72,0)=" D SET^HLOAPI(.SEG,""REP"",7) ; WHICH DATE/TIME STATUS QUALIFIER"
^XTV(8991,47,1,2,1,73,0)=" D SET^HLOAPI(.SEG,""ALL"",8) ; DATE/TIME SELECTION QUALIFIER"
^XTV(8991,47,1,2,1,74,0)=" ;"
^XTV(8991,47,1,2,1,75,0)=" ;ADD SEGMENT TO MESSAGE"
^XTV(8991,47,1,2,1,76,0)=" ;"
^XTV(8991,47,1,2,1,77,0)=" I '$$ADDSEG^HLOAPI(.HLMSTATE,.SEG) S ERR=""QRF"""
^XTV(8991,47,1,2,1,78,0)=" ;"
^XTV(8991,47,1,2,1,79,0)=" ;"
^XTV(8991,47,1,2,1,80,0)=" ;CREATE NTE SEGMENTS FROM SDARRAY ELEMENTS"
^XTV(8991,47,1,2,1,81,0)=" S INDEX=0"
^XTV(8991,47,1,2,1,82,0)=" F  S INDEX=$O(SDARRAY(INDEX)) Q:INDEX=""""  D"
^XTV(8991,47,1,2,1,83,0)=" .D SET^HLOAPI(.SEG,""NTE"",0)"
^XTV(8991,47,1,2,1,84,0)=" .I INDEX=+INDEX S CONSTRUCT=""SDARRAY(""_INDEX_"")="""
^XTV(8991,47,1,2,1,85,0)=" .I INDEX'=+INDEX S CONSTRUCT=""SDARRAY(""_""""""""_INDEX_""""""""_"")="""
^XTV(8991,47,1,2,1,86,0)=" .I SDARRAY(INDEX)=+SDARRAY(INDEX) S CONSTRUCT=CONSTRUCT_SDARRAY(INDEX)"
^XTV(8991,47,1,2,1,87,0)=" .I SDARRAY(INDEX)'=+SDARRAY(INDEX) S CONSTRUCT=CONSTRUCT_""""""""_SDARRAY(INDEX)_"""""""""
^XTV(8991,47,1,2,1,88,0)=" .D SET^HLOAPI(.SEG,CONSTRUCT,3) ; COMMENTS STORING SDARRAY(?)ARRAY ELEMENT"
^XTV(8991,47,1,2,1,89,0)=" .;"
^XTV(8991,47,1,2,1,90,0)=" .;ADD SEGMENT TO MESSAGE"
^XTV(8991,47,1,2,1,91,0)=" .;"
^XTV(8991,47,1,2,1,92,0)=" .;"
^XTV(8991,47,1,2,1,93,0)=" .S IFLAG=0"
^XTV(8991,47,1,2,1,94,0)=" .I '$$ADDSEG^HLOAPI(.HLMSTATE,.SEG) S IFLAG=""NTE""_INDEX"
^XTV(8991,47,1,2,1,95,0)=" .;"
^XTV(8991,47,1,2,1,96,0)=" .I IFLAG'=0 Q"
^XTV(8991,47,1,2,1,97,0)=" I IFLAG'=0 Q IFLAG"
^XTV(8991,47,1,2,1,98,0)=" ; DEFINE SENDING AND RECEIVING PARAMETERS"
^XTV(8991,47,1,2,1,99,0)=" S APPARMS(""SENDING APPLICATION"")=""VWSD HLO EXT"""
^XTV(8991,47,1,2,1,100,0)=" S APPARMS(""ACCEPT ACK TYPE"")=""NE"" ;""AL"""
^XTV(8991,47,1,2,1,101,0)=" ;S APPARMS(""APP ACK RESPONSE"")=""APPACKRR^SDVWHLEX"""
^XTV(8991,47,1,2,1,102,0)=" ;S APPARMS(""ACCEPT ACK RESPONSE"")=""MSGPROC^SDVWHLEX"""
^XTV(8991,47,1,2,1,103,0)=" ;REVERSE BELOW "
^XTV(8991,47,1,2,1,104,0)=" S APPARMS(""ACCEPT ACK RESPONSE"")=""APPACKRR^SDVWHLEX"" ; WHEN COMIT ACK , SU OR AE RETURN MADE"
^XTV(8991,47,1,2,1,105,0)=" S APPARMS(""APP ACK RESPONSE"")=""MSGPROC^SDVWHLEX"" ; WHEN NO ACK RETURN MADE "
^XTV(8991,47,1,2,1,106,0)=" S APPARMS(""APP ACK TYPE"")=""NE"" ;""AL"""
^XTV(8991,47,1,2,1,107,0)=" S WHO(""RECEIVING APPLICATION"")=""VWSD RECEIVER"""
^XTV(8991,47,1,2,1,108,0)=" S WHO(""FACILITY LINK NAME"")=""VWSDTSMML"""
^XTV(8991,47,1,2,1,109,0)=" ;"
^XTV(8991,47,1,2,1,110,0)=" ;SEND MESSAGE"
^XTV(8991,47,1,2,1,111,0)=" ;"
^XTV(8991,47,1,2,1,112,0)=" I '$$SENDONE^HLOAPI1(.HLMSTATE,.APPARMS,.WHO,.ERROR) Q ""ERR=""_ERR_"" ERROR=""_ERROR"
^XTV(8991,47,1,2,1,113,0)=" S MSGCTRL=HLMSTATE(""HDR"",""MESSAGE CONTROL ID"") ;HLMSTATE(""ID"")"
^XTV(8991,47,1,2,1,114,0)=" Q ""OK"""
^XTV(8991,47,1,2,1,115,0)="MSGPROC ; ACK PROCESSING ROUTINE FOR NO RECEIVE ACKS, ETC FOR SDAPI AND MAKE APPOINTMENT API RETURN DATA "
^XTV(8991,47,1,2,1,116,0)=" Q"
^XTV(8991,47,1,2,1,117,0)="APPACKRR ;MAIN APPLICATION ACK RESPONSE FOR SDAPI AND MAKE APPOINTMENT API RETURN DATA "
^XTV(8991,47,1,2,1,118,0)=" N IER,MSGCTRL,SEG,HLMSTATE,HDR"
^XTV(8991,47,1,2,1,119,0)=" S MSGCTRL=0"
^XTV(8991,47,1,2,1,120,0)=" S IER=$$APPACKR1(.MSGCTRL)"
^XTV(8991,47,1,2,1,121,0)=" I MSGCTRL'=0 S ^XTMP(MSGCTRL,""RETURN"")=IER"
^XTV(8991,47,1,2,1,122,0)=" Q"
^XTV(8991,47,1,2,1,123,0)="APPACKR1(MSGCTRL) ;APPLICATION ACK RESPONSE FOR SDAPI RETURN DATA AND MAKE APPOINTMENT API "
^XTV(8991,47,1,2,1,124,0)=" ; AND MAKE APPT API ACK "
^XTV(8991,47,1,2,1,125,0)=" N HLVWNOVA,HLMSGTMP,AJJ3CNT,AJJ3CNT1,AJJ3CNT2,SSNPATN,AJJ3VIS"
^XTV(8991,47,1,2,1,126,0)=" N APPARMS,ERROR,HLMSGIEN,WHO,QRDSORT,SORTORDR,OVERAPPT ;"
^XTV(8991,47,1,2,1,127,0)=" N SEGTYPE,IRECAPP,ISNDFAC,IEVN,IFLAGA19,IFLAGACK,POSITION"
^XTV(8991,47,1,2,1,128,0)=" N PATIENID,PATIENT,SSN,PATIENTCL,SDLOCATION,PRIMCREDCD,PRIMSTOPCD"
^XTV(8991,47,1,2,1,129,0)=" N SDDATE,ELIGIB,EXPECTDT,APPTST,DATEAPTM"
^XTV(8991,47,1,2,1,130,0)=" N PIDVALUES,PV1VALUES,PV2VALUES"
^XTV(8991,47,1,2,1,131,0)=" N SDARRAY,SDCOUNT,ERR,TEMP8"
^XTV(8991,47,1,2,1,132,0)=" N SDLOCATE,HOSPLOC,ORDRSORT,MSGMAKAP,COMMENT,X,Y,MSGCTRL1"
^XTV(8991,47,1,2,1,133,0)=" ;APPLICATION ACK REPONSE ROUTINE"
^XTV(8991,47,1,2,1,134,0)=" ;"
^XTV(8991,47,1,2,1,135,0)=" ;FOR SDAPI APPLICATION ACK BELOW"
^XTV(8991,47,1,2,1,136,0)=" ;INPUT"
^XTV(8991,47,1,2,1,137,0)=" ;           "
^XTV(8991,47,1,2,1,138,0)=" ;OUTPUT IF NO ERRORS AND SDCOUNT RETURNED >0 ( ALL FIELDS IN EXTERNAL FORMAT BELOW)"
^XTV(8991,47,1,2,1,139,0)=" ;.I $E(ORDRSORT,1,1)=""P"""
^XTV(8991,47,1,2,1,140,0)=" ;..S ^XTMP(MSGCTRL,""SDAMA301"",SSN,SDLOCATE,SDDATE)=SDAPPNT (UP TO 20 PIECES OF 20 SPECIFIED ""FLDS: FIELDS IN SDARRAY(""FLDS"")"
^XTV(8991,47,1,2,1,141,0)=" ;.I $E(ORDRSORT,1,1)=""C"""
^XTV(8991,47,1,2,1,142,0)=" ;..S ^XTMP(MSGCTRL,""SDAMA301"",SDLOCATE,SSN,SDDATE)=SDAPPNT (UP TO 20 PIECES OF 20 SPECIFIED ""FLDS: FIELDS IN SDARRAY(""FLDS"")"
^XTV(8991,47,1,2,1,143,0)=" ;"
^XTV(8991,47,1,2,1,144,0)=" ; AND S ^XTMP(MSGCTRL,""RETURN"")=IER  RETURNED "
^XTV(8991,47,1,2,1,145,0)=" ;"
^XTV(8991,47,1,2,1,146,0)=" ;AS EXPLAINED IN CODE BELOW"
^XTV(8991,47,1,2,1,147,0)=" ; FOR ELEMENTS RANGES OF SDLOCATE ( HOSPITAL LOCATION (CLINIC) EXTERNAL FORMAT ) IN APPOINTMENTS RETURNED"
^XTV(8991,47,1,2,1,148,0)=" ;              RANGES OF SSN FOR PATIENT'S UNIQUE SSN IN APPOINTMENTS RETURNED"
^XTV(8991,47,1,2,1,149,0)=" ;"
^XTV(8991,47,1,2,1,150,0)=" ; "
^XTV(8991,47,1,2,1,151,0)=" ;RETURN  POSITION_""^""_SDCOUNT_""^""_HDR(""APP ACK TYPE"") "
^XTV(8991,47,1,2,1,152,0)=" ;                            POSITION IS NUMBER OF RETURNED APPOINTMENTS/VISITS"
^XTV(8991,47,1,2,1,153,0)=" ;"
^XTV(8991,47,1,2,1,154,0)=" ;                            SDCOUNT IS SAME UNLESS ERROR "
^XTV(8991,47,1,2,1,155,0)=" ;                            WITH ERROR RETURNS AS "
^XTV(8991,47,1,2,1,156,0)=" ;                            FROM $$SDAPI^SDAM301 AND OTHER ERRORS FOUND FROM RECEIVING APPLICATION"
^XTV(8991,47,1,2,1,157,0)=" ;"
^XTV(8991,47,1,2,1,158,0)=" ;                            APP ACK TYPE ACTUALLY RETURNED, IE ""AA""OR ""AE"""
^XTV(8991,47,1,2,1,159,0)=" ;"
^XTV(8991,47,1,2,1,160,0)=" ;        OR ONE OF THE FOLLOWING FROM HIS REPONSE ROUTINE TO THE APPLICATION ACKNOWLEDGE TO THE "
^XTV(8991,47,1,2,1,161,0)=" ;"_$C(9,9,9,9)_"REQUESTING APPLICATION"
^XTV(8991,47,1,2,1,162,0)=" ;                                            "
^XTV(8991,47,1,2,1,163,0)=" ;        ""STARTMSG"" "
^XTV(8991,47,1,2,1,164,0)=" ;        ""ERR""_$$GET^HLOPRS(.SEQ,1)"
^XTV(8991,47,1,2,1,165,0)=" ;        ""NOTRETURNED ACK"""
^XTV(8991,47,1,2,1,166,0)=" ;        ""HOSPLOC"""
^XTV(8991,47,1,2,1,167,0)=" ;         VWSD"
^XTV(8991,47,1,2,1,168,0)=" ;PARSE ACK MESSAGE WITH REPEATING ADT RESPONSE (PID,PV1,PV2,NTE,NTE)"
^XTV(8991,47,1,2,1,169,0)=" ;WITH EVENT TYPE A19 WITH APPLICATION REPLY TO PATIENT INQUIRY REQUEST "
^XTV(8991,47,1,2,1,170,0)=" ;"
^XTV(8991,47,1,2,1,171,0)=" ;FOR MAKE APPT API RETURN   COMMENT_""^""_HDR(""APP ACK TYPE"") "
^XTV(8991,47,1,2,1,172,0)=" ;                 WHERE COMMENT IS AS RETURNED FROM VWSDMKPI CALL RETURN"
^XTV(8991,47,1,2,1,173,0)=" ;"
^XTV(8991,47,1,2,1,174,0)=" ;"
^XTV(8991,47,1,2,1,175,0)=" ;"
^XTV(8991,47,1,2,1,176,0)=" ;PASS THE HEADER AND RETURN INDIVIDUAL VALUES"
^XTV(8991,47,1,2,1,177,0)=" ;"
^XTV(8991,47,1,2,1,178,0)=" S HLVWNOVA=1  ; ALLOW NON-VA STATION NODE WITH ASSOCIATED INSTITUTION "
^XTV(8991,47,1,2,1,179,0)=" ; FOR DETERMINING FACILITY LINK WHEN SENDING APPLICATION BECOMES RECEIVING "
^XTV(8991,47,1,2,1,180,0)=" ; APPLICATION, AND TO FIGURE ""SENDING FACILITY LINK"" "
^XTV(8991,47,1,2,1,181,0)=" S HLMSGTMP=""AC"" ;200000000000  "
^XTV(8991,47,1,2,1,182,0)=" ;^HLB(""AC"",""HL7.VWSD INTERNAL MULTILISTENER:5026VWSD HLO EXT100 XXXXX"",200000000XXX)"
^XTV(8991,47,1,2,1,183,0)=" S HLMSGIEN=$O(^HLB(HLMSGTMP),-1)"
^XTV(8991,47,1,2,1,184,0)=" S HDR="""" S HLMSTATE="""""
^XTV(8991,47,1,2,1,185,0)=" ;"
^XTV(8991,47,1,2,1,186,0)=" I '$$STARTMSG^HLOPRS(.HLMSTATE,HLMSGIEN,.HDR) Q ""STARTMSG"""
^XTV(8991,47,1,2,1,187,0)=" ;"
^XTV(8991,47,1,2,1,188,0)=" ;"
^XTV(8991,47,1,2,1,189,0)="MSG1 ;CHECK RECEIVING APPLICATION"
^XTV(8991,47,1,2,1,190,0)=" ;;S IRECAPP=HDR(""RECEIVING APPLICATION"")"
^XTV(8991,47,1,2,1,191,0)=" ;W !,""IRECAPP="",IRECAPP"
^XTV(8991,47,1,2,1,192,0)=" ;;S ISNDFAC=HDR(""FACILITY LINK NAME"")"
^XTV(8991,47,1,2,1,193,0)=" S MSGCTRL1=HDR(""SECURITY"")"
^XTV(8991,47,1,2,1,194,0)=" ;"
^XTV(8991,47,1,2,1,195,0)=" ;CHECK TO SEE IF RETURN FROM MAKE APPT ( HAS # AND ACK CONDITION AA OR AEFOLLOWING)"
^XTV(8991,47,1,2,1,196,0)=" ;"
^XTV(8991,47,1,2,1,197,0)=" I MSGCTRL1[""#"" D"
^XTV(8991,47,1,2,1,198,0)=" . S MSGCTRL=$P(MSGCTRL1,""#"",1)"
^XTV(8991,47,1,2,1,199,0)=" E  D"
^XTV(8991,47,1,2,1,200,0)=" .S MSGCTRL=MSGCTRL1"
^XTV(8991,47,1,2,1,201,0)=" ;"
^XTV(8991,47,1,2,1,202,0)=" S IFLAGA19=0"
^XTV(8991,47,1,2,1,203,0)=" S POSITION=0"
^XTV(8991,47,1,2,1,204,0)=" S IEVN=0"
^XTV(8991,47,1,2,1,205,0)=" S SDCOUNT=0"
^XTV(8991,47,1,2,1,206,0)=" S SDLOCATE="""""
^XTV(8991,47,1,2,1,207,0)=" S ORDRSORT="""""
^XTV(8991,47,1,2,1,208,0)=" S MSGMAKAP=0 ;"
^XTV(8991,47,1,2,1,209,0)=" S COMMENT="""" ;"
^XTV(8991,47,1,2,1,210,0)=" S SDARRAY="""""
^XTV(8991,47,1,2,1,211,0)=" S ERR="""""
^XTV(8991,47,1,2,1,212,0)=" S AJJ3CNT=0"
^XTV(8991,47,1,2,1,213,0)=" S SEG="""""
^XTV(8991,47,1,2,1,214,0)=" ;I HDR(""MESSAGE TYPE"")'=""ACK"" S ERR=""NONRETURNED ACK"""
^XTV(8991,47,1,2,1,215,0)=" ; ADVANCE TO EACH SEGMENT IN THE MESSAGE"
^XTV(8991,47,1,2,1,216,0)=" ;"
^XTV(8991,47,1,2,1,217,0)=" S VWSDFLAG=1"
^XTV(8991,47,1,2,1,218,0)=" S AJJ3CNT1=0"
^XTV(8991,47,1,2,1,219,0)=" S AJJ3CNT2=0"
^XTV(8991,47,1,2,1,220,0)=" S AJJ3VIS=0"
^XTV(8991,47,1,2,1,221,0)="SEQ I '$$NEXTSEG^HLOPRS(.HLMSTATE,.SEG) G EXIT"
^XTV(8991,47,1,2,1,222,0)=" ;"
^XTV(8991,47,1,2,1,223,0)=" S VWSDFLAG=VWSDFLAG+1"
^XTV(8991,47,1,2,1,224,0)=" S AJJ3CNT1=AJJ3CNT1+1"
^XTV(8991,47,1,2,1,225,0)=" ;"
^XTV(8991,47,1,2,1,226,0)=" S SEGTYPE=$$GET^HLOPRS(.SEG,0)"
^XTV(8991,47,1,2,1,227,0)=" S AJJ3CNT=AJJ3CNT+1"
^XTV(8991,47,1,2,1,228,0)=" ;"
^XTV(8991,47,1,2,1,229,0)=" ;"
^XTV(8991,47,1,2,1,230,0)=" ; NEED TO GET REQUESTING APPLICATION'S MSGCTRL ID STORED IN SECURITY FIELD IN MSH SEGMENT."
^XTV(8991,47,1,2,1,231,0)=" ; ALSO IN HLMSTATE OR HDR"
^XTV(8991,47,1,2,1,232,0)=" ;"
^XTV(8991,47,1,2,1,233,0)=" ;CODED BELOW ?"
^XTV(8991,47,1,2,1,234,0)=" I SEGTYPE=""MSH"" D"
^XTV(8991,47,1,2,1,235,0)=" .;GET SYNC (MSGCTRL) IN SECURITY FIELD"
^XTV(8991,47,1,2,1,236,0)=" .S MSGCTRL=$$GET^HLOPRS(.SEG,8)  ; OR GET SECURITY OUT OF HDR OR HLMSTATE, IE HDR(""SECURITY) OT HLMSTATE(""SECURITY"")"
^XTV(8991,47,1,2,1,237,0)=" .;"
^XTV(8991,47,1,2,1,238,0)=" I SEGTYPE=""ERR"" D"
^XTV(8991,47,1,2,1,239,0)=" .S ERR=$$GET^HLOPRS(.SEG,1)"
^XTV(8991,47,1,2,1,240,0)=" .;"
^XTV(8991,47,1,2,1,241,0)=" I (MSGCTRL1[""#"")&(SEGTYPE=""ERR"") G SEQ"
^XTV(8991,47,1,2,1,242,0)=" I SEGTYPE=""QRD"" D"
^XTV(8991,47,1,2,1,243,0)=" .S QRDSORT=$$GET^HLOPRS(.SEG,8) ; WHO SUBJECT FILTER"
^XTV(8991,47,1,2,1,244,0)=" .S QRDSORT=$P(QRDSORT,"","",1) ; P,PS,C,CN"
^XTV(8991,47,1,2,1,245,0)=" .S SDCOUNT=$$GET^HLOPRS(.SEG,11) ; WHAT DATA CD VALUE QUA"
^XTV(8991,47,1,2,1,246,0)=" .;"
^XTV(8991,47,1,2,1,247,0)=" I SEGTYPE=""EVN"" D"
^XTV(8991,47,1,2,1,248,0)=" . S IEVN=$$GET^HLOPRS(.SEG,1)"
^XTV(8991,47,1,2,1,249,0)=" . ;"
^XTV(8991,47,1,2,1,250,0)=" ;"
^XTV(8991,47,1,2,1,251,0)=" ;NOW GET COMBINATION SEQUENCES OF PID,PV1,PV2,NTE"
^XTV(8991,47,1,2,1,252,0)=" I SEGTYPE=""PID"" D"
^XTV(8991,47,1,2,1,253,0)=" . S POSITION=POSITION+1"
^XTV(8991,47,1,2,1,254,0)=" . S SDARRAY="""""
^XTV(8991,47,1,2,1,255,0)=" . ;GET PATIENT INTERNAL ID"
^XTV(8991,47,1,2,1,256,0)=" . S PATIENID=$$GET^HLOPRS(.SEG,3)"
^XTV(8991,47,1,2,1,257,0)=" . S PATIENT=$$GET^HLOPRS(.SEG,5) "
^XTV(8991,47,1,2,1,258,0)=" . S SSN=$$GET^HLOPRS(.SEG,19)"
^XTV(8991,47,1,2,1,259,0)=" . S PIDVALUES=PATIENID_""^""_PATIENT_""^""_SSN"
^XTV(8991,47,1,2,1,260,0)=" . ;"
^XTV(8991,47,1,2,1,261,0)=" I (MSGCTRL1[""#"")&(SEGTYPE=""PID"") G SEQ"
^XTV(8991,47,1,2,1,262,0)=" I SEGTYPE=""PV1"" D"
^XTV(8991,47,1,2,1,263,0)=" . S AJJ3VIS=AJJ3VIS+1"
^XTV(8991,47,1,2,1,264,0)=" . ;GET PATIENT INTERNAL ID"
^XTV(8991,47,1,2,1,265,0)=" . S PATIENTCL=$$GET^HLOPRS(.SEG,2)  ; PATIENT CLASS"
^XTV(8991,47,1,2,1,266,0)=" . S SDLOCID=$$GET^HLOPRS(.SEG,3) ; INTERNAL ID ONLY, EXTERNAL IN NTE SEGMENT"
^XTV(8991,47,1,2,1,267,0)=" . S PURPVISIT=$$GET^HLOPRS(.SEG,10) ; HOSPITAL SERVICE (PURPOSE OF VISIT)"
^XTV(8991,47,1,2,1,268,0)=" . S PRIMSTOPCD=$$GET^HLOPRS(.SEG,18) ; PATIENT TYPE (PRIME STOP CODE)"
^XTV(8991,47,1,2,1,269,0)=" . S PRIMCREDCD=$$GET^HLOPRS(.SEG,41) ; ACCOUNT STATUS (CREDIT STOP CODE)"
^XTV(8991,47,1,2,1,270,0)=" . S SDDATE=$$GET^HLOPRS(.SEG,44) ; ADMIT-VISIT DATE/TIME"
^XTV(8991,47,1,2,1,271,0)=" . ; CONVERT FROM TS TO FM DATE"
^XTV(8991,47,1,2,1,272,0)=" . S SDDATE=$$FMDATE^HLFNC(SDDATE)"
^XTV(8991,47,1,2,1,273,0)=" . ; THEN FM DATE TO EXTERNAL DATE FORMAT"
^XTV(8991,47,1,2,1,274,0)=" . S Y=SDDATE D DD^%DT S SDDATE=Y"
^XTV(8991,47,1,2,1,275,0)=" . ;"
^XTV(8991,47,1,2,1,276,0)=" . ; S XXXX=$$GET^HLOPRS(.SEG,51) ;"
^XTV(8991,47,1,2,1,277,0)=" . S PVIVALUES=PATIENTCL_""^""_SDLOCID_""^""_PURPVISIT_""^""_PRIMSTOPCD_""^""_PRIMCREDCD_""^""_SDDATE"
^XTV(8991,47,1,2,1,278,0)=" . ;"
^XTV(8991,47,1,2,1,279,0)=" I SEGTYPE=""PV2"" D"
^XTV(8991,47,1,2,1,280,0)=" . S ELIGIB=$$GET^HLOPRS(.SEG,7) ; VISIT USER ID-ELIGIBILITY FOR UNSCHEDULED VISITS "
^XTV(8991,47,1,2,1,281,0)=" . S EXPECTDT=$$GET^HLOPRS(.SEG,8) ; EXPECTED DATE/TIME"
^XTV(8991,47,1,2,1,282,0)=" . S APPTST=$$GET^HLOPRS(.SEG,24)  ;APPOINT STATUS"
^XTV(8991,47,1,2,1,283,0)=" . S DATEAPTM=$$GET^HLOPRS(.SEG,46) ;DATE APPT MADE"
^XTV(8991,47,1,2,1,284,0)=" . S PV2VALUES=ELIGIB_""^""_EXPECTDT_""^""_APPTST_""^""_DATEAPTM"
^XTV(8991,47,1,2,1,285,0)=" . ;"
^XTV(8991,47,1,2,1,286,0)=" I SEGTYPE=""NTE"" D"
^XTV(8991,47,1,2,1,287,0)=" . S AJJ3CNT2=AJJ3CNT2+1"
^XTV(8991,47,1,2,1,288,0)=" . S TEMP=$$GET^HLOPRS(.SEG,3) ; UP TO 20 PIECES OF DATA FROM ARRAY DEFINITION FOR SDAPI"
^XTV(8991,47,1,2,1,289,0)=" . ;"
^XTV(8991,47,1,2,1,290,0)=" . I $E(TEMP,1,9)=""SDLOCATE="" D"
^XTV(8991,47,1,2,1,291,0)=" . .S SDLOCATE=$P(TEMP,""SDLOCATE="",2)"
^XTV(8991,47,1,2,1,292,0)=" . .S SDLOCATE=$P(SDLOCATE,"""""""",2) ;STRIP OFF LEADING QUOTE"
^XTV(8991,47,1,2,1,293,0)=" . .S SDLOCATE=$P(SDLOCATE,"""""""",1) ;STRIP OFF TRAILING QUOTE"
^XTV(8991,47,1,2,1,294,0)=" . .;"
^XTV(8991,47,1,2,1,295,0)=" . E  D"
^XTV(8991,47,1,2,1,296,0)=" . . S SDARRAY=TEMP"
^XTV(8991,47,1,2,1,297,0)=" . . ;"
^XTV(8991,47,1,2,1,298,0)=" ;EVERY TIME GET A PID SEGMENT INCREMENT POSITION"
^XTV(8991,47,1,2,1,299,0)=" ;AND STUFF IN ^XTMP ARRAY ACCORDING TO SORT ORDER"
^XTV(8991,47,1,2,1,300,0)=" ;"
^XTV(8991,47,1,2,1,301,0)=" ;"
^XTV(8991,47,1,2,1,302,0)=" I MSGCTRL=0 S ERR=""ERROR MSGCTRL=0"" G SEQ"
^XTV(8991,47,1,2,1,303,0)=" I (SDARRAY'="""")&(SDLOCATE="""")&(COMMENT="""") Q ""HOSPLOC"""
^XTV(8991,47,1,2,1,304,0)=" I (SDARRAY'="""")&(QRDSORT="""")&(COMMENT="""") Q ""ORDERSORT"""
^XTV(8991,47,1,2,1,305,0)=" I (SDARRAY'="""")&(SDCOUNT>0) D"
^XTV(8991,47,1,2,1,306,0)=" .;CONVERT EMBEDDED # IN SDARRAY BACK INTO LEGAL""^"" IN DATA"
^XTV(8991,47,1,2,1,307,0)=" .S TEMP8=SDARRAY"
^XTV(8991,47,1,2,1,308,0)=" .D REPLACE1(.TEMP8)"
^XTV(8991,47,1,2,1,309,0)=" .S SDARRAY=TEMP8"
^XTV(8991,47,1,2,1,310,0)=" .I $E(QRDSORT,1,1)=""P"" D"
^XTV(8991,47,1,2,1,311,0)=" ..S SSNPATN=SSN_""#""_PATIENT"
^XTV(8991,47,1,2,1,312,0)=" ..S ^XTMP(MSGCTRL,""SDAMA301"",AJJ3VIS)=SSNPATN_""^""_SDLOCATE_""^""_SDDATE_""^""_SDARRAY"
^XTV(8991,47,1,2,1,313,0)=" .I $E(QRDSORT,1,1)=""C"" D"
^XTV(8991,47,1,2,1,314,0)=" ..S SSNPATN=SSN_""#""_PATIENT"
^XTV(8991,47,1,2,1,315,0)=" ..S ^XTMP(MSGCTRL,""SDAMA301"",AJJ3VIS)=SDLOCATE_""^""_SSNPATN_""^""_SDDATE_""^""_SDARRAY"
^XTV(8991,47,1,2,1,316,0)=" .;"
^XTV(8991,47,1,2,1,317,0)=" ;"
^XTV(8991,47,1,2,1,318,0)=" I SDARRAY'="""" S SDARRAY="""""
^XTV(8991,47,1,2,1,319,0)=" G SEQ"
^XTV(8991,47,1,2,1,320,0)=" ;"
^XTV(8991,47,1,2,1,321,0)=" ;"
^XTV(8991,47,1,2,1,322,0)="EXIT ;"
^XTV(8991,47,1,2,1,323,0)=" ;NOT GO TO NEXT MESSAGE FOR THIS TEST"
^XTV(8991,47,1,2,1,324,0)=" ;"
^XTV(8991,47,1,2,1,325,0)=" ;"
^XTV(8991,47,1,2,1,326,0)=" ;I $$NEXTMSG^HLOPRS(.HLMSTATE,HLMGIEN,.HDR) G SEQ"
^XTV(8991,47,1,2,1,327,0)=" ;"
^XTV(8991,47,1,2,1,328,0)=" ;IF MAKE APPNT API APP ACK RESPONSE ( IE, COMMENT'="""")"
^XTV(8991,47,1,2,1,329,0)=" ;RETURN RETURN NOW FROM CAll to VWSDMKPI CALL RETURNED FROM RECEIVING APPLICATION"
^XTV(8991,47,1,2,1,330,0)=" ;"
^XTV(8991,47,1,2,1,331,0)=" I MSGCTRL1[""#"" S MSGCTRL1=$P(MSGCTRL1,""#"",2)_""^""_ERR Q MSGCTRL1 ; RETURN FOR MAKE APPT"
^XTV(8991,47,1,2,1,332,0)=" I ERR'="""" Q HDR(""APP ACK TYPE"")_""^""_ERR ; MAKE APPT API RETURN"
^XTV(8991,47,1,2,1,333,0)=" ;"
^XTV(8991,47,1,2,1,334,0)=" ;"
^XTV(8991,47,1,2,1,335,0)=" Q ""OK""_""^""_QRDSORT_""^""_SDCOUNT_""^""_POSITION ;SDAPI RETURN"
^XTV(8991,47,1,2,1,336,0)=" ;"
^XTV(8991,47,1,2,1,337,0)="REPLACE1(TEMP8)"
^XTV(8991,47,1,2,1,338,0)=" N REST,LEN8,L8,PIEC8"
^XTV(8991,47,1,2,1,339,0)=" S REST=TEMP8"
^XTV(8991,47,1,2,1,340,0)=" S LEN8=$L(TEMP8)"
^XTV(8991,47,1,2,1,341,0)=" F  Q:REST=""""  D"
^XTV(8991,47,1,2,1,342,0)=" .S PIEC8=$P(TEMP8,""#"",1)"
^XTV(8991,47,1,2,1,343,0)=" .S L8=$L(PIEC8)+2"
^XTV(8991,47,1,2,1,344,0)=" .I L8>LEN8 D"
^XTV(8991,47,1,2,1,345,0)=" ..S REST="""" I $E(TEMP8,LEN8,LEN8)=""#"" S $E(TEMP8,LEN8,LEN8)=""^"""
^XTV(8991,47,1,2,1,346,0)=" .E  D"
^XTV(8991,47,1,2,1,347,0)=" ..S REST=$E(TEMP8,L8,LEN8)"
^XTV(8991,47,1,2,1,348,0)=" .I (PIEC8'="""")&(REST'="""") D"
^XTV(8991,47,1,2,1,349,0)=" ..S TEMP8=PIEC8_""^""_REST"
^XTV(8991,47,1,2,1,350,0)=" Q"
^XTV(8991,47,1,2,1,351,0)="TRNSMKPI(PATIENTN,SSN,SD1,SC,STYP,SDARRAY,OUTIN,MSGCTRL,SDVWNVAI)"
^XTV(8991,47,1,2,1,352,0)=" ;;"
^XTV(8991,47,1,2,1,353,0)=" ;"
^XTV(8991,47,1,2,1,354,0)=" ; HL7 TRANSMIT DRIVER FOR"_$C(9)
^XTV(8991,47,1,2,1,355,0)=" ; MAKE AN APPOINTMENT AS WITH ANALOGOUS $$EN^VWSDMKPI CALL "
^XTV(8991,47,1,2,1,356,0)=" ;"
^XTV(8991,47,1,2,1,357,0)=" ;"
^XTV(8991,47,1,2,1,358,0)=" ;HOWEVER, DATE/TIMES ARE EXTERNAL FORM,PATIENT SSN OR OTHER LOOKUP ID INSTEAD OF PATIENT DFN"
^XTV(8991,47,1,2,1,359,0)=" ;AND LOCATION (CLINIC) EXTERNAL NAMES INSTEAD OF INTERNAL IEN, ."
^XTV(8991,47,1,2,1,360,0)=" ;"
^XTV(8991,47,1,2,1,361,0)=" ;"
^XTV(8991,47,1,2,1,362,0)=" ;  ;INPUT : MSGCTRL PASSED BY REFERENCE TO RECEIVE THIS BACK AFTER TRANSMITTING"
^XTV(8991,47,1,2,1,363,0)=" ;      "
^XTV(8991,47,1,2,1,364,0)=" ;"_$C(9,9)_"THEN"
^XTV(8991,47,1,2,1,365,0)="    ;"
^XTV(8991,47,1,2,1,366,0)=" ; "_$C(9,9)_"SSN AS PATIENT SSN OR OTHER UNIQUE PATIENT LOOKUP ID INSTEAD OF DFN (REQUIRED)"
^XTV(8991,47,1,2,1,367,0)=" ; "_$C(9,9)_"PATIENTN PATIENT NAME ( REQUIRED)"
^XTV(8991,47,1,2,1,368,0)=" ; "_$C(9,9)_"SD1 APPOINTMENT DATE (EXTERNAL FORMAT) (REQUIRED)"
^XTV(8991,47,1,2,1,369,0)=" ; "_$C(9,9)_"SC CLINIC FOR APPOINTMENT (EXTERNAL FORMAT) (REQUIRED)"
^XTV(8991,47,1,2,1,370,0)=" ; "_$C(9,9)_"STYP = (REQUIRED)"
^XTV(8991,47,1,2,1,371,0)=" ; "_$C(9,9)_"     =1 c&p"
^XTV(8991,47,1,2,1,372,0)=" ; "_$C(9,9)_"     =2 10-10"_$C(9,9)
^XTV(8991,47,1,2,1,373,0)=" ; "_$C(9,9)_"     =3 SCHEDULED APPOINTMENT "
^XTV(8991,47,1,2,1,374,0)=" ; "_$C(9,9)_"     =4 UNSCHEDULED VISIT"
^XTV(8991,47,1,2,1,375,0)=" ; "_$C(9,9)_"OUTIN= ""O"" for oupatient or ""I"" for inpatient"
^XTV(8991,47,1,2,1,376,0)=" ;       SDARRAY AS DEFINED BELOW ( WITH DATE/TIMES IN EXTERNAL DATE/TIME FORMAT)"
^XTV(8991,47,1,2,1,377,0)=" ;"_$C(9,9)_" (PASSED ARRAYS WITH NUMERIC INFO W/O QUOTES AND NON-NUMERIC ENCLOSED WITH QUOTES)"
^XTV(8991,47,1,2,1,378,0)=" ;               SDVWNVAI  OPTIONAL PASSED ARGUMENT WITH VALUES AS DEFINED BELOW REGARDING ICN CONNECTION"
^XTV(8991,47,1,2,1,379,0)=" ; "
^XTV(8991,47,1,2,1,380,0)=" ;"
^XTV(8991,47,1,2,1,381,0)=" ;"
^XTV(8991,47,1,2,1,382,0)=" ;"
^XTV(8991,47,1,2,1,383,0)=" ; OUTPUT"
^XTV(8991,47,1,2,1,384,0)=" ;       "
^XTV(8991,47,1,2,1,385,0)=" ;         "
^XTV(8991,47,1,2,1,386,0)=" ; "_$C(9,9)_" Q "
^XTV(8991,47,1,2,1,387,0)=" ;         ""NEW MESSAGE ERROR"""
^XTV(8991,47,1,2,1,388,0)=" ;         ""PID"""
^XTV(8991,47,1,2,1,389,0)=" ;         ""PV1"""
^XTV(8991,47,1,2,1,390,0)=" ;         ""PV2"""
^XTV(8991,47,1,2,1,391,0)=" ;         ""NTE""_INDEX"
^XTV(8991,47,1,2,1,392,0)=" ;         ""STYP"""
^XTV(8991,47,1,2,1,393,0)=" ;         ""HOSPLOC"""
^XTV(8991,47,1,2,1,394,0)=" ; "
^XTV(8991,47,1,2,1,395,0)=" ;       EXAMPLE AS IF ANALOGOUS CALL MADE AS BELOW:"
^XTV(8991,47,1,2,1,396,0)=" ;       "
^XTV(8991,47,1,2,1,397,0)=" ;       N DFN(SSN AND PATIENT NAME INSTEAD),SD1,SC(HOSP LOCATION (CLINIC) EXT FORMAT NAME INSTEAD,STYP,"
^XTV(8991,47,1,2,1,398,0)=" ;       N SDARRAY (DATE/TIMES IN EXTERNAL FORMAT),IER"
^XTV(8991,47,1,2,1,399,0)=" ;       N SDVWNVAI ; EXIST AS NON-VA RELATED PFSS EVENT MODE"
^XTV(8991,47,1,2,1,400,0)=" ;                                = ""D"" DISABLING THE NEED FOR ICN"
^XTV(8991,47,1,2,1,401,0)=" ;                                = ""O"" AS OTHER NON-VA ICN SYSTEM ( FUTURE)"
^XTV(8991,47,1,2,1,402,0)=" ;       S XQSDVWSI = 1    ;SILENT MODE FOR NON-INTERACTIVE MODE W/O WRITE IN XQOR ROUTINES"
^XTV(8991,47,1,2,1,403,0)=" ;       S SDVWNVAI = ""D""  ; NON-VA TESTING HERE WITH DISABLING THE NEED FOR ICN"
^XTV(8991,47,1,2,1,404,0)=" ;       S SSN=100001234 ; DFN=1"
^XTV(8991,47,1,2,1,405,0)=" ;       S SD1=""JAN 23, 2007@09:30""; SD1=3070123.0930 "
^XTV(8991,47,1,2,1,406,0)=" ;       S SC=""RADIOLOGY CLINIC"" ; S SC=3 "
^XTV(8991,47,1,2,1,407,0)=" ;       S STYP=3"
^XTV(8991,47,1,2,1,408,0)=" ;       S OUTIN=""O"" for outpatient clinic"
^XTV(8991,47,1,2,1,409,0)=" ;       S SDARRAY(""DATE NOW"")= ""DATE NOW"" ; D NOW^%DTC S X2=X\1 S Y=X2 D DD^%DT S SDARRAY(""DATE NOW"")=Y "
^XTV(8991,47,1,2,1,410,0)=" ;       S SDARRAY(""APPT TYPE"")=9"
^XTV(8991,47,1,2,1,411,0)="    ;       S SDARRAY(""SCHED_REQ_TYPE"")=""O"""
^XTV(8991,47,1,2,1,412,0)="    ;       S SDARRAY(""NEXT APPT IND"")=0"
^XTV(8991,47,1,2,1,413,0)="    ;       S SDARRAY(""FOLLOWUP VISIT INDICATOR"")=0  ; 0 FOR NO"
^XTV(8991,47,1,2,1,414,0)="    ;       S SDARRAY(""DATA ENTRY CLERK"")=""NEW PERSON NAME"" ; DUZ"
^XTV(8991,47,1,2,1,415,0)="    ;       ;THEN PARAMETERS CONVERTED TO INTERNAL VALUE"
^XTV(8991,47,1,2,1,416,0)="    ;       S IER=$$EN^SDVWMKPI(DFN,SD1,SC,STYP,.SDARRAY)"
^XTV(8991,47,1,2,1,417,0)=" ;"
^XTV(8991,47,1,2,1,418,0)=" ;"
^XTV(8991,47,1,2,1,419,0)=" ;"_$C(9)_"SDARRAY ELEMENT DEFINITIONS FOLLOW:"
^XTV(8991,47,1,2,1,420,0)=" ;"
^XTV(8991,47,1,2,1,421,0)=" ;"
^XTV(8991,47,1,2,1,422,0)=" ;"
^XTV(8991,47,1,2,1,423,0)=" ;"
^XTV(8991,47,1,2,1,424,0)=" ;       SDARRAY(""DATE NOW"") (REQ AT TIME REQUEST MADE)"
^XTV(8991,47,1,2,1,425,0)=" ;"
^XTV(8991,47,1,2,1,426,0)=" ;       SDARRAY(""LAB DATE TIME ASSOCIATED"") = "
^XTV(8991,47,1,2,1,427,0)=" ;               """" OR DATE/TIME     (OPTIONAL)"
^XTV(8991,47,1,2,1,428,0)=" ;"
^XTV(8991,47,1,2,1,429,0)=" ;       SDARRAY(""X-RAY DATE TIME ASSOCIATED"") = "
^XTV(8991,47,1,2,1,430,0)=" ;               """" OR DATE/TIME    (OPTIONAL)"
^XTV(8991,47,1,2,1,431,0)=" ;               "
^XTV(8991,47,1,2,1,432,0)=" ;       SDARRAY(""EKG DATE TIME ASSOCIATED"") = "
^XTV(8991,47,1,2,1,433,0)=" ;               """" OR DATE/TIME     (OPTIONAL)"
^XTV(8991,47,1,2,1,434,0)=" ;"
^XTV(8991,47,1,2,1,435,0)=" ;       SDARRAY(""APPT TYPE"") = 9   (REQUIRED)"
^XTV(8991,47,1,2,1,436,0)=" ;              9 for REGULAR APPOINTMENT TYPE"
^XTV(8991,47,1,2,1,437,0)=" ;              ptr 409.1"
^XTV(8991,47,1,2,1,438,0)=" ;       SDARRAY(""APPT SUB-CATEGORY"") = ""0"" (NOT USED)"
^XTV(8991,47,1,2,1,439,0)=" ;              ""0"" for none"
^XTV(8991,47,1,2,1,440,0)=" ;              ptr 35.2"
^XTV(8991,47,1,2,1,441,0)=" ;"_$C(9)_"  "_$C(9,9)
^XTV(8991,47,1,2,1,442,0)=" ; "_$C(9,9)_"SDARRAY(""SCHED_REQ_TYPE"")='O' (REQUIRED)"
^XTV(8991,47,1,2,1,443,0)=" ; "_$C(9,9)_"       'O' FOR OTHER THAN 'NEXT AVA.' APPT.;"
^XTV(8991,47,1,2,1,444,0)=" ; "_$C(9,9)_"       set of codes"
^XTV(8991,47,1,2,1,445,0)=" ; "_$C(9,9)_"SDARRAY(""NEXT APPT IND"")=0 (REQUIRED)"
^XTV(8991,47,1,2,1,446,0)=" ; "_$C(9,9)_"        0 FOR NO"
^XTV(8991,47,1,2,1,447,0)=" ; "_$C(9,9)_"SDARRAY(""DESIRED DATE TIME OF APPT"")=SD (OPTIONAL)"
^XTV(8991,47,1,2,1,448,0)=" ; "_$C(9,9)_"SDARRAY(""FOLLOWUP VISIT INDICATOR"")= (REQUIRED)"
^XTV(8991,47,1,2,1,449,0)=" ; "_$C(9,9)_"        ""0"" FOR NO"
^XTV(8991,47,1,2,1,450,0)=" ; "_$C(9,9)_"        ""1"" FOR YES"
^XTV(8991,47,1,2,1,451,0)=" ; "_$C(9,9)
^XTV(8991,47,1,2,1,452,0)=" ; "_$C(9,9)
^XTV(8991,47,1,2,1,453,0)=" ; "_$C(9,9)_"        "
^XTV(8991,47,1,2,1,454,0)=" ; "_$C(9,9)_"SDARRAY(""X RAY DATA FREE TEXT"")=  (OPTIONAL)"
^XTV(8991,47,1,2,1,455,0)=" ; "_$C(9,9)_"SDARRAY(""OTHER DATA FREE TEXT"")=  (OPTIONAL)"
^XTV(8991,47,1,2,1,456,0)=" ; "_$C(9,9)_"SDARRAY(""OTHER WARD LOCATION"")=   (OPTIONAL)"
^XTV(8991,47,1,2,1,457,0)=" ; "_$C(9,9)
^XTV(8991,47,1,2,1,458,0)=" ; "_$C(9,9)_"        "
^XTV(8991,47,1,2,1,459,0)=" ; "_$C(9,9)_"SDARRAY(""DATA ENTRY CLERK"")=       (REQUIRED) "
^XTV(8991,47,1,2,1,460,0)=" ; "_$C(9,9)_"        DUZ OF NEW PERSON (FILE 200) PTR"
^XTV(8991,47,1,2,1,461,0)=" ; "_$C(9,9)
^XTV(8991,47,1,2,1,462,0)=" ; "_$C(9,9)_"SDARRAY(""PRIOR XRAY RESULTS TO CLINIC"")= (OPTIONAL)"
^XTV(8991,47,1,2,1,463,0)=" ; "_$C(9,9)_"         ""Y"" OR """""
^XTV(8991,47,1,2,1,464,0)=" ; "_$C(9,9)
^XTV(8991,47,1,2,1,465,0)=" ; "_$C(9,9)
^XTV(8991,47,1,2,1,466,0)=" ; "_$C(9,9)_"SDARRAY(""CHECKED-IN DATE"")=  (OPTIONAL)"
^XTV(8991,47,1,2,1,467,0)=" ; "_$C(9,9)_"      """" OR DATE APPOINTMENT MADE"
^XTV(8991,47,1,2,1,468,0)=" ; "_$C(9,9)_"      FOR AN UNSCHEDULED VISIT "
^XTV(8991,47,1,2,1,469,0)=" ; "_$C(9,9)_"      "
^XTV(8991,47,1,2,1,470,0)=" ;               VWSDNVAI ; (OPTIONAL) EXIST AS NON-VA RELATED PFSS EVENT MODE"
^XTV(8991,47,1,2,1,471,0)=" ;                                = ""D"" DISABLING THE NEED FOR ICN"
^XTV(8991,47,1,2,1,472,0)=" ;                                = ""O"" AS OTHER NON-VA ICN SYSTEM ( FUTURE)      "
^XTV(8991,47,1,2,1,473,0)=" ; "_$C(9,9)_"        "
^XTV(8991,47,1,2,1,474,0)=" ;"
^XTV(8991,47,1,2,1,475,0)=" N APPARMS,HLSTATS,ERROR,SEG,WHO"
^XTV(8991,47,1,2,1,476,0)=" N HLMSTATE,ERROR,INDEX,CONSTRUCT,IFLAG,ERR"
^XTV(8991,47,1,2,1,477,0)=" N X,INTE,HOSPLOC,Y"
^XTV(8991,47,1,2,1,478,0)=" ;"
^XTV(8991,47,1,2,1,479,0)=" ;"
^XTV(8991,47,1,2,1,480,0)=" ;;BUILD PARAMETERS"
^XTV(8991,47,1,2,1,481,0)=" S APPARMS(""COUNTRY"")=""USA"""
^XTV(8991,47,1,2,1,482,0)=" S APPARMS(""FIELD SEPARATOR"")=""|"""
^XTV(8991,47,1,2,1,483,0)=" S APPARMS(""ENCODING CHARACTERS"")=""^~\&"""
^XTV(8991,47,1,2,1,484,0)=" S APPARMS(""VERSION"")=2.4"
^XTV(8991,47,1,2,1,485,0)=" S APPARMS(""MESSAGE TYPE"")=""ADT"""
^XTV(8991,47,1,2,1,486,0)=" S APPARMS(""EVENT"")=""A08"" ; PATIENT UPDATE"
^XTV(8991,47,1,2,1,487,0)=" S ERR="""""
^XTV(8991,47,1,2,1,488,0)=" S ERROR="""""
^XTV(8991,47,1,2,1,489,0)=" ;"
^XTV(8991,47,1,2,1,490,0)=" ;;CREATE NEW MESSAGE"
^XTV(8991,47,1,2,1,491,0)=" ;;"
^XTV(8991,47,1,2,1,492,0)=" I '$$NEWMSG^HLOAPI(.APPARMS,.HLMSTATE,.ERROR) Q ""NEW MESSAGE ERROR"" "
^XTV(8991,47,1,2,1,493,0)=" ;"
^XTV(8991,47,1,2,1,494,0)=" ;"
^XTV(8991,47,1,2,1,495,0)=" ;Use message control ID in MSH segment for sync flag"
^XTV(8991,47,1,2,1,496,0)=" ;"
^XTV(8991,47,1,2,1,497,0)=" ;"
^XTV(8991,47,1,2,1,498,0)=" ;CREATE SEGMENT"
^XTV(8991,47,1,2,1,499,0)=" D SET^HLOAPI(.SEG,""PID"",0)"
^XTV(8991,47,1,2,1,500,0)=" D SET^HLOAPI(.SEG,SSN,3)"
^XTV(8991,47,1,2,1,501,0)=" D SET^HLOAPI(.SEG,PATIENTN,5)"
^XTV(8991,47,1,2,1,502,0)=" D SET^HLOAPI(.SEG,SSN,19)"
^XTV(8991,47,1,2,1,503,0)=" ;"
^XTV(8991,47,1,2,1,504,0)=" ;; ADD SEGMENT"
^XTV(8991,47,1,2,1,505,0)=" I '$$ADDSEG^HLOAPI(.HLMSTATE,.SEG) S ERR=ERR_""^""_""PID"""
^XTV(8991,47,1,2,1,506,0)=" ;"
^XTV(8991,47,1,2,1,507,0)=" ;"
^XTV(8991,47,1,2,1,508,0)=" ;"
^XTV(8991,47,1,2,1,509,0)=" ;"_$C(9)
^XTV(8991,47,1,2,1,510,0)=" ;CREATE SEGMENT"
^XTV(8991,47,1,2,1,511,0)=" ;"
^XTV(8991,47,1,2,1,512,0)=" D SET^HLOAPI(.SEG,""PV1"",0)"
^XTV(8991,47,1,2,1,513,0)=" D SET^HLOAPI(.SEG,OUTIN,2) ;""O"" or ""I"" oupatient or inpatient"
^XTV(8991,47,1,2,1,514,0)=" ;D SET^HLOAPI(.SEG,IEN,3) ;HOSP LOC IEN NOT AVAILABLE "
^XTV(8991,47,1,2,1,515,0)=" D SET^HLOAPI(.SEG,SDARRAY(""APPT TYPE""),4) ;ADMISSION TYPE (APPOINTMENT TYPE)"
^XTV(8991,47,1,2,1,516,0)=" D SET^HLOAPI(.SEG,STYP,10) ; HOSPITAL SERVICE (PURPOSE OF  VISIT)"
^XTV(8991,47,1,2,1,517,0)=" ;CONVERT EXTERNAL DATE/TIME TO FM INTERNAL, THEN TO HL7"
^XTV(8991,47,1,2,1,518,0)=" S X=SD1 S %DT=""T"" D ^%DT S INTE=Y  ;EXT TO FM INTERNAL"
^XTV(8991,47,1,2,1,519,0)=" ;"
^XTV(8991,47,1,2,1,520,0)=" D SET^HLOAPI(.SEG,$$HLDATE^HLFNC(INTE,""TS""),44) ; DATE/TIME TO MAKE APPT"
^XTV(8991,47,1,2,1,521,0)=" ;"
^XTV(8991,47,1,2,1,522,0)=" ;; ADD SEGMENT"
^XTV(8991,47,1,2,1,523,0)=" ;; "
^XTV(8991,47,1,2,1,524,0)=" ;TEMP BELOW;"
^XTV(8991,47,1,2,1,525,0)=" ;S X=$P(SDARRAY(1),"";"",1) D ^%DT S INTE=Y  ;EXT TO FM INTERNAL"
^XTV(8991,47,1,2,1,526,0)=" ;D SET^HLOAPI(.SEG,$$HLDATE^HLFNC(INTE,""TS""),2) ;WHEN START DATE "
^XTV(8991,47,1,2,1,527,0)=" ;; "
^XTV(8991,47,1,2,1,528,0)=" I '$$ADDSEG^HLOAPI(.HLMSTATE,.SEG) S ERR=ERR_""^""_""PV1"""
^XTV(8991,47,1,2,1,529,0)=" ;"_$C(9)
^XTV(8991,47,1,2,1,530,0)=" ;"_$C(9)
^XTV(8991,47,1,2,1,531,0)=" ;CREATE SEGMENT"
^XTV(8991,47,1,2,1,532,0)=" ;"
^XTV(8991,47,1,2,1,533,0)=" D SET^HLOAPI(.SEG,""PV2"",0)"
^XTV(8991,47,1,2,1,534,0)=" I $D(SDARRAY(""DESIRED DATE TIME OF APPT""))>0 D"
^XTV(8991,47,1,2,1,535,0)=" .S X=SDARRAY(""DESIRED DATE TIME OF APPT"") S %DT=""T"" D ^%DT S INTE=Y  ;EXT TO FM INTERNAL"
^XTV(8991,47,1,2,1,536,0)=" .D SET^HLOAPI(.SEG,$$HLDATE^HLFNC(INTE,""TS""),8) ;EXPECTED(DESIRED) DATE/TIME OF VISIT"
^XTV(8991,47,1,2,1,537,0)=" E  D"
^XTV(8991,47,1,2,1,538,0)=" .S X=SD1 S %DT=""T"" D ^%DT S INTE=Y  ;EXT TO FM INTERNAL"
^XTV(8991,47,1,2,1,539,0)=" .D SET^HLOAPI(.SEG,$$HLDATE^HLFNC(INTE,""TS""),8) ;EXPECTED(DESIRED) DATE/TIME OF VISIT"
^XTV(8991,47,1,2,1,540,0)=" S X=SDARRAY(""DATE NOW"") D ^%DT S INTE=Y\1  ;EXT TO FM INTERNAL"
^XTV(8991,47,1,2,1,541,0)=" D SET^HLOAPI(.SEG,$$HLDATE^HLFNC(INTE,""TS""),46) ;EXPECTED(DESIRED) DATE/TIME OF VISIT"
^XTV(8991,47,1,2,1,542,0)=" ;"
^XTV(8991,47,1,2,1,543,0)=" ;ADD SEGMENT TO MESSAGE"
^XTV(8991,47,1,2,1,544,0)=" ;"
^XTV(8991,47,1,2,1,545,0)=" I '$$ADDSEG^HLOAPI(.HLMSTATE,.SEG) S ERR=ERR_""^""_""PV2"""
^XTV(8991,47,1,2,1,546,0)=" ;"
^XTV(8991,47,1,2,1,547,0)=" ;"
^XTV(8991,47,1,2,1,548,0)=" ;"
^XTV(8991,47,1,2,1,549,0)=" ;CREATE NTE SEGMENT FOR STYP"
^XTV(8991,47,1,2,1,550,0)=" ;"
^XTV(8991,47,1,2,1,551,0)=" D SET^HLOAPI(.SEG,""NTE"",0)"
^XTV(8991,47,1,2,1,552,0)=" D SET^HLOAPI(.SEG,""STYP=""_STYP,3)"
^XTV(8991,47,1,2,1,553,0)=" ;"
^XTV(8991,47,1,2,1,554,0)=" ;; ADD SEGMENT"
^XTV(8991,47,1,2,1,555,0)=" ;"
^XTV(8991,47,1,2,1,556,0)=" I '$$ADDSEG^HLOAPI(.HLMSTATE,.SEG) S ERR=ERR_""^""_""STYP"""
^XTV(8991,47,1,2,1,557,0)=" ;"
^XTV(8991,47,1,2,1,558,0)=" ;"
^XTV(8991,47,1,2,1,559,0)=" ;"
^XTV(8991,47,1,2,1,560,0)=" ;"
^XTV(8991,47,1,2,1,561,0)=" ;"
^XTV(8991,47,1,2,1,562,0)=" ;CREATE NTE SEGMENT FOR SC HOSPITAL LOCATION (CLINIC)"
^XTV(8991,47,1,2,1,563,0)=" ;"
^XTV(8991,47,1,2,1,564,0)=" D SET^HLOAPI(.SEG,""NTE"",0)"
^XTV(8991,47,1,2,1,565,0)=" D SET^HLOAPI(.SEG,""SDLOCATE=""_""""""""_SC_"""""""",3)"
^XTV(8991,47,1,2,1,566,0)=" ;"
^XTV(8991,47,1,2,1,567,0)=" ;; ADD SEGMENT"
^XTV(8991,47,1,2,1,568,0)=" ;"
^XTV(8991,47,1,2,1,569,0)=" I '$$ADDSEG^HLOAPI(.HLMSTATE,.SEG) S ERR=ERR_""^""_""HOSPLOC"""
^XTV(8991,47,1,2,1,570,0)=" ;"
^XTV(8991,47,1,2,1,571,0)=" ;"
^XTV(8991,47,1,2,1,572,0)=" ;"
^XTV(8991,47,1,2,1,573,0)=" ;"
^XTV(8991,47,1,2,1,574,0)=" ;CREATE NTE SEGMENTS FROM SDARRAY ELEMENTS"
^XTV(8991,47,1,2,1,575,0)=" S INDEX=0"
^XTV(8991,47,1,2,1,576,0)=" F  S INDEX=$O(SDARRAY(INDEX)) Q:INDEX=""""  D"
^XTV(8991,47,1,2,1,577,0)=" .D SET^HLOAPI(.SEG,""NTE"",0)"
^XTV(8991,47,1,2,1,578,0)=" .I INDEX=+INDEX S CONSTRUCT=""SDARRAY(""_INDEX_"")="""
^XTV(8991,47,1,2,1,579,0)=" .I INDEX'=+INDEX S CONSTRUCT=""SDARRAY(""_""""""""_INDEX_""""""""_"")="""
^XTV(8991,47,1,2,1,580,0)=" .I SDARRAY(INDEX)=+SDARRAY(INDEX) S CONSTRUCT=CONSTRUCT_SDARRAY(INDEX)"
^XTV(8991,47,1,2,1,581,0)=" .I SDARRAY(INDEX)'=+SDARRAY(INDEX) S CONSTRUCT=CONSTRUCT_""""""""_SDARRAY(INDEX)_"""""""""
^XTV(8991,47,1,2,1,582,0)=" .D SET^HLOAPI(.SEG,CONSTRUCT,3) ; COMMENTS STORING SDARRAY(?)ARRAY ELEMENT"
^XTV(8991,47,1,2,1,583,0)=" .;"
^XTV(8991,47,1,2,1,584,0)=" .;ADD SEGMENT TO MESSAGE"
^XTV(8991,47,1,2,1,585,0)=" .;"
^XTV(8991,47,1,2,1,586,0)=" .S IFLAG=0"
^XTV(8991,47,1,2,1,587,0)=" .I '$$ADDSEG^HLOAPI(.HLMSTATE,.SEG) S IFLAG=""NTE""_INDEX"
^XTV(8991,47,1,2,1,588,0)=" .;"
^XTV(8991,47,1,2,1,589,0)=" .I IFLAG'=0 Q"
^XTV(8991,47,1,2,1,590,0)=" I IFLAG'=0 Q IFLAG"
^XTV(8991,47,1,2,1,591,0)=" ;"
^XTV(8991,47,1,2,1,592,0)=" ; NOW OPTIONAL NTE SEGMENT IF SDVWNVAI IS DEFINED"
^XTV(8991,47,1,2,1,593,0)=" ;"
^XTV(8991,47,1,2,1,594,0)=" I $D(SDVWNVAI) D"
^XTV(8991,47,1,2,1,595,0)=" .;"
^XTV(8991,47,1,2,1,596,0)=" .;CREATE NTE SEGMENT FOR SDVWNVAI"
^XTV(8991,47,1,2,1,597,0)=" .;"
^XTV(8991,47,1,2,1,598,0)=" .D SET^HLOAPI(.SEG,""NTE"",0)"
^XTV(8991,47,1,2,1,599,0)=" .D SET^HLOAPI(.SEG,""SDVWNVAI=""_SDVWNVAI,3)"
^XTV(8991,47,1,2,1,600,0)=" .;"
^XTV(8991,47,1,2,1,601,0)=" .;; ADD SEGMENT"
^XTV(8991,47,1,2,1,602,0)=" .;"
^XTV(8991,47,1,2,1,603,0)=" .I '$$ADDSEG^HLOAPI(.HLMSTATE,.SEG) S ERR=ERR_""^""_""SDVWNVAI"""
^XTV(8991,47,1,2,1,604,0)=" .;"
^XTV(8991,47,1,2,1,605,0)=" .;"
^XTV(8991,47,1,2,1,606,0)=" .;"
^XTV(8991,47,1,2,1,607,0)=" ;"
^XTV(8991,47,1,2,1,608,0)=" ; DEFINE SENDING AND RECEIVING PARAMETERS"
^XTV(8991,47,1,2,1,609,0)=" S APPARMS(""SENDING APPLICATION"")=""VWSD HLO EXT"""
^XTV(8991,47,1,2,1,610,0)=" S APPARMS(""ACCEPT ACK TYPE"")=""NE"" ;""AL"" ;""NE"" ;""AL"""
^XTV(8991,47,1,2,1,611,0)=" ;S APPARMS(""APP ACK RESPONSE"")=""APPACKRR^SDVWHLEX"""
^XTV(8991,47,1,2,1,612,0)=" ;S APPARMS(""ACCEPT ACK RESPONSE"")=""MSGPROC^SDVWHLEX"""
^XTV(8991,47,1,2,1,613,0)=" ;REVERSE BELOW "
^XTV(8991,47,1,2,1,614,0)=" S APPARMS(""ACCEPT ACK RESPONSE"")=""APPACKRR^SDVWHLEX"" ; WHEN COMIT ACK , SU OR AE RETURN MADE"
^XTV(8991,47,1,2,1,615,0)=" S APPARMS(""APP ACK RESPONSE"")=""MSGPROC^SDVWHLEX"" ; WHEN NO ACK RETURN MADE "
^XTV(8991,47,1,2,1,616,0)=" S APPARMS(""APP ACK TYPE"")=""NE"" ;""AL"" ;""NE"" ;""AL"""
^XTV(8991,47,1,2,1,617,0)=" S WHO(""RECEIVING APPLICATION"")=""VWSD RECEIVER"""
^XTV(8991,47,1,2,1,618,0)=" S WHO(""FACILITY LINK NAME"")=""VWSDTSMML"""
^XTV(8991,47,1,2,1,619,0)=" ;"
^XTV(8991,47,1,2,1,620,0)=" ;SEND MESSAGE"
^XTV(8991,47,1,2,1,621,0)=" ;"
^XTV(8991,47,1,2,1,622,0)=" I '$$SENDONE^HLOAPI1(.HLMSTATE,.APPARMS,.WHO,.ERROR) Q ""ERR=""_ERR_"" ERROR=""_ERROR"
^XTV(8991,47,1,2,1,623,0)=" S MSGCTRL=HLMSTATE(""HDR"",""MESSAGE CONTROL ID"") ;HLMSTATE(""ID"")"
^XTV(8991,47,1,2,1,624,0)="    Q ""OK"""
^XTV(8991,47,1,2,1,625,0)=" "
^XTV(8991,47,1,2,1,626,0)=" "
^XTV(8991,47,1,"B",3070118.2242,1)=""
^XTV(8991,47,1,"B",3070118.2245,2)=""
^XTV(8991,48,0)="SDVWHLIN"
^XTV(8991,48,1,0)="^8991.01^2^2"
^XTV(8991,48,1,1,0)="3070118.2244"
^XTV(8991,48,1,1,1,0)="^8991.11^802^802"
^XTV(8991,48,1,1,1,1,0)=""
^XTV(8991,48,1,1,1,1,"DEL")="SDVWHLIN ;ENHANCED HL7 RECEIVE APPLICATION DRIVER FOR SDAPI and MAKE AN APPOINTMENT API 11/18/06 ;1/18/07  22:44"
^XTV(8991,48,1,1,1,2,"INS",0)="^8991.12^1^1"
^XTV(8991,48,1,1,1,2,"INS",1,0)="SDVWHLIN ;VOE/GW - ENHANCED HL7 RECEIVE APPLICATION DRIVER FOR SDAPI and MAKE AN APPOINTMENT API 11/18/06 ;1/18/07  22:46"
^XTV(8991,48,1,2,0)="3070118.2246"
^XTV(8991,48,1,2,1,0)="^8991.11^802^802"
^XTV(8991,48,1,2,1,1,0)="SDVWHLIN ;VOE/GW - ENHANCED HL7 RECEIVE APPLICATION DRIVER FOR SDAPI and MAKE AN APPOINTMENT API 11/18/06 ;1/18/07  22:46"
^XTV(8991,48,1,2,1,2,0)=" ;;5.3;Scheduling;**502**;Aug 13, 1993"
^XTV(8991,48,1,2,1,3,0)="RECEIVE ;MAIN RECEIVE APPLICATION FOR SDAPI API OR MAKE APPOINTMENT API REQUESTS ;;;;;Build 4"
^XTV(8991,48,1,2,1,4,0)=" ; AND MAKE APPT API ACK "
^XTV(8991,48,1,2,1,5,0)=" N APPARMS,ERROR,HLMSGIEN,WHO,SEG,QRDSORT,SORTORDR,OVERAPPT ;"
^XTV(8991,48,1,2,1,6,0)=" N HLMSTATE,HDR"
^XTV(8991,48,1,2,1,7,0)=" N HLVWNOVA"
^XTV(8991,48,1,2,1,8,0)=" N SEGTYPE,IRECAPP,ISNDFAC,IEVN,IFLAGA19,IFLAGACK,POSITION"
^XTV(8991,48,1,2,1,9,0)=" N PATIENID,PATIENT,SSN,PATIENTCL,SDLOCATION,PRIMCREDCD,PRIMSTOPCD"
^XTV(8991,48,1,2,1,10,0)=" N SDATE,ELIGIB,EXPECTDT,APPTST,DATEAPTM"
^XTV(8991,48,1,2,1,11,0)=" N PIDVALUES,PV1VALUES,PV2VALUES,IFLAG2"
^XTV(8991,48,1,2,1,12,0)=" N SDARRAY,SDCOUNT"
^XTV(8991,48,1,2,1,13,0)=" N SDLOCATE,HOSPLOC,ORDRSORT,MSGMAKAP,COMMENT,EXTER"
^XTV(8991,48,1,2,1,14,0)=" N MAKEAPPT"
^XTV(8991,48,1,2,1,15,0)=" N STARTIM,ENDTIME,CLINIEN,IDX,IFLAG,CLINIEN,FLDS,ACK,ERROR1,XQSDVWSI,PCIEN,TEMPC,IER,SD1,SC"
^XTV(8991,48,1,2,1,16,0)=" N SDCLIEN,SDDFN,SDDATE,SDAPPT,STYP,TEMP,VESD,AJJ3CNT,HLMSGTMP,FLDS"
^XTV(8991,48,1,2,1,17,0)=" N AJJ3CNT1,IFLAG2,TEMP1,AJJ3PIEC,AJJ3PIE2,AJJ3CNT2,ERETURN"
^XTV(8991,48,1,2,1,18,0)=" N ILOCATE,SDFNSSN,SDFNNAME"
^XTV(8991,48,1,2,1,19,0)=" ;RECEIVE APPLICATION"
^XTV(8991,48,1,2,1,20,0)=" ;      FIRST RECEIVE"
^XTV(8991,48,1,2,1,21,0)=" ;      THEN PROCESS"
^XTV(8991,48,1,2,1,22,0)=" ;      THEN SEND APPLICATION ACK"
^XTV(8991,48,1,2,1,23,0)=" ;"
^XTV(8991,48,1,2,1,24,0)=" ;FOR SDAPI APPLICATION ACK BELOW"
^XTV(8991,48,1,2,1,25,0)=" ;INPUT"
^XTV(8991,48,1,2,1,26,0)=" ;           "
^XTV(8991,48,1,2,1,27,0)=" ;OUTPUT IF NO ERRORS AND SDCOUNT RETURNED NOT =0"
^XTV(8991,48,1,2,1,28,0)=" ;RETURN PID,PV1,PV2,NTE, AND NTE SEGMENTS TO DESCRIBE PATIENT,CLINIC,DATES "
^XTV(8991,48,1,2,1,29,0)=" ;FOR APPPOINTMENS/UNSCHEDULED VISITS FOUND"
^XTV(8991,48,1,2,1,30,0)=" ;"
^XTV(8991,48,1,2,1,31,0)=" ;"
^XTV(8991,48,1,2,1,32,0)=" ;"
^XTV(8991,48,1,2,1,33,0)=" ;AS EXPLAINED IN CODE BELOW"
^XTV(8991,48,1,2,1,34,0)=" ;"
^XTV(8991,48,1,2,1,35,0)=" ; "
^XTV(8991,48,1,2,1,36,0)=" ;RETURN  HDR(""APP ACK TYPE"")_""^""_POSITION_""^""_SDCOUNT_""^""_ERRORS "
^XTV(8991,48,1,2,1,37,0)=" ;                            POSITION IS NUMBER OF RETURNED APPOINTMENTS/VISITS"
^XTV(8991,48,1,2,1,38,0)=" ;                            SDCOUNT IS SAME UNLESS ERROR "
^XTV(8991,48,1,2,1,39,0)=" ;                            AND ERROR RETURNES AS IS"
^XTV(8991,48,1,2,1,40,0)=" ;                            FROM $$SDAPI^SDAM301"
^XTV(8991,48,1,2,1,41,0)=" ;                            APP ACK TYPE ACTUALLY RETURNED, IE ""AA"""
^XTV(8991,48,1,2,1,42,0)=" ;                                            "
^XTV(8991,48,1,2,1,43,0)=" ;        ""STARTMSG"" "
^XTV(8991,48,1,2,1,44,0)=" ;        ""ERR""_$$GET^HLOPRS(.SEQ,1)"
^XTV(8991,48,1,2,1,45,0)=" ;        ""NOTRETURNED ACK"""
^XTV(8991,48,1,2,1,46,0)=" ;        ""NOT A19 EVENT"""
^XTV(8991,48,1,2,1,47,0)=" ;        ""HOSPLOC"""
^XTV(8991,48,1,2,1,48,0)=" ;         VWSD"
^XTV(8991,48,1,2,1,49,0)=" ;PARSE ACK MESSAGE TYPE WITH REPEATING ADR RESPONSE"
^XTV(8991,48,1,2,1,50,0)=" ;EMBEDDED WITH EVENT TYPE A19"
^XTV(8991,48,1,2,1,51,0)=" ;"
^XTV(8991,48,1,2,1,52,0)=" ;FOR MAKE APPT API "
^XTV(8991,48,1,2,1,53,0)=" ;"
^XTV(8991,48,1,2,1,54,0)=" ; INPUT"
^XTV(8991,48,1,2,1,55,0)=" ;"
^XTV(8991,48,1,2,1,56,0)=" ;"
^XTV(8991,48,1,2,1,57,0)=" ;OUTPUT IF NO ERRORS "
^XTV(8991,48,1,2,1,58,0)=" ;RETURN"_$C(9)_"ACK SEGMENT, ACK CODE AS ""AA"" OR ""AE"" , ERROR IN COMMENTS OF ERR SEGMENT IF ANY"
^XTV(8991,48,1,2,1,59,0)=" ;"
^XTV(8991,48,1,2,1,60,0)=" ;"
^XTV(8991,48,1,2,1,61,0)=" ;RETURN   HDR(""APP ACK TYPE"")_""^""_ERRORS "
^XTV(8991,48,1,2,1,62,0)=" ;                 WHERE COMMENT IS AS RETURNED FROM VWSDMKPI CALL RETURN"
^XTV(8991,48,1,2,1,63,0)=" ;"
^XTV(8991,48,1,2,1,64,0)=" ;"
^XTV(8991,48,1,2,1,65,0)=" ;"
^XTV(8991,48,1,2,1,66,0)=" ;PASS THE HEADER AND RETURN INDIVIDUAL VALUES"
^XTV(8991,48,1,2,1,67,0)=" ;"
^XTV(8991,48,1,2,1,68,0)=" S AJJ3CNT=0"
^XTV(8991,48,1,2,1,69,0)=" S HLVWNOVA=1  ; ALLOW NON-VA STATION NODE WITH ASSOCIATED INSTITUTION "
^XTV(8991,48,1,2,1,70,0)=" ; FOR DETERMINING FACILITY LINK WHEN SENDING APPLICATION BECOMES RECEIVING "
^XTV(8991,48,1,2,1,71,0)=" ; APPLICATION, AND TO FIGURE ""SENDING FACILITY LINK"" "
^XTV(8991,48,1,2,1,72,0)=" ;"
^XTV(8991,48,1,2,1,73,0)=" S HLMSGTMP=""AC"" ;200000000000  "
^XTV(8991,48,1,2,1,74,0)=" ;^HLB(""AC"",""HL7.VWSD INTERNAL MULTILISTENER:5026VWSD HLO EXT100 XXXXX"",200000000XXX)"
^XTV(8991,48,1,2,1,75,0)=" S HLMSGIEN=$O(^HLB(HLMSGTMP),-1)"
^XTV(8991,48,1,2,1,76,0)=" S HDR="""" S HLMSTATE="""""
^XTV(8991,48,1,2,1,77,0)=" ;"
^XTV(8991,48,1,2,1,78,0)=" ;"
^XTV(8991,48,1,2,1,79,0)=" I '$$STARTMSG^HLOPRS(.HLMSTATE,HLMSGIEN,.HDR) G OVER2 ;Q ""STARTMSG"""
^XTV(8991,48,1,2,1,80,0)=" ;"
^XTV(8991,48,1,2,1,81,0)="MSG1 ;CHECK RECEIVING APPLICATION"
^XTV(8991,48,1,2,1,82,0)=" ;;;;;S IRECAPP=HDR(""RECEIVING APPLICATION"")"
^XTV(8991,48,1,2,1,83,0)=" ;W !,""IRECAPP="",IRECAPP"
^XTV(8991,48,1,2,1,84,0)=" ;;;;;;S ISNDFAC=HDR(""FACILITY LINK NAME"")"
^XTV(8991,48,1,2,1,85,0)=" S MSGCTRL=HDR(""MESSAGE CONTROL ID"") ;HLMSTATE(""HDR"",""MESSAGE CONTROL ID"") ;HDR(""MESSAGE CONTROL ID"") ;OR HLMSTATE(:ID"")"
^XTV(8991,48,1,2,1,86,0)=" ;"
^XTV(8991,48,1,2,1,87,0)=" S IFLAGA19=0"
^XTV(8991,48,1,2,1,88,0)=" S POSITION=0"
^XTV(8991,48,1,2,1,89,0)=" ;"
^XTV(8991,48,1,2,1,90,0)=" S IEVN=0 ;0"
^XTV(8991,48,1,2,1,91,0)=" S SDCOUNT="""""
^XTV(8991,48,1,2,1,92,0)=" S SDLOCATE="""""
^XTV(8991,48,1,2,1,93,0)=" S ORDRSORT="""""
^XTV(8991,48,1,2,1,94,0)=" S MSGMAKAP=0 ;"
^XTV(8991,48,1,2,1,95,0)=" S COMMENT="""" ;"
^XTV(8991,48,1,2,1,96,0)=" ;"
^XTV(8991,48,1,2,1,97,0)=" ;K SDARRAY"
^XTV(8991,48,1,2,1,98,0)=" ;S SDARRAY="""""
^XTV(8991,48,1,2,1,99,0)=" S FLDS="""""
^XTV(8991,48,1,2,1,100,0)=" ;"
^XTV(8991,48,1,2,1,101,0)=" K SDARRAY"
^XTV(8991,48,1,2,1,102,0)=" ;"
^XTV(8991,48,1,2,1,103,0)=" S SDARRAY="""""
^XTV(8991,48,1,2,1,104,0)=" S ERROR="""""
^XTV(8991,48,1,2,1,105,0)=" S CLINIEN="""""
^XTV(8991,48,1,2,1,106,0)=" S STYP="""""
^XTV(8991,48,1,2,1,107,0)=" S IER=1"
^XTV(8991,48,1,2,1,108,0)=" K SDVWNVAI"
^XTV(8991,48,1,2,1,109,0)=" K ^TMP($J,""SDAMA301"")"
^XTV(8991,48,1,2,1,110,0)=" S SEG="""""
^XTV(8991,48,1,2,1,111,0)=" S APPARMS="""""
^XTV(8991,48,1,2,1,112,0)=" S DFN="""""
^XTV(8991,48,1,2,1,113,0)=" S ERETURN=0"
^XTV(8991,48,1,2,1,114,0)=" S ACK="""""
^XTV(8991,48,1,2,1,115,0)=" S MAKEAPPT=0"
^XTV(8991,48,1,2,1,116,0)=" ; ADVANCE TO EACH SEGMENT IN THE MESSAGE"
^XTV(8991,48,1,2,1,117,0)="SEQ I '$$NEXTSEG^HLOPRS(.HLMSTATE,.SEG) G EXIT"
^XTV(8991,48,1,2,1,118,0)=" ;"
^XTV(8991,48,1,2,1,119,0)=" S SEGTYPE=$$GET^HLOPRS(.SEG,0)"
^XTV(8991,48,1,2,1,120,0)=" ;"
^XTV(8991,48,1,2,1,121,0)=" I SEGTYPE=""QRF"" D"
^XTV(8991,48,1,2,1,122,0)=" .S STARTIM=$$GET^HLOPRS(.SEG,2) ; START TIME"
^XTV(8991,48,1,2,1,123,0)="    .S STARTIM=$$FMDATE^HLFNC(STARTIM) ; TS TO FM"
^XTV(8991,48,1,2,1,124,0)=" .S ENDTIME=$$GET^HLOPRS(.SEG,3) ; END TIME"
^XTV(8991,48,1,2,1,125,0)=" .S ENDTIME=$$FMDATE^HLFNC(ENDTIME)"
^XTV(8991,48,1,2,1,126,0)=" ;"
^XTV(8991,48,1,2,1,127,0)=" I SEGTYPE=""EVN"" D"
^XTV(8991,48,1,2,1,128,0)=" . S IEVN=$$GET^HLOPRS(.SEG,1) ; FOR SDAPI REQUEST AS EITHER NONE OR ""A19"" ,MAKE APPOINTMENT API REQUEST AS ""A08"""
^XTV(8991,48,1,2,1,129,0)=" ;"
^XTV(8991,48,1,2,1,130,0)=" ;"
^XTV(8991,48,1,2,1,131,0)=" ;BELOW PID, PV1,PV2 FOR RECEIVE MAKE APPOINTMENT API REQUEST PARTICULARS"
^XTV(8991,48,1,2,1,132,0)=" ;"
^XTV(8991,48,1,2,1,133,0)=" I SEGTYPE=""PID"" D"
^XTV(8991,48,1,2,1,134,0)=" . S POSITION=POSITION+1"
^XTV(8991,48,1,2,1,135,0)=" . S SDARRAY="""""
^XTV(8991,48,1,2,1,136,0)=" . ;GET PATIENT INTERNAL ID"
^XTV(8991,48,1,2,1,137,0)=" . S PATIENID=$$GET^HLOPRS(.SEG,3)"
^XTV(8991,48,1,2,1,138,0)=" . S PATIENT=$$GET^HLOPRS(.SEG,5) "
^XTV(8991,48,1,2,1,139,0)=" . S SSN=$$GET^HLOPRS(.SEG,19)"
^XTV(8991,48,1,2,1,140,0)=" . S PIDVALUES=PATIENID_""^""_PATIENT_""^""_SSN"
^XTV(8991,48,1,2,1,141,0)=" . ;"
^XTV(8991,48,1,2,1,142,0)=" I SEGTYPE=""PV1"" D"
^XTV(8991,48,1,2,1,143,0)=" . ;GET PATIENT INTERNAL ID"
^XTV(8991,48,1,2,1,144,0)=" . S PATIENTCL=$$GET^HLOPRS(.SEG,2)  ; PATIENT CLASS"
^XTV(8991,48,1,2,1,145,0)=" . ;S SDLOCID=$$GET^HLOPRS(.SEG,3) ; NOT RECEIVED FROM MAKE APPT REQUEST AS UNKNOWN ( SDLOCATE SENT IN NTE SEGMENT)"
^XTV(8991,48,1,2,1,146,0)=" . S PURPVISIT=$$GET^HLOPRS(.SEG,10) ; HOSPITAL SERVICE (PURPOSE OF VISIT)"
^XTV(8991,48,1,2,1,147,0)=" . S PRIMSTOPCD=$$GET^HLOPRS(.SEG,18) ; PATIENT TYPE (PRIME STOP CODE)"
^XTV(8991,48,1,2,1,148,0)=" . S PRIMCREDCD=$$GET^HLOPRS(.SEG,41) ; ACCOUNT STATUS (CREDIT STOP CODE)"
^XTV(8991,48,1,2,1,149,0)=" . S SDDATE=$$GET^HLOPRS(.SEG,44) ; ADMIT-VISIT DATE/TIME"
^XTV(8991,48,1,2,1,150,0)=" . ;CONVERT TO FM DATE"
^XTV(8991,48,1,2,1,151,0)=" . S SDDATE=$$FMDATE^HLFNC(SDDATE)"
^XTV(8991,48,1,2,1,152,0)=" . ; S XXXX=$$GET^HLOPRS(.SEG,51) ;"
^XTV(8991,48,1,2,1,153,0)=" . S PV1VALUES=PATIENTCL_""^""_PURPVISIT_""^""_PRIMSTOPCD_""^""_PRIMCREDCD_""^""_SDDATE"
^XTV(8991,48,1,2,1,154,0)=" . ;"
^XTV(8991,48,1,2,1,155,0)=" I SEGTYPE=""PV2"" D"
^XTV(8991,48,1,2,1,156,0)=" . S ELIGIB=$$GET^HLOPRS(.SEG,7) ; VISIT USER ID-ELIGIBILITY FOR UNSCHEDULED VISITS "
^XTV(8991,48,1,2,1,157,0)=" . S EXPECTDT=$$GET^HLOPRS(.SEG,8) ; EXPECTED DATE/TIME"
^XTV(8991,48,1,2,1,158,0)=" . ;CONVERT TO FM DATE"
^XTV(8991,48,1,2,1,159,0)=" . S EXPECTDT=$$FMDATE^HLFNC(EXPECTDT)"
^XTV(8991,48,1,2,1,160,0)=" . ;S APPTST=$$GET^HLOPRS(.SEG,24)  ;APPOINT STATUS"
^XTV(8991,48,1,2,1,161,0)=" . S DATEAPTM=$$GET^HLOPRS(.SEG,46) ;DATE APPT MADE"
^XTV(8991,48,1,2,1,162,0)=" . ;CONVERT TO FM DATE"
^XTV(8991,48,1,2,1,163,0)=" . S DATEAPTM=$$FMDATE^HLFNC(DATEAPTM)"
^XTV(8991,48,1,2,1,164,0)=" . S PV2VALUES=ELIGIB_""^""_EXPECTDT_""^""_DATEAPTM"
^XTV(8991,48,1,2,1,165,0)=" . ;"
^XTV(8991,48,1,2,1,166,0)=" ;"
^XTV(8991,48,1,2,1,167,0)=" ;"
^XTV(8991,48,1,2,1,168,0)=" ;BELOW FOR SDAPI REQUEST RECEIVE AND MAYBE SOME MAKE APPOINTMENT API REQUEST RECEIVE"
^XTV(8991,48,1,2,1,169,0)=" ;"
^XTV(8991,48,1,2,1,170,0)=" S ILOCATE="""" "
^XTV(8991,48,1,2,1,171,0)=" I SEGTYPE=""NTE"" D"
^XTV(8991,48,1,2,1,172,0)=" . S TEMP=$$GET^HLOPRS(.SEG,3) ; UP TO 6 PLUS SDARRAY ELEMENTS"
^XTV(8991,48,1,2,1,173,0)=" . ;CHECK FOR SDVWNVAI"
^XTV(8991,48,1,2,1,174,0)=" . I $E(TEMP,1,9)=""SDVWNVAI="" S SDVWNVAI=$P(TEMP,""SDVWNVAI="",2) "
^XTV(8991,48,1,2,1,175,0)=" . I $E(TEMP,1,9)=""SDVWNVAI="" Q"
^XTV(8991,48,1,2,1,176,0)=" . ;CHECK FOR STYP="
^XTV(8991,48,1,2,1,177,0)=" . I $E(TEMP,1,5)=""STYP="" S STYP=$P(TEMP,""STYP="",2) S IEVN=""A08""  ;MUST BE MAKE APPT REQUEST"
^XTV(8991,48,1,2,1,178,0)=" . I $E(TEMP,1,5)=""STYP="" Q"
^XTV(8991,48,1,2,1,179,0)=" . I ($E(TEMP,1,11)=""SDARRAY(2)="") S ILOCATE=1"
^XTV(8991,48,1,2,1,180,0)=" . I ($E(TEMP,1,9)=""SDLOCATE="") S ILOCATE=2"
^XTV(8991,48,1,2,1,181,0)=" . I ($E(TEMP,1,11)=""SDARRAY(2)="")!($E(TEMP,1,9)=""SDLOCATE="") D"
^XTV(8991,48,1,2,1,182,0)=" . .I ILOCATE=1 S SDLOCATE=$P(TEMP,""SDARRAY(2)="",2)"
^XTV(8991,48,1,2,1,183,0)=" . .I ILOCATE=2 S SDLOCATE=$P(TEMP,""SDLOCATE="",2)"
^XTV(8991,48,1,2,1,184,0)=" . .S SDLOCATE=$P(SDLOCATE,"""""""",2) ; TAKE OUT FRONT QUOTE"
^XTV(8991,48,1,2,1,185,0)=" . .S SDLOCATE=$P(SDLOCATE,"""""""",1) ; TAKE OFF ENDING QUOTE"
^XTV(8991,48,1,2,1,186,0)=" . .; CONVERT TO INTERNAL IEN FROM EXTERNAL"
^XTV(8991,48,1,2,1,187,0)=" . .; CHECK FIRST IF SDLOCATE IN B CROSS-REF"
^XTV(8991,48,1,2,1,188,0)=" . .S IDX="""""
^XTV(8991,48,1,2,1,189,0)=" . .S IFLAG=0"
^XTV(8991,48,1,2,1,190,0)=" "_$C(9)_". . F  S IDX=$O(^SC(""B"",IDX)) Q:(IDX="""")!(IFLAG=1)  D"
^XTV(8991,48,1,2,1,191,0)=" "_$C(9)_". . . I IDX=SDLOCATE S IFLAG=1"
^XTV(8991,48,1,2,1,192,0)=" . . I IFLAG=1 D"
^XTV(8991,48,1,2,1,193,0)=" . . . S CLINIEN=0"
^XTV(8991,48,1,2,1,194,0)="    . . . S CLINIEN=$O(^SC(""B"",SDLOCATE,CLINIEN))"
^XTV(8991,48,1,2,1,195,0)=" . . . S SDARRAY(2)=CLINIEN"
^XTV(8991,48,1,2,1,196,0)=" . . E  D"
^XTV(8991,48,1,2,1,197,0)=" . . . S ERROR=ERROR_""^""_""HOSPLOC NOT DEFINED"""
^XTV(8991,48,1,2,1,198,0)=" . . . ;"
^XTV(8991,48,1,2,1,199,0)=" . E  D"
^XTV(8991,48,1,2,1,200,0)=" . .;STORE EACH SDARRAY ELEMENT . LOOK FOR SDARRAY(""FLDS"") AS REQUIRED"
^XTV(8991,48,1,2,1,201,0)=" . .I TEMP[""FLDS"" S FLDS=1"
^XTV(8991,48,1,2,1,202,0)=" . .;D QUICK(TEMP,.SDARRAY)"
^XTV(8991,48,1,2,1,203,0)=" . ."_$C(9)_"S AJJ3CNT1=0"
^XTV(8991,48,1,2,1,204,0)=" . . S IFLAG2=0"
^XTV(8991,48,1,2,1,205,0)=" . . S TEMP1="""""
^XTV(8991,48,1,2,1,206,0)=" . . ;"
^XTV(8991,48,1,2,1,207,0)=" . . S TEMP=""S ""_TEMP"
^XTV(8991,48,1,2,1,208,0)=" . . ;G OVER55"
^XTV(8991,48,1,2,1,209,0)=" . . F  S AJJ3CNT1=AJJ3CNT1+1 S AJJ3PIEC=$P(TEMP,"""""""",AJJ3CNT1) Q:(IFLAG2=1)  D"
^XTV(8991,48,1,2,1,210,0)=" . . .I AJJ3PIEC'="""" D"
^XTV(8991,48,1,2,1,211,0)=" . . . .S AJJ3CNT2=AJJ3CNT1+1 S AJJ3PIE2=$P(TEMP,"""""""",AJJ3CNT2)"
^XTV(8991,48,1,2,1,212,0)=" . . . .I AJJ3PIE2="""" D"
^XTV(8991,48,1,2,1,213,0)=" . . . . .S ILENX=$L(TEMP) "
^XTV(8991,48,1,2,1,214,0)=" . . . . .I $E(TEMP,ILENX,ILENX)="""""""" D"
^XTV(8991,48,1,2,1,215,0)=" . . . . . .S TEMP1=TEMP1_AJJ3PIEC_"""""""""
^XTV(8991,48,1,2,1,216,0)=" . . . . .E  D"
^XTV(8991,48,1,2,1,217,0)=" . . . . . .S TEMP1=TEMP1_AJJ3PIEC"
^XTV(8991,48,1,2,1,218,0)=" . . . .E  D"
^XTV(8991,48,1,2,1,219,0)=" . . . . .S TEMP1=TEMP1_AJJ3PIEC_"""""""""
^XTV(8991,48,1,2,1,220,0)=" . . .I AJJ3PIEC="""" D"
^XTV(8991,48,1,2,1,221,0)=" . . . .S ILENX=$L(TEMP) "
^XTV(8991,48,1,2,1,222,0)=" . . . .I $E(TEMP,ILENX,ILENX)="""""""" D"
^XTV(8991,48,1,2,1,223,0)=" . . . . .S TEMP1=TEMP1_"""" "
^XTV(8991,48,1,2,1,224,0)=" . . . . .S IFLAG2=1"
^XTV(8991,48,1,2,1,225,0)=" . . . .E  D"
^XTV(8991,48,1,2,1,226,0)=" . . . . .S IFLAG2=1"
^XTV(8991,48,1,2,1,227,0)="OVER55 . .; "
^XTV(8991,48,1,2,1,228,0)=" . . ;"
^XTV(8991,48,1,2,1,229,0)=" . . ;CONVERT SDARRAY TO SDARRAY1 ARRAY"
^XTV(8991,48,1,2,1,230,0)=" . . S TEMP1=$P(TEMP1,""SDARRAY"",1)_""SDARRAY1""_$P(TEMP1,""SDARRAY"",2)"
^XTV(8991,48,1,2,1,231,0)=" . . X TEMP1"
^XTV(8991,48,1,2,1,232,0)=" . . S AJJ3CNT1=0"
^XTV(8991,48,1,2,1,233,0)=" . . F  S AJJ3CNT1=$O(SDARRAY1(AJJ3CNT1)) Q:AJJ3CNT1=""""  D"
^XTV(8991,48,1,2,1,234,0)=" . . .;"
^XTV(8991,48,1,2,1,235,0)=" . . .S SDARRAY(AJJ3CNT1)=SDARRAY1(AJJ3CNT1)"
^XTV(8991,48,1,2,1,236,0)=" . . ;"
^XTV(8991,48,1,2,1,237,0)=" . .;X TEMP"
^XTV(8991,48,1,2,1,238,0)=" . ;"
^XTV(8991,48,1,2,1,239,0)=" ;EVERY TIME GET A PID SEGMENT INCREMENT POSITION"
^XTV(8991,48,1,2,1,240,0)=" ;"
^XTV(8991,48,1,2,1,241,0)=" ;"
^XTV(8991,48,1,2,1,242,0)=" ;"
^XTV(8991,48,1,2,1,243,0)=" ;"
^XTV(8991,48,1,2,1,244,0)=" G SEQ"
^XTV(8991,48,1,2,1,245,0)=" ;"
^XTV(8991,48,1,2,1,246,0)=" ;"
^XTV(8991,48,1,2,1,247,0)="EXIT ;"
^XTV(8991,48,1,2,1,248,0)=" ;PROCESS COMPLETE MESSAGE NOW"
^XTV(8991,48,1,2,1,249,0)=" ;"
^XTV(8991,48,1,2,1,250,0)=" ;DETERMINE IF SDAPI REQUEST OR MAKE APPOINTMENT API REQUEST"
^XTV(8991,48,1,2,1,251,0)=" ;"
^XTV(8991,48,1,2,1,252,0)=" ;"
^XTV(8991,48,1,2,1,253,0)=" ; SDAPI PROCESSING HERE BELOW AFTER REQUEST DATA RECEIVED"
^XTV(8991,48,1,2,1,254,0)=" ;"
^XTV(8991,48,1,2,1,255,0)=" ;"
^XTV(8991,48,1,2,1,256,0)=" ;;"
^XTV(8991,48,1,2,1,257,0)=" I (IEVN=0)!(IEVN=""A19"") D   ; SDAPI REQUEST THEN DO APPLICATION ACK WITH ""A19"" PATIENT INQUIRY APPLICATION ACK"
^XTV(8991,48,1,2,1,258,0)=" .I FLDS="""" S ERROR=ERROR_""NO FLDS ARRAY ELEMENT PROVIDED"""
^XTV(8991,48,1,2,1,259,0)=" .;RESTABLISH SDARRAY(1) TO INTERNAL FM DATES"
^XTV(8991,48,1,2,1,260,0)=" .S SDARRAY(1)=STARTIM_"";""_ENDTIME"
^XTV(8991,48,1,2,1,261,0)=" .;"
^XTV(8991,48,1,2,1,262,0)=" .I ERROR'=""HOSPLOC NOT DEFINED"" I $D(SDARRAY(2)) I CLINIEN'="""" S SDARRAY(2)=CLINIEN  ; HOSP LOCATION "
^XTV(8991,48,1,2,1,263,0)=" .I $D(SDARRAY(4)) D"
^XTV(8991,48,1,2,1,264,0)=" ..S PATIENID=SDARRAY(4)"
^XTV(8991,48,1,2,1,265,0)=" ..S ^XTMP(""WELCH1"",""PATID"")=PATIENID"
^XTV(8991,48,1,2,1,266,0)=" ..;PATIENT ID AS SSN. TEST PATIENT NEEDS AT LEAST LEADING NON-ZERO DIGIT"
^XTV(8991,48,1,2,1,267,0)=" ..S IDX=0"
^XTV(8991,48,1,2,1,268,0)=" ..S IFLAG=0"
^XTV(8991,48,1,2,1,269,0)=" "_$C(9)_"..F  S IDX=$O(^DPT(""SSN"",IDX)) Q:(IDX="""")!(IFLAG=1)  D"
^XTV(8991,48,1,2,1,270,0)=" "_$C(9)_"...I IDX=PATIENID S IFLAG=1"
^XTV(8991,48,1,2,1,271,0)=" ..I IFLAG=1 D"
^XTV(8991,48,1,2,1,272,0)=" ...S DFN=0"
^XTV(8991,48,1,2,1,273,0)="    ...S DFN=$O(^DPT(""SSN"",PATIENID,DFN))"
^XTV(8991,48,1,2,1,274,0)=" ...S SDARRAY(4)=DFN"
^XTV(8991,48,1,2,1,275,0)=" ...S ^XTMP(""WELCH1"",""DFN"")=DFN"
^XTV(8991,48,1,2,1,276,0)=" ..E  D"
^XTV(8991,48,1,2,1,277,0)=" ...S ERROR=PATIENID_""PATIENTID NOT DEFINED"""
^XTV(8991,48,1,2,1,278,0)=" .I ERROR'="""" G OVER"
^XTV(8991,48,1,2,1,279,0)=" .;NOW CALL SDAM301 ROUTINE TO GET APPOINTMENTS"
^XTV(8991,48,1,2,1,280,0)=" .;"
^XTV(8991,48,1,2,1,281,0)=" .S AJJ3CNT1=0"
^XTV(8991,48,1,2,1,282,0)=" .F  S AJJ3CNT1=$O(SDARRAY1(AJJ3CNT1)) Q:AJJ3CNT1=""""  D"
^XTV(8991,48,1,2,1,283,0)=" ..;"
^XTV(8991,48,1,2,1,284,0)=" .I $D(SDARRAY(""MAX"")) D"
^XTV(8991,48,1,2,1,285,0)=" ..I SDARRAY(""MAX"")>2 S SDARRAY(""MAX"")=2"
^XTV(8991,48,1,2,1,286,0)=" .S SDCOUNT=$$SDAPI^SDAMA301(.SDARRAY)"
^XTV(8991,48,1,2,1,287,0)=" .; "
^XTV(8991,48,1,2,1,288,0)=" .I SDCOUNT>0 D"
^XTV(8991,48,1,2,1,289,0)=" ..;"
^XTV(8991,48,1,2,1,290,0)=" ..;get patient,or clinic arrays depending on sort by patient or clinic . "
^XTV(8991,48,1,2,1,291,0)=" ..I (DFN'="""")&(CLINIEN="""") S ORDRSORT=""P,C,D"""
^XTV(8991,48,1,2,1,292,0)=" ..I (CLINIEN'="""")&(DFN="""") S ORDRSORT=""C,P,D"""
^XTV(8991,48,1,2,1,293,0)=" ..I (DFN'="""")&(CLINIEN'="""") S ORDRSORT=""PS,CS,D"""
^XTV(8991,48,1,2,1,294,0)=" ..I (DFN="""")&(CLINIEN="""") S ORDRSORT=""CN,PN,D"""
^XTV(8991,48,1,2,1,295,0)=" .E  D"
^XTV(8991,48,1,2,1,296,0)=" ..; ERROR CONDITION OR NO ELEMENTS RETURNED"
^XTV(8991,48,1,2,1,297,0)="OVER .;"_$C(9)
^XTV(8991,48,1,2,1,298,0)=" .;DETERMINE IF AN APPLICATION ACK HAS BEEN REQUESTED"
^XTV(8991,48,1,2,1,299,0)=" .;I HDR(""APP ACK TYPE"")=""AL"" D SDAPIACK"
^XTV(8991,48,1,2,1,300,0)=" .D SDAPIACK"
^XTV(8991,48,1,2,1,301,0)=" ;"
^XTV(8991,48,1,2,1,302,0)=" ; MAKE APPOINTMENT API PROCESSING AFTER REQUEST DATA RECEIVED"
^XTV(8991,48,1,2,1,303,0)=" ;"
^XTV(8991,48,1,2,1,304,0)=" ;"
^XTV(8991,48,1,2,1,305,0)=" I IEVN=""A08"" D   ;MAKE APPOINTMENT API . NOW DO APPLICATION ACK"
^XTV(8991,48,1,2,1,306,0)=" .;CHECK FIRST IF STYP IS DEFINED (NOT """")"
^XTV(8991,48,1,2,1,307,0)=" .;"
^XTV(8991,48,1,2,1,308,0)=" .;"
^XTV(8991,48,1,2,1,309,0)=" .I STYP="""" S ERRROR=ERROR_""UNDEFINED STYP"""
^XTV(8991,48,1,2,1,310,0)=" .;ALSO CHECK SDLOCATE IS DEFINED (NOT="""")"
^XTV(8991,48,1,2,1,311,0)=" .I SDLOCATE="""" S ERROR=ERROR_""UNDEFINED SDLOCATE"""
^XTV(8991,48,1,2,1,312,0)=" .I SDLOCATE'="""" D  ; CONVERT TO INTERNAL FORMAT"
^XTV(8991,48,1,2,1,313,0)=" ..; CHECK FIRST IF SDLOCATE IN B CROSS-REF"
^XTV(8991,48,1,2,1,314,0)=" ..S IDX="""""
^XTV(8991,48,1,2,1,315,0)=" ..S IFLAG=0"
^XTV(8991,48,1,2,1,316,0)=" "_$C(9)_"..F  S IDX=$O(^SC(""B"",IDX)) Q:(IDX="""")!(IFLAG=1)  D"
^XTV(8991,48,1,2,1,317,0)=" "_$C(9)_"...I IDX=SDLOCATE S IFLAG=1"
^XTV(8991,48,1,2,1,318,0)=" ..I IFLAG=1 D"
^XTV(8991,48,1,2,1,319,0)=" ...S CLINIEN=0"
^XTV(8991,48,1,2,1,320,0)="    ...S CLINIEN=$O(^SC(""B"",SDLOCATE,CLINIEN))"
^XTV(8991,48,1,2,1,321,0)=" ..E  D"
^XTV(8991,48,1,2,1,322,0)=" ...S ERROR=ERROR_""^""_""SDLOCATE NOT DEFINED"""
^XTV(8991,48,1,2,1,323,0)=" .;ALSO CHECK FOR SDARRAY(""DATA ENTRY CLERK"") AND CONVERT TO DUZ"
^XTV(8991,48,1,2,1,324,0)=" .I $D(SDARRAY(""DATA ENTRY CLERK""))>0 S TEMP=SDARRAY(""DATA ENTRY CLERK"") D"
^XTV(8991,48,1,2,1,325,0)=" ..S TEMPC=0"
^XTV(8991,48,1,2,1,326,0)=" ..S IFLAG=0"
^XTV(8991,48,1,2,1,327,0)=" ..F  S TEMPC=$O(^VA(200,""B"",TEMPC)) Q:(TEMPC="""")!(IFLAG=1)  D"
^XTV(8991,48,1,2,1,328,0)=" ...I TEMPC=TEMP S IFLAG=1"
^XTV(8991,48,1,2,1,329,0)=" ..I IFLAG=1 D"
^XTV(8991,48,1,2,1,330,0)=" ...S PCIEN=0"
^XTV(8991,48,1,2,1,331,0)="    ...S PCIEN=$O(^VA(200,""B"",TEMP,PCIEN))"
^XTV(8991,48,1,2,1,332,0)=" ...S SDARRAY(""DATA ENTRY CLERK"")=PCIEN"
^XTV(8991,48,1,2,1,333,0)=" ..E  D"
^XTV(8991,48,1,2,1,334,0)=" ...S ERROR=ERROR_""^""_""DATA CLERK UNDEFINED"""
^XTV(8991,48,1,2,1,335,0)=" .;PATIENT ID AS SSN. TEST PATIENT NEEDS AT LEAST LEADING NON-ZERO DIGIT"
^XTV(8991,48,1,2,1,336,0)=" .;"
^XTV(8991,48,1,2,1,337,0)=" .;"
^XTV(8991,48,1,2,1,338,0)=" .S IDX=0"
^XTV(8991,48,1,2,1,339,0)=" .S IFLAG=0"
^XTV(8991,48,1,2,1,340,0)=" "_$C(9)_".F  S IDX=$O(^DPT(""SSN"",IDX)) Q:(IDX="""")!(IFLAG=1)  D"
^XTV(8991,48,1,2,1,341,0)=" "_$C(9)_"..I IDX=PATIENID S IFLAG=1"
^XTV(8991,48,1,2,1,342,0)=" .I IFLAG=1 D"
^XTV(8991,48,1,2,1,343,0)=" ..S DFN=0"
^XTV(8991,48,1,2,1,344,0)="    ..S DFN=$O(^DPT(""SSN"",PATIENID,DFN))"
^XTV(8991,48,1,2,1,345,0)=" .E  D"
^XTV(8991,48,1,2,1,346,0)=" ..S ERROR=ERROR_""^""_""PATIENTID NOT DEFINED"""
^XTV(8991,48,1,2,1,347,0)=" .;CONVERT ALL DATE/TIMES TO INTERNAL FM FORMAT"
^XTV(8991,48,1,2,1,348,0)=" .I $D(SDARRAY(""DATE NOW""))>0 S X=SDARRAY(""DATE NOW"") D ^%DT S INTE=Y S SDARRAY(""DATE NOW"")=INTE"
^XTV(8991,48,1,2,1,349,0)=" .I $D(SDARRAY(""LAB DATE TIME ASSOCIATED""))>0 S X=SDARRAY(""LAB DATE TIME ASSOCIATED"") S %DT=""T"" D ^%DT S INTE=Y S SDARRAY(""LAB DATE TIME ASSOCIATED"")=INTE"
^XTV(8991,48,1,2,1,350,0)=" .I $D(SDARRAY(""X-RAY DATE TIME ASSOCIATED""))>0 S X=SDARRAY(""X-RAY DATE TIME ASSOCIATED"") S %DT=""T"" D ^%DT S INTE=Y S SDARRAY(""X-RAY DATE TIME ASSOCIATED"")=INTE"
^XTV(8991,48,1,2,1,351,0)=" .I $D(SDARRAY(""EKG DATE TIME ASSOCIATED""))>0 S X=SDARRAY(""EKG DATE TIME ASSOCIATED"") S %DT=""T"" D ^%DT S INTE=Y S SDARRAY(""EKG DATE TIME ASSOCIATED"")=INTE"
^XTV(8991,48,1,2,1,352,0)=" .I $D(SDARRAY(""DESIRED DATE TIME OF APPOINTMENT""))>0 S X=SDARRAY(""DESIRED DATE TIME OF APPOINTMENT"") S %DT=""T"" D ^%DT S INTE=Y S SDARRAY(""DESIRED DATE TIME OF APPOINTMENT"")=INTE"
^XTV(8991,48,1,2,1,353,0)=" .;"
^XTV(8991,48,1,2,1,354,0)=" .I ERROR'="""" G OVER1"
^XTV(8991,48,1,2,1,355,0)=" .;ALSO UNDERSTAND THAT OPTIONAL SDVWNVAI COULD HAVE BEEN PASSED IN ($D(SDVWNVAI)>0)"
^XTV(8991,48,1,2,1,356,0)=" .S XQSDVWSI = 1    ;SILENT MODE FOR NON-INTERACTIVE MODE W/O WRITE IN XQOR ROUTINES"
^XTV(8991,48,1,2,1,357,0)=" .;"
^XTV(8991,48,1,2,1,358,0)=" .; MAKE VWSDMKPI CALL HERE"
^XTV(8991,48,1,2,1,359,0)=" .S SC=CLINIEN"
^XTV(8991,48,1,2,1,360,0)=" .S SD1=$G(SDDATE)      ;FROM PV1"
^XTV(8991,48,1,2,1,361,0)=" .;S DFN=      ;FROM PID AND CONVERTED SSN TO DFN ABOVE"
^XTV(8991,48,1,2,1,362,0)=" .;STYP SHOULD BE SET BY NOW"
^XTV(8991,48,1,2,1,363,0)=" .;AS MINIMALLY BELOW EXAMPLE"
^XTV(8991,48,1,2,1,364,0)=" .;S DFN=1 S SD1=3070123.0930 S SC=3 S STYP=3"
^XTV(8991,48,1,2,1,365,0)=" .;D NOW^%DTC S X2=X\1 S SDARRAY(""DATE NOW"")=X2"
^XTV(8991,48,1,2,1,366,0)=" .;S SDARRAY(""APPT TYPE"")=9"
^XTV(8991,48,1,2,1,367,0)="    .;S SDARRAY(""SCHED_REQ_TYPE"")=""O"""
^XTV(8991,48,1,2,1,368,0)="    .;S SDARRAY(""NEXT APPT IND"")=0"
^XTV(8991,48,1,2,1,369,0)="    .;S SDARRAY(""FOLLOWUP VISIT INDICATOR"")=0  ; 0 FOR NO"
^XTV(8991,48,1,2,1,370,0)="    .;"
^XTV(8991,48,1,2,1,371,0)="    .;Q"
^XTV(8991,48,1,2,1,372,0)="    .S IER=$$EN^SDVWMKPI(DFN,SD1,SC,STYP,.SDARRAY)"
^XTV(8991,48,1,2,1,373,0)="    .;W ""IER="",IER"
^XTV(8991,48,1,2,1,374,0)="    .S MAKEAPPT=1"
^XTV(8991,48,1,2,1,375,0)=" .; GET RETURNS"
^XTV(8991,48,1,2,1,376,0)="OVER1 .;"
^XTV(8991,48,1,2,1,377,0)=" .;DETERMINE IF AN APPLICATION ACK HAS BEEN REQUESTED"
^XTV(8991,48,1,2,1,378,0)=" .;I HDR(""APP ACK TYPE"")=""AL"" D MPKIACK"
^XTV(8991,48,1,2,1,379,0)=" .;I HDR(""ACCEPT ACK TYPE"")=""AL"" D MPKIACK"
^XTV(8991,48,1,2,1,380,0)=" .D SDAPIACK ; SHARE PARTS OF , NOT USE MPKIACK ;"
^XTV(8991,48,1,2,1,381,0)=" ;"
^XTV(8991,48,1,2,1,382,0)=" ;GO TO NEXT MESSAGE FOR THIS TEST"
^XTV(8991,48,1,2,1,383,0)=" ;"
^XTV(8991,48,1,2,1,384,0)=" ;"
^XTV(8991,48,1,2,1,385,0)="OVER2 I (IEVN=0)!(IEVN=""A19"") K ^TMP($J,""SDAMA301"")"
^XTV(8991,48,1,2,1,386,0)=" Q"_$C(9)
^XTV(8991,48,1,2,1,387,0)=" H 1"_$C(9)_"I $$NEXTMSG^HLOPRS(.HLMSTATE,HLMSGIEN,.HDR) G MSG1"
^XTV(8991,48,1,2,1,388,0)=" S AJJ3CNT=AJJ3CNT+1"
^XTV(8991,48,1,2,1,389,0)=" I AJJ3CNT>0 Q ; GET OUT EVENTUALLY AS NON-PERSISTANT TASK"
^XTV(8991,48,1,2,1,390,0)=" G OVER2"
^XTV(8991,48,1,2,1,391,0)=" ;"
^XTV(8991,48,1,2,1,392,0)=" ;"
^XTV(8991,48,1,2,1,393,0)=" ;"
^XTV(8991,48,1,2,1,394,0)=" ;"
^XTV(8991,48,1,2,1,395,0)=" Q"
^XTV(8991,48,1,2,1,396,0)="MPKIACK ; APPLICATION ACKNOWLEDGE TO MAKE APPOINTMENT API REQUEST"
^XTV(8991,48,1,2,1,397,0)=" N EXTRET"
^XTV(8991,48,1,2,1,398,0)=" S EXTRET=0"
^XTV(8991,48,1,2,1,399,0)=" ;;"
^XTV(8991,48,1,2,1,400,0)=" S APPARMS(""ACK CODE"")=""AA"""
^XTV(8991,48,1,2,1,401,0)=" S APPARMS(""MESSAGE TYPE"")=""ACK"""
^XTV(8991,48,1,2,1,402,0)=" S APPARMS(""SECURITY"")=MSGCTRL"
^XTV(8991,48,1,2,1,403,0)=" ;START THE APPLICATION ACKNOWLEDGE MESSAGE"
^XTV(8991,48,1,2,1,404,0)=" ;"
^XTV(8991,48,1,2,1,405,0)=" ;Q"
^XTV(8991,48,1,2,1,406,0)=" S ERROR1="""""
^XTV(8991,48,1,2,1,407,0)=" I (ERETURN'=0)!(ERROR'="""")!(IER'=1)!(ERROR1'="""") S APPARMS(""ACK CODE"")=""AE"""
^XTV(8991,48,1,2,1,408,0)=" I '$$ACK^HLOAPI2(.HLMSTATE,.APPARMS,.ACK,.ERROR1) S ERETURN=""START ACK MESSAGE"""
^XTV(8991,48,1,2,1,409,0)=" ;"
^XTV(8991,48,1,2,1,410,0)=" ;"
^XTV(8991,48,1,2,1,411,0)=" ; ADD ERR SEGMENT IF NEEDED"
^XTV(8991,48,1,2,1,412,0)=" ;"
^XTV(8991,48,1,2,1,413,0)=" I (ERETURN'=0)!(ERROR'="""")!(IER'=1)!(ERROR1'="""") S EXTRET=$$ERRORW()"
^XTV(8991,48,1,2,1,414,0)=" ;"
^XTV(8991,48,1,2,1,415,0)=" I (ERETURN'=0)!(ERROR'="""")!(EXTRET'=0)!(IER'=1)!(ERROR1'="""") S APPARMS(""ACK CODE"")=""AE"""
^XTV(8991,48,1,2,1,416,0)=" ;"
^XTV(8991,48,1,2,1,417,0)=" ; SEND APPLICATION ACKNOWLEDGEMENT"
^XTV(8991,48,1,2,1,418,0)=" ;"
^XTV(8991,48,1,2,1,419,0)=" I '$$SENDACK^HLOAPI2(.ACK,.ERROR1) S ERETURN=""SENDAPPACK"""
^XTV(8991,48,1,2,1,420,0)=" ;"
^XTV(8991,48,1,2,1,421,0)=" Q  "
^XTV(8991,48,1,2,1,422,0)="SDAPIACK ; APPLICATION ACKNOWLEDGE TO SDAPI REQUEST"
^XTV(8991,48,1,2,1,423,0)=" N EXTRET,ERROR2,LOCACKCD,ACKCDER,TEMP8,SEG"
^XTV(8991,48,1,2,1,424,0)=" N ERR,ERROR3,HLMSTATE,WHO,APPARMS,XQ,RETURN1 ; NEW ONES SO CANNOT USE OLD HLMSTATE TO RETURN REAL ACK"
^XTV(8991,48,1,2,1,425,0)=" S EXTRET=0"
^XTV(8991,48,1,2,1,426,0)=" ;S SEG="""""
^XTV(8991,48,1,2,1,427,0)=" S ERROR2="""""
^XTV(8991,48,1,2,1,428,0)=" S XQ="""""
^XTV(8991,48,1,2,1,429,0)=" ;"
^XTV(8991,48,1,2,1,430,0)=" ;"
^XTV(8991,48,1,2,1,431,0)=" ; SEND ACK MESSAGE COMMENTED OUT BELOW. INSTEAD JUST SEND NORMAL MESSAGE WITH ADDED SEGMENTS"
^XTV(8991,48,1,2,1,432,0)=" ;"
^XTV(8991,48,1,2,1,433,0)=" ;;;;S APPARMS(""ACK CODE"")=""AA"""
^XTV(8991,48,1,2,1,434,0)=" ;;;;S APPARMS(""ACCEPT ACK TYPE"")=""NE"""
^XTV(8991,48,1,2,1,435,0)=" ;;;;I (ERROR'="""")!(SDCOUNT<0) D"
^XTV(8991,48,1,2,1,436,0)=" ;;;;.S APPARMS(""ACK CODE"")=""AE"""
^XTV(8991,48,1,2,1,437,0)=" ;;;.S APPARMS(""ERROR MESSAGE"")=ERROR_""^""_SDCOUNT"
^XTV(8991,48,1,2,1,438,0)=" ;;;;S APPARMS(""MESSAGE TYPE"")=""ACK"""
^XTV(8991,48,1,2,1,439,0)=" ;;;;;S APPARMS(""EVENT"")=""A19"""
^XTV(8991,48,1,2,1,440,0)=" ;;"
^XTV(8991,48,1,2,1,441,0)=" ;;"
^XTV(8991,48,1,2,1,442,0)=" S APPARMS(""MESSAGE TYPE"")=""ADT"""
^XTV(8991,48,1,2,1,443,0)=" S APPARMS(""EVENT"")=""A19"" ; RESPONSE"
^XTV(8991,48,1,2,1,444,0)=" S APPARMS(""COUNTRY"")=""USA"""
^XTV(8991,48,1,2,1,445,0)=" S APPARMS(""FIELD SEPARATOR"")=""|"""
^XTV(8991,48,1,2,1,446,0)=" S APPARMS(""ENCODING CHARACTERS"")=""^~\&"""
^XTV(8991,48,1,2,1,447,0)=" S APPARMS(""VERSION"")=2.4"
^XTV(8991,48,1,2,1,448,0)=" ;"
^XTV(8991,48,1,2,1,449,0)=" ;"
^XTV(8991,48,1,2,1,450,0)=" S APPARMS(""SECURITY"")=MSGCTRL"
^XTV(8991,48,1,2,1,451,0)=" ;ANALOGY FOR ACK FOR MAKE APPT BELOW"
^XTV(8991,48,1,2,1,452,0)=" I MAKEAPPT=1 D"
^XTV(8991,48,1,2,1,453,0)=" .S APPARMS(""EVENT"")=""A08"""
^XTV(8991,48,1,2,1,454,0)=" .I IER=1 D"
^XTV(8991,48,1,2,1,455,0)=" ..S APPARMS(""SECURITY"")=MSGCTRL_""#""_""AA"""
^XTV(8991,48,1,2,1,456,0)=" .E  D"
^XTV(8991,48,1,2,1,457,0)=" ..S APPARMS(""SECURITY"")=MSGCTRL_""#""_""AE"""
^XTV(8991,48,1,2,1,458,0)=" ;"
^XTV(8991,48,1,2,1,459,0)=" ;"
^XTV(8991,48,1,2,1,460,0)=" ;"
^XTV(8991,48,1,2,1,461,0)=" ;DON'T USE ACK MESSAGE START , JUST REGULAR MESSAGE START"
^XTV(8991,48,1,2,1,462,0)=" ;START THE APPLICATION ACKNOWLEDGE MESSAGE"
^XTV(8991,48,1,2,1,463,0)=" ;;;I '$$ACK^HLOAPI2(.HLMSTATE,.APPARMS,.ACK,.ERROR1) S ERETURN=""START ACK MESSAGE"""
^XTV(8991,48,1,2,1,464,0)=" ;;;"
^XTV(8991,48,1,2,1,465,0)=" ;;;S ^XTMP(""WELCH1"",""ERROR1"")=ERROR1_""^""_ERETURN"
^XTV(8991,48,1,2,1,466,0)=" ;;;"
^XTV(8991,48,1,2,1,467,0)=" ;;; JUMP OVER THIS AS ADDSEG^HLOAPI DOES NOT RETURN WITH A START APPLICATION ACKNOWLEDGE "
^XTV(8991,48,1,2,1,468,0)=" ;;;D SET^HLOAPI(.SEG,""MSA"",0) ;creates an MSA segment"
^XTV(8991,48,1,2,1,469,0)=" ;;;S LOCACKCD=""AA"""
^XTV(8991,48,1,2,1,470,0)=" ;;;S ACKCDER="""""
^XTV(8991,48,1,2,1,471,0)=" ;;;I (ERROR'="""")!(SDCOUNT<0) D"
^XTV(8991,48,1,2,1,472,0)=" ;;;.S LOCACKCD=""AE"""
^XTV(8991,48,1,2,1,473,0)=" ;;;.S ACKCDER=ERROR_""^""_SDCOUNT"
^XTV(8991,48,1,2,1,474,0)=" ;;;D SET^HLOAPI(.SEG,LOCACKCD,1) ; ""AA' OR ""AE"""
^XTV(8991,48,1,2,1,475,0)=" ;;;D SET^HLOAPI(.SEG,MSGCTRL,2) ;=MSGCTRL "
^XTV(8991,48,1,2,1,476,0)="    ;;;D SET^HLOAPI(.SEG,ACKCDER,3) ;will place the value into the array position"
^XTV(8991,48,1,2,1,477,0)=" ;;;"
^XTV(8991,48,1,2,1,478,0)=" ;;;"
^XTV(8991,48,1,2,1,479,0)=" ;;; ADD SEGMENT"
^XTV(8991,48,1,2,1,480,0)=" ;;;I '$$ADDSEG^HLOAPI(.HLMSTATE,.SEG,.ERROR2) S ERETURN=""MSA"""
^XTV(8991,48,1,2,1,481,0)=" ;;;S ^XTMP(""WELCH1"",""HERE99"")=ERROR2_""^""_ERETURN"
^XTV(8991,48,1,2,1,482,0)=" ;"
^XTV(8991,48,1,2,1,483,0)=" ;;CREATE NEW MESSAGE"
^XTV(8991,48,1,2,1,484,0)=" ;;"
^XTV(8991,48,1,2,1,485,0)=" ;"
^XTV(8991,48,1,2,1,486,0)=" S ERR="""""
^XTV(8991,48,1,2,1,487,0)=" S ERROR3="""""
^XTV(8991,48,1,2,1,488,0)=" S ERROR1="""""
^XTV(8991,48,1,2,1,489,0)=" ;"
^XTV(8991,48,1,2,1,490,0)=" I '$$NEWMSG^HLOAPI(.APPARMS,.HLMSTATE,.ERROR3) S ERETURN=""NEW MESSAGE ERROR"" "
^XTV(8991,48,1,2,1,491,0)=" ;          "
^XTV(8991,48,1,2,1,492,0)=" ;"
^XTV(8991,48,1,2,1,493,0)=" ;JUMP OVER CREATE MSA SEGMENT OURSELF FOR A NON-ACK MESSAGE"
^XTV(8991,48,1,2,1,494,0)=" G OVERA"
^XTV(8991,48,1,2,1,495,0)=" ;Use message control ID in MSH segment for sync flag later in returned application ack "
^XTV(8991,48,1,2,1,496,0)=" ;"
^XTV(8991,48,1,2,1,497,0)=" ;;CREATE SEGMENT"
^XTV(8991,48,1,2,1,498,0)=" ;"
^XTV(8991,48,1,2,1,499,0)=" ;EXPERIMENT . BUILD MSA SEGMENT BY ITSELF"
^XTV(8991,48,1,2,1,500,0)=" ;"
^XTV(8991,48,1,2,1,501,0)=" D SET^HLOAPI(.SEG,""MSA"",0) ;creates an MSA segment"
^XTV(8991,48,1,2,1,502,0)=" S LOCACKCD=""AA"""
^XTV(8991,48,1,2,1,503,0)=" S ACKCDER="""""
^XTV(8991,48,1,2,1,504,0)=" I (ERROR'="""")!(SDCOUNT<0) D"
^XTV(8991,48,1,2,1,505,0)=" .S LOCACKCD=""AE"""
^XTV(8991,48,1,2,1,506,0)=" .S ACKCDER=ERROR_""^""_SDCOUNT"
^XTV(8991,48,1,2,1,507,0)=" D SET^HLOAPI(.SEG,LOCACKCD,1) ; ""AA' OR ""AE"""
^XTV(8991,48,1,2,1,508,0)=" D SET^HLOAPI(.SEG,MSGCTRL,2) ;=MSGCTRL "
^XTV(8991,48,1,2,1,509,0)="    D SET^HLOAPI(.SEG,ACKCDER,3) ;will place the value into the array position"
^XTV(8991,48,1,2,1,510,0)=" ;;;"
^XTV(8991,48,1,2,1,511,0)=" ;;;"
^XTV(8991,48,1,2,1,512,0)=" ;;; ADD SEGMENT"
^XTV(8991,48,1,2,1,513,0)=" I '$$ADDSEG^HLOAPI(.HLMSTATE,.SEG,.ERROR2) S ERETURN=""MSA"""
^XTV(8991,48,1,2,1,514,0)="OVERA ;"
^XTV(8991,48,1,2,1,515,0)=" ;"
^XTV(8991,48,1,2,1,516,0)=" ;"
^XTV(8991,48,1,2,1,517,0)=" ;"
^XTV(8991,48,1,2,1,518,0)=" ; ADD ERR SEGMENT IF NEEDED"
^XTV(8991,48,1,2,1,519,0)=" ;"
^XTV(8991,48,1,2,1,520,0)="    ;I (MAKEAPPT=1) I IER=1 S IER=0"
^XTV(8991,48,1,2,1,521,0)=" I (ERETURN'=0)!(ERROR'="""")!(SDCOUNT<0)!(ERROR1'="""")!(IER'=1) S EXTRET=$$ERRORW(XQ)"
^XTV(8991,48,1,2,1,522,0)=" ;"
^XTV(8991,48,1,2,1,523,0)=" ;"
^XTV(8991,48,1,2,1,524,0)=" ;;CREATE SEGMENT QRD"
^XTV(8991,48,1,2,1,525,0)=" ;"
^XTV(8991,48,1,2,1,526,0)=" ; PUT N SORT METHOD FOR APPT RETURNED AND SDCOUNT VALUE"
^XTV(8991,48,1,2,1,527,0)=" ; ADD ADT ACK SEGMENT FOR MAKE APPT"
^XTV(8991,48,1,2,1,528,0)=" I MAKEAPPT=1 D"
^XTV(8991,48,1,2,1,529,0)=" .D SET^HLOAPI(.SEG,""PID"",0)"
^XTV(8991,48,1,2,1,530,0)=" .D SET^HLOAPI(.SEG,DFN,3)"
^XTV(8991,48,1,2,1,531,0)=" .S SDFNNAME=$P($G(^DPT(DFN,0)),""^"",1)"
^XTV(8991,48,1,2,1,532,0)=" .D SET^HLOAPI(.SEG,SDFNNAME,5)"
^XTV(8991,48,1,2,1,533,0)=" .S SDFNSSN=$P($G(^DPT(DFN,0)),""^"",9)"
^XTV(8991,48,1,2,1,534,0)=" .D SET^HLOAPI(.SEG,SDFNSSN,19)"
^XTV(8991,48,1,2,1,535,0)=" .;"
^XTV(8991,48,1,2,1,536,0)=" .;; ADD SEGMENT"
^XTV(8991,48,1,2,1,537,0)=" .I '$$ADDSEG^HLOAPI(.HLMSTATE,.SEG) S ERETURN=""PID"""
^XTV(8991,48,1,2,1,538,0)=" ;"
^XTV(8991,48,1,2,1,539,0)=" I MAKEAPPT=1 G OVERT"
^XTV(8991,48,1,2,1,540,0)=" D SET^HLOAPI(.SEG,""QRD"",0)"
^XTV(8991,48,1,2,1,541,0)=" D SET^HLOAPI(.SEG,$$HLDATE^HLFNC($$NOW^XLFDT(),""TS""),1)"
^XTV(8991,48,1,2,1,542,0)=" D SET^HLOAPI(.SEG,ORDRSORT,8)"
^XTV(8991,48,1,2,1,543,0)=" I (ERROR="""")&(SDCOUNT'="""") D SET^HLOAPI(.SEG,SDCOUNT,11)"
^XTV(8991,48,1,2,1,544,0)=" ;"
^XTV(8991,48,1,2,1,545,0)=" ;"
^XTV(8991,48,1,2,1,546,0)=" ;"
^XTV(8991,48,1,2,1,547,0)=" ;; ADD SEGMENT"
^XTV(8991,48,1,2,1,548,0)=" I '$$ADDSEG^HLOAPI(.HLMSTATE,.SEG) S ^XTMP(""WELCH1"",""HERE88C"")="""" S ERR=""QRD"""
^XTV(8991,48,1,2,1,549,0)=" I $D(ERROR2) D"
^XTV(8991,48,1,2,1,550,0)=" .;"
^XTV(8991,48,1,2,1,551,0)=" E  D"
^XTV(8991,48,1,2,1,552,0)=" .;"
^XTV(8991,48,1,2,1,553,0)=" ;;CREATE SEGMENT EVN"
^XTV(8991,48,1,2,1,554,0)=" ;"
^XTV(8991,48,1,2,1,555,0)=" ; PUT IN ADT A19 RETURN , BUT THIS MAY ALREADY BE THERE FROM APPARMS(""EVENT"")FROM ORIGINAL RECEIVED MESSAGE, BUT THIS CREATES EVENT "
^XTV(8991,48,1,2,1,556,0)=" ;SEGMENT BELOW NOT ALREADY CREATED SINCE THIS IS REQUIRED TO SEND A NEW MSG WHICH IS WHAT THIS APP ACK IS."
^XTV(8991,48,1,2,1,557,0)=" ;"
^XTV(8991,48,1,2,1,558,0)=" ;;D SET^HLOAPI(.SEG,""EVN"",0)"
^XTV(8991,48,1,2,1,559,0)=" ;;D SET^HLOAPI(.SEG,""A19"",1)"
^XTV(8991,48,1,2,1,560,0)=" ;;D SET^HLOAPI(.SEG,$$HLDATE^HLFNC($$NOW^XLFDT(),""TS""),2)"
^XTV(8991,48,1,2,1,561,0)=" ;"
^XTV(8991,48,1,2,1,562,0)=" ;; ADD SEGMENT"
^XTV(8991,48,1,2,1,563,0)=" ;;I '$$ADDSEG^HLOAPI(.HLMSTATE,.SEG) S ERETURN=""EVN"""
^XTV(8991,48,1,2,1,564,0)=" ;"
^XTV(8991,48,1,2,1,565,0)=" ;"
^XTV(8991,48,1,2,1,566,0)=" ;"
^XTV(8991,48,1,2,1,567,0)=" ;I ORDRSORT=""P"" S SDCLIEN=$O(^TMP($J,""SDAMA301"",DFN,SDCLIEN)) LAST SDATE"
^XTV(8991,48,1,2,1,568,0)=" ;I ORDRSORT=""C"" S SDDFN=$O(^TMP($J,""SDAMA301"",CLINIEN,SDDFN)) LAST SDDATE"
^XTV(8991,48,1,2,1,569,0)=" ;I ORDRSORT=""PS"" S SDDATE=$O(^TMP($J,""SDAMA301"",PATIENTID,CLINIEN)) LAST SDDATE"
^XTV(8991,48,1,2,1,570,0)=" ;I ORDRSORT=""CN"" S SDDFN=$O(^TMP($J,""SDAMA301"",SDCLIEN,SDDFN)) LAST SDDATE"
^XTV(8991,48,1,2,1,571,0)=" I SDCOUNT>0 D"
^XTV(8991,48,1,2,1,572,0)=" .;CREATE MULTIPLES OF PID,PV1,PV2,NTE,NTE SEGMENTS FOR EACH APPOINTMENT/UNSCHEDULED VISIT RETURNED"
^XTV(8991,48,1,2,1,573,0)=" .;;"
^XTV(8991,48,1,2,1,574,0)=" .;DETERMINE FROM SORT ORDER IF $ORDER NEEDED TO GET DFN OR WHETHER ALREADY SPECIFIED THE SAME AS SUCH IN"
^XTV(8991,48,1,2,1,575,0)=" .;INPUT PARAMETERS"
^XTV(8991,48,1,2,1,576,0)=" .;"
^XTV(8991,48,1,2,1,577,0)=" .;FIRST ORDRSORT=""P"""
^XTV(8991,48,1,2,1,578,0)=" .I ($P(ORDRSORT,"","",1)=""P"")&($G(SDARRAY(""SORT""))="""") D"
^XTV(8991,48,1,2,1,579,0)=" ..S SDCLIEN=0"
^XTV(8991,48,1,2,1,580,0)=" ..F  S SDCLIEN=$O(^TMP($J,""SDAMA301"",DFN,SDCLIEN)) Q:SDCLIEN=""""  D"
^XTV(8991,48,1,2,1,581,0)=" ...S SDDATE=0 F  S SDDATE=$O(^TMP($J,""SDAMA301"",DFN,SDCLIEN,SDDATE)) Q:SDDATE=""""  D"
^XTV(8991,48,1,2,1,582,0)=" ....S SDAPPT=$G(^TMP($J,""SDAMA301"",DFN,SDCLIEN,SDDATE)) "
^XTV(8991,48,1,2,1,583,0)=" ....D CYCLE(DFN,SDCLIEN,SDDATE,SDAPPT,.ERETURN)"_$C(9)
^XTV(8991,48,1,2,1,584,0)=" .I ($P(ORDRSORT,"","",1)=""P"")&($G(SDARRAY(""SORT""))=""C"") D"
^XTV(8991,48,1,2,1,585,0)=" ..S SDCLIEN=0"
^XTV(8991,48,1,2,1,586,0)=" ..F  S SDCLIEN=$O(^TMP($J,""SDAMA301"",SDCLIEN)) Q:SDCLIEN=""""  D"
^XTV(8991,48,1,2,1,587,0)=" ...S SDDATE=0 F  S SDDATE=$O(^TMP($J,""SDAMA301"",SDCLIEN,SDDATE)) Q:SDDATE=""""  D"
^XTV(8991,48,1,2,1,588,0)=" ....S SDAPPT=$G(^TMP($J,""SDAMA301"",SDCLIEN,SDDATE)) "
^XTV(8991,48,1,2,1,589,0)=" ....D CYCLE(DFN,SDCLIEN,SDDATE,SDAPPT,.ERETURN)"_$C(9)
^XTV(8991,48,1,2,1,590,0)=" .I ($P(ORDRSORT,"","",1)=""PS"") D"
^XTV(8991,48,1,2,1,591,0)=" ..S SDDATE=0 F  S SDDATE=$O(^TMP($J,""SDAMA301"",DFN,CLINIEN,SDDATE)) Q:SDDATE=""""  D"
^XTV(8991,48,1,2,1,592,0)=" ...S SDAPPT=$G(^TMP($J,""SDAMA301"",DFN,CLINIEN,SDDATE)) "
^XTV(8991,48,1,2,1,593,0)=" ...D CYCLE(DFN,CLINIEN,SDDATE,SDAPPT,.ERETURN)"_$C(9)
^XTV(8991,48,1,2,1,594,0)=" .I ($P(ORDRSORT,"","",1)=""C"")&($G(SDARRAY(""SORT""))="""") D"
^XTV(8991,48,1,2,1,595,0)=" ..S SDDFN=0"
^XTV(8991,48,1,2,1,596,0)=" ..F  S SDDFN=$O(^TMP($J,""SDAMA301"",CLINIEN,SDDFN)) Q:SDDFN=""""  D"
^XTV(8991,48,1,2,1,597,0)=" ...S SDDATE=0 F  S SDDATE=$O(^TMP($J,""SDAMA301"",CLINIEN,SDDFN,SDDATE)) Q:SDDATE=""""  D"
^XTV(8991,48,1,2,1,598,0)=" ....S SDAPPT=$G(^TMP($J,""SDAMA301"",CLINIEN,SDDFN,SDDATE)) "
^XTV(8991,48,1,2,1,599,0)=" ....D CYCLE(SDDFN,CLINIEN,SDDATE,SDAPPT,.ERETURN)"
^XTV(8991,48,1,2,1,600,0)=" .I ($P(ORDRSORT,"","",1)=""C"")&($G(SDARRAY(""SORT""))=""P"") D"
^XTV(8991,48,1,2,1,601,0)=" ..S SDDFN=0"
^XTV(8991,48,1,2,1,602,0)=" ..F  S SDDFN=$O(^TMP($J,""SDAMA301"",SDDFN)) Q:SDDFN=""""  D"
^XTV(8991,48,1,2,1,603,0)=" ...S SDDATE=0 F  S SDDATE=$O(^TMP($J,""SDAMA301"",SDDFN,SDDATE)) Q:SDDATE=""""  D"
^XTV(8991,48,1,2,1,604,0)=" ....S SDAPPT=$G(^TMP($J,""SDAMA301"",SDDFN,SDDATE)) "
^XTV(8991,48,1,2,1,605,0)=" ....D CYCLE(SDDFN,CLINIEN,SDDATE,SDAPPT,.ERETURN)"_$C(9)
^XTV(8991,48,1,2,1,606,0)=" .I $P(ORDRSORT,"","",1)=""CN"" D"
^XTV(8991,48,1,2,1,607,0)=" ..S SDCLIEN=0"
^XTV(8991,48,1,2,1,608,0)=" ..F  S SDDFN=$O(^TMP($J,""SDAMA301"",SDCLIEN)) Q:SDCLIEN=""""  D"
^XTV(8991,48,1,2,1,609,0)=" ...S SDDFN=0"
^XTV(8991,48,1,2,1,610,0)=" ...F  S SDDFN=$O(^TMP($J,""SDAMA301"",SDCLIEN,SDDFN)) Q:SDDFN=""""  D"
^XTV(8991,48,1,2,1,611,0)=" ....S SDDATE=0 F  S SDDATE=$O(^TMP($J,""SDAMA301"",SDCLIEN,SDDFN,SDDATE)) Q:SDDATE=""""  D"
^XTV(8991,48,1,2,1,612,0)=" .....S SDAPPT=$G(^TMP($J,""SDAMA301"",SDCLIEN,SDDFN,SDDATE)) "
^XTV(8991,48,1,2,1,613,0)=" .....D CYCLE(SDDFN,SDCLIEN,SDDATE,SDAPPT,.ERETURN)"_$C(9)
^XTV(8991,48,1,2,1,614,0)=" ;"
^XTV(8991,48,1,2,1,615,0)=" ;"
^XTV(8991,48,1,2,1,616,0)=" ; "
^XTV(8991,48,1,2,1,617,0)=" ;;;;;;I (ERETURN'=0)!(ERROR'="""")!(EXTRET'=0)!(SDCOUNT<0)!(ERROR1'="""") S APPARMS(""ACK CODE"")=""AE"""
^XTV(8991,48,1,2,1,618,0)=" ;"
^XTV(8991,48,1,2,1,619,0)=" ; NOT SEND APPLICATION ACKNOWLEDGEMENT.JUST REGULAE SEND ONE MESSAGE "
^XTV(8991,48,1,2,1,620,0)=" ;"
^XTV(8991,48,1,2,1,621,0)=" ;;;;;;I $$SENDACK^HLOAPI2(.ACK,.ERROR1) S ERETURN=""SENDAPPACK"""
^XTV(8991,48,1,2,1,622,0)=" ;"
^XTV(8991,48,1,2,1,623,0)=" ; DEFINE SENDING AND RECEIVING PARAMETERS"
^XTV(8991,48,1,2,1,624,0)="OVERT S APPARMS(""SENDING APPLICATION"")=""VWSD RECEIVER"""
^XTV(8991,48,1,2,1,625,0)=" S APPARMS(""ACCEPT ACK TYPE"")=""NE"" ;""AL"""
^XTV(8991,48,1,2,1,626,0)=" ;S APPARMS(""APP ACK RESPONSE"")=""APPACKRR^SDVWHLIN"""
^XTV(8991,48,1,2,1,627,0)=" ;S APPARMS(""ACCEPT ACK RESPONSE"")=""MSGPROC^SDVWHLIN"""
^XTV(8991,48,1,2,1,628,0)=" ;REVERSE BELOW "
^XTV(8991,48,1,2,1,629,0)=" S APPARMS(""ACCEPT ACK RESPONSE"")=""APPACKRR^SDVWHLIN"" ; WHEN COMIT ACK , SU OR AE RETURN MADE"
^XTV(8991,48,1,2,1,630,0)=" S APPARMS(""APP ACK RESPONSE"")=""MSGPROC^SDVWHLIN"" ; WHEN NO ACK RETURN MADE "
^XTV(8991,48,1,2,1,631,0)=" S APPARMS(""APP ACK TYPE"")=""NE"" ;""AL"""
^XTV(8991,48,1,2,1,632,0)=" S WHO(""RECEIVING APPLICATION"")=""VWSD HLO EXT"""
^XTV(8991,48,1,2,1,633,0)=" S WHO(""FACILITY LINK NAME"")=""VWSD_PEASL"""
^XTV(8991,48,1,2,1,634,0)=" ;"
^XTV(8991,48,1,2,1,635,0)=" ;SEND MESSAGE"
^XTV(8991,48,1,2,1,636,0)=" ;"
^XTV(8991,48,1,2,1,637,0)=" S ERROR3="""""
^XTV(8991,48,1,2,1,638,0)=" S RETURN1=$$SENDONE^HLOAPI1(.HLMSTATE,.APPARMS,.WHO,.ERROR3)"
^XTV(8991,48,1,2,1,639,0)=" ;;;;;I '$$SENDONE^HLOAPI1(.HLMSTATE,.APPARMS,.WHO,.ERROR3) Q ;Q ""ERR=""_ERR_"" ERROR=""_ERROR"
^XTV(8991,48,1,2,1,640,0)=" ;;"
^XTV(8991,48,1,2,1,641,0)=" ;"
^XTV(8991,48,1,2,1,642,0)=" Q"
^XTV(8991,48,1,2,1,643,0)="CYCLE(SDDFN,SDCLIEN,SDDATE,SDAPPT,ERETURN) ;PID,PV1,PV2,NTE,NTE"
^XTV(8991,48,1,2,1,644,0)=" N SDFNNAME,SDFNSSN,TEMP,OUTIN,SDLOCATE"
^XTV(8991,48,1,2,1,645,0)=" ;"
^XTV(8991,48,1,2,1,646,0)=" ;CREATE SEGMENT PID"
^XTV(8991,48,1,2,1,647,0)=" ;"
^XTV(8991,48,1,2,1,648,0)=" ; PUT IN INTERNAL PATIENTID, NAME AND SSN "
^XTV(8991,48,1,2,1,649,0)=" ;"
^XTV(8991,48,1,2,1,650,0)=" ;"
^XTV(8991,48,1,2,1,651,0)=" ;"
^XTV(8991,48,1,2,1,652,0)=" D SET^HLOAPI(.SEG,""PID"",0)"
^XTV(8991,48,1,2,1,653,0)=" D SET^HLOAPI(.SEG,SDDFN,3)"
^XTV(8991,48,1,2,1,654,0)=" S SDFNNAME=$P($G(^DPT(SDDFN,0)),""^"",1)"
^XTV(8991,48,1,2,1,655,0)=" D SET^HLOAPI(.SEG,SDFNNAME,5)"
^XTV(8991,48,1,2,1,656,0)=" S SDFNSSN=$P($G(^DPT(SDDFN,0)),""^"",9)"
^XTV(8991,48,1,2,1,657,0)=" D SET^HLOAPI(.SEG,SDFNSSN,19)"
^XTV(8991,48,1,2,1,658,0)=" ;"
^XTV(8991,48,1,2,1,659,0)=" ;; ADD SEGMENT"
^XTV(8991,48,1,2,1,660,0)=" I '$$ADDSEG^HLOAPI(.HLMSTATE,.SEG) S ERETURN=""PID"""
^XTV(8991,48,1,2,1,661,0)=" ;"
^XTV(8991,48,1,2,1,662,0)=" ;NEXT PV1 SEGMENT"
^XTV(8991,48,1,2,1,663,0)=" ;"
^XTV(8991,48,1,2,1,664,0)=" ;CREATE SEGMENT PV1"
^XTV(8991,48,1,2,1,665,0)=" ;"
^XTV(8991,48,1,2,1,666,0)=" ;"
^XTV(8991,48,1,2,1,667,0)=" D SET^HLOAPI(.SEG,""PV1"",0)"
^XTV(8991,48,1,2,1,668,0)=" ; IF NOT ADMITTED THEN OUTPATIENT"
^XTV(8991,48,1,2,1,669,0)=" S OUTIN=""O"""
^XTV(8991,48,1,2,1,670,0)=" D SET^HLOAPI(.SEG,OUTIN,2) ;PATIENT CLASS"
^XTV(8991,48,1,2,1,671,0)=" D SET^HLOAPI(.SEG,SDCLIEN,3) ;HOSP LOCATION IEN"
^XTV(8991,48,1,2,1,672,0)=" S TEMP=$P(SDAPPT,""^"",18)"
^XTV(8991,48,1,2,1,673,0)=" S TEMP=$P(TEMP,"";"",1)"
^XTV(8991,48,1,2,1,674,0)=" D SET^HLOAPI(.SEG,TEMP,10) ;HOSPITAL SERVICE > PURPOSE OF VISIT(IEN)"
^XTV(8991,48,1,2,1,675,0)=" S TEMP=$P(SDAPPT,""^"",13)"
^XTV(8991,48,1,2,1,676,0)=" S TEMP=$P(TEMP,"";"",1)"
^XTV(8991,48,1,2,1,677,0)=" D SET^HLOAPI(.SEG,TEMP,18) ; PATIENT TYPE > PRIMARY STOP CODE IEN"
^XTV(8991,48,1,2,1,678,0)=" S TEMP=$P(SDAPPT,""^"",14)"
^XTV(8991,48,1,2,1,679,0)=" S TEMP=$P(TEMP,"";"",1)"
^XTV(8991,48,1,2,1,680,0)=" D SET^HLOAPI(.SEG,TEMP,41) ; PATIENT TYPE > CREDIT STOP CODE IEN"
^XTV(8991,48,1,2,1,681,0)=" D SET^HLOAPI(.SEG,$$HLDATE^HLFNC(SDDATE,""TS""),44) ; APPOINTMENT/UNSCHEDULED VISIT DATE"
^XTV(8991,48,1,2,1,682,0)=" ;"
^XTV(8991,48,1,2,1,683,0)=" ;"
^XTV(8991,48,1,2,1,684,0)=" ;"
^XTV(8991,48,1,2,1,685,0)=" ;; ADD SEGMENT"
^XTV(8991,48,1,2,1,686,0)=" I '$$ADDSEG^HLOAPI(.HLMSTATE,.SEG) S ERETURN=""PV1"""
^XTV(8991,48,1,2,1,687,0)=" ;"
^XTV(8991,48,1,2,1,688,0)=" ;NEXT PV2 SEGMENT"
^XTV(8991,48,1,2,1,689,0)=" ;"
^XTV(8991,48,1,2,1,690,0)=" ;CREATE SEGMENT PV2"
^XTV(8991,48,1,2,1,691,0)=" ;"
^XTV(8991,48,1,2,1,692,0)=" ;"
^XTV(8991,48,1,2,1,693,0)=" D SET^HLOAPI(.SEG,""PV2"",0)"
^XTV(8991,48,1,2,1,694,0)=" ; GET PURPOSE OF VISIT AGAIN"
^XTV(8991,48,1,2,1,695,0)=" ;IF UNSCHEDULED VISIT SET ELIGIBILITY IN PV2-7"
^XTV(8991,48,1,2,1,696,0)=" S TEMP=$P(SDAPPT,""^"",18)"
^XTV(8991,48,1,2,1,697,0)=" S TEMP=$P(TEMP,"";"",1)"
^XTV(8991,48,1,2,1,698,0)=" I TEMP=4 D"
^XTV(8991,48,1,2,1,699,0)=" .S TEMP=$P(SDAPPT,""^"",8)"
^XTV(8991,48,1,2,1,700,0)=" .S TEMP=$P(TEMP,"";"",1)"
^XTV(8991,48,1,2,1,701,0)=" .D SET^HLOAPI(.SEG,OUTIN,7) ;ELIGIBILITY"
^XTV(8991,48,1,2,1,702,0)=" D SET^HLOAPI(.SEG,$$HLDATE^HLFNC(SDDATE,""TS""),8) ; DESIRED EXPECTED APPOINTMENT/UNSCHEDULED VISIT DATE"
^XTV(8991,48,1,2,1,703,0)=" S TEMP=$P(SDAPPT,""^"",3)"
^XTV(8991,48,1,2,1,704,0)=" D SET^HLOAPI(.SEG,TEMP,24) ;APPOINTMENT/UNSCHEDULED VISIT STATUS"
^XTV(8991,48,1,2,1,705,0)=" S TEMP=$P(SDAPPT,""^"",16)"
^XTV(8991,48,1,2,1,706,0)=" D SET^HLOAPI(.SEG,$$HLDATE^HLFNC(TEMP,""TS""),46) ; DATE APPOINTMENT/UNSCHEDULED VISIT ACTUALLY MADE"
^XTV(8991,48,1,2,1,707,0)=" ;"
^XTV(8991,48,1,2,1,708,0)=" ;"
^XTV(8991,48,1,2,1,709,0)=" ;"
^XTV(8991,48,1,2,1,710,0)=" ;; ADD SEGMENT"
^XTV(8991,48,1,2,1,711,0)=" I '$$ADDSEG^HLOAPI(.HLMSTATE,.SEG) S ERETURN=""PV2"""
^XTV(8991,48,1,2,1,712,0)=" ;"
^XTV(8991,48,1,2,1,713,0)=" ;NEXT NTE SEGMENT FOR EXTERNAL LOCATION NAME"
^XTV(8991,48,1,2,1,714,0)=" ;"
^XTV(8991,48,1,2,1,715,0)=" ;CREATE SEGMENT NTE"
^XTV(8991,48,1,2,1,716,0)=" ;"
^XTV(8991,48,1,2,1,717,0)=" ;"
^XTV(8991,48,1,2,1,718,0)=" ;"
^XTV(8991,48,1,2,1,719,0)=" D SET^HLOAPI(.SEG,""NTE"",0)"
^XTV(8991,48,1,2,1,720,0)=" S SDLOCATE=$P($G(^SC(SDCLIEN,0)),""^"",1)"
^XTV(8991,48,1,2,1,721,0)=" D SET^HLOAPI(.SEG,""SDLOCATE=""_""""""""_SDLOCATE_"""""""",3)"
^XTV(8991,48,1,2,1,722,0)=" ;"
^XTV(8991,48,1,2,1,723,0)=" ;;"
^XTV(8991,48,1,2,1,724,0)=" ;"
^XTV(8991,48,1,2,1,725,0)=" ;; ADD SEGMENT"
^XTV(8991,48,1,2,1,726,0)=" I '$$ADDSEG^HLOAPI(.HLMSTATE,.SEG) S ERETURN=""NTE""_SDLOCATE"
^XTV(8991,48,1,2,1,727,0)=" ;"
^XTV(8991,48,1,2,1,728,0)=" ;NEXT NTE SEGMENT FOR SDAPPT "
^XTV(8991,48,1,2,1,729,0)=" ;"
^XTV(8991,48,1,2,1,730,0)=" ;CREATE SEGMENT NTE"
^XTV(8991,48,1,2,1,731,0)=" ;"
^XTV(8991,48,1,2,1,732,0)=" ;FIRST CONVERT ALL FM DATE/TIMES TO EXTERNAL FORMAT"
^XTV(8991,48,1,2,1,733,0)=" ;"
^XTV(8991,48,1,2,1,734,0)=" ; FIELDS 1,9,11,16,17,19,20,21,24,25"
^XTV(8991,48,1,2,1,735,0)=" S DATETIM=$P(SDAPPT,""^"",1)"
^XTV(8991,48,1,2,1,736,0)=" S Y=DATETIM D DD^%DT S $P(SDAPPT,""^"",1)=Y"
^XTV(8991,48,1,2,1,737,0)=" S DATETIM=$P(SDAPPT,""^"",9)"
^XTV(8991,48,1,2,1,738,0)=" S Y=DATETIM D DD^%DT S $P(SDAPPT,""^"",9)=Y"
^XTV(8991,48,1,2,1,739,0)=" S DATETIM=$P(SDAPPT,""^"",11)"
^XTV(8991,48,1,2,1,740,0)=" S Y=DATETIM D DD^%DT S $P(SDAPPT,""^"",11)=Y"
^XTV(8991,48,1,2,1,741,0)=" S DATETIM=$P(SDAPPT,""^"",16)"
^XTV(8991,48,1,2,1,742,0)=" S Y=DATETIM D DD^%DT S $P(SDAPPT,""^"",16)=Y"
^XTV(8991,48,1,2,1,743,0)=" S DATETIM=$P(SDAPPT,""^"",17)"
^XTV(8991,48,1,2,1,744,0)=" S Y=DATETIM D DD^%DT S $P(SDAPPT,""^"",17)=Y"
^XTV(8991,48,1,2,1,745,0)=" S DATETIM=$P(SDAPPT,""^"",19)"
^XTV(8991,48,1,2,1,746,0)=" S Y=DATETIM D DD^%DT S $P(SDAPPT,""^"",19)=Y"
^XTV(8991,48,1,2,1,747,0)=" S DATETIM=$P(SDAPPT,""^"",20)"
^XTV(8991,48,1,2,1,748,0)=" S Y=DATETIM D DD^%DT S $P(SDAPPT,""^"",20)=Y"
^XTV(8991,48,1,2,1,749,0)=" S DATETIM=$P(SDAPPT,""^"",21)"
^XTV(8991,48,1,2,1,750,0)=" S Y=DATETIM D DD^%DT S $P(SDAPPT,""^"",21)=Y"
^XTV(8991,48,1,2,1,751,0)=" S DATETIM=$P(SDAPPT,""^"",124)"
^XTV(8991,48,1,2,1,752,0)=" S Y=DATETIM D DD^%DT S $P(SDAPPT,""^"",24)=Y"
^XTV(8991,48,1,2,1,753,0)=" S DATETIM=$P(SDAPPT,""^"",25)"
^XTV(8991,48,1,2,1,754,0)=" S Y=DATETIM D DD^%DT S $P(SDAPPT,""^"",25)=Y"
^XTV(8991,48,1,2,1,755,0)=" ;"
^XTV(8991,48,1,2,1,756,0)=" ;"
^XTV(8991,48,1,2,1,757,0)=" D SET^HLOAPI(.SEG,""NTE"",0)"
^XTV(8991,48,1,2,1,758,0)=" ;TAKE OUT ""^"" AND REPLACE WITH ""#"" AS ""^"" IN NOT A CHARACTER"
^XTV(8991,48,1,2,1,759,0)=" ;THAT CAN BE USED IN HL7 DATA PART OF SEGMENT"
^XTV(8991,48,1,2,1,760,0)=" S TEMP8=SDAPPT"
^XTV(8991,48,1,2,1,761,0)=" D REPLACE(.TEMP8)"
^XTV(8991,48,1,2,1,762,0)=" S SDAPPT=TEMP8"
^XTV(8991,48,1,2,1,763,0)=" D SET^HLOAPI(.SEG,SDAPPT,3)"
^XTV(8991,48,1,2,1,764,0)=" ;"
^XTV(8991,48,1,2,1,765,0)=" ;; ADD SEGMENT"
^XTV(8991,48,1,2,1,766,0)=" I '$$ADDSEG^HLOAPI(.HLMSTATE,.SEG) S ERETURN=""NTE""_SDAPPT"
^XTV(8991,48,1,2,1,767,0)=" Q"
^XTV(8991,48,1,2,1,768,0)="REPLACE(TEMP8)"
^XTV(8991,48,1,2,1,769,0)=" N REST,LEN8,L8,PIEC8"
^XTV(8991,48,1,2,1,770,0)=" S REST=TEMP8"
^XTV(8991,48,1,2,1,771,0)=" S LEN8=$L(TEMP8)"
^XTV(8991,48,1,2,1,772,0)=" F  Q:REST=""""  D"
^XTV(8991,48,1,2,1,773,0)=" .S PIEC8=$P(TEMP8,""^"",1)"
^XTV(8991,48,1,2,1,774,0)=" .S L8=$L(PIEC8)+2"
^XTV(8991,48,1,2,1,775,0)=" .I L8>LEN8 D"
^XTV(8991,48,1,2,1,776,0)=" ..S REST="""" I $E(TEMP8,LEN8,LEN8)=""^"" S $E(TEMP8,LEN8,LEN8)=""#"""
^XTV(8991,48,1,2,1,777,0)=" .E  D"
^XTV(8991,48,1,2,1,778,0)=" ..S REST=$E(TEMP8,L8,LEN8)"
^XTV(8991,48,1,2,1,779,0)=" .I (PIEC8'="""")&(REST'="""") D"
^XTV(8991,48,1,2,1,780,0)=" ..S TEMP8=PIEC8_""#""_REST"
^XTV(8991,48,1,2,1,781,0)=" Q"
^XTV(8991,48,1,2,1,782,0)="ERRORW(X) ;ERROR SEGMENT (WITH ERETURN'=0,PATIENT,CLINIC,OR OTHER SDCOUNT ERROR )"
^XTV(8991,48,1,2,1,783,0)=" ;;CREATE SEGMENT"
^XTV(8991,48,1,2,1,784,0)=" ;"
^XTV(8991,48,1,2,1,785,0)=" N CONSTRUC,ERROR2"
^XTV(8991,48,1,2,1,786,0)=" S ERROR2="""""
^XTV(8991,48,1,2,1,787,0)=" D SET^HLOAPI(.SEG,""ERR"",0)"
^XTV(8991,48,1,2,1,788,0)=" ;"
^XTV(8991,48,1,2,1,789,0)=" S CONSTRUC=""ERETURN=""_ERETURN_"" ERROR=""_ERROR_""^""_"" IER=""_IER_"" SDCOUNT=""_SDCOUNT"
^XTV(8991,48,1,2,1,790,0)=" ;"
^XTV(8991,48,1,2,1,791,0)=" D SET^HLOAPI(.SEG,CONSTRUC,1)"
^XTV(8991,48,1,2,1,792,0)=" ;"
^XTV(8991,48,1,2,1,793,0)=" ;"
^XTV(8991,48,1,2,1,794,0)=" ;; ADD SEGMENT"
^XTV(8991,48,1,2,1,795,0)=" I '$$ADDSEG^HLOAPI(.HLMSTATE,.SEG) Q ""ERR"""
^XTV(8991,48,1,2,1,796,0)=" ;"
^XTV(8991,48,1,2,1,797,0)=" Q 0"
^XTV(8991,48,1,2,1,798,0)="MSGPROC ; ACK PROCESSING ROUTINE FOR NO RECEIVE ACKS, ETC FOR SDAPI AND MAKE APPOINTMENT API RETURN DATA "
^XTV(8991,48,1,2,1,799,0)=" Q"
^XTV(8991,48,1,2,1,800,0)="APPACKRR ;MAIN APPLICATION ACK RESPONSE FOR SDAPI AND MAKE APPOINTMENT API RETURN DATA "
^XTV(8991,48,1,2,1,801,0)=" Q"
^XTV(8991,48,1,2,1,802,0)=" "
^XTV(8991,48,1,"B",3070118.2244,1)=""
^XTV(8991,48,1,"B",3070118.2246,2)=""
^XTV(8991,49,0)="SDVWMKPI"
^XTV(8991,49,1,0)="^8991.01^1^1"
^XTV(8991,49,1,1,0)="3070118.2247"
^XTV(8991,49,1,1,1,0)="^8991.11^255^255"
^XTV(8991,49,1,1,1,1,0)="SDVWMKPI ;VOE/GW - ENHANCED MAKE AN APPOINTMENT SDAPI 11/18/06 ;1/18/07  22:46"
^XTV(8991,49,1,1,1,2,0)=" ;;5.3;Scheduling;**502**;Aug 13, 1993"
^XTV(8991,49,1,1,1,3,0)="EN(DFN,SD1,SC,STYP,SDARRAY) ;;;;;;Build 4"
^XTV(8991,49,1,1,1,4,0)=" ; MAKE AN APPOINTMENT"
^XTV(8991,49,1,1,1,5,0)=" ; INPUT"
^XTV(8991,49,1,1,1,6,0)=" ; "_$C(9,9)_"DFN PATIENT (REQUIRED)"
^XTV(8991,49,1,1,1,7,0)=" ; "_$C(9,9)_"SD1 APPOINTMENT DATE (REQUIRED)"
^XTV(8991,49,1,1,1,8,0)=" ; "_$C(9,9)_"SC CLINIC FOR APPOINTMENT (REQUIRED)"
^XTV(8991,49,1,1,1,9,0)=" ; "_$C(9,9)_"STYP (REQUIRED)"
^XTV(8991,49,1,1,1,10,0)=" ; "_$C(9,9)_"     =1  C&P"
^XTV(8991,49,1,1,1,11,0)=" ; "_$C(9,9)_"     =2  10-10"
^XTV(8991,49,1,1,1,12,0)=" ; "_$C(9,9)_"     =3 SCHEDULED APPOINTMENT  "
^XTV(8991,49,1,1,1,13,0)=" ; "_$C(9,9)_"     =4 UNSCHEDULED VISIT"
^XTV(8991,49,1,1,1,14,0)=" ;"
^XTV(8991,49,1,1,1,15,0)=" ;       SDARRAY(""DATE NOW"") (REQ AT TIME REQUEST MADE)"
^XTV(8991,49,1,1,1,16,0)=" ;"
^XTV(8991,49,1,1,1,17,0)=" ;       SDARRAY(""LAB DATE TIME ASSOCIATED"") = "
^XTV(8991,49,1,1,1,18,0)=" ;               """" OR DATE/TIME     (OPTIONAL)"
^XTV(8991,49,1,1,1,19,0)=" ;"
^XTV(8991,49,1,1,1,20,0)=" ;       SDARRAY(""X-RAY DATE TIME ASSOCIATED"") = "
^XTV(8991,49,1,1,1,21,0)=" ;               """" OR DATE/TIME    (OPTIONAL)"
^XTV(8991,49,1,1,1,22,0)=" ;               "
^XTV(8991,49,1,1,1,23,0)=" ;       SDARRAY(""EKG DATE TIME ASSOCIATED"") = "
^XTV(8991,49,1,1,1,24,0)=" ;               """" OR DATE/TIME     (OPTIONAL)"
^XTV(8991,49,1,1,1,25,0)=" ;"
^XTV(8991,49,1,1,1,26,0)=" ;       SDARRAY(""APPT TYPE"") = 9   (REQUIRED)"
^XTV(8991,49,1,1,1,27,0)=" ;              9 for REGULAR APPOINTMENT TYPE"
^XTV(8991,49,1,1,1,28,0)=" ;              ptr 409.1"
^XTV(8991,49,1,1,1,29,0)=" ;       SDARRAY(""APPT SUB-CATEGORY"") = ""0"" (NOT USED)"
^XTV(8991,49,1,1,1,30,0)=" ;              ""0"" for none"
^XTV(8991,49,1,1,1,31,0)=" ;              ptr 35.2"
^XTV(8991,49,1,1,1,32,0)=" ;"_$C(9)_"  "_$C(9,9)
^XTV(8991,49,1,1,1,33,0)=" ; "_$C(9,9)_"SDARRAY(""SCHED_REQ_TYPE"")='O' (REQUIRED)"
^XTV(8991,49,1,1,1,34,0)=" ; "_$C(9,9)_"       'O' FOR OTHER THAN 'NEXT AVA.' APPT.;"
^XTV(8991,49,1,1,1,35,0)=" ; "_$C(9,9)_"       set of codes"
^XTV(8991,49,1,1,1,36,0)=" ; "_$C(9,9)_"SDARRAY(""NEXT APPT IND"")=0 (REQUIRED)"
^XTV(8991,49,1,1,1,37,0)=" ; "_$C(9,9)_"        0 FOR NO"
^XTV(8991,49,1,1,1,38,0)=" ; "_$C(9,9)_"SDARRAY(""DESIRED DATE TIME OF APPT"")=SD (OPTIONAL)"
^XTV(8991,49,1,1,1,39,0)=" ; "_$C(9,9)_"SDARRAY(""FOLLOWUP VISIT INDICATOR"")= (REQUIRED)"
^XTV(8991,49,1,1,1,40,0)=" ; "_$C(9,9)_"        ""0"" FOR NO"
^XTV(8991,49,1,1,1,41,0)=" ; "_$C(9,9)_"        ""1"" FOR YES"
^XTV(8991,49,1,1,1,42,0)=" ; "_$C(9,9)
^XTV(8991,49,1,1,1,43,0)=" ; "_$C(9,9)
^XTV(8991,49,1,1,1,44,0)=" ; "_$C(9,9)_"        "
^XTV(8991,49,1,1,1,45,0)=" ; "_$C(9,9)_"SDARRAY(""X RAY DATA FREE TEXT"")=  (OPTIONAL)"
^XTV(8991,49,1,1,1,46,0)=" ; "_$C(9,9)_"SDARRAY(""OTHER DATA FREE TEXT"")=  (OPTIONAL)"
^XTV(8991,49,1,1,1,47,0)=" ; "_$C(9,9)_"SDARRAY(""OTHER WARD LOCATION"")=   (OPTIONAL)"
^XTV(8991,49,1,1,1,48,0)=" ; "_$C(9,9)
^XTV(8991,49,1,1,1,49,0)=" ; "_$C(9,9)_"        "
^XTV(8991,49,1,1,1,50,0)=" ; "_$C(9,9)_"SDARRAY(""DATA ENTRY CLERK"")=       (REQUIRED) "
^XTV(8991,49,1,1,1,51,0)=" ; "_$C(9,9)_"        DUZ OR NEW PERSON (FILE 200) PTR"
^XTV(8991,49,1,1,1,52,0)=" ; "_$C(9,9)
^XTV(8991,49,1,1,1,53,0)=" ; "_$C(9,9)_"SDARRAY(""PRIOR XRAY RESULTS TO CLINIC"")= (OPTIONAL)"
^XTV(8991,49,1,1,1,54,0)=" ; "_$C(9,9)_"         ""Y"" OR """""
^XTV(8991,49,1,1,1,55,0)=" ; "_$C(9,9)
^XTV(8991,49,1,1,1,56,0)=" ; "_$C(9,9)
^XTV(8991,49,1,1,1,57,0)=" ; "_$C(9,9)_"SDARRAY(""CHECKED-IN DATE"")=  (OPTIONAL)"
^XTV(8991,49,1,1,1,58,0)=" ; "_$C(9,9)_"      """" OR DATE APPOINTMENT MADE"
^XTV(8991,49,1,1,1,59,0)=" ; "_$C(9,9)_"      FOR AN UNSCHEDULED VISIT "
^XTV(8991,49,1,1,1,60,0)=" ; "_$C(9,9)_"      "
^XTV(8991,49,1,1,1,61,0)=" ; "_$C(9,9)_"XQSDVWSI ; EXIST AS NON-INTERACTIVE SILENT NODE W/O WRITE FOR XQOR ROUTINES"
^XTV(8991,49,1,1,1,62,0)=" ;       SDVWNVAI ; EXIST AS NON-VA RELATED PFSS EVENT MODE"
^XTV(8991,49,1,1,1,63,0)=" ;                                = ""D"" DISABLING THE NEED FOR ICN"
^XTV(8991,49,1,1,1,64,0)=" ;                                = ""O"" AS OTHER NON-VA ICN SYSTEM ( FUTURE)      "
^XTV(8991,49,1,1,1,65,0)=" ; "_$C(9,9)_"        "
^XTV(8991,49,1,1,1,66,0)=" ; "_$C(9,9)_"Q 1 OK,APPOINTMENT SUCCESSFULLY MADE "
^XTV(8991,49,1,1,1,67,0)=" ; "_$C(9,9)_"Q NEG NUMBER ERROR "
^XTV(8991,49,1,1,1,68,0)=" ;         -101 INVALID PATIENT DFN"
^XTV(8991,49,1,1,1,69,0)=" ;         -102 INVALID HOSPITAL LOCATION IEN (SC)"
^XTV(8991,49,1,1,1,70,0)=" ;         -103  SD1 < DATE NOW"
^XTV(8991,49,1,1,1,71,0)=" ;         -104 INVALID STYP "
^XTV(8991,49,1,1,1,72,0)=" ;         -105 I $G(SDARRAY(""DATE NOW""))=""""   "
^XTV(8991,49,1,1,1,73,0)=" ;         -106 I $G(SDARRAY(""APPT TYPE""))="""" "
^XTV(8991,49,1,1,1,74,0)=" ;         -107 I $G(SDARRAY(""SCHED_REQ_TYPE""))="""" "
^XTV(8991,49,1,1,1,75,0)=" ;         -108 I $G(SDARRAY(""NEXT APPT IND""))="""" "
^XTV(8991,49,1,1,1,76,0)=" ;         -109 I $G(SDARRAY(""DATA ENTRY CLERK""))="""""
^XTV(8991,49,1,1,1,77,0)=" ;         -110 I $G(SDARRAY(""FOLLOWUP VISIT INDICATOR"")=""""     "
^XTV(8991,49,1,1,1,78,0)=" ;         -111 NO SCHEDULED SLOT WHERE SCHED APPT IS WANTED"
^XTV(8991,49,1,1,1,79,0)=" N SD,TIMEDD"
^XTV(8991,49,1,1,1,80,0)=" N SDCL,SDT,SDDA,SDMODE,SDORG"
^XTV(8991,49,1,1,1,81,0)=" N AJJ3CNT,SDY,SDATE,DAYW,AJJ3ONE,AJJ3OVER,AJJ3VAL,MULTM,START,INCRM"
^XTV(8991,49,1,1,1,82,0)=" N TIMED,ILENT,AJJ3MATC,AJJ3OV2,AJJ3VAL2,TIMED"
^XTV(8991,49,1,1,1,83,0)=" N SDSL,SL,SDSDATESTARTDAY,D,SDHDL,SDEMP,SDMKHDL,SDMADE,SDLOCK,SDAPTYP,SDCOL"
^XTV(8991,49,1,1,1,84,0)=" ;"
^XTV(8991,49,1,1,1,85,0)=" N PURVISIT,SAVENOW,OVERBOOK,ELIGIB,OVERBOKM,AJJ3SAVE"
^XTV(8991,49,1,1,1,86,0)=" ;"
^XTV(8991,49,1,1,1,87,0)=" ;VALIDATE DFN, SC AS VALID PATIENTS AND CLINIC"
^XTV(8991,49,1,1,1,88,0)=" I '$D(^DPT(DFN,0)) Q -101"
^XTV(8991,49,1,1,1,89,0)=" I '$D(^SC(SC,0)) Q -102"
^XTV(8991,49,1,1,1,90,0)=" ;"
^XTV(8991,49,1,1,1,91,0)=" ;"
^XTV(8991,49,1,1,1,92,0)=" ;CHECK DATE>=NOW"
^XTV(8991,49,1,1,1,93,0)=" ;"
^XTV(8991,49,1,1,1,94,0)=" S SD=SD1"
^XTV(8991,49,1,1,1,95,0)=" S X=$G(SDARRAY(""DATE NOW"")) S SAVENOW=X"
^XTV(8991,49,1,1,1,96,0)=" I SD<SAVENOW Q -103"
^XTV(8991,49,1,1,1,97,0)=" I STYP=4 S SD=X"
^XTV(8991,49,1,1,1,98,0)=" ;FORMAT SD BELOW SHOULD BE FOUND IN NODE BELOW"
^XTV(8991,49,1,1,1,99,0)=" I $G(^SC(SC,""S"",SD,0))=SD D"
^XTV(8991,49,1,1,1,100,0)=" .S AJJ3CNT=0"
^XTV(8991,49,1,1,1,101,0)=" .;.F  S AJJ3CNT=$O(^SC(SC,""S"",DT,1,AJJ3CNT)) Q:AJJ3CNT=""""  D  "
^XTV(8991,49,1,1,1,102,0)=" .F  S AJJ3CNT=$O(^SC(SC,""S"",SD,1,AJJ3CNT)) Q:AJJ3CNT=""""  D  "
^XTV(8991,49,1,1,1,103,0)="    ..S SDY=AJJ3CNT+1"
^XTV(8991,49,1,1,1,104,0)="    E  D"
^XTV(8991,49,1,1,1,105,0)="    .;AJJ3CNT=SDY=1"
^XTV(8991,49,1,1,1,106,0)="    .S SDY=1"
^XTV(8991,49,1,1,1,107,0)="    I (STYP<1)!(STYP>4) Q -104"
^XTV(8991,49,1,1,1,108,0)="    ;"
^XTV(8991,49,1,1,1,109,0)=" ;CHECK OTHER REQUIRED VARIABLES"
^XTV(8991,49,1,1,1,110,0)=" I $G(SDARRAY(""DATE NOW""))=""""  Q -105"
^XTV(8991,49,1,1,1,111,0)=" I $G(SDARRAY(""APPT TYPE""))="""" Q -106"
^XTV(8991,49,1,1,1,112,0)=" I $G(SDARRAY(""SCHED_REQ_TYPE""))="""" Q -107"
^XTV(8991,49,1,1,1,113,0)=" I $G(SDARRAY(""NEXT APPT IND""))="""" Q -108"
^XTV(8991,49,1,1,1,114,0)=" I $G(SDARRAY(""DATA ENTRY CLERK""))="""" Q -109"
^XTV(8991,49,1,1,1,115,0)=" I $G(SDARRAY(""FOLLOWUP VISIT INDICATOR""))="""" Q -110"
^XTV(8991,49,1,1,1,116,0)=" ;"
^XTV(8991,49,1,1,1,117,0)=" ;"
^XTV(8991,49,1,1,1,118,0)=" ;"
^XTV(8991,49,1,1,1,119,0)="    S AJJ3OV2=0"
^XTV(8991,49,1,1,1,120,0)="    I STYP'=4 D"
^XTV(8991,49,1,1,1,121,0)="    .;BEFORE MAKE APPT"
^XTV(8991,49,1,1,1,122,0)="    .;THIS MAY ALSO DO CHECKIN AN APPOINTMENT"
^XTV(8991,49,1,1,1,123,0)="    .;ALSO NEED TO CHECK AGAINST SCHEDULE FOR THAT DAY"
^XTV(8991,49,1,1,1,124,0)="    .;DETERMINE LAST RELATIVE ENTRY # FOR "
^XTV(8991,49,1,1,1,125,0)=" .;THIS APPOINTMENT DATE ( IF ANY) ON THIS CLINIC"
^XTV(8991,49,1,1,1,126,0)=" .;"
^XTV(8991,49,1,1,1,127,0)="    .;TO SEE IF OVERBOOK MAX ACHIEVED OR APPOINTMENT NOT AVAILABLE"
^XTV(8991,49,1,1,1,128,0)="    .;FOR THAT TIME AND DATE."
^XTV(8991,49,1,1,1,129,0)="    .;GET DATE"
^XTV(8991,49,1,1,1,130,0)="    .S SDATE=SD\1"
^XTV(8991,49,1,1,1,131,0)="    .S TIMED=$P(SD,""."",2)"
^XTV(8991,49,1,1,1,132,0)="    .S ILENT=$L(TIMED)"
^XTV(8991,49,1,1,1,133,0)="    .F  Q:ILENT=4  D"
^XTV(8991,49,1,1,1,134,0)="    ..S TIMED=TIMED_""0"" S ILENT=$L(TIMED) ;PAD OUT TIME TO 4 DIGITS"
^XTV(8991,49,1,1,1,135,0)="    .;W !,""TIMED="",TIMED"
^XTV(8991,49,1,1,1,136,0)="    .;CHECK WHAT MULTIPLE OF DAY OF WEEK FOR APPOINTMENT START"
^XTV(8991,49,1,1,1,137,0)="    .;GET DAY OF WEEK"
^XTV(8991,49,1,1,1,138,0)="    .S X=SDATE"
^XTV(8991,49,1,1,1,139,0)="    .D DW^%DTC"
^XTV(8991,49,1,1,1,140,0)="    .I X'="""" D"
^XTV(8991,49,1,1,1,141,0)="    ..S DAYW=$E(X,1,2)"
^XTV(8991,49,1,1,1,142,0)="    ..;W !,""DAYW="",X"
^XTV(8991,49,1,1,1,143,0)="    ..S AJJ3ONE=0"
^XTV(8991,49,1,1,1,144,0)="    ..S AJJ3OVER=0"
^XTV(8991,49,1,1,1,145,0)="    ..;FIND DAY OF WEEK ENTRY IN ""ST"" MULT , THEN FIND STARTING TIME AND "
^XTV(8991,49,1,1,1,146,0)="    ..;TIME MATCH IN SAME ""T"" MULT."
^XTV(8991,49,1,1,1,147,0)="    ..S AJJ3MATC=0"
^XTV(8991,49,1,1,1,148,0)="    ..F  S AJJ3ONE=$O(^SC(SC,""ST"",AJJ3ONE)) Q:(AJJ3ONE="""")!(AJJ3OVER'=0)  D"
^XTV(8991,49,1,1,1,149,0)="    ...S AJJ3VAL=$G(^SC(SC,""ST"",AJJ3ONE,1)) S X2=AJJ3ONE S X1=SDATE D ^%DTC S SDIFF=X I ($E(AJJ3VAL,1,2)=DAYW)&(SDIFF'<0) S AJJ3SAVE=AJJ3ONE I $$CHKAVAIL(AJJ3SAVE,SD) S AJJ3OVER=AJJ3ONE"
^XTV(8991,49,1,1,1,150,0)="    ...;W !,""AJJ3VAL="",AJJ3VAL,"" AJJ3ONE="",AJJ3ONE,"" SDATE="",SDATE,"" SDIFF="",SDIFF"
^XTV(8991,49,1,1,1,151,0)="    ...I AJJ3OVER'=0 D"
^XTV(8991,49,1,1,1,152,0)="    ....S AJJ3INCR=0"
^XTV(8991,49,1,1,1,153,0)="    ....F  S AJJ3INCR=$O(^SC(SC,""T"",AJJ3OVER,2,AJJ3INCR)) Q:(AJJ3INCR="""")!(AJJ3OV2=1)  D"
^XTV(8991,49,1,1,1,154,0)="    .....S AJJ3VAL2=$G(^SC(SC,""T"",AJJ3OVER,2,AJJ3INCR,0)) S AJJ3VAL2=$P(AJJ3VAL2,""^"",1) I AJJ3VAL2=TIMED  S AJJ3OV2=1"
^XTV(8991,49,1,1,1,155,0)="    ..I AJJ3OV2'=0 D"
^XTV(8991,49,1,1,1,156,0)="    ...;NOW CHECK IN ""S"" ARRAY TO SEE IF APPT ALREADY MADE"
^XTV(8991,49,1,1,1,157,0)="    ...I SDY'=1 D"
^XTV(8991,49,1,1,1,158,0)="    ....;CHECK IF OVERBOOKS ALLOWED"
^XTV(8991,49,1,1,1,159,0)="    ....I $P($G(^SC(SC,""SL"")),""^"",7)=0 S AJJ3OV2=0"
^XTV(8991,49,1,1,1,160,0)="    .E  D"
^XTV(8991,49,1,1,1,161,0)="    ..S AJJ3OV2=0"
^XTV(8991,49,1,1,1,162,0)="    E  D"
^XTV(8991,49,1,1,1,163,0)="    .;ALSO "
^XTV(8991,49,1,1,1,164,0)="    .S AJJ3OV2=1"
^XTV(8991,49,1,1,1,165,0)="   I AJJ3OV2'=0 D"
^XTV(8991,49,1,1,1,166,0)="    .;"
^XTV(8991,49,1,1,1,167,0)="    .;D NOW^%DTC S X2=X\1 S SAVENOW=X S X1=SDATE D ^%DTC IF X<0 S AJJ3OV2=0"
^XTV(8991,49,1,1,1,168,0)="    .D"
^XTV(8991,49,1,1,1,169,0)="    ..S SDCL=SC"
^XTV(8991,49,1,1,1,170,0)="    ..S SDT=SD"
^XTV(8991,49,1,1,1,171,0)="    ..S SDDA=SDY"
^XTV(8991,49,1,1,1,172,0)="    ..S SDMODE=2"
^XTV(8991,49,1,1,1,173,0)="    ..S SDORG=1"
^XTV(8991,49,1,1,1,174,0)="    ..;ADDITIONAL"
^XTV(8991,49,1,1,1,175,0)="    ..;S SDSL=$P(^SC(SC,""SL""),""^"",1) S SL=SDSL S SDXSCAT=0"
^XTV(8991,49,1,1,1,176,0)="    ..S SL=$P(^SC(SC,""SL""),""^"",1) "
^XTV(8991,49,1,1,1,177,0)="    ..S SDSDATE=SD "
^XTV(8991,49,1,1,1,178,0)="    ..;S STARTDAY"
^XTV(8991,49,1,1,1,179,0)="    ..;"
^XTV(8991,49,1,1,1,180,0)="    ..;START PREPARING DATA FROM SDARRAY INTO NODES"
^XTV(8991,49,1,1,1,181,0)="    ..;"
^XTV(8991,49,1,1,1,182,0)="    ..;FIRST INITIAL TOP NODE FOR APPOINTMENT SUB-FILE"
^XTV(8991,49,1,1,1,183,0)="    ..S ^DPT(DFN,""S"",0)=""^2.98P^^"""
^XTV(8991,49,1,1,1,184,0)="    ..L +^DPT(DFN,""S"",0):5"
^XTV(8991,49,1,1,1,185,0)="    ..;NEXT NODE 0"
^XTV(8991,49,1,1,1,186,0)="    ..S PURVISIT=STYP"
^XTV(8991,49,1,1,1,187,0)="    ..S TIMEDD=$P(SD,""."",1)"
^XTV(8991,49,1,1,1,188,0)="    ..S ^DPT(DFN,""S"",SD,0)=SC_""^^""_$G(SDARRAY(""LAB DATE TIME ASSOCIATED""))_""^""_$G(SDARRAY(""X-RAY DATE TIME ASSOCIATED""))_""^""_$G(SDARRAY(""EKG DATE TIME ASSOCIATED""))"
^XTV(8991,49,1,1,1,189,0)="    ..S ^DPT(DFN,""S"",SD,0)=^DPT(DFN,""S"",SD,0)_""^^""_PURVISIT_""^^^^^^^^^""_$G(SDARRAY(""APPT TYPE""))_""^^^""_TIMEDD_""^^^^^""_0"
^XTV(8991,49,1,1,1,190,0)="    ..S ^DPT(DFN,""S"",SD,0)=^DPT(DFN,""S"",SD,0)_""^""_$G(SDARRAY(""SCHED_REQ_TYPE""))_""^""_$G(SDARRAY(""NEXT APPT IND""))"
^XTV(8991,49,1,1,1,191,0)="    ..;NEXT NODE 1"
^XTV(8991,49,1,1,1,192,0)="    ..I $G(SDARRAY(""DESIRED DATE TIME OF APPT""))'="""" D "
^XTV(8991,49,1,1,1,193,0)="    ...S ^DPT(DFN,""S"",SD,1)=$G(SDARRAY(""DESIRED DATE TIME OF APPT""))_""^""_$G(SDARRAY(""FOLLOWUP VISIT INDICATOR""))  "
^XTV(8991,49,1,1,1,194,0)="    ..E  D"
^XTV(8991,49,1,1,1,195,0)="    ...;"
^XTV(8991,49,1,1,1,196,0)="    ...S ^DPT(DFN,""S"",SD,1)=TIMEDD_""^""_$G(SDARRAY(""FOLLOWUP VISIT INDICATOR""))   "
^XTV(8991,49,1,1,1,197,0)="    ..L -^DPT(DFN,""S"",0)"
^XTV(8991,49,1,1,1,198,0)="    ..;NOW FILE 44 MULTIPLE IN APPOINTMENT SUB-FILE"
^XTV(8991,49,1,1,1,199,0)="    ..;FIRST  TOP NODE IN CLINIC FOR DATE"
^XTV(8991,49,1,1,1,200,0)="    ..S ^SC(SC,""S"",0)=""^44.001DA^^"""
^XTV(8991,49,1,1,1,201,0)="    ..L +^SC(SC,""S"",0):5"
^XTV(8991,49,1,1,1,202,0)="    ..;NEXT DATE MULTIPLE"
^XTV(8991,49,1,1,1,203,0)="    ..S ^SC(SC,""S"",SD,0)=SD"
^XTV(8991,49,1,1,1,204,0)="    ..;NEXT TOP NODE UNDER DATE FOR PATIENT"
^XTV(8991,49,1,1,1,205,0)="    ..S ^SC(SC,""S"",SD,1,0)=""^44.003PA^^"""
^XTV(8991,49,1,1,1,206,0)="    ..;NEXT MULTIPLE ENTRY PER PATIENT"
^XTV(8991,49,1,1,1,207,0)="    ..S ^SC(SC,""S"",SD,1,SDY,0)=DFN_""^""_SL_""^""_$G(SDARRAY(""X RAY DATA FREE TEXT""))_""^""_$G(SDARRAY(""OTHER DATA FREE TEXT""))_""^""_$G(SDARRAY(""OTHER WARD LOCATION"")) "
^XTV(8991,49,1,1,1,208,0)="    ..S ^SC(SC,""S"",SD,1,SDY,0)=^SC(SC,""S"",SD,1,SDY,0)_""^""_$G(SDARRAY(""DATA ENTRY CLERK""))_""^""_SAVENOW"
^XTV(8991,49,1,1,1,209,0)="    ..I STYP=4 S ^SC(SC,""S"",SD,1,SDY,0)=^SC(SC,""S"",SD,1,SDY,0)_""^""_$G(SDARRAY(""PRIOR X-RAY RESULTS TO CLINIC""))"
^XTV(8991,49,1,1,1,210,0)="    ..;DETERMINE ANY OVERBOOK AND ELIGIBILITY HERE"
^XTV(8991,49,1,1,1,211,0)="    ..;"
^XTV(8991,49,1,1,1,212,0)="    ..S OVERBOKM=$P(^SC(SC,""SL""),""^"",7)"
^XTV(8991,49,1,1,1,213,0)="    ..I SDY>OVERBOKM D"
^XTV(8991,49,1,1,1,214,0)="    ...S OVERBOOK=""O"""
^XTV(8991,49,1,1,1,215,0)="    ...S ^SC(SC,""S"",SD,1,SDY,""OB"")=""0"""
^XTV(8991,49,1,1,1,216,0)="    ..E  D"
^XTV(8991,49,1,1,1,217,0)="    ...S OVERBOOK="""""
^XTV(8991,49,1,1,1,218,0)="    ..;ELIGIBILITY NEXT"
^XTV(8991,49,1,1,1,219,0)="    ..D ELIG^VADPT S ELIGIB=$P(VAEL(1),""^"",1)"
^XTV(8991,49,1,1,1,220,0)="    ..IF STYP=4 S ^SC(SC,""S"",SD,1,SDY,0)=^SC(SC,""S"",SD,1,SDY,0)_""^""_""^""_""^""_ELIGIB"
^XTV(8991,49,1,1,1,221,0)="    ..;NOW UNSCHEDULED VISITS EXTRA DATA"
^XTV(8991,49,1,1,1,222,0)="    ..;REALLY LATER MAY NEED ELIGIBILITY FOR NON-VA SYSTEMS PATIENTS WITH"
^XTV(8991,49,1,1,1,223,0)="    ..;SCHEDULED APPTS AND UNSCHEDULED VISITS ( HUMANITARIAN, REIMBURSABLE INSURANCE, ETC)"
^XTV(8991,49,1,1,1,224,0)="    ..I STYP=4 D"
^XTV(8991,49,1,1,1,225,0)="    ...S ^SC(SC,""S"",SD,1,SDY,""C"")=SD_""^""_$G(SDARRAY(""DATA ENTRY CLERK""))_""^^^""_SD"
^XTV(8991,49,1,1,1,226,0)="    ..L -^SC(SC,""S"",0)"
^XTV(8991,49,1,1,1,227,0)="    ..;EVENT GENERATION ALSO FOR PFSS SYSTEM WHICH CAN BE USED WITH AN EXTERNAL SCHEDULING SYSTEM"
^XTV(8991,49,1,1,1,228,0)="    ..;FOR MAKE APPT EVENTS AS WELL AS CHECKIN,CHECKOUT,CANCEL,DELETE, AND OUTPATIENT ENCOUNTER DATA"
^XTV(8991,49,1,1,1,229,0)="    ..D MAKE^SDAMEVT(DFN,SDT,SDCL,SDDA,SDMODE)"
^XTV(8991,49,1,1,1,230,0)="    E  Q -111"
^XTV(8991,49,1,1,1,231,0)="    Q 1"
^XTV(8991,49,1,1,1,232,0)="CHKAVAIL(AJJ3SAVE,SD) ;"
^XTV(8991,49,1,1,1,233,0)="    N SL,AJJ3VAL,DATE,STARTTIM,TIMED,ILENT,SL,POS,COUNT"
^XTV(8991,49,1,1,1,234,0)=" ;CHECK IF SLOT ALLOWED FOR THAT DAY/TIME SLOT"
^XTV(8991,49,1,1,1,235,0)=" S SL=$P($G(^SC(SC,""SL"")),""^"",1) ;LENGTH OF APPT"
^XTV(8991,49,1,1,1,236,0)=" S AJJ3VAL=$G(^SC(SC,""ST"",AJJ3SAVE,1))"
^XTV(8991,49,1,1,1,237,0)=" ;START AT 9TH PIECE TO SEE IF NON-BLANK"
^XTV(8991,49,1,1,1,238,0)=" ;FORMAT DATE+STARTTIME"
^XTV(8991,49,1,1,1,239,0)=" S STARTTIM=$P($G(^SC(SC,""SL"")),""^"",3) ;STARTIM"
^XTV(8991,49,1,1,1,240,0)=" I $L(STARTTIM)=1 S STARTTIM=""0""_STARTTIM"
^XTV(8991,49,1,1,1,241,0)=" ;0 PAD TO 4 DIGITS STARTTIM"
^XTV(8991,49,1,1,1,242,0)=" S ILENT=$L(STARTTIM)"
^XTV(8991,49,1,1,1,243,0)="    F  Q:ILENT=4  D"
^XTV(8991,49,1,1,1,244,0)="    .S STARTTIM=STARTTIM_""0"" S ILENT=$L(STARTTIM) ;PAD OUT TIME TO 4 DIGITS"
^XTV(8991,49,1,1,1,245,0)=" S TIMED=$P(SD,""."",2)"
^XTV(8991,49,1,1,1,246,0)="    S ILENT=$L(TIMED)"
^XTV(8991,49,1,1,1,247,0)="    F  Q:ILENT=4  D"
^XTV(8991,49,1,1,1,248,0)="    .S TIMED=TIMED_""0"" S ILENT=$L(TIMED) ;PAD OUT TIME TO 4 DIGITS"
^XTV(8991,49,1,1,1,249,0)="    S DIFF=TIMED-STARTTIM"
^XTV(8991,49,1,1,1,250,0)="    S SL=$P(^SC(SC,""SL""),""^"",1)"
^XTV(8991,49,1,1,1,251,0)="    S COUNT=DIFF/SL"
^XTV(8991,49,1,1,1,252,0)="    S POS=9+2*COUNT "
^XTV(8991,49,1,1,1,253,0)="    I $E(AJJ3VAL,POS,POS)'="" "" Q 1"
^XTV(8991,49,1,1,1,254,0)=" Q 0"
^XTV(8991,49,1,1,1,255,0)=" "
^XTV(8991,49,1,"B",3070118.2247,1)=""
^XTV(8991,50,0)="SDVWTEST"
^XTV(8991,50,1,0)="^8991.01^1^1"
^XTV(8991,50,1,1,0)="3070118.2247"
^XTV(8991,50,1,1,1,0)="^8991.11^316^316"
^XTV(8991,50,1,1,1,1,0)="SDVWTEST ;VOE/GW - VWSD VOE SDAPI AND MAKE APPOINTMENT Test Exercises  ;1/18/07  22:47"
^XTV(8991,50,1,1,1,2,0)=" ;;5.3;Scheduling;**502**;Aug 13, 1993"
^XTV(8991,50,1,1,1,3,0)=" N SDARRAY,SDCOUNT,SDDFN,SDDATE,SDAPPT,SDPAT,SDPATNAM,SDSTATUS"
^XTV(8991,50,1,1,1,4,0)=" N SDDATEP "
^XTV(8991,50,1,1,1,5,0)="EN1 ;"
^XTV(8991,50,1,1,1,6,0)=" S SDARRAY(1)=""3061106;3061109"" "
^XTV(8991,50,1,1,1,7,0)=" S SDARRAY(2)=6 ;""VWVOE RADIOLOGY CLINIC"""
^XTV(8991,50,1,1,1,8,0)=" S SDARRAY(""FLDS"")=""4;3"" "
^XTV(8991,50,1,1,1,9,0)=" S SDCOUNT=$$SDAPI^SDAMA301(.SDARRAY) "
^XTV(8991,50,1,1,1,10,0)=" I SDCOUNT>0 D "
^XTV(8991,50,1,1,1,11,0)=" . ;get patient "
^XTV(8991,50,1,1,1,12,0)=" . S SDDFN=0 F  S SDDFN=$O(^TMP($J,""SDAMA301"",6,SDDFN)) Q:SDDFN=""""  D "
^XTV(8991,50,1,1,1,13,0)=" .. ;get appointment date/time "
^XTV(8991,50,1,1,1,14,0)=" .. S SDDATE=0 "
^XTV(8991,50,1,1,1,15,0)=" ..F  S SDDATE=$O(^TMP($J,""SDAMA301"",6,SDDFN,SDDATE)) Q:SDDATE=""""  D "
^XTV(8991,50,1,1,1,16,0)=" ...S SDAPPT=$G(^TMP($J,""SDAMA301"",6,SDDFN,SDDATE)) ;appointment data"
^XTV(8991,50,1,1,1,17,0)=" ...S SDSTATUS=$P($G(SDAPPT),""^"",3) ;appointment status "
^XTV(8991,50,1,1,1,18,0)=" ...S SDPAT=$P($G(SDAPPT),""^"",4) ;patient DFN and Name "
^XTV(8991,50,1,1,1,19,0)=" ...S SDPATNAM=$P($G(SDPAT),"";"",2) ;patient Name only "
^XTV(8991,50,1,1,1,20,0)=" ...;continue processing this appointment as needed "
^XTV(8991,50,1,1,1,21,0)=" ...S Y=SDDATE X ^DD(""DD"") S SDDATEP=Y"
^XTV(8991,50,1,1,1,22,0)=" ...W !,""RADIOLOGY CLINIC "",""PATIENT: "",SDPATNAM,"" DATE/TIME: "",SDDATEP,"" STATUS="",SDSTATUS "
^XTV(8991,50,1,1,1,23,0)=" I SDCOUNT<0 D "
^XTV(8991,50,1,1,1,24,0)=" . W !,""SDCOUNT="",SDCOUNT ; do processing for errors 101 and 116 "
^XTV(8991,50,1,1,1,25,0)=" ; when finished with all processing, kill the output array "
^XTV(8991,50,1,1,1,26,0)=" I SDCOUNT'=0 K ^TMP($J,""SDAMA301"")"
^XTV(8991,50,1,1,1,27,0)=" Q"
^XTV(8991,50,1,1,1,28,0)="EN2 ;"
^XTV(8991,50,1,1,1,29,0)=" N SDARRAY,SDCOUNT,SDCLIEN,SDDATE,SDAPPT,SDSTATUS,SDCLINFO,SDCLNAME "
^XTV(8991,50,1,1,1,30,0)=" N SDDATEP "
^XTV(8991,50,1,1,1,31,0)=" S SDARRAY(1)=""3061105;3061114"""
^XTV(8991,50,1,1,1,32,0)=" S SDARRAY(3)=""R;I"" "
^XTV(8991,50,1,1,1,33,0)=" S SDARRAY(4)=1 ;ZZ PATIENT,TEST ONE"
^XTV(8991,50,1,1,1,34,0)=" S SDARRAY(""MAX"")=3 "
^XTV(8991,50,1,1,1,35,0)=" S SDARRAY(""FLDS"")=""1;2;3"" "
^XTV(8991,50,1,1,1,36,0)=" S SDCOUNT=$$SDAPI^SDAMA301(.SDARRAY)"
^XTV(8991,50,1,1,1,37,0)=" I SDCOUNT>0 D "
^XTV(8991,50,1,1,1,38,0)=" . ;get clinic "
^XTV(8991,50,1,1,1,39,0)=" . S SDCLIEN=0 F  S SDCLIEN=$O(^TMP($J,""SDAMA301"",1,SDCLIEN)) Q:SDCLIEN=""""  D "
^XTV(8991,50,1,1,1,40,0)=" .. ;get appointment date/time "
^XTV(8991,50,1,1,1,41,0)=" .. S SDDATE=0 F  S SDDATE=$O(^TMP($J,""SDAMA301"",1,SDCLIEN,SDDATE)) Q:SDDATE=""""  D "
^XTV(8991,50,1,1,1,42,0)=" ... S SDAPPT=$G(^TMP($J,""SDAMA301"",1,SDCLIEN,SDDATE)) ;appointment data "
^XTV(8991,50,1,1,1,43,0)=" ... S SDSTATUS=$P(SDAPPT,""^"",3) ;appt status "
^XTV(8991,50,1,1,1,44,0)=" ... S SDCLINFO=$P(SDAPPT,""^"",2) ;clinic IEN and Name "
^XTV(8991,50,1,1,1,45,0)=" ... S SDCLNAME=$P(SDCLINFO,"";"",2) ;clinic Name only "
^XTV(8991,50,1,1,1,46,0)=" ... S Y=SDDATE X ^DD(""DD"") S SDDATEP=Y"
^XTV(8991,50,1,1,1,47,0)=" ... ;continue processing this appointment as needed"
^XTV(8991,50,1,1,1,48,0)=" ... W !,""ZZ PATIENT,TEST ONE "",""CLINIC: "",SDCLNAME,"" DATE/TIME: "",SDDATEP,"" STATUS="",SDSTATUS  "
^XTV(8991,50,1,1,1,49,0)=" I SDCOUNT<0 D "
^XTV(8991,50,1,1,1,50,0)=" .W !,""SDCOUNT="",SDCOUNT ;  ;do processing for errors 101 and 116 "
^XTV(8991,50,1,1,1,51,0)=" ; when finished with all processing, kill output array "
^XTV(8991,50,1,1,1,52,0)=" I SDCOUNT'=0 K ^TMP($J,""SDAMA301"")"
^XTV(8991,50,1,1,1,53,0)=" Q"
^XTV(8991,50,1,1,1,54,0)="EN3 ;"
^XTV(8991,50,1,1,1,55,0)=" N SDARRAY,SDCOUNT,SDDATE,SDAPPT,SDCRSTOP"
^XTV(8991,50,1,1,1,56,0)=" N SDATEP,SDCREDIN,SDCREDIT "
^XTV(8991,50,1,1,1,57,0)=" S SDARRAY(1)=""3061101;3061130"" "
^XTV(8991,50,1,1,1,58,0)=" S SDARRAY(2)=3   ;VWVOE DR. PHYSICIAN CLINIC "
^XTV(8991,50,1,1,1,59,0)=" S SDARRAY(4)=1  ;ZZ PATIENT,TEST ONE"
^XTV(8991,50,1,1,1,60,0)=" S SDARRAY(""FLDS"")=""1;14;16"" "
^XTV(8991,50,1,1,1,61,0)=" S SDCOUNT=$$SDAPI^SDAMA301(.SDARRAY) "
^XTV(8991,50,1,1,1,62,0)=" I SDCOUNT>0 D"
^XTV(8991,50,1,1,1,63,0)=" . ; GET APPOINTMENT DATA "
^XTV(8991,50,1,1,1,64,0)=" . S SDDATE=0 F  S SDDATE=$O(^TMP($J,""SDAMA301"",1,3,SDDATE)) Q:SDDATE=""""  D "
^XTV(8991,50,1,1,1,65,0)=" .. S SDAPPT=$G(^TMP($J,""SDAMA301"",1,3,SDDATE)) ;appointment data "
^XTV(8991,50,1,1,1,66,0)=" .. S SDCREDIT=$P(SDAPPT,""^"",14) ;credit stop code IEN"
^XTV(8991,50,1,1,1,67,0)=" .. S SDCREDIT=$P(SDCREDIT,"";"",1)"
^XTV(8991,50,1,1,1,68,0)=" .. S SDCREDIN=$P($G(^DIC(40.7,SDCREDIT,0)),""^"",1) "
^XTV(8991,50,1,1,1,69,0)=" .. I $G(SDCREDIT)'="";"" S SDCRIEN=$P(SDCREDIT,"";"",1) ;credit stop code IEN only "
^XTV(8991,50,1,1,1,70,0)=" .. S Y=SDDATE X ^DD(""DD"") S SDDATEP=Y"
^XTV(8991,50,1,1,1,71,0)=" .. W !,""ZZ PATIENT,TEST ONE "",""CLINIC: "",""VWVOE DR. PHYSICIAN CLINIC"","" DATE/TIME: "",SDDATEP,"" CREDIT STOP="",SDCREDIN  "
^XTV(8991,50,1,1,1,72,0)=" .. ;continue processing this appointment as needed "
^XTV(8991,50,1,1,1,73,0)=" I SDCOUNT<0 D "
^XTV(8991,50,1,1,1,74,0)=" . W !,""SDCOUNT="",SDCOUNT ; ;do processing for errors 101 and 116 "
^XTV(8991,50,1,1,1,75,0)=" ; when finished with all processing, kill output array "
^XTV(8991,50,1,1,1,76,0)=" I SDCOUNT'=0 K ^TMP($J,""SDAMA301"")"
^XTV(8991,50,1,1,1,77,0)=" Q"
^XTV(8991,50,1,1,1,78,0)="EN4 ;"
^XTV(8991,50,1,1,1,79,0)=" N SDARRAY,SDCOUNT,SDCLIEN,SDDFN,SDDATE,SDAPPT,SDSTATUS "
^XTV(8991,50,1,1,1,80,0)=" N SDATEP,SDCREDIN,SDCREDIT"
^XTV(8991,50,1,1,1,81,0)=" S SDARRAY(1)=""3061101;3061130"" "
^XTV(8991,50,1,1,1,82,0)=" S SDARRAY(13)=323 "
^XTV(8991,50,1,1,1,83,0)=" S SDARRAY(""FLDS"")=""3;13;16"" "
^XTV(8991,50,1,1,1,84,0)=" S SDCOUNT=$$SDAPI^SDAMA301(.SDARRAY) "
^XTV(8991,50,1,1,1,85,0)=" I SDCOUNT>0 D "
^XTV(8991,50,1,1,1,86,0)=" . ;get clinic "
^XTV(8991,50,1,1,1,87,0)=" . S SDCLIEN=0 F  S SDCLIEN=$O(^TMP($J,""SDAMA301"",SDCLIEN)) Q:SDCLIEN=""""  D "
^XTV(8991,50,1,1,1,88,0)=" .. ;get patient "
^XTV(8991,50,1,1,1,89,0)=" .. S SDDFN=0 F  S SDDFN=$O(^TMP($J,""SDAMA301"",SDCLIEN,SDDFN)) Q:SDDFN=""""  D "
^XTV(8991,50,1,1,1,90,0)=" ... ;get appointment date/time "
^XTV(8991,50,1,1,1,91,0)=" ... S SDDATE=0 F  S SDDATE=$O(^TMP($J,""SDAMA301"",SDCLIEN,SDDFN,SDDATE)) Q:SDDATE=""""  D "
^XTV(8991,50,1,1,1,92,0)=" ....S SDSTATUS=$P($G(^TMP($J,""SDAMA301"",SDCLIEN,SDDFN,SDDATE)),""^"",3) ;appointment status "
^XTV(8991,50,1,1,1,93,0)=" ....S SDAPPT=$G(^TMP($J,""SDAMA301"",SDCLIEN,SDDFN,SDDATE)) ;appointment data "
^XTV(8991,50,1,1,1,94,0)=" ....S SDCREDIT=$P(SDAPPT,""^"",13) ;credit stop code IEN"
^XTV(8991,50,1,1,1,95,0)=" .... S SDCREDIT=$P(SDCREDIT,"";"",1)"
^XTV(8991,50,1,1,1,96,0)=" .... S SDCREDIN=$P($G(^DIC(40.7,SDCREDIT,0)),""^"",1) "
^XTV(8991,50,1,1,1,97,0)=" .... I $G(SDCREDIT)'="";"" S SDCRIEN=$P(SDCREDIT,"";"",1) ;credit stop code IEN only "
^XTV(8991,50,1,1,1,98,0)=" .... S Y=SDDATE X ^DD(""DD"") S SDDATEP=Y"
^XTV(8991,50,1,1,1,99,0)=" .... ;continue processing this appointment as needed "
^XTV(8991,50,1,1,1,100,0)=" .... W !,""CLINIC: "",$P($G(^SC(SDCLIEN,0)),""^"",1),"" PATIENT: "",$P($G(^DPT(SDDFN,0)),""^"",1),"" DATE/TIME: "",SDDATEP,"" STATUS: "",SDSTATUS,"" STOP CODE="",SDCREDIN  "
^XTV(8991,50,1,1,1,101,0)=" I SDCOUNT<0 D "
^XTV(8991,50,1,1,1,102,0)=" . ;do processing for errors 101 and 116 "
^XTV(8991,50,1,1,1,103,0)=" . W !,""SDCOUNT="",SDCOUNT ;  "
^XTV(8991,50,1,1,1,104,0)=" ; when finished with all processing, kill output array "
^XTV(8991,50,1,1,1,105,0)=" I SDCOUNT'=0 K ^TMP($J,""SDAMA301"") "
^XTV(8991,50,1,1,1,106,0)=" Q"
^XTV(8991,50,1,1,1,107,0)="EN5 ;"_$C(9)
^XTV(8991,50,1,1,1,108,0)=" N SDARRAY,SDCOUNT,SDDFN,SDDATE,SDAPPT,SDPAT,SDPATNAM,SDSTATUS "
^XTV(8991,50,1,1,1,109,0)=" N SDATEP"
^XTV(8991,50,1,1,1,110,0)=" S SDARRAY(1)=""3061107;3061107"" "
^XTV(8991,50,1,1,1,111,0)=" S SDARRAY(2)=4    ; VWVOE PSYCHIATRIC CLINIC "
^XTV(8991,50,1,1,1,112,0)=" S SDARRAY(""SORT"")=""P"" "
^XTV(8991,50,1,1,1,113,0)=" S SDARRAY(""FLDS"")=""4;3"" ;order is irrelevant "
^XTV(8991,50,1,1,1,114,0)=" S SDCOUNT=$$SDAPI^SDAMA301(.SDARRAY) "
^XTV(8991,50,1,1,1,115,0)=" I SDCOUNT>0 D "
^XTV(8991,50,1,1,1,116,0)=" . ;get patient "
^XTV(8991,50,1,1,1,117,0)=" . S SDDFN=0 F  S SDDFN=$O(^TMP($J,""SDAMA301"",SDDFN)) Q:SDDFN=""""  D "
^XTV(8991,50,1,1,1,118,0)=" .. ;get appointment date/time "
^XTV(8991,50,1,1,1,119,0)=" .. S SDDATE=0 F  S SDDATE=$O(^TMP($J,""SDAMA301"",SDDFN,SDDATE)) Q:SDDATE=""""  D "
^XTV(8991,50,1,1,1,120,0)=" ... S SDAPPT=$G(^TMP($J,""SDAMA301"",SDDFN,SDDATE)) ;appointment data "
^XTV(8991,50,1,1,1,121,0)=" ... S SDSTATUS=$P($G(SDAPPT),""^"",3) ;appointment status "
^XTV(8991,50,1,1,1,122,0)=" ... S SDPAT=$P($G(SDAPPT),""^"",4) ;patient DFN and Name "
^XTV(8991,50,1,1,1,123,0)=" ... S SDPATNAM=$P($G(SDPAT),"";"",2) ;patient Name only "
^XTV(8991,50,1,1,1,124,0)=" ... S Y=SDDATE X ^DD(""DD"") S SDDATEP=Y"
^XTV(8991,50,1,1,1,125,0)=" ... ;continue processing this appointment as needed "
^XTV(8991,50,1,1,1,126,0)=" ... W !,""CLINIC: "",""VWVOE PSYCHIATRIC CLINIC"","" PATIENT: "",SDPATNAM,"" DATE/TIME: "",SDDATEP,"" STATUS: "",SDSTATUS "
^XTV(8991,50,1,1,1,127,0)=" I SDCOUNT<0 D "
^XTV(8991,50,1,1,1,128,0)=" . W !,""SDCOUNT="",SDCOUNT ; "
^XTV(8991,50,1,1,1,129,0)=" . ;do processing for errors 101 and 116 "
^XTV(8991,50,1,1,1,130,0)=" ; when finished with all processing, kill the output array "
^XTV(8991,50,1,1,1,131,0)=" I SDCOUNT'=0 K ^TMP($J,""SDAMA301"")"
^XTV(8991,50,1,1,1,132,0)=" Q"
^XTV(8991,50,1,1,1,133,0)="EN6 ;"
^XTV(8991,50,1,1,1,134,0)=" N SDARRAY,SDCOUNT,SDCLIEN,SDDFN,SDDATE,SDAPPT,SDSTATUS "
^XTV(8991,50,1,1,1,135,0)=" N SDDATEP,SDAPPM"
^XTV(8991,50,1,1,1,136,0)=" S SDARRAY(1)=""3061101;3061130"" "
^XTV(8991,50,1,1,1,137,0)=" S SDARRAY(13)=323 "
^XTV(8991,50,1,1,1,138,0)=" S ^SDDFN(1)="""" "
^XTV(8991,50,1,1,1,139,0)=" S ^SDDFN(2)="""" "
^XTV(8991,50,1,1,1,140,0)=" S ^SDDFN(3)="""" "
^XTV(8991,50,1,1,1,141,0)=" S SDARRAY(4)=""^SDDFN("" "
^XTV(8991,50,1,1,1,142,0)=" S SDARRAY(""FLDS"")=""3;16"" "
^XTV(8991,50,1,1,1,143,0)=" S SDCOUNT=$$SDAPI^SDAMA301(.SDARRAY) "
^XTV(8991,50,1,1,1,144,0)=" I SDCOUNT>0 D "
^XTV(8991,50,1,1,1,145,0)=" . ;get clinic "
^XTV(8991,50,1,1,1,146,0)=" . S SDCLIEN=0 F  S SDCLIEN=$O(^TMP($J,""SDAMA301"",SDCLIEN)) Q:SDCLIEN=""""  D "
^XTV(8991,50,1,1,1,147,0)=" .. ;get patient "
^XTV(8991,50,1,1,1,148,0)=" .. S SDDFN=0 F  S SDDFN=$O(^TMP($J,""SDAMA301"",SDCLIEN,SDDFN)) Q:SDDFN=""""  D "
^XTV(8991,50,1,1,1,149,0)=" ... ;get appointment date/time "
^XTV(8991,50,1,1,1,150,0)=" ... S SDDATE=0 F  S SDDATE=$O(^TMP($J,""SDAMA301"",SDCLIEN,SDDFN,SDDATE)) Q:SDDATE=""""  D "
^XTV(8991,50,1,1,1,151,0)=" .... S SDSTATUS=$P($G(^TMP($J,""SDAMA301"",SDCLIEN,SDDFN,SDDATE)),""^"",3) ;appointment status "
^XTV(8991,50,1,1,1,152,0)=" .... S SDAPPM=$P($G(^TMP($J,""SDAMA301"",SDCLIEN,SDDFN,SDDATE)),""^"",16) ;date appointment made   "
^XTV(8991,50,1,1,1,153,0)=" .... S Y=SDAPPM X ^DD(""DD"") S SDAPPM=Y"
^XTV(8991,50,1,1,1,154,0)=" .... S Y=SDDATE X ^DD(""DD"") S SDDATEP=Y"
^XTV(8991,50,1,1,1,155,0)=" .... ;continue processing this appointment as needed "
^XTV(8991,50,1,1,1,156,0)=" ... W !,""CLINIC: "",$P($G(^SC(SDCLIEN,0)),""^"",1),"" PATIENT: "",$P($G(^DPT(SDDFN,0)),""^"",1),"" DATE/TIME: "",SDDATEP,"" STATUS: "",SDSTATUS,"" DATE APPT MADE: "",SDAPPM "
^XTV(8991,50,1,1,1,157,0)=" I SDCOUNT<0 D "
^XTV(8991,50,1,1,1,158,0)=" . ;do processing for errors 101 and 116 "
^XTV(8991,50,1,1,1,159,0)=" . W !,""SDCOUNT="",SDCOUNT ;"
^XTV(8991,50,1,1,1,160,0)=" ; when finished with all processing, kill output array and user-defined patient list "
^XTV(8991,50,1,1,1,161,0)=" I SDCOUNT'=0 K ^TMP($J,""SDAMA301"") "
^XTV(8991,50,1,1,1,162,0)=" K ^SDDFN"
^XTV(8991,50,1,1,1,163,0)=" Q "
^XTV(8991,50,1,1,1,164,0)="MKPITEST ;"
^XTV(8991,50,1,1,1,165,0)=" N DFN,SD1,SC,STYP,X2,X,X1,SDARRAY,IER"
^XTV(8991,50,1,1,1,166,0)=" N XQSDVWSI ; EXIST AS NON-INTERACTIVE SILENT NODE W/O WRITE FOR XQOR ROUTINES"
^XTV(8991,50,1,1,1,167,0)=" N SDVWNVAI ; EXIST AS NON-VA RELATED PFSS EVENT MODE"
^XTV(8991,50,1,1,1,168,0)=" ;                                = ""D"" DISABLING THE NEED FOR ICN"
^XTV(8991,50,1,1,1,169,0)=" ;                                = ""O"" AS OTHER NON-VA ICN SYSTEM ( FUTURE)"
^XTV(8991,50,1,1,1,170,0)=" S XQSDVWSI = 1    ;SILENT MODE FOR NON-INTERACTIVE MODE W/O WRITE"
^XTV(8991,50,1,1,1,171,0)=" S SDVWNVAI = ""D""  ; NON-VA TESTING HERE WITH DISABLING THE NEED FOR ICN"
^XTV(8991,50,1,1,1,172,0)=" S DFN=3 S SD1=3070123.10 S SC=3 S STYP=3"
^XTV(8991,50,1,1,1,173,0)=" D NOW^%DTC S X2=X\1 S SDARRAY(""DATE NOW"")=X2"
^XTV(8991,50,1,1,1,174,0)=" S SDARRAY(""APPT TYPE"")=9"
^XTV(8991,50,1,1,1,175,0)="    S SDARRAY(""SCHED_REQ_TYPE"")=""O"""
^XTV(8991,50,1,1,1,176,0)="    S SDARRAY(""NEXT APPT IND"")=0"
^XTV(8991,50,1,1,1,177,0)="    S SDARRAY(""FOLLOWUP VISIT INDICATOR"")=0  ; 0 FOR NO"
^XTV(8991,50,1,1,1,178,0)="    S SDARRAY(""DATA ENTRY CLERK"")=DUZ"
^XTV(8991,50,1,1,1,179,0)="    S IER=$$EN^SDVWMKPI(DFN,SD1,SC,STYP,.SDARRAY)"
^XTV(8991,50,1,1,1,180,0)="    W ""IER="",IER"
^XTV(8991,50,1,1,1,181,0)="    Q"
^XTV(8991,50,1,1,1,182,0)="HL7SDAPI ;;"
^XTV(8991,50,1,1,1,183,0)=" ; HL7 SDAPI TEST PROGRAM ( RETURN LIST OF APPOINTMENTS)"
^XTV(8991,50,1,1,1,184,0)=" ;"
^XTV(8991,50,1,1,1,185,0)=" N FIRST,SSN,SDDATE,SDLOCATE,SDARRAY,PATIENTN,SSNPATN,AJJ3VIS,SDARRAY2 "
^XTV(8991,50,1,1,1,186,0)=" N MSGCTRL,IER,RETURN,ORDRSORT,SSN,SDLOCATE,SDDATE,SDCOUNT,ACKCODE"
^XTV(8991,50,1,1,1,187,0)=" S MSGCTRL=0"
^XTV(8991,50,1,1,1,188,0)=" S SDARRAY(1)=""Nov 6,2006;Nov 10,2006"""
^XTV(8991,50,1,1,1,189,0)=" S SDARRAY(3)=""R;I"" "
^XTV(8991,50,1,1,1,190,0)=" S SDARRAY(2)=""VWVOE RADIOLOGY CLINIC""    ;""VWVOE DRPHYSICIAN CLINIC"""
^XTV(8991,50,1,1,1,191,0)=" ;""VWVOE RADIOLOGY CLINIC"""
^XTV(8991,50,1,1,1,192,0)=" ;""VWVOE DR. PHYSICIAN CLINIC"""
^XTV(8991,50,1,1,1,193,0)=" ;""VWVOE RADIOLOGY CLINIC"""
^XTV(8991,50,1,1,1,194,0)=" ;""VWVOE DR. PHYSICIAN CLINIC"" ;""VWVOE RADIOLOGY CLINIC"" ;""VWVOE DR. PHYSICIAN CLINIC"" ;""VWVOE RADIOLOGY CLINIC"" ;EXTERNAL NAME"
^XTV(8991,50,1,1,1,195,0)=" ;S SDARRAY(4)=""100001298"" ;EXTERNAL PATIENT ID AS SSN"
^XTV(8991,50,1,1,1,196,0)=" S SDARRAY(""MAX"")=2 "
^XTV(8991,50,1,1,1,197,0)=" S SDARRAY(""FLDS"")=""1;2;3"""
^XTV(8991,50,1,1,1,198,0)=" S IER=$$TRNSDAPI^SDVWHLEX(.SDARRAY,.MSGCTRL)"
^XTV(8991,50,1,1,1,199,0)=" I (IER=""OK"")&(MSGCTRL'=0) D"
^XTV(8991,50,1,1,1,200,0)=" .S AJJ3CNT=0"
^XTV(8991,50,1,1,1,201,0)="CHKAGAIN .I AJJ3CNT>8 Q"
^XTV(8991,50,1,1,1,202,0)=" .I $D(^XTMP(MSGCTRL,""RETURN""))=0 H 3 S AJJ3CNT=AJJ3CNT+1 G CHKAGAIN"
^XTV(8991,50,1,1,1,203,0)=" .;W !,""HERE"""
^XTV(8991,50,1,1,1,204,0)=" .S RETURN=^XTMP(MSGCTRL,""RETURN"") ; THIS INCLUDES ACK CODE AS AA OR AE"
^XTV(8991,50,1,1,1,205,0)=" .S ACKCODE=$P(RETURN,""^"",1)"
^XTV(8991,50,1,1,1,206,0)=" .I ACKCODE=""OK"" D"
^XTV(8991,50,1,1,1,207,0)=" ..;"
^XTV(8991,50,1,1,1,208,0)=" ..S ORDRSORT=$P(RETURN,""^"",2)"
^XTV(8991,50,1,1,1,209,0)=" ..S SDCOUNT=$P(RETURN,""^"",3)"
^XTV(8991,50,1,1,1,210,0)=" ..I SDCOUNT>0 D"
^XTV(8991,50,1,1,1,211,0)=" ...D"
^XTV(8991,50,1,1,1,212,0)=" ....I $E(ORDRSORT,1,1)=""P"" D"
^XTV(8991,50,1,1,1,213,0)=" .....S AJJ3VIS=0"
^XTV(8991,50,1,1,1,214,0)=" .....F  S AJJ3VIS=$O(^XTMP(MSGCTRL,""SDAMA301"",AJJ3VIS)) Q:AJJ3VIS=""""  D"
^XTV(8991,50,1,1,1,215,0)=" ......S SDARRAY2=^XTMP(MSGCTRL,""SDAMA301"",AJJ3VIS)"
^XTV(8991,50,1,1,1,216,0)=" ......S SSNPATN=$P(SDARRAY2,""^"",1)"
^XTV(8991,50,1,1,1,217,0)=" ......S SDLOCATE=$P(SDARRAY2,""^"",2)"
^XTV(8991,50,1,1,1,218,0)=" ......S SDDATE=$P(SDARRAY2,""^"",3)"
^XTV(8991,50,1,1,1,219,0)=" ......S FIRST=SSNPATN_""^""_SDLOCATE_""^""_SDDATE_""^"""
^XTV(8991,50,1,1,1,220,0)=" ......S SDARRAY2=$P(SDARRAY2,FIRST,2)"
^XTV(8991,50,1,1,1,221,0)=" ......S PATIENTN=$P(SSNPATN,""#"",2)"
^XTV(8991,50,1,1,1,222,0)=" ......S SSN=$P(SSNPATN,""#"",1) "
^XTV(8991,50,1,1,1,223,0)=" ......W !,""APPT/UNSCHED VISIT, PATIENT="",PATIENTN,"" SSN="",SSN,"" HOSP LOCATION="",SDLOCATE,"" DATE/TIME="",SDDATE "
^XTV(8991,50,1,1,1,224,0)=" ......W !,""                   DATA FIELDS="",SDARRAY2 "
^XTV(8991,50,1,1,1,225,0)=" ....I $E(ORDRSORT,1,1)=""C"" D"
^XTV(8991,50,1,1,1,226,0)=" .....S AJJ3VIS=0"
^XTV(8991,50,1,1,1,227,0)=" .....F  S AJJ3VIS=$O(^XTMP(MSGCTRL,""SDAMA301"",AJJ3VIS)) Q:AJJ3VIS=""""  D"
^XTV(8991,50,1,1,1,228,0)=" ......S SDARRAY2=^XTMP(MSGCTRL,""SDAMA301"",AJJ3VIS)"
^XTV(8991,50,1,1,1,229,0)=" ......S SSNPATN=$P(SDARRAY2,""^"",2)"
^XTV(8991,50,1,1,1,230,0)=" ......S SDLOCATE=$P(SDARRAY2,""^"",1)"
^XTV(8991,50,1,1,1,231,0)=" ......S SDDATE=$P(SDARRAY2,""^"",3)"
^XTV(8991,50,1,1,1,232,0)=" ......S FIRST=SDLOCATE_""^""_SSNPATN_""^""_SDDATE_""^"""
^XTV(8991,50,1,1,1,233,0)=" ......S SDARRAY2=$P(SDARRAY2,FIRST,2)"
^XTV(8991,50,1,1,1,234,0)=" ......S PATIENTN=$P(SSNPATN,""#"",2)"
^XTV(8991,50,1,1,1,235,0)=" ......S SSN=$P(SSNPATN,""#"",1) "
^XTV(8991,50,1,1,1,236,0)=" ......W !,""APPT/UNSCHED VISIT, HOSP LOCATION="",SDLOCATE,"" PATIENT="",PATIENTN,"" SSN="",SSN,"" DATE/TIME="",SDDATE "
^XTV(8991,50,1,1,1,237,0)=" ......W !,""                   DATA FIELDS="",SDARRAY2"
^XTV(8991,50,1,1,1,238,0)=" ...;I $E(ORDRSORT,1,1)=""C"" D"
^XTV(8991,50,1,1,1,239,0)=" ...;.W !,""APPT/UNSCHED VISIT="",^XTMP(MSGCTRL,""SDAMA301"",SDLOCATE,SSN,SDDATE)=SDARRAY"
^XTV(8991,50,1,1,1,240,0)=" ...;ANSWERS IN ORDERED ARRAYS ^XTMP(MSGCTRL,""SDAM301"")."
^XTV(8991,50,1,1,1,241,0)=" ...;BELOW ORDRSORT IS 1ST PIECE RETURNED IN RETURN"
^XTV(8991,50,1,1,1,242,0)=" ...;I ($E(ORDRSORT,1,1)=""P"")&(SDCOUNT>0)"
^XTV(8991,50,1,1,1,243,0)=" ...;.S ^XTMP(MSGCTRL,""SDAMA301"",SSN,SDLOCATE,SDDATE)=SDARRAY OR "
^XTV(8991,50,1,1,1,244,0)=" ...;.S ^XTMP(MSGCTRL,""SDAMA301"",SDLOCATE,SDDATE)=SDARRAY IF S SDARRAY(""SORT"")=""C"" WITH SDARRAY(4) SPECIFIED (PATIENT)"
^XTV(8991,50,1,1,1,245,0)=" ...;I ($E(ORDRSORT,1,1)=""C"")&(SDCOUNT>0)"
^XTV(8991,50,1,1,1,246,0)=" ...;.S ^XTMP(MSGCTRL,""SDAMA301"",SDLOCATE,SSN,SDDATE)=SDARRAY OR"
^XTV(8991,50,1,1,1,247,0)=" ...;.S ^XTMP(MSGCTRL,""SDAMA301"",SSN,SDDATE)=SDARRAY IF S SDARRAY(""SORT"")=""P"" WITH SDARRAY(2) SPECIFIED (CLINIC)"
^XTV(8991,50,1,1,1,248,0)=" ..E  D"
^XTV(8991,50,1,1,1,249,0)=" ...;LOOK AT ERRORS IN API CALL, ETC"
^XTV(8991,50,1,1,1,250,0)=" E  D"
^XTV(8991,50,1,1,1,251,0)=" . ; APP ACK CODE=""AE"". SOME OTHER ERRORS IN TRANSMISSION IN OTHER PIECES OF RETURN"
^XTV(8991,50,1,1,1,252,0)=" W !,""MSGCTRL="",MSGCTRL"
^XTV(8991,50,1,1,1,253,0)=" Q"_$C(9)
^XTV(8991,50,1,1,1,254,0)="HL7MKPI ;"_$C(9)_";"
^XTV(8991,50,1,1,1,255,0)=" ;MAke Appointment HL7 TEST PROGRAM"
^XTV(8991,50,1,1,1,256,0)=" ;"
^XTV(8991,50,1,1,1,257,0)=" N MSGCTRL,IER,RETURN"
^XTV(8991,50,1,1,1,258,0)=" N PATIENTN,SSN,SD1,SC,STYP,SDARRAY,OUTIN,SDVWNVAI,X,Y,X2,ACKCODE"
^XTV(8991,50,1,1,1,259,0)=" N AJJ3CNT"
^XTV(8991,50,1,1,1,260,0)=" ;N VXSDNVAI"
^XTV(8991,50,1,1,1,261,0)=" S MSGCTRL=0  ;"
^XTV(8991,50,1,1,1,262,0)=" ;N DFN(SSN AND PATIENT NAME INSTEAD),SD1,SC(HOSP LOCATION (CLINIC) EXT FORMAT NAME INSTEAD,STYP,"
^XTV(8991,50,1,1,1,263,0)=" ;N SDARRAY (DATE/TIMES IN EXTERNAL FORMAT),IER"
^XTV(8991,50,1,1,1,264,0)=" S PATIENTN=""ZZ PATIENT,TEST ONE"""
^XTV(8991,50,1,1,1,265,0)="    S SDVWNVAI=""D""  ; NON-VA TESTING HERE WITH DISABLING THE NEED FOR ICN"
^XTV(8991,50,1,1,1,266,0)=" S SSN=100001298 ; DFN=1 NON TEST PATRIENT FOR PFSS EVENT GENERATION"
^XTV(8991,50,1,1,1,267,0)=" S SD1=""JAN 24,2007@11:30"" ; SD1=3070123.1130  "
^XTV(8991,50,1,1,1,268,0)=" S SC=""VWVOE RADIOLOGY CLINIC"" ; S SC=3 "
^XTV(8991,50,1,1,1,269,0)=" S STYP=3  ;SCHEDULED APPT"
^XTV(8991,50,1,1,1,270,0)=" S OUTIN=""O"" ;for outpatient clinic"
^XTV(8991,50,1,1,1,271,0)=" ;"
^XTV(8991,50,1,1,1,272,0)=" D NOW^%DTC S X2=X\1 S Y=X2 D DD^%DT S SDARRAY(""DATE NOW"")=Y"
^XTV(8991,50,1,1,1,273,0)=" S SDARRAY(""APPT TYPE"")=9"
^XTV(8991,50,1,1,1,274,0)="    S SDARRAY(""SCHED_REQ_TYPE"")=""O"" ;'OTHER THAN NEXT AVAIABLE"
^XTV(8991,50,1,1,1,275,0)="    S SDARRAY(""NEXT APPT IND"")=0 ;0 FOR NO"
^XTV(8991,50,1,1,1,276,0)="    S SDARRAY(""FOLLOWUP VISIT INDICATOR"")=0  ; 0 FOR NO"
^XTV(8991,50,1,1,1,277,0)="    S SDARRAY(""DATA ENTRY CLERK"")=""SCHLEHUBER,CAMERON"" ; PERSON ON MACHINE MAKING APPT REMOTELY"
^XTV(8991,50,1,1,1,278,0)="    ;THEN PARAMETERS CONVERTED TO INTERNAL VALUE"
^XTV(8991,50,1,1,1,279,0)="    ;"
^XTV(8991,50,1,1,1,280,0)=" S IER=$$TRNSMKPI^SDVWHLEX(PATIENTN,SSN,SD1,SC,STYP,.SDARRAY,OUTIN,.MSGCTRL,SDVWNVAI)"
^XTV(8991,50,1,1,1,281,0)=" ;VWSDNVAI AS OPTIONAL LAST PARAMETER PASSED"
^XTV(8991,50,1,1,1,282,0)=" I (IER=""OK"")&(MSGCTRL'=0) D"
^XTV(8991,50,1,1,1,283,0)=" .S AJJ3CNT=0"
^XTV(8991,50,1,1,1,284,0)="CHKGAIN .I AJJ3CNT>8 Q"
^XTV(8991,50,1,1,1,285,0)=" .I $D(^XTMP(MSGCTRL,""RETURN""))=0 H 3 S AJJ3CNT=AJJ3CNT+1 G CHKGAIN"
^XTV(8991,50,1,1,1,286,0)=" .S RETURN=^XTMP(MSGCTRL,""RETURN"") ; THIS INCLUDES ACK CODE AS AA OR AE"
^XTV(8991,50,1,1,1,287,0)=" .S ACKCODE=$P(RETURN,""^"",1)"
^XTV(8991,50,1,1,1,288,0)=" .I ACKCODE=""AA"" D"
^XTV(8991,50,1,1,1,289,0)=" ..W !,""MAKE APPT GOOD RETURN"""
^XTV(8991,50,1,1,1,290,0)=" .E  D"
^XTV(8991,50,1,1,1,291,0)=" ..;ACKCODE=""AE"". LOOK AT SOME OTHER ERRORS IN TRNSMISSION IN OTHER PIECES OF RETURN"
^XTV(8991,50,1,1,1,292,0)=" ..W !,""RETURN="",RETURN"
^XTV(8991,50,1,1,1,293,0)=" W !,""MSGCTRL="",MSGCTRL"
^XTV(8991,50,1,1,1,294,0)=" Q"
^XTV(8991,50,1,1,1,295,0)="QUICK ;"
^XTV(8991,50,1,1,1,296,0)=" D"
^XTV(8991,50,1,1,1,297,0)=" . D"
^XTV(8991,50,1,1,1,298,0)=" . . ;S TEMP=""S SDARRAY(1)=""_""""""""_""Nov 6,2006;Nov 9,2006""_""""""""_"""""
^XTV(8991,50,1,1,1,299,0)=" . . S TEMP=""S SDARRAY(1)=""_3 ;"
^XTV(8991,50,1,1,1,300,0)=" . . ZW TEMP"
^XTV(8991,50,1,1,1,301,0)=" . . ;X TEMP"
^XTV(8991,50,1,1,1,302,0)=" . . S AJJ3CNT1=0"
^XTV(8991,50,1,1,1,303,0)=" . . S IFLAG2=0"
^XTV(8991,50,1,1,1,304,0)=" . . S TEMP1="""""
^XTV(8991,50,1,1,1,305,0)=" . . F  S AJJ3CNT1=AJJ3CNT1+1 S AJJ3PIEC=$P(TEMP,"""""""",AJJ3CNT1) Q:(IFLAG2=1)  D"
^XTV(8991,50,1,1,1,306,0)=" . . .I AJJ3PIEC'="""" S AJJ3CNT2=AJJ3CNT1+1 S AJJ3PIE2=$P(TEMP,"""""""",AJJ3CNT2) I AJJ3PIE2="""" D"
^XTV(8991,50,1,1,1,307,0)=" . . . .S ILENX=$L(TEMP) I $E(TEMP,ILENX,ILENX)="""""""" D"
^XTV(8991,50,1,1,1,308,0)=" . . . . .S TEMP1=TEMP1_AJJ3PIEC_"""""""""
^XTV(8991,50,1,1,1,309,0)=" . . . .E  D"
^XTV(8991,50,1,1,1,310,0)=" . . . . .S TEMP1=TEMP1_AJJ3PIEC"
^XTV(8991,50,1,1,1,311,0)=" . . .I AJJ3PIEC="""" S ILENX=$L(TEMP) I $E(TEMP,ILENX,ILENX)="""""""" D"
^XTV(8991,50,1,1,1,312,0)=" . . . . S TEMP1=TEMP1_"""" S IFLAG2=1"
^XTV(8991,50,1,1,1,313,0)=" . . .E  D"
^XTV(8991,50,1,1,1,314,0)=" . . . . S IFLAG2=1"
^XTV(8991,50,1,1,1,315,0)=" . . X TEMP1"
^XTV(8991,50,1,1,1,316,0)=" Q"
^XTV(8991,50,1,"B",3070118.2247,1)=""
^XTV(8991,51,0)="PXRMAGE"
^XTV(8991,51,1,0)="^8991.01^4^4"
^XTV(8991,51,1,1,0)="3070122.2127"
^XTV(8991,51,1,1,1,0)="^8991.11^189^189"
^XTV(8991,51,1,1,1,1,0)=""
^XTV(8991,51,1,1,1,1,"DEL")="PXRMAGE ; SLC/PKR - Utilities for age calculations. ;1/22/07  21:27"
^XTV(8991,51,1,1,1,2,"INS",0)="^8991.12^1^1"
^XTV(8991,51,1,1,1,2,"INS",1,0)="PXRMAGE ; SLC/PKR - Utilities for age calculations. ;1/22/07  22:03"
^XTV(8991,51,1,1,1,58,0)=""
^XTV(8991,51,1,1,1,58,"DEL")=" I CODE=""MOS"" S MULT=30.42"
^XTV(8991,51,1,1,1,59,0)=""
^XTV(8991,51,1,1,1,59,"DEL")=" I CODE=""""!(CODE=""YRS"") S MULT=365.25"
^XTV(8991,51,1,1,1,60,"INS",0)="^8991.12^2^2"
^XTV(8991,51,1,1,1,60,"INS",1,0)=" I CODE=""M"" S MULT=30.42"
^XTV(8991,51,1,1,1,60,"INS",2,0)=" I CODE=""""!(CODE=""Y"") S MULT=365.25"
^XTV(8991,51,1,2,0)="3070122.2203"
^XTV(8991,51,1,2,1,0)="^8991.11^189^189"
^XTV(8991,51,1,2,1,1,0)=""
^XTV(8991,51,1,2,1,1,"DEL")="PXRMAGE ; SLC/PKR - Utilities for age calculations. ;1/22/07  22:03"
^XTV(8991,51,1,2,1,2,"INS",0)="^8991.12^1^1"
^XTV(8991,51,1,2,1,2,"INS",1,0)="PXRMAGE ; SLC/PKR - Utilities for age calculations. ;1/23/07  13:03"
^XTV(8991,51,1,2,1,28,0)=""
^XTV(8991,51,1,2,1,28,"DEL")=" D ^%DTC S X3=X\365.25,X=$S(X3>2:X3_"" Y"",X<31:X_"" D"",1:X\30_"" M"")"
^XTV(8991,51,1,2,1,29,"INS",0)="^8991.12^1^1"
^XTV(8991,51,1,2,1,29,"INS",1,0)=" D ^%DTC S X3=X\365.25,X=$S(X3>2:X3_""Y"",X<31:X_""D"",1:X\30_""M"")"
^XTV(8991,51,1,3,0)="3070123.1303"
^XTV(8991,51,1,3,1,0)="^8991.11^189^189"
^XTV(8991,51,1,3,1,1,0)=""
^XTV(8991,51,1,3,1,1,"DEL")="PXRMAGE ; SLC/PKR - Utilities for age calculations. ;1/23/07  13:03"
^XTV(8991,51,1,3,1,2,"INS",0)="^8991.12^1^1"
^XTV(8991,51,1,3,1,2,"INS",1,0)="PXRMAGE ; SLC/PKR - Utilities for age calculations. ;1/23/07  13:09"
^XTV(8991,51,1,3,1,56,0)=""
^XTV(8991,51,1,3,1,56,"DEL")=" S NUM=$P(AGEVALUE,"" "",1),CODE=$P(AGEVALUE,"" "",2)"
^XTV(8991,51,1,3,1,57,"INS",0)="^8991.12^1^1"
^XTV(8991,51,1,3,1,57,"INS",1,0)=" S NUM=+AGEVALUE,CODE=$P(AGEVALUE,NUM,2)"
^XTV(8991,51,1,4,0)="3070123.1309"
^XTV(8991,51,1,4,1,0)="^8991.11^189^189"
^XTV(8991,51,1,4,1,1,0)="PXRMAGE ; SLC/PKR - Utilities for age calculations. ;1/23/07  13:09"
^XTV(8991,51,1,4,1,2,0)=" ;;2.0;CLINICAL REMINDERS;**4,7**;Feb 04, 2005;Build 3"
^XTV(8991,51,1,4,1,3,0)=" ; Modified from FOIA VISTA,"
^XTV(8991,51,1,4,1,4,0)=" ; Copyright (C) 2007 WorldVistA"
^XTV(8991,51,1,4,1,5,0)=" ;"
^XTV(8991,51,1,4,1,6,0)=" ; This program is free software; you can redistribute it and/or modify"
^XTV(8991,51,1,4,1,7,0)=" ; it under the terms of the GNU General Public License as published by"
^XTV(8991,51,1,4,1,8,0)=" ; the Free Software Foundation; either version 2 of the License, or"
^XTV(8991,51,1,4,1,9,0)=" ; (at your option) any later version."
^XTV(8991,51,1,4,1,10,0)=" ;"
^XTV(8991,51,1,4,1,11,0)=" ; This program is distributed in the hope that it will be useful,"
^XTV(8991,51,1,4,1,12,0)=" ; but WITHOUT ANY WARRANTY; without even the implied warranty of"
^XTV(8991,51,1,4,1,13,0)=" ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the"
^XTV(8991,51,1,4,1,14,0)=" ; GNU General Public License for more details."
^XTV(8991,51,1,4,1,15,0)=" ;"
^XTV(8991,51,1,4,1,16,0)=" ; You should have received a copy of the GNU General Public License"
^XTV(8991,51,1,4,1,17,0)=" ; along with this program; if not, write to the Free Software"
^XTV(8991,51,1,4,1,18,0)=" ; Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA"
^XTV(8991,51,1,4,1,19,0)=" ;==========================================="
^XTV(8991,51,1,4,1,20,0)="AGE(DOB,DOD,DATE) ;Given a date of birth, date of death, and a date"
^XTV(8991,51,1,4,1,21,0)=" ;return the age on that date. If the date of death is not null the"
^XTV(8991,51,1,4,1,22,0)=" ;return the age on the date of death. All dates should be in VA"
^XTV(8991,51,1,4,1,23,0)=" ;Fileman format."
^XTV(8991,51,1,4,1,24,0)=" N CDATE,X,X1,X2,X3"
^XTV(8991,51,1,4,1,25,0)=" S CDATE=$S(DOD="""":DATE,DOD'="""":DOD)"
^XTV(8991,51,1,4,1,26,0)=" S X=(CDATE-DOB)\10000 Q:X>1 X ; Begin VOE changes to support pediatrics"
^XTV(8991,51,1,4,1,27,0)=" S X1=CDATE,X2=DOB"
^XTV(8991,51,1,4,1,28,0)=" D ^%DTC S X3=X\365.25,X=$S(X3>2:X3_""Y"",X<31:X_""D"",1:X\30_""M"")"
^XTV(8991,51,1,4,1,29,0)=" Q X ; End VOE changes to support pediatric ages"
^XTV(8991,51,1,4,1,30,0)=" ;"
^XTV(8991,51,1,4,1,31,0)=" ;==========================================="
^XTV(8991,51,1,4,1,32,0)="AGECHECK(AGE,MINAGE,MAXAGE) ;Given an AGE, MINimumAGE, and MAXimumAGE"
^XTV(8991,51,1,4,1,33,0)=" ;return true if age lies within the range."
^XTV(8991,51,1,4,1,34,0)=" ;Special values of NULL or 0 mean there are no limits."
^XTV(8991,51,1,4,1,35,0)=" ;"
^XTV(8991,51,1,4,1,36,0)=" ; IHS/CIA/MGH - 5/12/2004 PATCH 1001 Changed to function call to calculate age"
^XTV(8991,51,1,4,1,37,0)=" ; Two lines changed and one added ; for VOE too"
^XTV(8991,51,1,4,1,38,0)=" ;S MAXAGE=+MAXAGE"
^XTV(8991,51,1,4,1,39,0)=" ;S MINAGE=+MINAGE"
^XTV(8991,51,1,4,1,40,0)=" ;"
^XTV(8991,51,1,4,1,41,0)=" S MAXAGE=$$DECODE(MAXAGE) ; DECODE used in VOE Pediatric patients"
^XTV(8991,51,1,4,1,42,0)=" S MINAGE=$$DECODE(MINAGE)"
^XTV(8991,51,1,4,1,43,0)=" S AGE=$$DECAGE(AGE)"
^XTV(8991,51,1,4,1,44,0)=" ;"
^XTV(8991,51,1,4,1,45,0)=" ;See if too old."
^XTV(8991,51,1,4,1,46,0)=" I (AGE>MAXAGE)&(MAXAGE>0) Q 0"
^XTV(8991,51,1,4,1,47,0)=" ;"
^XTV(8991,51,1,4,1,48,0)=" ;See if too young."
^XTV(8991,51,1,4,1,49,0)=" I MINAGE=0 Q 1"
^XTV(8991,51,1,4,1,50,0)=" I AGE<MINAGE Q 0"
^XTV(8991,51,1,4,1,51,0)=" Q 1"
^XTV(8991,51,1,4,1,52,0)=" ;"
^XTV(8991,51,1,4,1,53,0)="DECAGE(AGEVALUE) ; Put age from VADPT into format for reminders ; for VOE too"
^XTV(8991,51,1,4,1,54,0)=" ; IHS/CIA/MGH - 5/12/2004 PATCH 1001 Added function to change age into days"
^XTV(8991,51,1,4,1,55,0)=" N NUM,CODE,MULT"
^XTV(8991,51,1,4,1,56,0)=" S NUM=+AGEVALUE,CODE=$P(AGEVALUE,NUM,2)"
^XTV(8991,51,1,4,1,57,0)=" S MULT=1.0"
^XTV(8991,51,1,4,1,58,0)=" I CODE=""M"" S MULT=30.42"
^XTV(8991,51,1,4,1,59,0)=" I CODE=""""!(CODE=""Y"") S MULT=365.25"
^XTV(8991,51,1,4,1,60,0)=" Q +(MULT*NUM)"
^XTV(8991,51,1,4,1,61,0)="DECODE(AGEVALUE) ;Determine the age in years or months ; From IHS for VOE"
^XTV(8991,51,1,4,1,62,0)=" ; IHS/CIA/MGH - 5/12/2004 PATCH 1001 Added function to change reminder defintion ages into days"
^XTV(8991,51,1,4,1,63,0)=" N CODE,LEN,MULT,NUM"
^XTV(8991,51,1,4,1,64,0)=" S LEN=$L(AGEVALUE)"
^XTV(8991,51,1,4,1,65,0)=" S NUM=$E(AGEVALUE,1,LEN-1)"
^XTV(8991,51,1,4,1,66,0)=" S CODE=$E(AGEVALUE,LEN,LEN)"
^XTV(8991,51,1,4,1,67,0)=" S MULT=1.0"
^XTV(8991,51,1,4,1,68,0)=" I CODE=""M"" S MULT=30.42"
^XTV(8991,51,1,4,1,69,0)=" I CODE=""Y""!(CODE="""") S MULT=365.25"
^XTV(8991,51,1,4,1,70,0)=" Q +(MULT*NUM)"
^XTV(8991,51,1,4,1,71,0)=" ;======================================================================"
^XTV(8991,51,1,4,1,72,0)="FMTAGE(MINAGE,MAXAGE) ;Format the minimum age and maximum age for display."
^XTV(8991,51,1,4,1,73,0)=" N STR"
^XTV(8991,51,1,4,1,74,0)=" I $L(MINAGE)!$L(MAXAGE) D"
^XTV(8991,51,1,4,1,75,0)=" . I $L(MINAGE)&$L(MAXAGE) S STR="" for ages ""_MINAGE_"" to ""_MAXAGE Q"
^XTV(8991,51,1,4,1,76,0)=" . I $L(MINAGE) S STR="" for ages ""_MINAGE_"" and older"" Q"
^XTV(8991,51,1,4,1,77,0)=" . I $L(MAXAGE) S STR="" for ages ""_MAXAGE_"" and younger"" Q"
^XTV(8991,51,1,4,1,78,0)=" E  S STR="" for all ages"""
^XTV(8991,51,1,4,1,79,0)=" Q STR"
^XTV(8991,51,1,4,1,80,0)=" ;"
^XTV(8991,51,1,4,1,81,0)=" ;==========================================="
^XTV(8991,51,1,4,1,82,0)="FMTFREQ(FREQ) ;Format the frequency for display."
^XTV(8991,51,1,4,1,83,0)=" N FREQT,STR"
^XTV(8991,51,1,4,1,84,0)=" S STR=""Frequency: """
^XTV(8991,51,1,4,1,85,0)=" S FREQT=$$FREQ^PXRMPTD2(FREQ)"
^XTV(8991,51,1,4,1,86,0)=" I FREQ=-1 Q STR_FREQT"
^XTV(8991,51,1,4,1,87,0)=" Q STR_""Due every ""_FREQT"
^XTV(8991,51,1,4,1,88,0)=" ;"
^XTV(8991,51,1,4,1,89,0)=" ;==========================================="
^XTV(8991,51,1,4,1,90,0)="MMF(DEFARR,PXRMPDEM,MINAGE,MAXAGE,FREQ,FIEVAL) ;Set the baseline minimum age,"
^XTV(8991,51,1,4,1,91,0)=" ;maximum age, and frequency.  If there are multiple intervals they"
^XTV(8991,51,1,4,1,92,0)=" ;cannot overlap."
^XTV(8991,51,1,4,1,93,0)=" N FR,IC,INDEX,MATCH,MAXA,MINA,NAR,TEMP"
^XTV(8991,51,1,4,1,94,0)=" ;Initialize MINAGE, MAXAGE, and FREQ."
^XTV(8991,51,1,4,1,95,0)=" S (MINAGE,MAXAGE,FREQ)="""""
^XTV(8991,51,1,4,1,96,0)=" S (IC,NAR)=0"
^XTV(8991,51,1,4,1,97,0)=" F  S IC=$O(DEFARR(7,IC)) Q:+IC=0  D"
^XTV(8991,51,1,4,1,98,0)=" . S NAR=NAR+1"
^XTV(8991,51,1,4,1,99,0)=" . S TEMP=DEFARR(7,IC,0)"
^XTV(8991,51,1,4,1,100,0)=" . S FR(NAR)=$$UP^XLFSTR($P(TEMP,U,1))"
^XTV(8991,51,1,4,1,101,0)=" . S MINA(NAR)=$P(TEMP,U,2)"
^XTV(8991,51,1,4,1,102,0)=" . S MAXA(NAR)=$P(TEMP,U,3)"
^XTV(8991,51,1,4,1,103,0)=" . S INDEX(NAR)=IC"
^XTV(8991,51,1,4,1,104,0)=" . S FIEVAL(""AGE"",IC)=0"
^XTV(8991,51,1,4,1,105,0)=" I NAR=0 Q"
^XTV(8991,51,1,4,1,106,0)=" ;"
^XTV(8991,51,1,4,1,107,0)=" ;Make sure that none of the age ranges overlap."
^XTV(8991,51,1,4,1,108,0)=" I $D(PXRMDEBG),$$OVERLAP(NAR,.MINA,.MAXA) Q"
^XTV(8991,51,1,4,1,109,0)=" ;"
^XTV(8991,51,1,4,1,110,0)=" ;Look for an age range match."
^XTV(8991,51,1,4,1,111,0)=" S FREQ=-1"
^XTV(8991,51,1,4,1,112,0)=" S MATCH=0"
^XTV(8991,51,1,4,1,113,0)=" F IC=1:1:NAR Q:MATCH  D"
^XTV(8991,51,1,4,1,114,0)=" . I $$AGECHECK(PXRMPDEM(""AGE""),MINA(IC),MAXA(IC)) D"
^XTV(8991,51,1,4,1,115,0)=" .. S MATCH=1"
^XTV(8991,51,1,4,1,116,0)=" .. S MINAGE=MINA(IC)"
^XTV(8991,51,1,4,1,117,0)=" .. S MAXAGE=MAXA(IC)"
^XTV(8991,51,1,4,1,118,0)=" .. S FREQ=FR(IC)"
^XTV(8991,51,1,4,1,119,0)=" .. S FIEVAL(""AGE"",INDEX(IC))=1"
^XTV(8991,51,1,4,1,120,0)=" Q"
^XTV(8991,51,1,4,1,121,0)=" ;"
^XTV(8991,51,1,4,1,122,0)=" ;==========================================="
^XTV(8991,51,1,4,1,123,0)="OVERLAP(NAR,MINA,MAXA) ;Check age ranges for overlap.  Return an error message"
^XTV(8991,51,1,4,1,124,0)=" ;if an overlap is found."
^XTV(8991,51,1,4,1,125,0)=" ;IHS/CIA/MGH Changes made to decode the ages into numeric results"
^XTV(8991,51,1,4,1,126,0)=" I NAR'>1 Q 0"
^XTV(8991,51,1,4,1,127,0)=" N IC,IN,JC,MAXI,MAXJ,MINI,MINJ,OVRLAP,TEXT"
^XTV(8991,51,1,4,1,128,0)=" S OVRLAP=0"
^XTV(8991,51,1,4,1,129,0)=" F IC=1:1:NAR-1 D"
^XTV(8991,51,1,4,1,130,0)=" . S MAXI=$$DECODE(MAXA(IC)) ; DECODE used in VOE Pediatric patients"
^XTV(8991,51,1,4,1,131,0)=" . I MAXI="""" S MAXI=1000"
^XTV(8991,51,1,4,1,132,0)=" . S MINI=$$DECODE(MINA(IC))"
^XTV(8991,51,1,4,1,133,0)=" . I MINI="""" S MINI=0"
^XTV(8991,51,1,4,1,134,0)=" . F JC=IC+1:1:NAR D"
^XTV(8991,51,1,4,1,135,0)=" .. S MAXJ=$$DECODE(MAXA(JC))"
^XTV(8991,51,1,4,1,136,0)=" .. I MAXJ="""" S MAXJ=1000"
^XTV(8991,51,1,4,1,137,0)=" .. S MINJ=$$DECODE(MINA(JC))"
^XTV(8991,51,1,4,1,138,0)=" .. I MINJ="""" S MINJ=0"
^XTV(8991,51,1,4,1,139,0)=" .. S IN=0"
^XTV(8991,51,1,4,1,140,0)=" .. I (MINJ'<MINI)&(MINJ'>MAXI) S IN=1"
^XTV(8991,51,1,4,1,141,0)=" .. I (MAXJ'<MINI)&(MAXJ'>MAXI) S IN=1"
^XTV(8991,51,1,4,1,142,0)=" .. I IN D"
^XTV(8991,51,1,4,1,143,0)=" ... S OVRLAP=OVRLAP+1"
^XTV(8991,51,1,4,1,144,0)=" ... S TEXT=MINA(IC)_"" to ""_MAXA(IC)_"" and ""_MINA(JC)_"" to ""_MAXA(JC)"
^XTV(8991,51,1,4,1,145,0)=" ... I $D(PXRMPID) S ^TMP(PXRMPID,$J,PXRMITEM,""FERROR"",""AGE OVERLAP"",OVRLAP)=TEXT"
^XTV(8991,51,1,4,1,146,0)=" ... E  S ^TMP($J,""OVERLAP"",OVRLAP)=TEXT"
^XTV(8991,51,1,4,1,147,0)=" I OVRLAP>1 S OVRLAP=1"
^XTV(8991,51,1,4,1,148,0)=" Q OVRLAP"
^XTV(8991,51,1,4,1,149,0)=" ;"
^XTV(8991,51,1,4,1,150,0)=" ;==========================================="
^XTV(8991,51,1,4,1,151,0)="OVLAP() ;Check age ranges for overlap. Called from definition editor after"
^XTV(8991,51,1,4,1,152,0)=" ;input of baseline frequency/age ranges."
^XTV(8991,51,1,4,1,153,0)=" N IC,NAR,MAXA,MINA,OVERLAP,TEMP"
^XTV(8991,51,1,4,1,154,0)=" S (IC,NAR)=0"
^XTV(8991,51,1,4,1,155,0)=" F  S IC=$O(^PXD(811.9,DA,7,IC)) Q:+IC=0  D"
^XTV(8991,51,1,4,1,156,0)=" . S NAR=NAR+1"
^XTV(8991,51,1,4,1,157,0)=" . S TEMP=^PXD(811.9,DA,7,IC,0)"
^XTV(8991,51,1,4,1,158,0)=" . S MINA(NAR)=$P(TEMP,U,2)"
^XTV(8991,51,1,4,1,159,0)=" . S MAXA(NAR)=$P(TEMP,U,3)"
^XTV(8991,51,1,4,1,160,0)=" S OVERLAP=$$OVERLAP^PXRMAGE(NAR,.MINA,.MAXA)"
^XTV(8991,51,1,4,1,161,0)=" I OVERLAP D"
^XTV(8991,51,1,4,1,162,0)=" . W !,""Error - the following age ranges overlap:"""
^XTV(8991,51,1,4,1,163,0)=" . S IC=0"
^XTV(8991,51,1,4,1,164,0)=" . F  S IC=$O(^TMP($J,""OVERLAP"",IC)) Q:IC=""""  W !,?2,^TMP($J,""OVERLAP"",IC)"
^XTV(8991,51,1,4,1,165,0)=" . K ^TMP($J,""OVERLAP"")"
^XTV(8991,51,1,4,1,166,0)=" . W !,""Please correct this problem."""
^XTV(8991,51,1,4,1,167,0)=" Q OVERLAP"
^XTV(8991,51,1,4,1,168,0)=" ;"
^XTV(8991,51,1,4,1,169,0)=" ;======================================================================"
^XTV(8991,51,1,4,1,170,0)="RESTORE(SOURCE,INDEX,FREQ,MINAGE,MAXAGE) ;Restore FREQ, MINAGE, and"
^XTV(8991,51,1,4,1,171,0)=" ;MAXAGE back to the original form.  From IHS for VOE"
^XTV(8991,51,1,4,1,172,0)=" N IND,TEMP"
^XTV(8991,51,1,4,1,173,0)=" I SOURCE=""CFIND"" D"
^XTV(8991,51,1,4,1,174,0)=" . S IND=$O(^PXD(811.9,PXRMITEM,10,""B"",INDEX,""""))"
^XTV(8991,51,1,4,1,175,0)=" . S TEMP=^PXD(811.9,PXRMITEM,10,IND,0)"
^XTV(8991,51,1,4,1,176,0)=" ;"
^XTV(8991,51,1,4,1,177,0)=" I SOURCE=""HFIND"" D"
^XTV(8991,51,1,4,1,178,0)=" . S IND=$O(^PXD(811.9,PXRMITEM,6,""B"",INDEX,""""))"
^XTV(8991,51,1,4,1,179,0)=" . S TEMP=^PXD(811.9,PXRMITEM,6,IND,0)"
^XTV(8991,51,1,4,1,180,0)=" ;"
^XTV(8991,51,1,4,1,181,0)=" I SOURCE=""TFIND"" D"
^XTV(8991,51,1,4,1,182,0)=" . S IND=$O(^PXD(811.9,PXRMITEM,4,""B"",INDEX,""""))"
^XTV(8991,51,1,4,1,183,0)=" . S TEMP=^PXD(811.9,PXRMITEM,4,IND,0)"
^XTV(8991,51,1,4,1,184,0)=" ;"
^XTV(8991,51,1,4,1,185,0)=" S MINAGE=$P(TEMP,U,2)"
^XTV(8991,51,1,4,1,186,0)=" S MAXAGE=$P(TEMP,U,3)"
^XTV(8991,51,1,4,1,187,0)=" S FREQ=$P(TEMP,U,4)"
^XTV(8991,51,1,4,1,188,0)=" Q"
^XTV(8991,51,1,4,1,189,0)=" ; "
^XTV(8991,51,1,"B",3070122.2127,1)=""
^XTV(8991,51,1,"B",3070122.2203,2)=""
^XTV(8991,51,1,"B",3070123.1303,3)=""
^XTV(8991,51,1,"B",3070123.1309,4)=""
^XTV(8991,52,0)="HLOTLNK"
^XTV(8991,52,1,0)="^8991.01^1^1"
^XTV(8991,52,1,1,0)="3070123.1659"
^XTV(8991,52,1,1,1,0)="^8991.11^197^197"
^XTV(8991,52,1,1,1,1,0)="HLOTLNK ;IRMFO-ALB/CJM - APIs for the HL Logical Link file;03/24/2004  14:43 ;1/23/07  16:59"
^XTV(8991,52,1,1,1,2,0)=" ;;1.6;HEALTH LEVEL SEVEN;**126,130,131,135**;Oct 13, 1995;Build 4"
^XTV(8991,52,1,1,1,3,0)=" ; Modified from FOIA VISTA,"
^XTV(8991,52,1,1,1,4,0)=" ; Copyright (C) 2007 WorldVistA"
^XTV(8991,52,1,1,1,5,0)=" ;"
^XTV(8991,52,1,1,1,6,0)=" ; This program is free software; you can redistribute it and/or modify"
^XTV(8991,52,1,1,1,7,0)=" ; it under the terms of the GNU General Public License as published by"
^XTV(8991,52,1,1,1,8,0)=" ; the Free Software Foundation; either version 2 of the License, or"
^XTV(8991,52,1,1,1,9,0)=" ; (at your option) any later version."
^XTV(8991,52,1,1,1,10,0)=" ;"
^XTV(8991,52,1,1,1,11,0)=" ; This program is distributed in the hope that it will be useful,"
^XTV(8991,52,1,1,1,12,0)=" ; but WITHOUT ANY WARRANTY; without even the implied warranty of"
^XTV(8991,52,1,1,1,13,0)=" ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the"
^XTV(8991,52,1,1,1,14,0)=" ; GNU General Public License for more details."
^XTV(8991,52,1,1,1,15,0)=" ;"
^XTV(8991,52,1,1,1,16,0)=" ; You should have received a copy of the GNU General Public License"
^XTV(8991,52,1,1,1,17,0)=" ; along with this program; if not, write to the Free Software"
^XTV(8991,52,1,1,1,18,0)=" ; Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA"
^XTV(8991,52,1,1,1,19,0)=" ;"
^XTV(8991,52,1,1,1,20,0)=" ;;  VWSD LOGICAL TO ALLOW A NON-VA STATION ( NODE )WITH $D(HLVWNOVA) VARIABLE EXIST FOR HL LOGICAL LINKS"
^XTV(8991,52,1,1,1,21,0)=" ;"
^XTV(8991,52,1,1,1,22,0)="SETSHUT(LINKIEN) ;"
^XTV(8991,52,1,1,1,23,0)=" ;sets the shutdown flag (can not fail - if the link doesn't exist, by definition its shutdown)"
^XTV(8991,52,1,1,1,24,0)=" Q:'$G(LINKIEN) 1"
^XTV(8991,52,1,1,1,25,0)=" Q:'$D(^HLCS(870,LINKIEN,0)) 1"
^XTV(8991,52,1,1,1,26,0)=" S $P(^HLCS(870,LINKIEN,0),""^"",16)=1"
^XTV(8991,52,1,1,1,27,0)=" Q 1"
^XTV(8991,52,1,1,1,28,0)="SETOPEN(LINKIEN) ;"
^XTV(8991,52,1,1,1,29,0)=" ;clears the shutdown flag, returns 1 on success, 0 on failure"
^XTV(8991,52,1,1,1,30,0)=" Q:'$G(LINKIEN) 0"
^XTV(8991,52,1,1,1,31,0)=" Q:'$D(^HLCS(870,LINKIEN,0)) 0"
^XTV(8991,52,1,1,1,32,0)=" S $P(^HLCS(870,LINKIEN,0),""^"",16)="""""
^XTV(8991,52,1,1,1,33,0)=" Q 1"
^XTV(8991,52,1,1,1,34,0)=" ;"
^XTV(8991,52,1,1,1,35,0)="IFSHUT(LINKNAME) ;"
^XTV(8991,52,1,1,1,36,0)=" ;returns 1 if the link was shut down to HLO"
^XTV(8991,52,1,1,1,37,0)=" N IEN,LINK"
^XTV(8991,52,1,1,1,38,0)=" S LINK=$P($G(LINKNAME),"":"")"
^XTV(8991,52,1,1,1,39,0)=" Q:LINK="""""
^XTV(8991,52,1,1,1,40,0)=" S IEN=$O(^HLCS(870,""B"",LINK,0))"
^XTV(8991,52,1,1,1,41,0)=" Q:'IEN 1"
^XTV(8991,52,1,1,1,42,0)=" Q:$P($G(^HLCS(870,IEN,0)),""^"",16) 1"
^XTV(8991,52,1,1,1,43,0)=" Q 0"
^XTV(8991,52,1,1,1,44,0)=" ;"
^XTV(8991,52,1,1,1,45,0)="DOMAIN(LINKIEN) ;"
^XTV(8991,52,1,1,1,46,0)=" ;Returns the domain associated with this link"
^XTV(8991,52,1,1,1,47,0)=" ;"
^XTV(8991,52,1,1,1,48,0)=" Q:'$G(LINKIEN) """""
^XTV(8991,52,1,1,1,49,0)=" N NODE,DOMAIN"
^XTV(8991,52,1,1,1,50,0)=" S DOMAIN="""""
^XTV(8991,52,1,1,1,51,0)=" S NODE=$G(^HLCS(870,LINKIEN,0))"
^XTV(8991,52,1,1,1,52,0)=" I $P(NODE,""^"",7) D"
^XTV(8991,52,1,1,1,53,0)=" .S DOMAIN=$P($G(^DIC(4.2,$P(NODE,""^"",7),0)),""^"")"
^XTV(8991,52,1,1,1,54,0)=" .S DOMAIN=$S($L(DOMAIN):""HL7.""_DOMAIN,1:"""")"
^XTV(8991,52,1,1,1,55,0)=" I '$L(DOMAIN) S DOMAIN=$P(NODE,""^"",8)"
^XTV(8991,52,1,1,1,56,0)=" Q DOMAIN"
^XTV(8991,52,1,1,1,57,0)="PORT(LINKIEN) ;"
^XTV(8991,52,1,1,1,58,0)=" ;Returns the HLO port associated with this link"
^XTV(8991,52,1,1,1,59,0)=" ;"
^XTV(8991,52,1,1,1,60,0)=" Q:'$G(LINKIEN) """""
^XTV(8991,52,1,1,1,61,0)=" N NODE,PORT"
^XTV(8991,52,1,1,1,62,0)=" S NODE=$G(^HLCS(870,LINKIEN,400))"
^XTV(8991,52,1,1,1,63,0)=" S PORT=$P(NODE,""^"",8)"
^XTV(8991,52,1,1,1,64,0)=" S:'PORT PORT=$S($P($G(^HLD(779.1,1,0)),""^"",3)=""P"":5001,1:5026)"
^XTV(8991,52,1,1,1,65,0)=" Q PORT"
^XTV(8991,52,1,1,1,66,0)=" ;"
^XTV(8991,52,1,1,1,67,0)="PORT2(LINKNAME) ;given the name of the link, returns its HLO port"
^XTV(8991,52,1,1,1,68,0)=" Q $$PORT($O(^HLCS(870,""B"",LINKNAME,0)))"
^XTV(8991,52,1,1,1,69,0)=" ;"
^XTV(8991,52,1,1,1,70,0)="STATNUM(LINKIEN) ;"
^XTV(8991,52,1,1,1,71,0)=" ;Given the ien of the link, this function returns the station #."
^XTV(8991,52,1,1,1,72,0)=" ;"
^XTV(8991,52,1,1,1,73,0)=" Q:'$G(LINKIEN) """""
^XTV(8991,52,1,1,1,74,0)=" N INST"
^XTV(8991,52,1,1,1,75,0)=" S INST=$P($G(^HLCS(870,LINKIEN,0)),""^"",2)"
^XTV(8991,52,1,1,1,76,0)=" Q:'INST """""
^XTV(8991,52,1,1,1,77,0)=" Q $P($G(^DIC(4,INST,99)),""^"")"
^XTV(8991,52,1,1,1,78,0)=" ;"
^XTV(8991,52,1,1,1,79,0)="FINDLINK(STATN) ;"
^XTV(8991,52,1,1,1,80,0)=" ;Returns the link ien based on the station # =STATN"
^XTV(8991,52,1,1,1,81,0)=" ;The link found must have a name starting with ""VA"", as these are"
^XTV(8991,52,1,1,1,82,0)=" ;reserved for officially released links associated with VHA institutions"
^XTV(8991,52,1,1,1,83,0)=" ;** EXCEPTION** MPIVA is an official link associated with 200M"
^XTV(8991,52,1,1,1,84,0)=" ;***LOCAL VWSD - ALLOW NON-VA STATION (NODE) AS VARIABLE HLVWNOVA TO BE USED TO DETERMINE FACILITY LINK"
^XTV(8991,52,1,1,1,85,0)=" Q:'$L($G(STATN)) 0"
^XTV(8991,52,1,1,1,86,0)=" ;"
^XTV(8991,52,1,1,1,87,0)=" N NAME,IEN"
^XTV(8991,52,1,1,1,88,0)=" S (NAME,IEN)="""""
^XTV(8991,52,1,1,1,89,0)=" ; START LOCAL MOD VWSD FLAG HLVWNOVA"
^XTV(8991,52,1,1,1,90,0)=" ; F  S NAME=$O(^HLCS(870,""AC"",STATN,NAME)) Q:NAME=""""  I (NAME'=""VA-VIE""),($E(NAME,1,2)=""VA"")!(NAME=""MPIVA"") S IEN=$O(^HLCS(870,""AC"",STATN,NAME,0)) Q"
^XTV(8991,52,1,1,1,91,0)=" F  S NAME=$O(^HLCS(870,""AC"",STATN,NAME)) Q:NAME=""""  I (NAME'=""VA-VIE""),(($E(NAME,1,2)=""VA"")!(NAME=""MPIVA""))!$D(HLVWNOVA) S IEN=$O(^HLCS(870,""AC"",STATN,NAME,0)) Q"
^XTV(8991,52,1,1,1,92,0)=" ;END LOCAL MOD"
^XTV(8991,52,1,1,1,93,0)=" Q IEN"
^XTV(8991,52,1,1,1,94,0)=" ;"
^XTV(8991,52,1,1,1,95,0)="GETLINK(LINKNAME,LINK) ;"
^XTV(8991,52,1,1,1,96,0)=" N IEN"
^XTV(8991,52,1,1,1,97,0)=" S IEN=$O(^HLCS(870,""B"",LINKNAME,0))"
^XTV(8991,52,1,1,1,98,0)=" I IEN Q $$GET(IEN,.LINK)"
^XTV(8991,52,1,1,1,99,0)=" I LINKNAME=""HLO DEFAULT LISTENER"" D  Q 1"
^XTV(8991,52,1,1,1,100,0)=" .N NODE"
^XTV(8991,52,1,1,1,101,0)=" .S LINK(""NAME"")=LINKNAME"
^XTV(8991,52,1,1,1,102,0)=" .S LINK(""IEN"")=0"
^XTV(8991,52,1,1,1,103,0)=" .S LINK(""SHUTDOWN"")="""""
^XTV(8991,52,1,1,1,104,0)=" .S LINK(""LLP"")=""TCP"""
^XTV(8991,52,1,1,1,105,0)=" .S LINK(""SERVER"")=""1^""_""M"""
^XTV(8991,52,1,1,1,106,0)=" .S NODE=$G(^HLD(779.1,1,0))"
^XTV(8991,52,1,1,1,107,0)=" .S LINK(""DOMAIN"")=$P(NODE,""^"",1)"
^XTV(8991,52,1,1,1,108,0)=" .S LINK(""PORT"")=$S($P(NODE,""^"",3)=""P"":5001,$P(NODE,""^"",3)=""T"":5026,1:"""")"
^XTV(8991,52,1,1,1,109,0)=" .S LINK(""IP"")="""""
^XTV(8991,52,1,1,1,110,0)=" Q 0"
^XTV(8991,52,1,1,1,111,0)="GET(IEN,LINK) ;"
^XTV(8991,52,1,1,1,112,0)=" N NODE,PTR"
^XTV(8991,52,1,1,1,113,0)=" K LINK"
^XTV(8991,52,1,1,1,114,0)=" S NODE=$G(^HLCS(870,IEN,0))"
^XTV(8991,52,1,1,1,115,0)=" Q:NODE="""" 0"
^XTV(8991,52,1,1,1,116,0)=" S LINK(""NAME"")=$P(NODE,""^"")"
^XTV(8991,52,1,1,1,117,0)=" S LINK(""IEN"")=IEN"
^XTV(8991,52,1,1,1,118,0)=" S LINK(""SHUTDOWN"")=+$P(NODE,""^"",16)"
^XTV(8991,52,1,1,1,119,0)=" I $P(NODE,""^"",7) D"
^XTV(8991,52,1,1,1,120,0)=" .S LINK(""DOMAIN"")=$P(^DIC(4.2,$P(NODE,""^"",7),0),""^"")"
^XTV(8991,52,1,1,1,121,0)=" .S LINK(""DOMAIN"")=$S($L(LINK(""DOMAIN"")):""HL7.""_LINK(""DOMAIN""),1:"""")"
^XTV(8991,52,1,1,1,122,0)=" I $G(LINK(""DOMAIN""))="""" S LINK(""DOMAIN"")=$P(NODE,""^"",8)"
^XTV(8991,52,1,1,1,123,0)=" S PTR=$P(NODE,""^"",3)"
^XTV(8991,52,1,1,1,124,0)=" S LINK(""LLP"")=$S('PTR:"""",1:$P($G(^HLCS(869.1,PTR,0)),""^""))"
^XTV(8991,52,1,1,1,125,0)=" S LINK(""SERVER"")="""""
^XTV(8991,52,1,1,1,126,0)=" I LINK(""LLP"")=""TCP"" D"
^XTV(8991,52,1,1,1,127,0)=" .S LINK(""SERVER"")=1"
^XTV(8991,52,1,1,1,128,0)=" .S NODE=$G(^HLCS(870,IEN,400))"
^XTV(8991,52,1,1,1,129,0)=" .S LINK(""IP"")=$P(NODE,""^"")"
^XTV(8991,52,1,1,1,130,0)=" .S LINK(""PORT"")=$P(NODE,""^"",8)"
^XTV(8991,52,1,1,1,131,0)=" .S:'LINK(""PORT"") LINK(""PORT"")=$S($P($G(^HLD(779.1,1,0)),""^"",3)=""P"":5001,1:5026)"
^XTV(8991,52,1,1,1,132,0)=" .S:$P(NODE,""^"",3)=""C"" LINK(""SERVER"")=0"
^XTV(8991,52,1,1,1,133,0)=" .I LINK(""SERVER"") S LINK(""SERVER"")=LINK(""SERVER"")_""^""_$P(NODE,""^"",3)"
^XTV(8991,52,1,1,1,134,0)=" Q 1"
^XTV(8991,52,1,1,1,135,0)=" ;"
^XTV(8991,52,1,1,1,136,0)="SET1(LINK,MDOMAIN) ;"
^XTV(8991,52,1,1,1,137,0)=" N DOMAIN"
^XTV(8991,52,1,1,1,138,0)=" Q:'$L(MDOMAIN)"
^XTV(8991,52,1,1,1,139,0)=" S DOMAIN=$P($G(^DIC(4.2,MDOMAIN,0)),""^"")"
^XTV(8991,52,1,1,1,140,0)=" S DOMAIN=$S($L(DOMAIN):""HL7.""_DOMAIN,1:"""")"
^XTV(8991,52,1,1,1,141,0)=" I DOMAIN'="""" S ^HLCS(870,""AD"",""TCP"",DOMAIN,LINK)="""""
^XTV(8991,52,1,1,1,142,0)=" Q"
^XTV(8991,52,1,1,1,143,0)="KILL1(LINK,MDOMAIN) ;"
^XTV(8991,52,1,1,1,144,0)=" N DOMAIN"
^XTV(8991,52,1,1,1,145,0)=" Q:'$L(MDOMAIN)"
^XTV(8991,52,1,1,1,146,0)=" S DOMAIN=$P($G(^DIC(4.2,MDOMAIN,0)),""^"")"
^XTV(8991,52,1,1,1,147,0)=" S DOMAIN=$S($L(DOMAIN):""HL7.""_DOMAIN,1:"""")"
^XTV(8991,52,1,1,1,148,0)=" I DOMAIN'="""" K ^HLCS(870,""AD"",""TCP"",DOMAIN,LINK)"
^XTV(8991,52,1,1,1,149,0)=" Q"
^XTV(8991,52,1,1,1,150,0)="SET2(LINK,DOMAIN) ;"
^XTV(8991,52,1,1,1,151,0)=" I DOMAIN'="""" S ^HLCS(870,""AD"",""TCP"",DOMAIN,LINK)="""""
^XTV(8991,52,1,1,1,152,0)=" Q"
^XTV(8991,52,1,1,1,153,0)="KILL2(LINK,DOMAIN) ;"
^XTV(8991,52,1,1,1,154,0)=" I DOMAIN'="""" K ^HLCS(870,""AD"",""TCP"",DOMAIN,LINK)"
^XTV(8991,52,1,1,1,155,0)=" Q"
^XTV(8991,52,1,1,1,156,0)="SET3(LINK,DEVICE) ;"
^XTV(8991,52,1,1,1,157,0)=" Q:'DEVICE"
^XTV(8991,52,1,1,1,158,0)=" S ^HLCS(870,""AD"",""HLLP"",DEVICE,LINK)="""""
^XTV(8991,52,1,1,1,159,0)=" Q"
^XTV(8991,52,1,1,1,160,0)="KILL3(LINK,DEVICE) ;"
^XTV(8991,52,1,1,1,161,0)=" Q:'DEVICE"
^XTV(8991,52,1,1,1,162,0)=" S ^HLCS(870,""AD"",""HLLP"",DEVICE,LINK)="""""
^XTV(8991,52,1,1,1,163,0)=" Q"
^XTV(8991,52,1,1,1,164,0)="LLP(LINKNAME) ;"
^XTV(8991,52,1,1,1,165,0)=" ;finds the type of LLP for a named link"
^XTV(8991,52,1,1,1,166,0)=" N IEN,LLP"
^XTV(8991,52,1,1,1,167,0)=" S IEN=$O(^HLCS(870,""B"",LINKNAME,0))"
^XTV(8991,52,1,1,1,168,0)=" Q:'IEN """""
^XTV(8991,52,1,1,1,169,0)=" S LLP=$P($G(^HLCS(870,IEN,0)),""^"",3)"
^XTV(8991,52,1,1,1,170,0)=" Q:'LLP """""
^XTV(8991,52,1,1,1,171,0)=" Q $P($G(^HLCS(869.1,LLP,0)),""^"")"
^XTV(8991,52,1,1,1,172,0)=" ;"
^XTV(8991,52,1,1,1,173,0)="DEVICE(LINKNAME) ;"
^XTV(8991,52,1,1,1,174,0)=" N IEN"
^XTV(8991,52,1,1,1,175,0)=" S IEN=$O(^HLCS(870,""B"",LINKNAME,0))"
^XTV(8991,52,1,1,1,176,0)=" Q:'IEN """""
^XTV(8991,52,1,1,1,177,0)=" Q $P($G(^HLCS(870,IEN,200)),""^"")"
^XTV(8991,52,1,1,1,178,0)=" ;"
^XTV(8991,52,1,1,1,179,0)="RTRNLNK(COMP1,COMP2,COMP3) ;"
^XTV(8991,52,1,1,1,180,0)=" ;based on the sending facility from the original header, this function finds the return link, or """" if not successful"
^XTV(8991,52,1,1,1,181,0)=" ;Inputs:"
^XTV(8991,52,1,1,1,182,0)=" ;  COMP1,COMP2,COMP3 - 3 components of the sending facility from the original message"
^XTV(8991,52,1,1,1,183,0)=" ;"
^XTV(8991,52,1,1,1,184,0)=" N LINK,IEN"
^XTV(8991,52,1,1,1,185,0)=" S LINK="""""
^XTV(8991,52,1,1,1,186,0)=" I $G(COMP3)=""DNS"",$P($G(COMP2),"":"")]"""" S LINK=$O(^HLCS(870,""AD"",""TCP"",$P(COMP2,"":""),""""))"
^XTV(8991,52,1,1,1,187,0)=" I LINK="""",$L($G(COMP1)) S IEN=$$FINDLINK(COMP1) S:IEN LINK=$P($G(^HLCS(870,IEN,0)),""^"")"
^XTV(8991,52,1,1,1,188,0)=" Q LINK"
^XTV(8991,52,1,1,1,189,0)=" ;"
^XTV(8991,52,1,1,1,190,0)=" ;HLLP is not implemented in HLO"
^XTV(8991,52,1,1,1,191,0)=" ;I LLP=""HLLP"" N DEVICE S DEVICE=$$DEVICE(FROMLINK) I DEVICE Q $O(^HLCS(870,""AD"",""TCP"",DEVICE,""""))"
^XTV(8991,52,1,1,1,192,0)=" ;Q """""
^XTV(8991,52,1,1,1,193,0)=" ;"
^XTV(8991,52,1,1,1,194,0)="CHKLINK(LINK) ;"
^XTV(8991,52,1,1,1,195,0)=" Q:'$L(LINK) 0"
^XTV(8991,52,1,1,1,196,0)=" Q:'$O(^HLCS(870,""B"",LINK,0)) 0"
^XTV(8991,52,1,1,1,197,0)=" Q 1"
^XTV(8991,52,1,"B",3070123.1659,1)=""
^XTV(8991,53,0)="LRX"
^XTV(8991,53,1,0)="^8991.01^1^1"
^XTV(8991,53,1,1,0)="3070123.17"
^XTV(8991,53,1,1,1,0)="^8991.11^229^229"
^XTV(8991,53,1,1,1,1,0)="LRX ;SLC/BA/DALISC/FHS - UTILITY ROUTINES -- PREVIOUSLY ^LAB(""X"",""..."") ;1/23/07  17:00"
^XTV(8991,53,1,1,1,2,0)=" ;;5.2;LAB SERVICE;**65,153,201,217,290,360,350**;Sep 27, 1994;Build 1"
^XTV(8991,53,1,1,1,3,0)="PT ;patient info"
^XTV(8991,53,1,1,1,4,0)=" ;"
^XTV(8991,53,1,1,1,5,0)=" N X,I,N,Y"
^XTV(8991,53,1,1,1,6,0)=" D KVAR^VADPT"
^XTV(8991,53,1,1,1,7,0)=" K LRTREA,LRWRD,AGE S (AGE,PNM,SEX,DOB,DOD,SSN,VA200,LRWRD,LRRB,LRTREA,VA(""PID""),VA(""BID""))="""""
^XTV(8991,53,1,1,1,8,0)=" I $G(LRDFN),'$G(LRDPF),$G(^LR(LRDFN,0)) S LRDPF=$P(^(0),U,2),DFN=$P(^(0),U,3)"
^XTV(8991,53,1,1,1,9,0)=" S LREND=0 S:$G(DFN)<1!('$G(LRDPF)) LREND=1 Q:$G(LREND)"
^XTV(8991,53,1,1,1,10,0)=" I +$G(LRDPF)'=2 D"
^XTV(8991,53,1,1,1,11,0)=" . S X=$$GET1^DID(1,+LRDPF,"""",""GLOBAL NAME"",""ANS"",""ANS1"")"
^XTV(8991,53,1,1,1,12,0)=" . S X=X_DFN_"",0)"",X=$S($D(@X):@X,1:""""),LRWRD=$S($D(^(.1)):$P(^(.1),U),1:0),LRRB=$S($D(^(.101)):$P(^(.101),U),1:""""),DOD=$S($D(^(.35)):$P(^(.35),U),1:"""")"
^XTV(8991,53,1,1,1,13,0)=" . S PNM=$P(X,U),SSN=$P(X,U,9) Q:+$G(LRDPF)=62.3"
^XTV(8991,53,1,1,1,14,0)=" . S SEX=$P(X,U,2),SEX=$S(SEX="""":""M"",1:SEX)"
^XTV(8991,53,1,1,1,15,0)=" . S DOB=$P(X,U,3)"
^XTV(8991,53,1,1,1,16,0)=" . S AGE=$S($D(DT)&(DOB?1(7N,7N1""."".6N)):DT-DOB\10000,1:""??"")"
^XTV(8991,53,1,1,1,17,0)=" . S AGE(2)=$$AGE2(DOB,$G(LRCDT)) ;Age of the patient when the specimen was collected (default =99Yr if no valid DOB present)"
^XTV(8991,53,1,1,1,18,0)=" . ;Default for LRCDT (collection date) is DT"
^XTV(8991,53,1,1,1,19,0)=" I +$G(LRDPF)=2 D"
^XTV(8991,53,1,1,1,20,0)=" . N I,X,N,Y"
^XTV(8991,53,1,1,1,21,0)=" . D OERR^VADPT D:'VAERR"
^XTV(8991,53,1,1,1,22,0)=" . . S PNM=VADM(1)"
^XTV(8991,53,1,1,1,23,0)=" . . S SEX=$P(VADM(5),U),DOB=$P(VADM(3),U),DOD=$P(VADM(6),U)"
^XTV(8991,53,1,1,1,24,0)=" . . S AGE=VADM(4),AGE(2)=$$AGE2(DOB,$G(LRCDT))"
^XTV(8991,53,1,1,1,25,0)=" ; . . S SSN=$P(VADM(2),U),LRWRD=$P(VAIN(4),U,2)"
^XTV(8991,53,1,1,1,26,0)=" . . S SSN=VA(""PID""),LRWRD=$P(VAIN(4),U,2) ; for VOE"
^XTV(8991,53,1,1,1,27,0)=" . . S LRWRD(1)=+VAIN(4),LRRB=VAIN(5),LRPRAC=+VAIN(2)"
^XTV(8991,53,1,1,1,28,0)=" . . S:VAIN(3) LRTREA=+VAIN(3)"
^XTV(8991,53,1,1,1,29,0)=" D SSNFM^LRU"
^XTV(8991,53,1,1,1,30,0)=" Q"
^XTV(8991,53,1,1,1,31,0)="DEM ;Call DEM^VADPT instead of OERR used above"
^XTV(8991,53,1,1,1,32,0)=" N X,I,N,Y"
^XTV(8991,53,1,1,1,33,0)=" D KVAR^VADPT"
^XTV(8991,53,1,1,1,34,0)=" K LRTREA,LRWRD,AGE S (AGE,PNM,SEX,DOB,SSN,VA200,LRWRD,LRRB,LRTREA,VA(""PID""),VA(""BID""))="""""
^XTV(8991,53,1,1,1,35,0)=" I $G(LRDFN),'$G(LRDPF),$G(^LR(LRDFN,0)) S LRDPF=$P(^(0),U,2),DFN=$P(^(0),U,3)"
^XTV(8991,53,1,1,1,36,0)=" S LREND=0 S:$G(DFN)<1!('$G(LRDPF)) LREND=1 Q:$G(LREND)"
^XTV(8991,53,1,1,1,37,0)=" I +$G(LRDPF)'=2 D"
^XTV(8991,53,1,1,1,38,0)=" . S X=^DIC(+LRDPF,0,""GL"")_DFN_"",0)"",X=$S($D(@X):@X,1:""""),LRWRD=$S($D(^(.1)):$P(^(.1),U),1:0),LRRB=$S($D(^(.101)):$P(^(.101),U),1:"""")"
^XTV(8991,53,1,1,1,39,0)=" . S PNM=$P(X,U),SEX=$P(X,U,2),SEX=$S(SEX="""":""M"",1:SEX),DOB=$P(X,U,3)"
^XTV(8991,53,1,1,1,40,0)=" . S AGE=$S($D(DT)&(DOB?1(7N,7N1""."".6N)):DT-DOB\10000,1:""??"")"
^XTV(8991,53,1,1,1,41,0)=" . S AGE(2)=$$AGE2(DOB,$G(LRCDT))"
^XTV(8991,53,1,1,1,42,0)=" . S SSN=$P(X,U,9)"
^XTV(8991,53,1,1,1,43,0)=" I +$G(LRDPF)=2 N I,X,N,Y D"
^XTV(8991,53,1,1,1,44,0)=" . D DEM^VADPT D:'VAERR"
^XTV(8991,53,1,1,1,45,0)=" . . S PNM=VADM(1),SEX=$P(VADM(5),U)"
^XTV(8991,53,1,1,1,46,0)=" ; . . S DOB=$P(VADM(3),U),SSN=$P(VADM(2),U)"
^XTV(8991,53,1,1,1,47,0)=" . . S DOB=$P(VADM(3),U),SSN=VA(""PID"") ; for VOE"
^XTV(8991,53,1,1,1,48,0)=" . . S AGE=VADM(4),AGE(2)=$$AGE2(DOB,$G(LRCDT))"
^XTV(8991,53,1,1,1,49,0)=" D SSNFM^LRU"
^XTV(8991,53,1,1,1,50,0)=" Q"
^XTV(8991,53,1,1,1,51,0)="DD ;date/time format"
^XTV(8991,53,1,1,1,52,0)=" S Y=$$FMTE^XLFDT(Y,""5Z"")"
^XTV(8991,53,1,1,1,53,0)=" S Y=$P(Y,""@"")_"" ""_$P($P(Y,""@"",2),"":"",1,2)"
^XTV(8991,53,1,1,1,54,0)=" Q"
^XTV(8991,53,1,1,1,55,0)="DDOLD ;OLD"
^XTV(8991,53,1,1,1,56,0)=" I $E(Y,4,7)=""0000"" S Y=$S($E(Y)=2:""19""_$E(Y,2,3),1:""20""_$E(Y,2,3)) Q"
^XTV(8991,53,1,1,1,57,0)=" S Y=$E(Y,4,5)_""/""_$E(Y,6,7)_""/""_$E(Y,2,3)_$S(Y#1:"" ""_$E(Y_0,9,10)_"":""_$E(Y_""000"",11,12),1:"""")"
^XTV(8991,53,1,1,1,58,0)=" Q"
^XTV(8991,53,1,1,1,59,0)="DT ;current date format is LRDT0"
^XTV(8991,53,1,1,1,60,0)=" N X,DIK,DIC,%I,DICS,%DT"
^XTV(8991,53,1,1,1,61,0)=" D DT^DICRW"
^XTV(8991,53,1,1,1,62,0)=" S Y=$$FMTE^XLFDT(DT,""5D"")"
^XTV(8991,53,1,1,1,63,0)=" S LRDT0=Y"
^XTV(8991,53,1,1,1,64,0)=" Q"
^XTV(8991,53,1,1,1,65,0)="DTOLD ;2-DIGIT"
^XTV(8991,53,1,1,1,66,0)=" ;current date format is LRDT0"
^XTV(8991,53,1,1,1,67,0)=" N X,DIK,DIC,%I,DICS,%DT"
^XTV(8991,53,1,1,1,68,0)=" D DT^DICRW"
^XTV(8991,53,1,1,1,69,0)=" S Y=$P(DT,""."") D DDOLD S LRDTO=Y"
^XTV(8991,53,1,1,1,70,0)=" Q"
^XTV(8991,53,1,1,1,71,0)="DASH ;line of dashes"
^XTV(8991,53,1,1,1,72,0)=" W !,$E(""--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------"",1,IOM-1)"
^XTV(8991,53,1,1,1,73,0)=" Q"
^XTV(8991,53,1,1,1,74,0)="EQUALS ;line of equals"
^XTV(8991,53,1,1,1,75,0)=" W !,$E(""===================================================================================================================================================================================================================="",1,IOM-1)"
^XTV(8991,53,1,1,1,76,0)=" Q"
^XTV(8991,53,1,1,1,77,0)="DUZ ;user info"
^XTV(8991,53,1,1,1,78,0)=" S (LRUSNM,LRUSI)="""" Q:'$D(X)  Q:'$D(^VA(200,+X,0))  S LRUSNM=$P(^(0),""^""),LRUSI=$P(^(0),""^"",2)"
^XTV(8991,53,1,1,1,79,0)=" Q"
^XTV(8991,53,1,1,1,80,0)="DOC ;provider info"
^XTV(8991,53,1,1,1,81,0)=" I $L(X),'X S LRDOC=X Q"
^XTV(8991,53,1,1,1,82,0)=" S LRDOC=$P($G(^VA(200,+X,0)),U)"
^XTV(8991,53,1,1,1,83,0)=" S:LRDOC="""" LRDOC=""Unknown"""
^XTV(8991,53,1,1,1,84,0)=" Q"
^XTV(8991,53,1,1,1,85,0)="PRAC(X) ;prac info"
^XTV(8991,53,1,1,1,86,0)=" N Y"
^XTV(8991,53,1,1,1,87,0)=" I $L(X),'X Q X"
^XTV(8991,53,1,1,1,88,0)=" S Y=$P($G(^VA(200,+X,0)),U)"
^XTV(8991,53,1,1,1,89,0)=" S:Y="""" Y=""Unknown"""
^XTV(8991,53,1,1,1,90,0)=" Q Y"
^XTV(8991,53,1,1,1,91,0)="YMD ;year/month/date"
^XTV(8991,53,1,1,1,92,0)=" S %=%H>21549+%H-.1,%Y=%\365.25+141,%=%#365.25\1,%D=%+306#(%Y#4=0+365)#153#61#31+1,%M=%-%D\29+1,X=%Y_""00""+%M_""00""+%D K %Y,%D,%M,%"
^XTV(8991,53,1,1,1,93,0)=" Q"
^XTV(8991,53,1,1,1,94,0)="STAMP ;time stamp"
^XTV(8991,53,1,1,1,95,0)=" S X=""N"",%DT=""ET"" D ^%DT"
^XTV(8991,53,1,1,1,96,0)=" Q"
^XTV(8991,53,1,1,1,97,0)="KEYCOM ;key to result flags"
^XTV(8991,53,1,1,1,98,0)=" D EQUALS W !!,""  ------------------------------  COMMENTS  ------------------------------"",!,""  Key:  'L' = reference Low,  'H' = reference Hi, '*' = critical range"""
^XTV(8991,53,1,1,1,99,0)=" Q"
^XTV(8991,53,1,1,1,100,0)="URG ;urgencys"
^XTV(8991,53,1,1,1,101,0)=" K LRURG S LRURG(0)=""ROUTINE"" S I=0 F  S I=$O(^LAB(62.05,I)) Q:I<1  I $D(^(I,0)) S:'$P(^(0),U,3) LRURG(I)=$P(^(0),U)"
^XTV(8991,53,1,1,1,102,0)=" Q"
^XTV(8991,53,1,1,1,103,0)="ADD ;date format"
^XTV(8991,53,1,1,1,104,0)=" S Y=$E(""JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC"",$E(Y,4,5)*3-2,$E(Y,4,5)*3)_"" ""_$S(Y#100:$J(Y#100\1,2)_"", "",1:"""")_(Y\10000+1700)_$S(Y#1:""  ""_$E(Y_0,9,10)_"":""_$E(Y_""000"",11,12),1:"""")"
^XTV(8991,53,1,1,1,105,0)=" Q"
^XTV(8991,53,1,1,1,106,0)="INF ;Display Infectious Warning"
^XTV(8991,53,1,1,1,107,0)=" I $L($G(IO)),$D(^LR(LRDFN,.091)),$L(^(.091)),'$G(LRQUIET) W !,$C(7),"" Pat Info: "",^(.091) Q"
^XTV(8991,53,1,1,1,108,0)=" Q"
^XTV(8991,53,1,1,1,109,0)="LRGLIN ;"
^XTV(8991,53,1,1,1,110,0)=" N HZ"
^XTV(8991,53,1,1,1,111,0)=" D GSET^%ZISS W IOG1"
^XTV(8991,53,1,1,1,112,0)=" F HZ=1:1:79 W IOHL"
^XTV(8991,53,1,1,1,113,0)=" W IOG0 D GKILL^%ZISS"
^XTV(8991,53,1,1,1,114,0)=" W !"
^XTV(8991,53,1,1,1,115,0)=" Q"
^XTV(8991,53,1,1,1,116,0)="LRUID(LRAA,LRAD,LRAN) ;Extrinsic function call to create a unique "
^XTV(8991,53,1,1,1,117,0)=" ;accession identifier for an accession number.  See description"
^XTV(8991,53,1,1,1,118,0)=" ;of field .092 in file 68 for a full explanation of this number.   "
^XTV(8991,53,1,1,1,119,0)=" ;This function returns a value equal to the unique ID generated."
^XTV(8991,53,1,1,1,120,0)=" ;LRAA=ien in file 68, accession area"
^XTV(8991,53,1,1,1,121,0)=" ;LRAD=ien for accession date in field 68.01"
^XTV(8991,53,1,1,1,122,0)=" ;LRAN=ien for accession number in field 68.02"
^XTV(8991,53,1,1,1,123,0)=" Q:$S('$G(LRAA):1,'$D(^LRO(68,LRAA,.4)):1,1:0) 0"
^XTV(8991,53,1,1,1,124,0)=" N DA,DIE,DLAYGO,DR,LRMNTH,LRUID,LRQTR,LRTYPE,LRYR1,LRYR2,LRJUL"
^XTV(8991,53,1,1,1,125,0)=" S LRUID=$P($G(^LRO(68,LRAA,.4)),""^"") ;start building LRUID"
^XTV(8991,53,1,1,1,126,0)=" S:$L(LRUID)'=2 LRUID=""0""_LRUID"
^XTV(8991,53,1,1,1,127,0)=" S LRTYPE=$P($G(^LRO(68,LRAA,0)),""^"",3)"
^XTV(8991,53,1,1,1,128,0)=" S LRYR1=$E(LRAD,3)"
^XTV(8991,53,1,1,1,129,0)=" S LRYR2=$E(LRAD,2,3)"
^XTV(8991,53,1,1,1,130,0)=" S LRMNTH=$E(LRAD,4,5)"
^XTV(8991,53,1,1,1,131,0)=" S LRQTR=0_(LRMNTH\3.1+1)"
^XTV(8991,53,1,1,1,132,0)=" I ""DW""[LRTYPE D"
^XTV(8991,53,1,1,1,133,0)=" . S X1=LRAD,X2=$E(LRAD,1,3)_""0101"" D ^%DTC"
^XTV(8991,53,1,1,1,134,0)=" . S X=X+1,LRJUL=$E(""000"",1,3-$L(X))_X"
^XTV(8991,53,1,1,1,135,0)=" . S LRUID=LRUID_LRYR1_LRJUL"
^XTV(8991,53,1,1,1,136,0)=" . S LRUID=LRUID_$E(""0000"",1,4-$L(LRAN))_LRAN"
^XTV(8991,53,1,1,1,137,0)=" I LRTYPE=""Y"" D"
^XTV(8991,53,1,1,1,138,0)=" . S LRUID=LRUID_LRYR2_$E(""000000"",1,6-$L(LRAN))_LRAN"
^XTV(8991,53,1,1,1,139,0)=" I LRTYPE=""Q"" D"
^XTV(8991,53,1,1,1,140,0)=" . S LRUID=LRUID_LRYR1_LRQTR"
^XTV(8991,53,1,1,1,141,0)=" . S LRUID=LRUID_$E(""00000"",1,5-$L(LRAN))_LRAN"
^XTV(8991,53,1,1,1,142,0)=" I LRTYPE=""M"" D"
^XTV(8991,53,1,1,1,143,0)=" . S LRUID=LRUID_LRYR1_LRMNTH_$E(""00000"",1,5-$L(LRAN))_LRAN"
^XTV(8991,53,1,1,1,144,0)=" L +^LRO(68,""C""):99999"
^XTV(8991,53,1,1,1,145,0)=" I $D(^LRO(68,""C"",LRUID)),'$D(^LRO(68,""C"",LRUID,LRAA,LRAD,LRAN)) D"
^XTV(8991,53,1,1,1,146,0)=" . N X"
^XTV(8991,53,1,1,1,147,0)=" . S X=$E(LRUID,3,10)"
^XTV(8991,53,1,1,1,148,0)=" . F  S LRUID=""00""_X Q:'$D(^LRO(68,""C"",LRUID))  S X=X+1 S:X>99999999 X=11111111"
^XTV(8991,53,1,1,1,149,0)=" ;The following fields are also set in rtn LROLOVER"
^XTV(8991,53,1,1,1,150,0)="SET3 I $G(LRORDRR)'=""R"" S DR=""16////""_LRUID"
^XTV(8991,53,1,1,1,151,0)=" I $G(LRORDRR)=""R"" D"
^XTV(8991,53,1,1,1,152,0)=" . S DR="";16.1////""_+$G(LRRSITE(""RSITE""))_"";16.2////""_+$G(LRRSITE(""RPSITE""))_"";16.3////""_LRUID_"";16.4////""_LRSD(""RUID"")"
^XTV(8991,53,1,1,1,153,0)=" . I '$G(LRRSITE(""IDTYPE"")),'$D(^LRO(68,""C"",LRSD(""RUID""))) S LRUID=LRSD(""RUID"") ; Use sender's UID, unless previously used."
^XTV(8991,53,1,1,1,154,0)=" . S DR=""16////""_LRUID_DR"
^XTV(8991,53,1,1,1,155,0)=" S DA=LRAN,DA(1)=LRAD,DA(2)=LRAA,DIE=""^LRO(68,""_DA(2)_"",1,""_DA(1)_"",1,"",DLAYGO=68"
^XTV(8991,53,1,1,1,156,0)=" D ^DIE"
^XTV(8991,53,1,1,1,157,0)=" L -^LRO(68,""C"")"
^XTV(8991,53,1,1,1,158,0)=" S LRORU3=$G(^LRO(68,LRAA,1,LRAD,1,LRAN,.3))"
^XTV(8991,53,1,1,1,159,0)=" Q LRUID"
^XTV(8991,53,1,1,1,160,0)=" ;"
^XTV(8991,53,1,1,1,161,0)="KVAR ;Kill laboratory/VADPT patient demographics"
^XTV(8991,53,1,1,1,162,0)=" K LRTREA,LRWRD,PNM,SEX,DOB,DOD,SSN,LRWRD,LRRB,LRTREA,VA,LRDFN,LRDPF,LREND,VAERR"
^XTV(8991,53,1,1,1,163,0)=" D KVA^VADPT"
^XTV(8991,53,1,1,1,164,0)=" Q"
^XTV(8991,53,1,1,1,165,0)="ADDPT ;Returns VAPA( Patient data"
^XTV(8991,53,1,1,1,166,0)=" N X,I,N,Y D ADD^VADPT Q"
^XTV(8991,53,1,1,1,167,0)="OPDPT ;Returns VAPD( Patient data"
^XTV(8991,53,1,1,1,168,0)=" N X,I,N,Y D OPD^VADPT Q"
^XTV(8991,53,1,1,1,169,0)="SVCPT ;Returns VASV( Patient data"
^XTV(8991,53,1,1,1,170,0)=" N X,I,N,Y D SVC^VADPT Q"
^XTV(8991,53,1,1,1,171,0)="OADPT ;Returns VAOA( Patient data"
^XTV(8991,53,1,1,1,172,0)=" N X,I,N,Y D OAD^VADPT Q"
^XTV(8991,53,1,1,1,173,0)="INPPT ;Returns VAIN( Patient data"
^XTV(8991,53,1,1,1,174,0)=" N X,I,N,Y D INP^VADPT Q"
^XTV(8991,53,1,1,1,175,0)="IN5PT ;Returns VAIP( Patient data"
^XTV(8991,53,1,1,1,176,0)=" N X,I,N,Y D IN5^VADPT Q"
^XTV(8991,53,1,1,1,177,0)="PIDPT ;Returns VA(""PID"") and VA(""BID"") Patient Identifier"
^XTV(8991,53,1,1,1,178,0)=" N X,I,N,Y D PID^VADPT Q"
^XTV(8991,53,1,1,1,179,0)=" ;"
^XTV(8991,53,1,1,1,180,0)=" ;"
^XTV(8991,53,1,1,1,181,0)=" QUIT"
^XTV(8991,53,1,1,1,182,0)="Y2K(X,LRYR) ;   --> used to convert 2digit year to 4digit century and year"
^XTV(8991,53,1,1,1,183,0)=" ; 1/1/91 TO 1/1/1991"
^XTV(8991,53,1,1,1,184,0)=" ;"
^XTV(8991,53,1,1,1,185,0)=" ;S X=$P(X,""."") ;--> Date only. Not time"
^XTV(8991,53,1,1,1,186,0)=" S LRYR=$G(LRYR,""5S"")"
^XTV(8991,53,1,1,1,187,0)=" N YR"
^XTV(8991,53,1,1,1,188,0)=" S Y=$$FMTE^XLFDT(X,LRYR)"
^XTV(8991,53,1,1,1,189,0)=" I $L($P(Y,""/""))=1 S $P(Y,""/"")=""0""_$P(Y,""/"") ;--> pad for 2digit day"
^XTV(8991,53,1,1,1,190,0)=" I $L($P(Y,""/"",2))=1 S $P(Y,""/"",2)=""0""_$P(Y,""/"",2) ;--> for 2digit month"
^XTV(8991,53,1,1,1,191,0)=" Q Y"
^XTV(8991,53,1,1,1,192,0)=" ;"
^XTV(8991,53,1,1,1,193,0)=" QUIT"
^XTV(8991,53,1,1,1,194,0)="RD ;DIR read"
^XTV(8991,53,1,1,1,195,0)=" N Y,X"
^XTV(8991,53,1,1,1,196,0)=" K LRANSY,LRANSX"
^XTV(8991,53,1,1,1,197,0)=" S LREND=0 W !"
^XTV(8991,53,1,1,1,198,0)=" D ^DIR I $D(DTOUT)!($D(DUOUT))!($D(DIRUT))!($D(DIROUT)) S LREND=1"
^XTV(8991,53,1,1,1,199,0)=" S LRANSY=$G(Y),LRANSX=$G(X)"
^XTV(8991,53,1,1,1,200,0)=" Q"
^XTV(8991,53,1,1,1,201,0)="AGE2(DOB,LRCDT) ;Entry point if passing only a valid Date without patient"
^XTV(8991,53,1,1,1,202,0)=" ;   DOB, LRCDT must be defined in VA FileManager internal format"
^XTV(8991,53,1,1,1,203,0)=" ; Date error will return 99yr"
^XTV(8991,53,1,1,1,204,0)=" N X,Y,%DT"
^XTV(8991,53,1,1,1,205,0)=" I '$G(LRCDT) S LRCDT=$$DT^XLFDT"
^XTV(8991,53,1,1,1,206,0)=" I '$G(DOB) Q ""99yr""  ;no DOB passed"
^XTV(8991,53,1,1,1,207,0)=" S DOB=$P(DOB,""."")"
^XTV(8991,53,1,1,1,208,0)=" S X=DOB,LRCDT=$P(LRCDT,""."")"
^XTV(8991,53,1,1,1,209,0)=" I $S(DOB'=+DOB:1,LRCDT'=+LRCDT:1,1:0) Q ""99yr"""
^XTV(8991,53,1,1,1,210,0)=" I $S(DOB'?7N.NE:1,LRCDT'?7N.NE:1,1:0) Q ""99yr"""
^XTV(8991,53,1,1,1,211,0)=" D ^%DT I Y'>0 Q ""99yr""  ;invalid date"
^XTV(8991,53,1,1,1,212,0)=" S X=LRCDT"
^XTV(8991,53,1,1,1,213,0)=" K %DT D ^%DT I Y'>0 Q ""99yr""  ;invalid date"
^XTV(8991,53,1,1,1,214,0)=" ;"
^XTV(8991,53,1,1,1,215,0)="CALC ;Calculate timeframe based on difference between DOB and collection"
^XTV(8991,53,1,1,1,216,0)=" ; date. Time is stripped off."
^XTV(8991,53,1,1,1,217,0)=" ; .0001-24 hour = dy"
^XTV(8991,53,1,1,1,218,0)=" ; 0-29 days = dy"
^XTV(8991,53,1,1,1,219,0)=" ; 30-730 dy = mo"
^XTV(8991,53,1,1,1,220,0)=" ; >24 mo = yr"
^XTV(8991,53,1,1,1,221,0)=" ;"
^XTV(8991,53,1,1,1,222,0)=" I DOB>LRCDT Q ""99yr""  ;DOB in future"
^XTV(8991,53,1,1,1,223,0)=" I DOB=LRCDT Q ""1dy""  ;same dates---pass 1 day old"
^XTV(8991,53,1,1,1,224,0)=" S X=$E(LRCDT,1,3)-$E(DOB,1,3)-($E(LRCDT,4,7)<$E(DOB,4,7))"
^XTV(8991,53,1,1,1,225,0)=" I X>1 S X=+X_""yr"" Q X   ;age 2 years or more---pass in years"
^XTV(8991,53,1,1,1,226,0)=" S X=$$FMDIFF^XLFDT(LRCDT,DOB,1)"
^XTV(8991,53,1,1,1,227,0)=" I X>30 S X=X\30_""mo"" Q X  ;over 30 days---pass in months"
^XTV(8991,53,1,1,1,228,0)=" E  S X=X_""dy"" Q X  ;under 31 days---pass in days"
^XTV(8991,53,1,1,1,229,0)=" Q ""99yr"""
^XTV(8991,53,1,"B",3070123.17,1)=""
^XTV(8991,54,0)="ORWDX"
^XTV(8991,54,1,0)="^8991.01^1^1"
^XTV(8991,54,1,1,0)="3070123.1704"
^XTV(8991,54,1,1,1,0)="^8991.11^230^230"
^XTV(8991,54,1,1,1,1,0)="ORWDX ; SLC/KCM/REV/JLI - Order dailog utilities ;1/23/07  17:04"
^XTV(8991,54,1,1,1,2,0)=" ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,125,131,132,141,164,178,187,190,195,215,269**;Dec 17, 1997;Build 2"
^XTV(8991,54,1,1,1,3,0)=" ; Modified from FOIA VISTA,"
^XTV(8991,54,1,1,1,4,0)=" ; Copyright (C) 2007 WorldVistA"
^XTV(8991,54,1,1,1,5,0)=" ;"
^XTV(8991,54,1,1,1,6,0)=" ; This program is free software; you can redistribute it and/or modify"
^XTV(8991,54,1,1,1,7,0)=" ; it under the terms of the GNU General Public License as published by"
^XTV(8991,54,1,1,1,8,0)=" ; the Free Software Foundation; either version 2 of the License, or"
^XTV(8991,54,1,1,1,9,0)=" ; (at your option) any later version."
^XTV(8991,54,1,1,1,10,0)=" ;"
^XTV(8991,54,1,1,1,11,0)=" ; This program is distributed in the hope that it will be useful,"
^XTV(8991,54,1,1,1,12,0)=" ; but WITHOUT ANY WARRANTY; without even the implied warranty of"
^XTV(8991,54,1,1,1,13,0)=" ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the"
^XTV(8991,54,1,1,1,14,0)=" ; GNU General Public License for more details."
^XTV(8991,54,1,1,1,15,0)=" ;"
^XTV(8991,54,1,1,1,16,0)=" ; You should have received a copy of the GNU General Public License"
^XTV(8991,54,1,1,1,17,0)=" ; along with this program; if not, write to the Free Software"
^XTV(8991,54,1,1,1,18,0)=" ; Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA"
^XTV(8991,54,1,1,1,19,0)="NXT() ; -- Gets index in array"
^XTV(8991,54,1,1,1,20,0)=" S ILST=ILST+1"
^XTV(8991,54,1,1,1,21,0)=" Q ILST"
^XTV(8991,54,1,1,1,22,0)=" ;"
^XTV(8991,54,1,1,1,23,0)="ORDITM(Y,FROM,DIR,XREF) ; Subset of orderable items"
^XTV(8991,54,1,1,1,24,0)=" ; Y(n)=IEN^.01 Name^.01 Name  -or-  IEN^Synonym <.01 Name>^.01 Name"
^XTV(8991,54,1,1,1,25,0)=" N I,IEN,CNT,X,DTXT,CURTM"
^XTV(8991,54,1,1,1,26,0)=" S I=0,CNT=44,CURTM=$$NOW^XLFDT"
^XTV(8991,54,1,1,1,27,0)=" F  Q:I'<CNT  S FROM=$O(^ORD(101.43,XREF,FROM),DIR) Q:FROM=""""  D"
^XTV(8991,54,1,1,1,28,0)=" . S IEN="""" F  S IEN=$O(^ORD(101.43,XREF,FROM,IEN),DIR) Q:'IEN  D"
^XTV(8991,54,1,1,1,29,0)=" . . S X=^ORD(101.43,XREF,FROM,IEN)"
^XTV(8991,54,1,1,1,30,0)=" . . I +$P(X,U,3),$P(X,U,3)<CURTM Q"
^XTV(8991,54,1,1,1,31,0)=" . . Q:$P(X,U,5)  S I=I+1"
^XTV(8991,54,1,1,1,32,0)=" . . I 'X S Y(I)=IEN_U_$P(X,U,2)_U_$P(X,U,2)"
^XTV(8991,54,1,1,1,33,0)=" . . E  S Y(I)=IEN_U_$P(X,U,2)_$C(9)_""<""_$P(X,U,4)_"">""_U_$P(X,U,4)"
^XTV(8991,54,1,1,1,34,0)=" Q"
^XTV(8991,54,1,1,1,35,0)="ODITMBC(Y,XREF,ODLST) ;"
^XTV(8991,54,1,1,1,36,0)=" N CNT,NM,XRF"
^XTV(8991,54,1,1,1,37,0)=" S CNT=0,NM=0,XRF=XREF"
^XTV(8991,54,1,1,1,38,0)=" F  S CNT=$O(ODLST(CNT)) Q:'CNT  D FNDINFO(.Y,ODLST(CNT))"
^XTV(8991,54,1,1,1,39,0)=" Q"
^XTV(8991,54,1,1,1,40,0)="FNDINFO(Y,ODIEN) ;"
^XTV(8991,54,1,1,1,41,0)=" D FNDINFO^ORWDX1(.Y,.ODIEN)"
^XTV(8991,54,1,1,1,42,0)=" Q"
^XTV(8991,54,1,1,1,43,0)="DLGDEF(LST,DLG) ; Format mapping for a dlg"
^XTV(8991,54,1,1,1,44,0)=" D DLGDEF^ORWDX1(.LST,.DLG)"
^XTV(8991,54,1,1,1,45,0)=" Q"
^XTV(8991,54,1,1,1,46,0)="DLGQUIK(LST,QO) ;(NOT USED)"
^XTV(8991,54,1,1,1,47,0)=" D LOADRSP(.LST,QO)"
^XTV(8991,54,1,1,1,48,0)=" Q"
^XTV(8991,54,1,1,1,49,0)="LOADRSP(LST,RSPID)      ; Load responses from 101.41 or 100"
^XTV(8991,54,1,1,1,50,0)=" ; RSPID:  C123456;1-3243 = cached copy,   134-3234 = cached quick"
^XTV(8991,54,1,1,1,51,0)=" ;         X123456;1      = change order,  134      = quick dialog"
^XTV(8991,54,1,1,1,52,0)=" N I,J,DLG,INST,ID,VAL,ILST,ROOT S ROOT="""""
^XTV(8991,54,1,1,1,53,0)=" I RSPID[""-"" S ROOT=""^TMP(""""ORWDXMQ"""",$J,""""""_RSPID_"""""")"" G XROOT"
^XTV(8991,54,1,1,1,54,0)=" I $E(RSPID)=""X"" S ROOT=""^OR(100,""_+$P(RSPID,""X"",2)_"",4.5)""  G XROOT"
^XTV(8991,54,1,1,1,55,0)=" I +RSPID=RSPID  S ROOT=""^ORD(101.41,""_+RSPID_"",6)"" G XROOT"
^XTV(8991,54,1,1,1,56,0)=" Q:ROOT="""""
^XTV(8991,54,1,1,1,57,0)="XROOT S (ILST,I)=0 F  S I=$O(@ROOT@(I)) Q:I'>0  D"
^XTV(8991,54,1,1,1,58,0)=" . S DLG=$P(@ROOT@(I,0),U,2),INST=$P(^(0),U,3)"
^XTV(8991,54,1,1,1,59,0)=" . S ID=$P($G(^ORD(101.41,DLG,1)),U,3)"
^XTV(8991,54,1,1,1,60,0)=" . I '$L(ID) S ID=""ID""_DLG"
^XTV(8991,54,1,1,1,61,0)=" . S VAL=$G(@ROOT@(I,1))"
^XTV(8991,54,1,1,1,62,0)=" . I $P($G(^ORD(101.41,DLG,0)),U)=""OR GTX ADDITIVE"" S ID=""ADDITIVE"""
^XTV(8991,54,1,1,1,63,0)=" . I $E(RSPID)=""C"",(ID=""START""),VAL Q  ; skip literal start time on copy"
^XTV(8991,54,1,1,1,64,0)=" . S LST($$NXT)=""~""_DLG_U_INST_U_ID"
^XTV(8991,54,1,1,1,65,0)=" . I $L(VAL) D"
^XTV(8991,54,1,1,1,66,0)=" .. S LST($$NXT)=""i""_VAL,LST($$NXT)=""e""_$$EXTVAL(VAL,DLG)"
^XTV(8991,54,1,1,1,67,0)=" . I $D(@ROOT@(I,2))>1 D"
^XTV(8991,54,1,1,1,68,0)=" .. S J=0 F  S J=$O(@ROOT@(I,2,J)) Q:J'>0  D"
^XTV(8991,54,1,1,1,69,0)=" ... S LST($$NXT)=""t""_$G(@ROOT@(I,2,J,0))"
^XTV(8991,54,1,1,1,70,0)=" I $E(ROOT,1,4)=""^TMP"" K ^TMP(""ORWDXMQ"",$J)"
^XTV(8991,54,1,1,1,71,0)=" Q"
^XTV(8991,54,1,1,1,72,0)="SAVE(REC,ORVP,ORNP,ORL,DLG,ORDG,ORIT,ORIFN,ORDIALOG,ORDEA,ORAPPT,ORSRC,OREVTDF) ;"
^XTV(8991,54,1,1,1,73,0)=" ; ORVP=DFN, ORNP=Provider, ORL=Location, DLG=Order Dialog,"
^XTV(8991,54,1,1,1,74,0)=" ; ORDG=Display Group, ORIT=Quick Order Dialog, ORAPPT=Appointment"
^XTV(8991,54,1,1,1,75,0)=" N ORDUZ,ORSTS,OREVENT,ORCAT,ORDA,ORTS,ORNEW,ORCHECK,ORLOG,ORLEAD,ORTRAIL,ORPKG,ORWP94,ORCATFN,OREVTYPE,ONPASS"
^XTV(8991,54,1,1,1,76,0)=" ; JD FIX FOR WASHINGTON DC"
^XTV(8991,54,1,1,1,77,0)=" ;I '$L(ORSRC)!($G(ORSRC)="" "")!($G(ORSRC)=0) S ORSRC=$P(ORVP,U,2)"
^XTV(8991,54,1,1,1,78,0)=" ;S ORVP=$P(ORVP,U)"
^XTV(8991,54,1,1,1,79,0)=" ; END FIX JD"
^XTV(8991,54,1,1,1,80,0)=" S ORCATFN="""""
^XTV(8991,54,1,1,1,81,0)=" I $L($P(DLG,U,2)) S ORCATFN=$P(DLG,U,2),DLG=$P(DLG,U,1)"
^XTV(8991,54,1,1,1,82,0)=" ;Remove treating facility if inpatient and IMO order 26.42"
^XTV(8991,54,1,1,1,83,0)=" I $G(^DPT(ORVP,.1))'="""",$P($G(^ORD(100.98,ORDG,0)),U)=""CLINIC ORDERS"" K ORDIALOG(""ORTS"")"
^XTV(8991,54,1,1,1,84,0)=" I $G(ORDIALOG(""ORTS"")) S ORTS=ORDIALOG(""ORTS"") K ORDIALOG(""ORTS"")"
^XTV(8991,54,1,1,1,85,0)=" I $G(ORDIALOG(""ORSLOG"")) S ORLOG=ORDIALOG(""ORSLOG"") K ORDIALOG(""ORSLOG"")"
^XTV(8991,54,1,1,1,86,0)=" I $D(ORDIALOG(""OREVENT"")) S OREVENT=ORDIALOG(""OREVENT"") K ORDIALOG(""OREVENT"")"
^XTV(8991,54,1,1,1,87,0)=" ;====================================================="
^XTV(8991,54,1,1,1,88,0)=" ; Changed for v26.27 (RV)"
^XTV(8991,54,1,1,1,89,0)=" S ORCAT=$$INPT^ORCD,ORCAT=$S(ORCAT=1:""I"",1:""O"")"
^XTV(8991,54,1,1,1,90,0)=" ;I $L($G(OREVENT)) D"
^XTV(8991,54,1,1,1,91,0)=" ;. S ONPASS=0"
^XTV(8991,54,1,1,1,92,0)=" ;. S OREVTYPE=$$TYPE^OREVNTX(OREVENT)"
^XTV(8991,54,1,1,1,93,0)=" ;. I OREVTYPE=""T"" D ISPASS^OREVNTX1(.ONPASS,+OREVENT,""T"")"
^XTV(8991,54,1,1,1,94,0)=" ;. S ORCAT=$S(OREVTYPE=""A"":""I"",OREVTYPE=""T"":""I"",ONPASS=1:""O"",1:""O"")"
^XTV(8991,54,1,1,1,95,0)=" ;E  S ORCAT=$S($L($P($G(^DPT(+ORVP,.1)),U)):""I"",1:""O"")"
^XTV(8991,54,1,1,1,96,0)=" ;====================================================="
^XTV(8991,54,1,1,1,97,0)=" I DLG=""PS MEDS"" S ORWP94=1 D"
^XTV(8991,54,1,1,1,98,0)=" . I ORIT=$O(^ORD(101.41,""AB"",""PSO SUPPLY"",0)) S DLG=""PSO SUPPLY"""
^XTV(8991,54,1,1,1,99,0)=" . I ORIT=$O(^ORD(101.41,""AB"",""PSO OERR"",0)) S DLG=""PSO OERR"""
^XTV(8991,54,1,1,1,100,0)=" . I ORIT=$O(^ORD(101.41,""AB"",""PSJ OR PAT OE"",0)) S DLG=""PSJ OR PAT OE"""
^XTV(8991,54,1,1,1,101,0)=" I DLG=""PSO OERR"" S ORCAT=""O"" I $G(OREVENT(""EFFECTIVE"")) D"
^XTV(8991,54,1,1,1,102,0)=" . S ORDIALOG($O(^ORD(101.41,""B"",""OR GTX START DATE""_$S($G(ORWP94):""/TIME"",1:""""),0)),1)=OREVENT(""EFFECTIVE"")"
^XTV(8991,54,1,1,1,103,0)=" I DLG=""PSJ OR PAT OE"" S ORCAT=""I"""
^XTV(8991,54,1,1,1,104,0)=" S:DLG=""FHW1"" ORCAT=""I"" S:DLG?1""FHW ""2.7U1"" MEAL"" ORCAT=""O"""
^XTV(8991,54,1,1,1,105,0)=" S ORVP=ORVP_"";DPT("",ORL(2)=ORL_"";SC("",ORL=ORL(2)"
^XTV(8991,54,1,1,1,106,0)=" K:'ORDG ORDG K:'ORIT ORIT ; Dgrp & Quick must be non-zero"
^XTV(8991,54,1,1,1,107,0)=" M ORCHECK=ORDIALOG(""ORCHECK"") K ORDIALOG(""ORCHECK"")"
^XTV(8991,54,1,1,1,108,0)=" S ORDIALOG=$O(^ORD(101.41,""AB"",DLG,0))"
^XTV(8991,54,1,1,1,109,0)=" I 'ORDIALOG S ORDIALOG=$O(^ORD(101.41,""B"",DLG,0))"
^XTV(8991,54,1,1,1,110,0)=" I $D(ORDIALOG(""ORLEAD"")) S ORLEAD=ORDIALOG(""ORLEAD"")"
^XTV(8991,54,1,1,1,111,0)=" I $D(ORDIALOG(""ORTRAIL"")) S ORTRAIL=ORDIALOG(""ORTRAIL"")"
^XTV(8991,54,1,1,1,112,0)=" D GETDLG1^ORCD(ORDIALOG)"
^XTV(8991,54,1,1,1,113,0)=" I $L(ORCATFN) S ORCAT=ORCATFN"
^XTV(8991,54,1,1,1,114,0)=" I $G(ORWP94) D"
^XTV(8991,54,1,1,1,115,0)=" . N SIGPRMT S SIGPRMT=$O(^ORD(101.41,""B"",""OR GTX SIG"",0))"
^XTV(8991,54,1,1,1,116,0)=" . N INSPRMT S INSPRMT=$O(^ORD(101.41,""B"",""OR GTX INSTRUCTIONS"",0))"
^XTV(8991,54,1,1,1,117,0)=" . I $L($G(ORDIALOG(SIGPRMT,1))) S ORDIALOG(INSPRMT,""FORMAT"")=""@"""
^XTV(8991,54,1,1,1,118,0)=" . I ORCAT=""O"" S ORPKG=$O(^DIC(9.4,""C"",""PSO"",0))"
^XTV(8991,54,1,1,1,119,0)=" . I ORCAT=""I"" S ORPKG=$O(^DIC(9.4,""C"",""PSJ"",0))"
^XTV(8991,54,1,1,1,120,0)=" S ORSRC=$G(ORSRC)"
^XTV(8991,54,1,1,1,121,0)=" D DELPI^ORWDX1 ;delete empty PI"
^XTV(8991,54,1,1,1,122,0)=" I $G(ORIFN)="""" D  ; new order"
^XTV(8991,54,1,1,1,123,0)=" . D EN^ORCSAVE"
^XTV(8991,54,1,1,1,124,0)=" . S REC="""" I ORIFN D GETBYIFN^ORWORR(.REC,ORIFN)"
^XTV(8991,54,1,1,1,125,0)=" . I '$D(^TMP(""ORECALL"",$J,ORDIALOG)) M ^TMP(""ORECALL"",$J,ORDIALOG)=ORDIALOG"
^XTV(8991,54,1,1,1,126,0)=" E  D"
^XTV(8991,54,1,1,1,127,0)=" . N OR0"
^XTV(8991,54,1,1,1,128,0)=" . S OR0=$G(^OR(100,+ORIFN,0)),ORSTS=$P($G(^(3)),U,3),ORDG=$P(OR0,U,11)"
^XTV(8991,54,1,1,1,129,0)=" . I $L($P(OR0,U,17)),ORSTS=10 S OREVENT=$P(OR0,U,17),OREVENT(""TS"")=$P(OR0,U,13)"
^XTV(8991,54,1,1,1,130,0)=" . D XX^ORCSAVE ; edit order"
^XTV(8991,54,1,1,1,131,0)=" . S REC="""" S ORIFN=+ORIFN_"";""_ORDA D GETBYIFN^ORWORR(.REC,ORIFN)"
^XTV(8991,54,1,1,1,132,0)=" Q"
^XTV(8991,54,1,1,1,133,0)="SENDED(ORWLST,ORIENS,TS,LOC) ; Release EDOs to svc"
^XTV(8991,54,1,1,1,134,0)=" N OK,ORVP,ORWERR,ORSIGST,ORDA,ORNATURE,ORIX,X,PTEVT,ORIFN,J,EVENT,LOCK"
^XTV(8991,54,1,1,1,135,0)=" S ORWERR="""",ORIX=0,LOC=LOC_"";SC("""
^XTV(8991,54,1,1,1,136,0)=" F  S ORIX=$O(ORIENS(ORIX)) Q:'ORIX  D"
^XTV(8991,54,1,1,1,137,0)=" . S ORIFN=ORIENS(ORIX)"
^XTV(8991,54,1,1,1,138,0)=" . S PTEVT=$P(^OR(100,+ORIFN,0),U,17) I PTEVT S LOCK=$$LCKEVT^ORX2(PTEVT) S:LOCK EVENT(PTEVT)="""" I 'LOCK S ORWERR=""1^delayed event is locked - another user is processing orders for this event"" ;195"
^XTV(8991,54,1,1,1,139,0)=" . S ORDA=$P(ORIFN,"";"",2) S:'ORDA ORDA=1"
^XTV(8991,54,1,1,1,140,0)=" . S ORVP=$P($G(^OR(100,+ORIFN,0)),U,2)"
^XTV(8991,54,1,1,1,141,0)=" . I $D(^OR(100,+ORIFN,8,ORDA,0)) D"
^XTV(8991,54,1,1,1,142,0)=" .. S ORSIGST=$P($G(^(0)),U,4)"
^XTV(8991,54,1,1,1,143,0)=" .. S ORNATURE=$P($G(^(0)),U,12)"
^XTV(8991,54,1,1,1,144,0)=" . S:$G(LOC) $P(^OR(100,+ORIFN,0),U,10)=LOC ;set location"
^XTV(8991,54,1,1,1,145,0)=" . S:$G(TS) $P(^OR(100,+ORIFN,0),U,13)=TS ;set specialty"
^XTV(8991,54,1,1,1,146,0)=" . S OK=$$LOCK1^ORX2(ORIFN) I 'OK S ORWERR=""1^""_$P(OK,U,2)"
^XTV(8991,54,1,1,1,147,0)=" . I OK,$G(LOCK) D EN2^ORCSEND(ORIENS(ORIX),ORSIGST,ORNATURE,.ORWERR),UNLK1^ORX2(ORIENS(ORIX)) ;add ,LOCK to if statement for 195"
^XTV(8991,54,1,1,1,148,0)=" . S ORWLST(ORIX)=ORIENS(ORIX)"
^XTV(8991,54,1,1,1,149,0)=" . I $L(ORWERR) S ORWLST(ORIX)=ORWLST(ORIX)_""^E^""_ORWERR Q"
^XTV(8991,54,1,1,1,150,0)=" . E  D"
^XTV(8991,54,1,1,1,151,0)=" .. S PTEVT=$P($G(^OR(100,+ORIENS(ORIX),0)),U,17)"
^XTV(8991,54,1,1,1,152,0)=" .. D:$$TYPE^OREVNTX(PTEVT)=""M"" SAVE^ORMEVNT1(ORIENS(ORIX),PTEVT,2)"
^XTV(8991,54,1,1,1,153,0)=" . S X=""RS"""
^XTV(8991,54,1,1,1,154,0)=" . S $P(ORWLST(ORIX),U,2)=X"
^XTV(8991,54,1,1,1,155,0)=" S J=0 F  S J=$O(EVENT(J)) Q:'+J  D UNLEVT^ORX2(J) ;195"
^XTV(8991,54,1,1,1,156,0)=" Q"
^XTV(8991,54,1,1,1,157,0)="SEND(ORWLST,DFN,ORNP,ORL,ES,ORWREC) ; Sign"
^XTV(8991,54,1,1,1,158,0)=" ; DFN=Patient, ORNP=Provider, ORL=Location, ES=Encrypted ES code"
^XTV(8991,54,1,1,1,159,0)=" ; ORWREC(n)=ORIFN;Action^Signature Sts^Release Sts^Nature of Order"
^XTV(8991,54,1,1,1,160,0)="SEND1 N ORVP,ORWI,ORWERR,ORWREL,ORWSIG,ORWNATR,ORDERID,ORBEF,ORLR,ORLAB,X,I"
^XTV(8991,54,1,1,1,161,0)=" S ORVP=DFN_"";DPT("",ORL=ORL_"";SC("",ORL(2)=ORL,ORWLST=0"
^XTV(8991,54,1,1,1,162,0)=" F I=""LR"",""VBEC"" S X=+$O(^DIC(9.4,""C"",I,0)) S:X ORLR(X)=1"
^XTV(8991,54,1,1,1,163,0)=" S ORWI=0 F  S ORWI=$O(ORWREC(ORWI)) Q:'ORWI  D"
^XTV(8991,54,1,1,1,164,0)=" . S X=ORWREC(ORWI),ORWERR="""""
^XTV(8991,54,1,1,1,165,0)=" . S ORDERID=$P(X,U),ORWSIG=$P(X,U,2),ORWREL=$P(X,U,3),ORWNATR=$P(X,U,4)"
^XTV(8991,54,1,1,1,166,0)=" . S ORBEF=0"
^XTV(8991,54,1,1,1,167,0)=" . I '$D(^OR(100,+ORDERID,0)) Q"
^XTV(8991,54,1,1,1,168,0)=" . I $D(^OR(100,+ORDERID,8,+$P(ORDERID,"";"",2),0)) S ORBEF=$P(^OR(100,+ORDERID,8,+$P(ORDERID,"";"",2),0),U,15)"
^XTV(8991,54,1,1,1,169,0)=" . S:$D(^OR(100,+ORDERID,8,+$P(ORDERID,"";"",2),0)) ORWNATR=$S($P(^OR(100,+ORDERID,8,+$P(ORDERID,"";"",2),0),""^"",4)=3:"""",1:ORWNATR)"
^XTV(8991,54,1,1,1,170,0)=" . S ORWERR=$$CHKACT^ORWDXR(ORDERID,ORWSIG,ORWREL,ORWNATR)"
^XTV(8991,54,1,1,1,171,0)=" . I $L(ORWERR) S ORWERR=""1^""_ORWERR"
^XTV(8991,54,1,1,1,172,0)=" . I '$L(ORWERR) D"
^XTV(8991,54,1,1,1,173,0)=" .. I $G(ORLR(+$P(^OR(100,+ORDERID,0),U,14))),'$G(ORLAB) D  ; lab batch start"
^XTV(8991,54,1,1,1,174,0)=" ... I $L($T(BHS^ORMBLD)) D BHS^ORMBLD(ORVP) S ORLAB=1"
^XTV(8991,54,1,1,1,175,0)=" .. N OK S OK=$$LOCK1^ORX2(ORDERID) I 'OK S ORWERR=""1^""_$P(OK,U,2)"
^XTV(8991,54,1,1,1,176,0)=" .. I OK D EN^ORCSEND(ORDERID,"""",ORWSIG,ORWREL,ORWNATR,"""",.ORWERR),UNLK1^ORX2(ORDERID) D EN^PSOAFIN ;vfah"
^XTV(8991,54,1,1,1,177,0)=" . S ORWLST(ORWI)=ORDERID,X="""""
^XTV(8991,54,1,1,1,178,0)=" . I $L(ORWERR) S ORWLST(ORWI)=ORWLST(ORWI)_""^E^""_ORWERR Q"
^XTV(8991,54,1,1,1,179,0)=" . I ORWREL,((ORBEF=10)!(ORBEF=11)),($P(^OR(100,+ORDERID,3),U,3)'=10) S X=""R"""
^XTV(8991,54,1,1,1,180,0)=" . I ORWSIG'=2 S X=X_""S"""
^XTV(8991,54,1,1,1,181,0)=" . S $P(ORWLST(ORWI),U,2)=X"
^XTV(8991,54,1,1,1,182,0)=" I $G(ORLAB) D BTS^ORMBLD(ORVP)"
^XTV(8991,54,1,1,1,183,0)=" Q"
^XTV(8991,54,1,1,1,184,0)="EXTVAL(IVAL,DLG) ; External value given a dlg ptr"
^XTV(8991,54,1,1,1,185,0)=" N ORDIALOG"
^XTV(8991,54,1,1,1,186,0)=" S ORDIALOG(DLG,0)=$P($G(^ORD(101.41,DLG,1)),U,1,2)"
^XTV(8991,54,1,1,1,187,0)=" S ORDIALOG(DLG,1)=IVAL"
^XTV(8991,54,1,1,1,188,0)=" I $E(ORDIALOG(DLG,0))=""R"",(+IVAL'=IVAL) Q IVAL  ; free text date/time"
^XTV(8991,54,1,1,1,189,0)=" Q $$EXT^ORCD(DLG,1)  ; all others"
^XTV(8991,54,1,1,1,190,0)="DLGID(VAL,ORIFN) ; return dlg IEN for order"
^XTV(8991,54,1,1,1,191,0)=" S VAL=$P(^OR(100,+ORIFN,0),U,5)"
^XTV(8991,54,1,1,1,192,0)=" S VAL=$S($P(VAL,"";"",2)=""ORD(101.41,"":+VAL,1:0)"
^XTV(8991,54,1,1,1,193,0)=" Q"
^XTV(8991,54,1,1,1,194,0)="FORMID(VAL,ORIFN)  ; Base dlg FormID for an order"
^XTV(8991,54,1,1,1,195,0)=" N DLG"
^XTV(8991,54,1,1,1,196,0)=" S VAL=0,DLG=$P(^OR(100,+ORIFN,0),U,5)"
^XTV(8991,54,1,1,1,197,0)=" Q:$P(DLG,"";"",2)'=""ORD(101.41,"""
^XTV(8991,54,1,1,1,198,0)=" D FORMID^ORWDXM(.VAL,+DLG)"
^XTV(8991,54,1,1,1,199,0)=" Q"
^XTV(8991,54,1,1,1,200,0)="AGAIN(VAL,DLG)  ; return true to keep dlg for another order"
^XTV(8991,54,1,1,1,201,0)=" S VAL=''$P($G(^ORD(101.41,DLG,0)),U,9)"
^XTV(8991,54,1,1,1,202,0)=" Q"
^XTV(8991,54,1,1,1,203,0)="DGRP(VAL,DLG)   ; Display grp pointer for a dlg"
^XTV(8991,54,1,1,1,204,0)=" S DLG=$S($E(DLG)=""`"":+$P(DLG,""`"",2),1:$O(^ORD(101.41,""AB"",DLG,0))) ;kcm"
^XTV(8991,54,1,1,1,205,0)=" S VAL=$P($G(^ORD(101.41,DLG,0)),U,5)"
^XTV(8991,54,1,1,1,206,0)=" Q"
^XTV(8991,54,1,1,1,207,0)="DGNM(VAL,NM) ; Display grp pointer for name"
^XTV(8991,54,1,1,1,208,0)=" S VAL=$O(^ORD(100.98,""B"",NM,0))"
^XTV(8991,54,1,1,1,209,0)=" Q"
^XTV(8991,54,1,1,1,210,0)="WRLST(LST,LOC) ; List of dlgs for writing orders"
^XTV(8991,54,1,1,1,211,0)=" G WRLST1^ORWDX1"
^XTV(8991,54,1,1,1,212,0)="MSG(LST,IEN) ; Msg text for orderable item"
^XTV(8991,54,1,1,1,213,0)=" N I"
^XTV(8991,54,1,1,1,214,0)=" S I=0 F  S I=$O(^ORD(101.43,IEN,8,I)) Q:I'>0  S LST(I)=^(I,0)"
^XTV(8991,54,1,1,1,215,0)=" Q"
^XTV(8991,54,1,1,1,216,0)="DISMSG(VAL,IEN) ; Disabled mge for ordering dlg"
^XTV(8991,54,1,1,1,217,0)=" S VAL=$P($G(^ORD(101.41,+IEN,0)),U,3)"
^XTV(8991,54,1,1,1,218,0)=" Q"
^XTV(8991,54,1,1,1,219,0)="LOCK(OK,DFN) ; Attempt to lock pt for ordering"
^XTV(8991,54,1,1,1,220,0)=" S OK=$$LOCK^ORX2(DFN)"
^XTV(8991,54,1,1,1,221,0)=" Q"
^XTV(8991,54,1,1,1,222,0)="UNLOCK(OK,DFN) ; Unlock pt for ordering"
^XTV(8991,54,1,1,1,223,0)=" D UNLOCK^ORX2(DFN) S OK=1"
^XTV(8991,54,1,1,1,224,0)=" Q"
^XTV(8991,54,1,1,1,225,0)="LOCKORD(OK,ORIFN) ; Attempt to lock order"
^XTV(8991,54,1,1,1,226,0)=" S OK=$$LOCK1^ORX2(ORIFN)"
^XTV(8991,54,1,1,1,227,0)=" Q"
^XTV(8991,54,1,1,1,228,0)="UNLKORD(OK,ORIFN) ; Unlock order"
^XTV(8991,54,1,1,1,229,0)=" D UNLK1^ORX2(ORIFN) S OK=1"
^XTV(8991,54,1,1,1,230,0)=" Q"
^XTV(8991,54,1,"B",3070123.1704,1)=""
^XTV(8991,55,0)="VADPT1"
^XTV(8991,55,1,0)="^8991.01^1^1"
^XTV(8991,55,1,1,0)="3070123.1752"
^XTV(8991,55,1,1,1,0)="^8991.11^164^164"
^XTV(8991,55,1,1,1,1,0)="VADPT1 ;ALB/MRL/MJK - PATIENT VARIABLES ;1/23/07  17:52"
^XTV(8991,55,1,1,1,2,0)=" ;;5.3;Registration;**415,489,516,614,634**;Aug 13, 1993;Build 8"
^XTV(8991,55,1,1,1,3,0)=" ; Modified from FOIA VISTA,"
^XTV(8991,55,1,1,1,4,0)=" ; Copyright (C) 2007 WorldVistA"
^XTV(8991,55,1,1,1,5,0)=" ;"
^XTV(8991,55,1,1,1,6,0)=" ; This program is free software; you can redistribute it and/or modify"
^XTV(8991,55,1,1,1,7,0)=" ; it under the terms of the GNU General Public License as published by"
^XTV(8991,55,1,1,1,8,0)=" ; the Free Software Foundation; either version 2 of the License, or"
^XTV(8991,55,1,1,1,9,0)=" ; (at your option) any later version."
^XTV(8991,55,1,1,1,10,0)=" ;"
^XTV(8991,55,1,1,1,11,0)=" ; This program is distributed in the hope that it will be useful,"
^XTV(8991,55,1,1,1,12,0)=" ; but WITHOUT ANY WARRANTY; without even the implied warranty of"
^XTV(8991,55,1,1,1,13,0)=" ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the"
^XTV(8991,55,1,1,1,14,0)=" ; GNU General Public License for more details."
^XTV(8991,55,1,1,1,15,0)=" ;"
^XTV(8991,55,1,1,1,16,0)=" ; You should have received a copy of the GNU General Public License"
^XTV(8991,55,1,1,1,17,0)=" ; along with this program; if not, write to the Free Software"
^XTV(8991,55,1,1,1,18,0)=" ; Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA"
^XTV(8991,55,1,1,1,19,0)="1 ;Demographic [DEM]"
^XTV(8991,55,1,1,1,20,0)=" N W,Z,NODE"
^XTV(8991,55,1,1,1,21,0)=" ;"
^XTV(8991,55,1,1,1,22,0)=" ; -- name [1 - NM]"
^XTV(8991,55,1,1,1,23,0)=" S VAX=^DPT(DFN,0),@VAV@($P(VAS,""^"",1))=$P(VAX,""^"")"
^XTV(8991,55,1,1,1,24,0)=" ;"
^XTV(8991,55,1,1,1,25,0)=" ; -- ssn [2 - SS]"
^XTV(8991,55,1,1,1,26,0)=" S Z=$P(VAX,""^"",9) S:Z]"""" @VAV@($P(VAS,""^"",2))=Z_$S(Z]"""":""^""_$E(Z,1,3)_""-""_$E(Z,4,5)_""-""_$E(Z,6,10),1:"""")"
^XTV(8991,55,1,1,1,27,0)=" ;"
^XTV(8991,55,1,1,1,28,0)=" ; -- date of birth [2 - DB]"
^XTV(8991,55,1,1,1,29,0)=" S Z=$P(VAX,""^"",3),Y=Z I Y]"""" X ^DD(""DD"") S @VAV@($P(VAS,""^"",3))=Z_""^""_Y"
^XTV(8991,55,1,1,1,30,0)=" ;"
^XTV(8991,55,1,1,1,31,0)=" ; -- age [4 - AG]"
^XTV(8991,55,1,1,1,32,0)=" S W=$S('$D(^DPT(DFN,.35)):"""",'^(.35):"""",1:+^(.35)) S Y=$S('W:DT,1:W) S:Z]"""" @VAV@($P(VAS,""^"",4))=$E(Y,1,3)-$E(Z,1,3)-($E(Y,4,7)<$E(Z,4,7))"
^XTV(8991,55,1,1,1,33,0)=" ;"
^XTV(8991,55,1,1,1,34,0)=" ; Added for VOE to support pediatrics"
^XTV(8991,55,1,1,1,35,0)=" ;"
^XTV(8991,55,1,1,1,36,0)=" I @VAV@($P(VAS,""^"",4))<2 D  ;IHS/ANMC/CLS 01/20/2005"
^XTV(8991,55,1,1,1,37,0)=" .N X,X1,X2,X3"
^XTV(8991,55,1,1,1,38,0)=" .S X1=$S('$G(^DPT(DFN,.35)):DT,1:+^(.35))"
^XTV(8991,55,1,1,1,39,0)=" .S X2=$P(VAX,""^"",3) Q:'X1!('X2)"
^XTV(8991,55,1,1,1,40,0)=" .D ^%DTC S X3=X\365.25,X=$S(X3>2:X3_"" YRS"",X<31:X_"" DYS"",1:X\30_"" MOS"")"
^XTV(8991,55,1,1,1,41,0)=" .S @VAV@($P(VAS,""^"",4))=X Q"
^XTV(8991,55,1,1,1,42,0)=" ;"
^XTV(8991,55,1,1,1,43,0)=" ; End VOE addition"
^XTV(8991,55,1,1,1,44,0)=" ;"
^XTV(8991,55,1,1,1,45,0)=" ;"
^XTV(8991,55,1,1,1,46,0)=" ; -- expired date [6 - EX]"
^XTV(8991,55,1,1,1,47,0)=" S (Y,Z)=W X:Y]"""" ^DD(""DD"") S:Z]"""" @VAV@($P(VAS,""^"",6))=Z_""^""_Y"
^XTV(8991,55,1,1,1,48,0)=" ;"
^XTV(8991,55,1,1,1,49,0)=" ; -- sex [5 - SX]"
^XTV(8991,55,1,1,1,50,0)=" S Z=$P(VAX,""^"",2) S:Z]"""" @VAV@($P(VAS,""^"",5))=Z_""^""_$S(Z=""M"":""MALE"",Z=""F"":""FEMALE"",1:"""") K Z"
^XTV(8991,55,1,1,1,51,0)=" ;"
^XTV(8991,55,1,1,1,52,0)=" ; -- remarks [7 - RE]"
^XTV(8991,55,1,1,1,53,0)=" S @VAV@($P(VAS,""^"",7))=$P(VAX,""^"",10)"
^XTV(8991,55,1,1,1,54,0)=" ;"
^XTV(8991,55,1,1,1,55,0)=" ; -- historic race [8 - RA]"
^XTV(8991,55,1,1,1,56,0)=" S Z=$P(VAX,""^"",6),@VAV@($P(VAS,""^"",8))=Z_$S($D(^DIC(10,+Z,0)):""^""_$P(^(0),""^""),1:"""")"
^XTV(8991,55,1,1,1,57,0)=" ;"
^XTV(8991,55,1,1,1,58,0)=" ; -- religion [9 - RP]"
^XTV(8991,55,1,1,1,59,0)=" S Z=$P(VAX,""^"",8),@VAV@($P(VAS,""^"",9))=Z_$S($D(^DIC(13,+Z,0)):""^""_$P(^(0),""^""),1:"""")"
^XTV(8991,55,1,1,1,60,0)=" ;"
^XTV(8991,55,1,1,1,61,0)=" ; -- marital status [10 - MS]"
^XTV(8991,55,1,1,1,62,0)=" S Z=$P(VAX,""^"",5),@VAV@($P(VAS,""^"",10))=Z_$S($D(^DIC(11,+Z,0)):""^""_$P(^(0),""^""),1:"""")"
^XTV(8991,55,1,1,1,63,0)=" ;"
^XTV(8991,55,1,1,1,64,0)=" ; -- ethnicity [11 - ET]"
^XTV(8991,55,1,1,1,65,0)=" S X=0 F Y=1:1 S X=+$O(^DPT(DFN,.06,X)) Q:'X  D"
^XTV(8991,55,1,1,1,66,0)=" .S NODE=$G(^DPT(DFN,.06,X,0)),Z=$P(NODE,""^"",1) I Z D"
^XTV(8991,55,1,1,1,67,0)=" ..S @VAV@($P(VAS,""^"",11),Y)=Z_""^""_$P($G(^DIC(10.2,Z,0)),""^"",1)"
^XTV(8991,55,1,1,1,68,0)=" ..; -- collection method"
^XTV(8991,55,1,1,1,69,0)=" ..S Z=$P(NODE,""^"",2) I Z D"
^XTV(8991,55,1,1,1,70,0)=" ...S @VAV@($P(VAS,""^"",11),Y,1)=Z_""^""_$P($G(^DIC(10.3,Z,0)),""^"",1)"
^XTV(8991,55,1,1,1,71,0)=" S @VAV@($P(VAS,""^"",11))=Y-1"
^XTV(8991,55,1,1,1,72,0)=" ;"
^XTV(8991,55,1,1,1,73,0)=" ; -- race [12 - RC]"
^XTV(8991,55,1,1,1,74,0)=" S X=0 F Y=1:1 S X=+$O(^DPT(DFN,.02,X)) Q:'X  D"
^XTV(8991,55,1,1,1,75,0)=" .S NODE=$G(^DPT(DFN,.02,X,0)),Z=$P(NODE,""^"",1) I Z D"
^XTV(8991,55,1,1,1,76,0)=" ..S @VAV@($P(VAS,""^"",12),Y)=Z_""^""_$P($G(^DIC(10,Z,0)),""^"",1)"
^XTV(8991,55,1,1,1,77,0)=" ..; -- collection method"
^XTV(8991,55,1,1,1,78,0)=" ..S Z=$P(NODE,""^"",2) I Z D"
^XTV(8991,55,1,1,1,79,0)=" ...S @VAV@($P(VAS,""^"",12),Y,1)=Z_""^""_$P($G(^DIC(10.3,Z,0)),""^"",1)"
^XTV(8991,55,1,1,1,80,0)=" S @VAV@($P(VAS,""^"",12))=Y-1"
^XTV(8991,55,1,1,1,81,0)=" Q"
^XTV(8991,55,1,1,1,82,0)=" ;"
^XTV(8991,55,1,1,1,83,0)=" ; Added for VOE to support pediatrics"
^XTV(8991,55,1,1,1,84,0)=" ;"
^XTV(8991,55,1,1,1,85,0)="PAGE ; -- IHS printable age  ;IHS/ITSC/CLS 01/14/2005"
^XTV(8991,55,1,1,1,86,0)=" N X,X1,X2,Y,AUX"
^XTV(8991,55,1,1,1,87,0)=" S X1=$S('$D(^DPT(DFN,.35)):DT,1:+^(.35))"
^XTV(8991,55,1,1,1,88,0)=" S X2=$P(VAX,""^"",3) D:X2 ^%DTC:X1 S AUX=X\365.25,X=$S(AUX>2:AUX_"" YRS"",X<31:X_"" DYS"",1:X\30_"" MOS"")"
^XTV(8991,55,1,1,1,89,0)=" S @VAV@($P(VAS,""^"",4))=X Q"
^XTV(8991,55,1,1,1,90,0)=" ;"
^XTV(8991,55,1,1,1,91,0)=" ; End addition for VOE & IHS"
^XTV(8991,55,1,1,1,92,0)=" ;"
^XTV(8991,55,1,1,1,93,0)="2 ;Other Patient Variables [OPD]"
^XTV(8991,55,1,1,1,94,0)=" N W,Z"
^XTV(8991,55,1,1,1,95,0)=" S VAX=^DPT(DFN,0)"
^XTV(8991,55,1,1,1,96,0)=" ;"
^XTV(8991,55,1,1,1,97,0)=" ; -- city of birth [1 - BC]"
^XTV(8991,55,1,1,1,98,0)=" S @VAV@($P(VAS,""^"",1))=$P(VAX,""^"",11)"
^XTV(8991,55,1,1,1,99,0)=" ;"
^XTV(8991,55,1,1,1,100,0)=" ; -- state of birth [2 - BS]"
^XTV(8991,55,1,1,1,101,0)=" S Z=$P(VAX,""^"",12),@VAV@($P(VAS,""^"",2))=Z_$S($D(^DIC(5,+Z,0)):""^""_$P(^(0),""^"",1),1:"""")"
^XTV(8991,55,1,1,1,102,0)=" ;"
^XTV(8991,55,1,1,1,103,0)=" ; -- occupation [6 - OC]"
^XTV(8991,55,1,1,1,104,0)=" S @VAV@($P(VAS,""^"",6))=$P(VAX,""^"",7)"
^XTV(8991,55,1,1,1,105,0)=" ;"
^XTV(8991,55,1,1,1,106,0)=" ; -- names"
^XTV(8991,55,1,1,1,107,0)=" S VAX=$S($D(^DPT(DFN,.24)):^(.24),1:"""")"
^XTV(8991,55,1,1,1,108,0)=" S @VAV@($P(VAS,""^"",3))=$P(VAX,""^"",1) ; father's        [3 - FN]"
^XTV(8991,55,1,1,1,109,0)=" S @VAV@($P(VAS,""^"",4))=$P(VAX,""^"",2) ; mother's        [4 - MN]"
^XTV(8991,55,1,1,1,110,0)=" S @VAV@($P(VAS,""^"",5))=$P(VAX,""^"",3) ; mother's maiden [5 - MM]"
^XTV(8991,55,1,1,1,111,0)=" ;"
^XTV(8991,55,1,1,1,112,0)=" ; -- employment status [7 - ES]"
^XTV(8991,55,1,1,1,113,0)=" S VAX=$S($D(^DPT(DFN,.311)):^(.311),1:""""),W=""EMPLOYED FULL TIME^EMPLOYED PART TIME^NOT EMPLOYED^SELF EMPLOYED^RETIRED^ACTIVE MILITARY DUTY^UNKNOWN"""
^XTV(8991,55,1,1,1,114,0)=" S Z=$P(VAX,""^"",15),@VAV@($P(VAS,""^"",7))=Z_$S(Z:""^""_$P(W,""^"",Z),1:"""")"
^XTV(8991,55,1,1,1,115,0)=" Q"
^XTV(8991,55,1,1,1,116,0)=" ;"
^XTV(8991,55,1,1,1,117,0)="3 ;Address [ADD]"
^XTV(8991,55,1,1,1,118,0)=" S VABEG=$S($D(VATEST(""ADD"",9)):VATEST(""ADD"",9),1:DT),VAEND=$S($D(VATEST(""ADD"",10)):VATEST(""ADD"",10),1:DT)"
^XTV(8991,55,1,1,1,119,0)=" I $S($D(VAPA(""P"")):1,'$D(^DPT(DFN,.121)):1,$P(^(.121),""^"",9)'=""Y"":1,'$P(^(.121),""^"",7):1,$P(^(.121),""^"",7)>VABEG:1,'$P(^(.121),""^"",8):0,1:$P(^(.121),""^"",8)<VAEND) S VAX=$S($D(^DPT(DFN,.11)):^(.11),1:""""),VAX(1)=0"
^XTV(8991,55,1,1,1,120,0)=" E  S VAX=$S($D(^DPT(DFN,.121)):^(.121),1:""""),VAX(1)=1"
^XTV(8991,55,1,1,1,121,0)=" F I=1:1:6 S VAZ=$P(VAX,""^"",I),@VAV@($P(VAS,""^"",I))=VAZ I I=5,$D(^DIC(5,+VAZ,0)) S VAZ=$P(^(0),""^""),@VAV@($P(VAS,""^"",5))=@VAV@($P(VAS,""^"",5))_""^""_VAZ"
^XTV(8991,55,1,1,1,122,0)=" S VAZ=$S('VAX(1):$P(VAX,""^"",7),1:$P(VAX,""^"",11)) S:$D(^DIC(5,+$P(VAX,""^"",5),1,+VAZ,0)) VAZ=VAZ_""^""_$P(^(0),""^"",1) S @VAV@($P(VAS,""^"",7))=VAZ"
^XTV(8991,55,1,1,1,123,0)=" S VAZIP4=$P(VAX,U,12)"
^XTV(8991,55,1,1,1,124,0)=" S @VAV@($P(VAS,U,11))=VAZIP4_$S('$G(VAZIP4):"""",($L(VAZIP4)=5):U_VAZIP4,1:U_$E(VAZIP4,1,5)_""-""_$E(VAZIP4,6,9))"
^XTV(8991,55,1,1,1,125,0)=" ;DG*5.3*516"
^XTV(8991,55,1,1,1,126,0)=" I $D(^DPT(DFN,.13)) S @VAV@($P(VAS,""^"",8))=$P(^(.13),""^"",1)"
^XTV(8991,55,1,1,1,127,0)=" I 'VAX(1) G CA"
^XTV(8991,55,1,1,1,128,0)=" S @VAV@($P(VAS,""^"",8))=$P(VAX,""^"",10)"
^XTV(8991,55,1,1,1,129,0)=" F I=7,8 S VAZ=$P(VAX,""^"",I),Y=VAZ X:Y]"""" ^DD(""DD"") S @VAV@($P(VAS,""^"",I+2))=VAZ_""^""_Y"
^XTV(8991,55,1,1,1,130,0)="CA ;Confidential Address"
^XTV(8991,55,1,1,1,131,0)=" I '$D(^DPT(DFN,.141)) G Q3"
^XTV(8991,55,1,1,1,132,0)=" N VACAT,VAACT,VAACTDT,VATYP,VATYPNAM,VACAN"
^XTV(8991,55,1,1,1,133,0)=" S VAX=$S($D(^DPT(DFN,.141)):^(.141),1:"""")"
^XTV(8991,55,1,1,1,134,0)=" S VAACTDT=$S($D(VAPA(""CD"")):VAPA(""CD""),1:DT)"
^XTV(8991,55,1,1,1,135,0)=" F I=1:1:6 S VAZ=$P(VAX,""^"",I),@VAV@($P(VAS,""^"",I+12))=VAZ D"
^XTV(8991,55,1,1,1,136,0)=" .I I=5,$D(^DIC(5,+VAZ,0)) S VAZ=$P(^(0),""^""),@VAV@($P(VAS,""^"",I+12))=@VAV@($P(VAS,""^"",I+12))_""^""_VAZ Q"
^XTV(8991,55,1,1,1,137,0)=" .I I=6,($G(VAZ)]"""") S @VAV@($P(VAS,""^"",I+12))=@VAV@($P(VAS,""^"",I+12))_""^""_$S(($L(VAZ)=5):VAZ,1:$E(VAZ,1,5)_""-""_$E(VAZ,6,9))"
^XTV(8991,55,1,1,1,138,0)=" S VAZ=$P(VAX,""^"",11) S:$D(^DIC(5,+$P(VAX,""^"",5),1,+VAZ,0)) VAZ=VAZ_""^""_$P(^(0),""^"",1) S @VAV@($P(VAS,""^"",19))=VAZ"
^XTV(8991,55,1,1,1,139,0)=" F I=7,8 S VAZ=$P(VAX,""^"",I),Y=VAZ X:Y]"""" ^DD(""DD"") S @VAV@($P(VAS,""^"",I+13))=VAZ_""^""_Y"
^XTV(8991,55,1,1,1,140,0)=" S VABEG=$P(VAX,""^"",7),VAEND=$P(VAX,""^"",8)"
^XTV(8991,55,1,1,1,141,0)=" S @VAV@($P(VAS,""^"",12))=1"
^XTV(8991,55,1,1,1,142,0)=" I 'VABEG!(VABEG>VAACTDT)!(VAEND&(VAEND<VAACTDT)) S @VAV@($P(VAS,""^"",12))=0"
^XTV(8991,55,1,1,1,143,0)=" I $D(^DPT(DFN,.14)) D"
^XTV(8991,55,1,1,1,144,0)=" .S VACAN="""" F  S VACAN=$O(^DPT(DFN,.14,VACAN)) Q:VACAN=""""  D"
^XTV(8991,55,1,1,1,145,0)=" ..Q:'$D(^DPT(DFN,.14,VACAN,0))"
^XTV(8991,55,1,1,1,146,0)=" ..S VATYP=$P(^DPT(DFN,.14,VACAN,0),""^"",1),VAACT=$P(^DPT(DFN,.14,VACAN,0),""^"",2)"
^XTV(8991,55,1,1,1,147,0)=" ..S VACAT=$$GET1^DID(2.141,.01,"""",""POINTER"","""",""DGERR"")"
^XTV(8991,55,1,1,1,148,0)=" ..S VATYPNAM="""" F I=1:1 S VATYPNAM=$P(VACAT,"";"",I) Q:VATYPNAM=""""  D"
^XTV(8991,55,1,1,1,149,0)=" ...I +VATYPNAM[VATYP S VATYPNAM=$P(VATYPNAM,"":"",2),@VAV@($P(VAS,""^"",22),VATYP)=VATYP_""^""_VATYPNAM_""^""_VAACT"
^XTV(8991,55,1,1,1,150,0)="Q3 K VABEG,VAEND,VAZIP4 Q"
^XTV(8991,55,1,1,1,151,0)=" ;"
^XTV(8991,55,1,1,1,152,0)="4 ;Other Address [OAD]"
^XTV(8991,55,1,1,1,153,0)=" N VAZIP4"
^XTV(8991,55,1,1,1,154,0)=" I $S('$D(VAOA(""A"")):1,VAOA(""A"")<1:1,VAOA(""A"")>6:1,1:0) S VAX=.21,VAOA(""A"")=7"
^XTV(8991,55,1,1,1,155,0)=" E  S VAX="".""_$P(""33^34^211^331^311^25"",""^"",+VAOA(""A""))"
^XTV(8991,55,1,1,1,156,0)=" S VAX(1)=VAX,VAX=$S($D(^DPT(DFN,VAX(1))):^(VAX(1)),1:"""") I VAX(1)=.25 S VAX=$P(VAX,""^"",1)_""^^""_$P(VAX,""^"",2,99)"
^XTV(8991,55,1,1,1,157,0)=" S VAX(2)=0 F I=3,4,5,6,7,8 S VAX(2)=VAX(2)+1,@VAV@($P(VAS,""^"",VAX(2)))=$P(VAX,""^"",I)"
^XTV(8991,55,1,1,1,158,0)=" S @VAV@($P(VAS,""^"",7))="""",@VAV@($P(VAS,""^"",8))=$P(VAX,""^"",9),VAX(2)=8"
^XTV(8991,55,1,1,1,159,0)=" F I=1,2 S VAX(2)=VAX(2)+1,@VAV@($P(VAS,""^"",VAX(2)))=$P(VAX,""^"",I)"
^XTV(8991,55,1,1,1,160,0)=" I ""^.311^.25""[(""^""_VAX(1)_""^"") S @VAV@($P(VAS,""^"",10))="""""
^XTV(8991,55,1,1,1,161,0)=" S VAZ=@VAV@($P(VAS,""^"",5)) I VAZ,$D(^DIC(5,+VAZ,0)) S VAZ(1)=$P(^(0),""^"",1),@VAV@($P(VAS,""^"",5))=VAZ_""^""_VAZ(1)"
^XTV(8991,55,1,1,1,162,0)=" S VAZIP4=$P($G(^DPT(DFN,.22)),U,VAOA(""A""))"
^XTV(8991,55,1,1,1,163,0)=" S @VAV@($P(VAS,U,11))=VAZIP4_$S('$G(VAZIP4):"""",($L(VAZIP4)=5):U_VAZIP4,1:U_$E(VAZIP4,1,5)_""-""_$E(VAZIP4,6,9))"
^XTV(8991,55,1,1,1,164,0)=" Q"
^XTV(8991,55,1,"B",3070123.1752,1)=""
^XTV(8991,56,0)="TEST"
^XTV(8991,56,1,0)="^8991.01^1^1"
^XTV(8991,56,1,1,0)="3070124.1619"
^XTV(8991,56,1,1,1,0)="^8991.11^7^7"
^XTV(8991,56,1,1,1,1,0)="TEST ; ;1/24/07  16:19"
^XTV(8991,56,1,1,1,2,0)=" I A=1  D;HUMPH"
^XTV(8991,56,1,1,1,3,0)=" . S B=1"
^XTV(8991,56,1,1,1,4,0)=" . I 0 W !,""$T="",$T"
^XTV(8991,56,1,1,1,5,0)=" E  D"
^XTV(8991,56,1,1,1,6,0)=" . S B=2"
^XTV(8991,56,1,1,1,7,0)=" Q"
^XTV(8991,56,1,"B",3070124.1619,1)=""
^XTV(8991,57,0)="AUPNLK3"
^XTV(8991,57,1,0)="^8991.01^3^3"
^XTV(8991,57,1,1,0)="3070129.083"
^XTV(8991,57,1,1,1,0)="^8991.11^67^67"
^XTV(8991,57,1,1,1,1,0)=""
^XTV(8991,57,1,1,1,1,"DEL")="AUPNLK3 ; IHS/CMI/LAB - IHS PATIENT LOOKUP CHECK FOR DUPLICATES ;1/29/07  08:30"
^XTV(8991,57,1,1,1,2,0)=""
^XTV(8991,57,1,1,1,2,"DEL")=" ;;PATIENT CARE ENCOUNTER;**167**;Aug 12, 1996"
^XTV(8991,57,1,1,1,3,"INS",0)="^8991.12^2^2"
^XTV(8991,57,1,1,1,3,"INS",1,0)="AUPNLK3 ; IHS/CMI/LAB - IHS PATIENT LOOKUP CHECK FOR DUPLICATES ;1/29/07  09:05"
^XTV(8991,57,1,1,1,3,"INS",2,0)=" ;;1.0;PATIENT CARE ENCOUNTER;**167**;Aug 12, 1996"
^XTV(8991,57,1,2,0)="3070129.0905"
^XTV(8991,57,1,2,1,0)="^8991.11^67^67"
^XTV(8991,57,1,2,1,1,0)=""
^XTV(8991,57,1,2,1,1,"DEL")="AUPNLK3 ; IHS/CMI/LAB - IHS PATIENT LOOKUP CHECK FOR DUPLICATES ;1/29/07  09:05"
^XTV(8991,57,1,2,1,2,0)=""
^XTV(8991,57,1,2,1,2,"DEL")=" ;;1.0;PATIENT CARE ENCOUNTER;**167**;Aug 12, 1996"
^XTV(8991,57,1,2,1,3,"INS",0)="^8991.12^2^2"
^XTV(8991,57,1,2,1,3,"INS",1,0)="AUPNLK3 ; IHS/CMI/LAB - IHS PATIENT LOOKUP CHECK FOR DUPLICATES ;1/31/07  17:02"
^XTV(8991,57,1,2,1,3,"INS",2,0)=" ;;1.0;PCE PATIENT CARE ENCOUNTER;**167**;Aug 12, 1996;Build 18"
^XTV(8991,57,1,3,0)="3070131.1702"
^XTV(8991,57,1,3,1,0)="^8991.11^67^67"
^XTV(8991,57,1,3,1,1,0)="AUPNLK3 ; IHS/CMI/LAB - IHS PATIENT LOOKUP CHECK FOR DUPLICATES ;1/31/07  17:02"
^XTV(8991,57,1,3,1,2,0)=" ;;1.0;PCE PATIENT CARE ENCOUNTER;**167**;Aug 12, 1996;Build 18"
^XTV(8991,57,1,3,1,3,0)=" ;'Modified' MAS Patient Look-up Check for Duplicates, June 1987"
^XTV(8991,57,1,3,1,4,0)=" ;"
^XTV(8991,57,1,3,1,5,0)=" ; Upon exiting this routine AUPNLK3 will be set as follows:"
^XTV(8991,57,1,3,1,6,0)=" ;"
^XTV(8991,57,1,3,1,7,0)=" ;          AUPNLK3 =  0 means ok to add patient"
^XTV(8991,57,1,3,1,8,0)=" ;          AUPNLK3 = -1 means do not add patient"
^XTV(8991,57,1,3,1,9,0)=" ;"
^XTV(8991,57,1,3,1,10,0)=" ; AUPQF3 values have the following meaing."
^XTV(8991,57,1,3,1,11,0)=" ;"
^XTV(8991,57,1,3,1,12,0)=" ;        0 = Initial state"
^XTV(8991,57,1,3,1,13,0)=" ;        1 = Missing fields"
^XTV(8991,57,1,3,1,14,0)=" ;        2 = No potential duplicates"
^XTV(8991,57,1,3,1,15,0)=" ;        3 = Operator said no"
^XTV(8991,57,1,3,1,16,0)=" ;        4 = Operator said yes"
^XTV(8991,57,1,3,1,17,0)=" ;"
^XTV(8991,57,1,3,1,18,0)="START ;"
^XTV(8991,57,1,3,1,19,0)=" D INIT ;                    Initialization"
^XTV(8991,57,1,3,1,20,0)=" I AUPQF3 D EOJ Q"
^XTV(8991,57,1,3,1,21,0)=" D SEARCH ;                  Do search"
^XTV(8991,57,1,3,1,22,0)=" I AUPQF3 D EOJ Q"
^XTV(8991,57,1,3,1,23,0)=" D SHOW ;                    Show list of potential duplicates"
^XTV(8991,57,1,3,1,24,0)=" D ASK ;                     See if still want to add"
^XTV(8991,57,1,3,1,25,0)=" D EOJ"
^XTV(8991,57,1,3,1,26,0)=" Q"
^XTV(8991,57,1,3,1,27,0)=" ; - - - - - - - - - - - - - - - - - - - - - - - - - - - -"
^XTV(8991,57,1,3,1,28,0)=" ;"
^XTV(8991,57,1,3,1,29,0)="SEARCH ; SEARCH FOR POTENTIAL DUPLICATES"
^XTV(8991,57,1,3,1,30,0)=" S AUPNM=AUPX,SEX=AUPIDS(.02),DOB=AUPIDS(.03),SSN=AUPIDS(.09)"
^XTV(8991,57,1,3,1,31,0)=" W !!?3,""...searching for potential duplicates"""
^XTV(8991,57,1,3,1,32,0)=" D ^AUPNLKD"
^XTV(8991,57,1,3,1,33,0)=" I 'AUPD W !!?3,""No potential duplicates have been identified."" S AUPQF3=2 Q"
^XTV(8991,57,1,3,1,34,0)=" Q"
^XTV(8991,57,1,3,1,35,0)=" ; - - - - - - - - - - - - - - - - - - - - - - - - - - - - -"
^XTV(8991,57,1,3,1,36,0)=" ;"
^XTV(8991,57,1,3,1,37,0)="SHOW ; SHOW LIST OF POTENTIAL DUPLICATES"
^XTV(8991,57,1,3,1,38,0)=" W !!?3,*7,""The following patients have been identified as potential duplicates:"",!"
^XTV(8991,57,1,3,1,39,0)=" F Y=0:0 S Y=$O(AUPD(Y)) Q:'Y  W !?5,$P(^DPT(Y,0),U) X DIC(""W"") I $D(^DPT(Y,.01)) F AUPAN=0:0 S AUPAN=$O(^DPT(Y,.01,AUPAN)) Q:AUPAN'=+AUPAN  I $D(^(AUPAN,0)) W !?10,$P(^(0),U,1)"
^XTV(8991,57,1,3,1,40,0)=" Q"
^XTV(8991,57,1,3,1,41,0)=" ; - - - - - - - - - - - - - - - - - - - - - - - - - - - -"
^XTV(8991,57,1,3,1,42,0)=" ;"
^XTV(8991,57,1,3,1,43,0)="ASK ; ASK OPERATOR"
^XTV(8991,57,1,3,1,44,0)=" F AUPL=0:0 D ASKADD Q:%"
^XTV(8991,57,1,3,1,45,0)=" I %'=1 S AUPQF3=3 Q"
^XTV(8991,57,1,3,1,46,0)=" S AUPQF3=4"
^XTV(8991,57,1,3,1,47,0)=" Q"
^XTV(8991,57,1,3,1,48,0)=" ;"
^XTV(8991,57,1,3,1,49,0)="ASKADD ;"
^XTV(8991,57,1,3,1,50,0)=" W !!?3,""Do you still want to add '"",AUPX,""' as a new patient"""
^XTV(8991,57,1,3,1,51,0)=" S %=2 D YN^DICN I '% W !!?6,""Enter 'YES' to add new patient, or 'NO' not to."" Q"
^XTV(8991,57,1,3,1,52,0)=" Q"
^XTV(8991,57,1,3,1,53,0)=" ;"
^XTV(8991,57,1,3,1,54,0)=" ; - - - - - - - - - - - - - - - - - - - - - - - - - - - -"
^XTV(8991,57,1,3,1,55,0)=" ;"
^XTV(8991,57,1,3,1,56,0)="INIT ; INITIALIZATION"
^XTV(8991,57,1,3,1,57,0)=" S AUPQF3=0"
^XTV(8991,57,1,3,1,58,0)=" I '$D(AUPX)!('$D(AUPIDS(.02)))!('$D(AUPIDS(.03)))!('$D(AUPIDS(.09))) W !?3,*7,""Unable to search for potential duplicates, Sex, Date of Birth and"",!?3,""Social Security Number must be defined."" S AUPQF3=1 Q"
^XTV(8991,57,1,3,1,59,0)=" Q"
^XTV(8991,57,1,3,1,60,0)=" ;"
^XTV(8991,57,1,3,1,61,0)=" ; - - - - - - - - - - - - - - - - - - - - - - - - - - - -"
^XTV(8991,57,1,3,1,62,0)=" ;"
^XTV(8991,57,1,3,1,63,0)="EOJ ;"
^XTV(8991,57,1,3,1,64,0)=" S AUPNLK3=$S(AUPQF3#2:-1,1:0)"
^XTV(8991,57,1,3,1,65,0)=" K AUPAN,AUPD,AUPNM,AUPQF3"
^XTV(8991,57,1,3,1,66,0)=" K DOB,SEX,SSN"
^XTV(8991,57,1,3,1,67,0)=" Q"
^XTV(8991,57,1,"B",3070129.083,1)=""
^XTV(8991,57,1,"B",3070129.0905,2)=""
^XTV(8991,57,1,"B",3070131.1702,3)=""
^XTV(8991,58,0)="AUPNLKD"
^XTV(8991,58,1,0)="^8991.01^3^3"
^XTV(8991,58,1,1,0)="3070129.0831"
^XTV(8991,58,1,1,1,0)="^8991.11^102^102"
^XTV(8991,58,1,1,1,1,0)=""
^XTV(8991,58,1,1,1,1,"DEL")="AUPNLKD ; IHS/CMI/LAB - IHS PATIENT LOOKUP, QUICK DUPE CHECK ;1/29/07  08:31"
^XTV(8991,58,1,1,1,2,0)=""
^XTV(8991,58,1,1,1,2,"DEL")=" ;;PATIENT CARE ENCOUNTER;**167**;Aug 12, 1996"
^XTV(8991,58,1,1,1,3,"INS",0)="^8991.12^2^2"
^XTV(8991,58,1,1,1,3,"INS",1,0)="AUPNLKD ; IHS/CMI/LAB - IHS PATIENT LOOKUP, QUICK DUPE CHECK ;1/29/07  09:05"
^XTV(8991,58,1,1,1,3,"INS",2,0)=" ;;1.0;PATIENT CARE ENCOUNTER;**167**;Aug 12, 1996"
^XTV(8991,58,1,2,0)="3070129.0905"
^XTV(8991,58,1,2,1,0)="^8991.11^102^102"
^XTV(8991,58,1,2,1,1,0)=""
^XTV(8991,58,1,2,1,1,"DEL")="AUPNLKD ; IHS/CMI/LAB - IHS PATIENT LOOKUP, QUICK DUPE CHECK ;1/29/07  09:05"
^XTV(8991,58,1,2,1,2,0)=""
^XTV(8991,58,1,2,1,2,"DEL")=" ;;1.0;PATIENT CARE ENCOUNTER;**167**;Aug 12, 1996"
^XTV(8991,58,1,2,1,3,"INS",0)="^8991.12^2^2"
^XTV(8991,58,1,2,1,3,"INS",1,0)="AUPNLKD ; IHS/CMI/LAB - IHS PATIENT LOOKUP, QUICK DUPE CHECK ;1/31/07  17:03"
^XTV(8991,58,1,2,1,3,"INS",2,0)=" ;;1.0;PCE PATIENT CARE ENCOUNTER;**167**;Aug 12, 1996;Build 18"
^XTV(8991,58,1,3,0)="3070131.1703"
^XTV(8991,58,1,3,1,0)="^8991.11^102^102"
^XTV(8991,58,1,3,1,1,0)="AUPNLKD ; IHS/CMI/LAB - IHS PATIENT LOOKUP, QUICK DUPE CHECK ;1/31/07  17:03"
^XTV(8991,58,1,3,1,2,0)=" ;;1.0;PCE PATIENT CARE ENCOUNTER;**167**;Aug 12, 1996;Build 18"
^XTV(8991,58,1,3,1,3,0)=" ;SEA/AMF-ALB/RMO - CHECK FOR DUPLICATES ON NEW PATIENT ENTRY JUNE 1987"
^XTV(8991,58,1,3,1,4,0)=" ;"
^XTV(8991,58,1,3,1,5,0)=" ; Upon exiting this routine AUPD will be the number of potential"
^XTV(8991,58,1,3,1,6,0)=" ; duplicates found, and the array AUPD(n) will contain those"
^XTV(8991,58,1,3,1,7,0)=" ; potential duplicate where 'n' is the patient's DFN."
^XTV(8991,58,1,3,1,8,0)=" ;"
^XTV(8991,58,1,3,1,9,0)="START ;"
^XTV(8991,58,1,3,1,10,0)=" D INIT ;                       Initialization"
^XTV(8991,58,1,3,1,11,0)=" D:$E(DOB,6,7)'=""00"" DOB ;      Check patients with similar DOBs"
^XTV(8991,58,1,3,1,12,0)=" D:SSN'="""" SSN ;                Check patients with similar SSNs"
^XTV(8991,58,1,3,1,13,0)=" D EOJ"
^XTV(8991,58,1,3,1,14,0)=" Q"
^XTV(8991,58,1,3,1,15,0)=" ; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -"
^XTV(8991,58,1,3,1,16,0)=" ;"
^XTV(8991,58,1,3,1,17,0)="DOB ; CHECK SAME DOB + TRANSPOSED DAY"
^XTV(8991,58,1,3,1,18,0)=" F AUPIN=0:0 S AUPIN=$O(^DPT(""ADOB"",DOB,AUPIN)) Q:AUPIN=""""  D DOB1"
^XTV(8991,58,1,3,1,19,0)=" S AUPDOB=DOB,DOB=$E(DOB,1,5)_$E(DOB,7)_$E(DOB,6)"
^XTV(8991,58,1,3,1,20,0)=" F AUPIN=0:0 S AUPIN=$O(^DPT(""ADOB"",DOB,AUPIN)) Q:AUPIN=""""  D DOB1"
^XTV(8991,58,1,3,1,21,0)=" S DOB=AUPDOB"
^XTV(8991,58,1,3,1,22,0)=" Q"
^XTV(8991,58,1,3,1,23,0)=" ;"
^XTV(8991,58,1,3,1,24,0)="DOB1 ;"
^XTV(8991,58,1,3,1,25,0)=" W ""."""
^XTV(8991,58,1,3,1,26,0)=" Q:$D(^VA(15,""AFR"",""DPT("",AUPIN))  ; Quit if verified duplicate"
^XTV(8991,58,1,3,1,27,0)=" S AUPV=^DPT(AUPIN,0),AUPV1=$P(AUPV,U,1)"
^XTV(8991,58,1,3,1,28,0)=" Q:$P(AUPV,U,18)=""I"""
^XTV(8991,58,1,3,1,29,0)=" Q:$P(AUPV,U,2)'=SEX"
^XTV(8991,58,1,3,1,30,0)=" I AUPV1?.E1P.E S AUPT=AUPV1 D PUNC S AUPV1=AUPT"
^XTV(8991,58,1,3,1,31,0)=" S AUPV1L=$P(AUPV1,"","",1),AUPV1F=$P($P(AUPV1,"","",2),"" "",1),AUPV1M=$P($P(AUPV1,"","",2),"" "",2)"
^XTV(8991,58,1,3,1,32,0)=" I ($E(AUPNL,1,2)_$E(AUPNF,1,2))=($E(AUPV1L,1,2)_$E(AUPV1F,1,2)) D HIT Q"
^XTV(8991,58,1,3,1,33,0)=" I AUPNF=AUPV1F D HIT Q"
^XTV(8991,58,1,3,1,34,0)=" I AUPNL=AUPV1L,AUPNM=AUPV1F D HIT Q"
^XTV(8991,58,1,3,1,35,0)=" I AUPNL=AUPV1L,AUPV1M=AUPNF D HIT Q"
^XTV(8991,58,1,3,1,36,0)=" I $D(^DPT(AUPIN,.01)) D ALIAS"
^XTV(8991,58,1,3,1,37,0)=" Q:SSN="""""
^XTV(8991,58,1,3,1,38,0)=" S AUPV1=$P(AUPV,U,9)"
^XTV(8991,58,1,3,1,39,0)=" Q:AUPV1="""""
^XTV(8991,58,1,3,1,40,0)=" S AUPF=0 F K=1:1:9 Q:(AUPF>2)  I $E(AUPV1,K)'=$E(SSN,K) S AUPF=AUPF+1"
^XTV(8991,58,1,3,1,41,0)=" I AUPF<3 D HIT Q"
^XTV(8991,58,1,3,1,42,0)=" Q"
^XTV(8991,58,1,3,1,43,0)=" ;"
^XTV(8991,58,1,3,1,44,0)="ALIAS ;"
^XTV(8991,58,1,3,1,45,0)=" F AUPAN=0:0 S AUPAF=1,AUPAN=$O(^DPT(AUPIN,.01,AUPAN)) Q:AUPAN'=+AUPAN  I $D(^(AUPAN,0)) D ALIAS2 I AUPAF D HIT Q"
^XTV(8991,58,1,3,1,46,0)=" K AUPAN,AUPAF"
^XTV(8991,58,1,3,1,47,0)=" Q"
^XTV(8991,58,1,3,1,48,0)=" ;"
^XTV(8991,58,1,3,1,49,0)="ALIAS2 ;"
^XTV(8991,58,1,3,1,50,0)=" S AUPV1=$P(^(0),U,1)"
^XTV(8991,58,1,3,1,51,0)=" S AUPV1L=$P(AUPV1,"","",1),AUPV1F=$P($P(AUPV1,"","",2),"" "",1),AUPV1M=$P($P(AUPV1,"","",2),"" "",2)"
^XTV(8991,58,1,3,1,52,0)=" I AUPV1L=AUPNL Q"
^XTV(8991,58,1,3,1,53,0)=" I AUPV1F=AUPNF Q"
^XTV(8991,58,1,3,1,54,0)=" I AUPV1M=AUPNF Q"
^XTV(8991,58,1,3,1,55,0)=" I AUPNF=AUPV1M Q"
^XTV(8991,58,1,3,1,56,0)=" S AUPAF=0"
^XTV(8991,58,1,3,1,57,0)=" Q"
^XTV(8991,58,1,3,1,58,0)=" ;"
^XTV(8991,58,1,3,1,59,0)=" ; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -"
^XTV(8991,58,1,3,1,60,0)=" ;"
^XTV(8991,58,1,3,1,61,0)="SSN ; CHECK SSNS WITH SAME FIRST FIVE DIGITS"
^XTV(8991,58,1,3,1,62,0)=" S AUPSSN=$E(SSN,1,5)_""0000"" F AUPSSN=0:0 S AUPSSN=$O(^DPT(""SSN"",AUPSSN)) Q:AUPSSN=""""!($E(AUPSSN,1,5)'=$E(SSN,1,5))  F AUPIN=0:0 S AUPIN=$O(^DPT(""SSN"",AUPSSN,AUPIN)) Q:AUPIN=""""  D SSN1"
^XTV(8991,58,1,3,1,63,0)=" Q"
^XTV(8991,58,1,3,1,64,0)=" ;"
^XTV(8991,58,1,3,1,65,0)="SSN1 ;"
^XTV(8991,58,1,3,1,66,0)=" W ""."""
^XTV(8991,58,1,3,1,67,0)=" Q:$D(AUPD(AUPIN))  ; Quit if already found"
^XTV(8991,58,1,3,1,68,0)=" Q:$D(^VA(15,""AFR"",""DPT("",AUPIN))  ; Quit if verified duplicate"
^XTV(8991,58,1,3,1,69,0)=" S AUPV1=^DPT(AUPIN,0)"
^XTV(8991,58,1,3,1,70,0)=" Q:$P(AUPV1,U,2)'=SEX"
^XTV(8991,58,1,3,1,71,0)=" I $P(AUPV1,"","",1)=$P(AUPN,"","",1)!($E(AUPV1,1,2)_$E($P(AUPV1,"","",2),1,2)=($E(AUPN,1,2)_$E($P(AUPN,"","",2),1,2))) S AUPD(AUPIN)="""",AUPD=AUPD+1 Q"
^XTV(8991,58,1,3,1,72,0)=" S AUPV=$E(SSN,6,9),AUPV1=$E(AUPSSN,6,9)"
^XTV(8991,58,1,3,1,73,0)=" S AUPF=0 F K=1:1:4 Q:(AUPF>2)  I $E(AUPV,K)'=$E(AUPV1,K) S AUPF=AUPF+1"
^XTV(8991,58,1,3,1,74,0)=" I AUPF<3 D HIT Q"
^XTV(8991,58,1,3,1,75,0)=" Q"
^XTV(8991,58,1,3,1,76,0)=" ;"
^XTV(8991,58,1,3,1,77,0)=" ; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -"
^XTV(8991,58,1,3,1,78,0)=" ;"
^XTV(8991,58,1,3,1,79,0)="HIT ; POTENTIAL DUPLICATE FOUND"
^XTV(8991,58,1,3,1,80,0)=" Q:$D(AUPD(AUPIN))"
^XTV(8991,58,1,3,1,81,0)=" S AUPD(AUPIN)="""""
^XTV(8991,58,1,3,1,82,0)=" S AUPD=AUPD+1"
^XTV(8991,58,1,3,1,83,0)=" Q"
^XTV(8991,58,1,3,1,84,0)=" ;"
^XTV(8991,58,1,3,1,85,0)=" ; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -"
^XTV(8991,58,1,3,1,86,0)=" ;"
^XTV(8991,58,1,3,1,87,0)="INIT ; INITIALIZATION"
^XTV(8991,58,1,3,1,88,0)=" K AUPD"
^XTV(8991,58,1,3,1,89,0)=" S AUPD=0,AUPN=AUPNM"
^XTV(8991,58,1,3,1,90,0)=" I $P(AUPN,"","",1)?.E1P.E S AUPT=$P(AUPN,"","",1) D PUNC S AUPN=AUPT_"",""_$P(AUPN,"","",2,99)"
^XTV(8991,58,1,3,1,91,0)=" S AUPNL=$P(AUPN,"","",1),AUPNF=$P($P(AUPN,"","",2),"" "",1),AUPNM=$P($P(AUPN,"","",2),"" "",2)"
^XTV(8991,58,1,3,1,92,0)=" Q"
^XTV(8991,58,1,3,1,93,0)=" ;"
^XTV(8991,58,1,3,1,94,0)="PUNC ;"
^XTV(8991,58,1,3,1,95,0)=" F I=1:1:$L(AUPT) I $E(AUPT,I)?1P,$E(AUPT,I)'="","",$E(AUPT,I)'="" "" S AUPT=$E(AUPT,1,I-1)_$E(AUPT,I+1,99)"
^XTV(8991,58,1,3,1,96,0)=" Q"
^XTV(8991,58,1,3,1,97,0)=" ;"
^XTV(8991,58,1,3,1,98,0)=" ; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -"
^XTV(8991,58,1,3,1,99,0)=" ;"
^XTV(8991,58,1,3,1,100,0)="EOJ ;"
^XTV(8991,58,1,3,1,101,0)=" K AUPAF,AUPAN,AUPDOB,AUPF,AUPIN,AUPN,AUPNF,AUPNL,AUPNM,AUPSSN,AUPT,AUPV,AUPV1,AUPV1F,AUPV1L,AUPV1M"
^XTV(8991,58,1,3,1,102,0)=" Q"
^XTV(8991,58,1,"B",3070129.0831,1)=""
^XTV(8991,58,1,"B",3070129.0905,2)=""
^XTV(8991,58,1,"B",3070131.1703,3)=""
^XTV(8991,59,0)="AUPNLKDP"
^XTV(8991,59,1,0)="^8991.01^3^3"
^XTV(8991,59,1,1,0)="3070129.0833"
^XTV(8991,59,1,1,1,0)="^8991.11^51^51"
^XTV(8991,59,1,1,1,1,0)=""
^XTV(8991,59,1,1,1,1,"DEL")="AUPNLKDP ; IHS/CMI/LAB - PGMR DOCUMENTATION FOR AUPNLK (PATIENT LOOKUP) 24-MAY-1993 ;1/29/07  08:33"
^XTV(8991,59,1,1,1,2,0)=""
^XTV(8991,59,1,1,1,2,"DEL")=" ;;PATIENT CARE ENCOUNTER;**167**;Aug 12, 1996"
^XTV(8991,59,1,1,1,3,"INS",0)="^8991.12^2^2"
^XTV(8991,59,1,1,1,3,"INS",1,0)="AUPNLKDP ; IHS/CMI/LAB - PGMR DOCUMENTATION FOR AUPNLK (PATIENT LOOKUP) 24-MAY-1993 ;1/29/07  09:05"
^XTV(8991,59,1,1,1,3,"INS",2,0)=" ;;1.0;PATIENT CARE ENCOUNTER;**167**;Aug 12, 1996"
^XTV(8991,59,1,2,0)="3070129.0905"
^XTV(8991,59,1,2,1,0)="^8991.11^51^51"
^XTV(8991,59,1,2,1,1,0)=""
^XTV(8991,59,1,2,1,1,"DEL")="AUPNLKDP ; IHS/CMI/LAB - PGMR DOCUMENTATION FOR AUPNLK (PATIENT LOOKUP) 24-MAY-1993 ;1/29/07  09:05"
^XTV(8991,59,1,2,1,2,0)=""
^XTV(8991,59,1,2,1,2,"DEL")=" ;;1.0;PATIENT CARE ENCOUNTER;**167**;Aug 12, 1996"
^XTV(8991,59,1,2,1,3,"INS",0)="^8991.12^2^2"
^XTV(8991,59,1,2,1,3,"INS",1,0)="AUPNLKDP ; IHS/CMI/LAB - PGMR DOCUMENTATION FOR AUPNLK (PATIENT LOOKUP) 24-MAY-1993 ;1/31/07  17:03"
^XTV(8991,59,1,2,1,3,"INS",2,0)=" ;;1.0;PCE PATIENT CARE ENCOUNTER;**167**;Aug 12, 1996;Build 18"
^XTV(8991,59,1,3,0)="3070131.1703"
^XTV(8991,59,1,3,1,0)="^8991.11^51^51"
^XTV(8991,59,1,3,1,1,0)="AUPNLKDP ; IHS/CMI/LAB - PGMR DOCUMENTATION FOR AUPNLK (PATIENT LOOKUP) 24-MAY-1993 ;1/31/07  17:03"
^XTV(8991,59,1,3,1,2,0)=" ;;1.0;PCE PATIENT CARE ENCOUNTER;**167**;Aug 12, 1996;Build 18"
^XTV(8991,59,1,3,1,3,0)=" ;"
^XTV(8991,59,1,3,1,4,0)="PGMR ; Programmer documentation"
^XTV(8991,59,1,3,1,5,0)=" ;"
^XTV(8991,59,1,3,1,6,0)=" ;  There are seven functional routines in the IHS PATIENT LOOKUP:"
^XTV(8991,59,1,3,1,7,0)=" ;"
^XTV(8991,59,1,3,1,8,0)=" ;  AUPNLK   - Main driver"
^XTV(8991,59,1,3,1,9,0)=" ;  AUPNLK1  - Looks up on xrefs"
^XTV(8991,59,1,3,1,10,0)=" ;  AUPNLK2  - Adds new patients"
^XTV(8991,59,1,3,1,11,0)=" ;  AUPNLK3  - Checks for duplicates"
^XTV(8991,59,1,3,1,12,0)=" ;  AUPNLKD  - Actual duplicate checking logic.  Called by AUPNLK3"
^XTV(8991,59,1,3,1,13,0)=" ;  AUPNLKID - Prints identifiers and duplicate patient messages"
^XTV(8991,59,1,3,1,14,0)=" ;  AUPNLKUT - Contains functions common to multiple routines"
^XTV(8991,59,1,3,1,15,0)=" ;"
^XTV(8991,59,1,3,1,16,0)=" ;  AUPNLKI is the initialization logic for AUPNLK."
^XTV(8991,59,1,3,1,17,0)=" ;"
^XTV(8991,59,1,3,1,18,0)=" ;  Routines broken up because of size will create a new"
^XTV(8991,59,1,3,1,19,0)=" ;  routine with B appended (e.g. AUPNLKB & AUPNLK2B)."
^XTV(8991,59,1,3,1,20,0)=" ;"
^XTV(8991,59,1,3,1,21,0)=" ;  Use caution with the following variables:"
^XTV(8991,59,1,3,1,22,0)=" ;"
^XTV(8991,59,1,3,1,23,0)=" ;  AUPDIC, AUPDICS, AUPDICW - All used to save a variable that needs"
^XTV(8991,59,1,3,1,24,0)=" ;                             to be restored."
^XTV(8991,59,1,3,1,25,0)=" ;  AUPX - Input value for patient lookup.  Common to most routines."
^XTV(8991,59,1,3,1,26,0)=" ;  AUPDFN - Flag indicating lookup status - patient DFN if found."
^XTV(8991,59,1,3,1,27,0)=" ;           Common to most routines."
^XTV(8991,59,1,3,1,28,0)=" ;  AUP(""DR"") - Used to build DIC(""DR"") string - AUPNLK2 only."
^XTV(8991,59,1,3,1,29,0)=" ;  AUP(""NOPRT^"") - Used to suppress printing in PRTAUP^AUPNLKUT."
^XTV(8991,59,1,3,1,30,0)=" ;                  Used by AUPNLK and AUPNLK1."
^XTV(8991,59,1,3,1,31,0)=" ;  AUPS(s) - Used to store all xref lookup hits.  Used by AUPNLK,"
^XTV(8991,59,1,3,1,32,0)=" ;            AUPNLK1, and AUPNLKUT.  Contains the patient's NAME_""^""_"
^XTV(8991,59,1,3,1,33,0)=" ;            LOOKUP VALUE which caused the hit."
^XTV(8991,59,1,3,1,34,0)=" ;  AUPNICK(s) - Indicates hit on ALIAS.  Used by AUPNLK, AUPNLK1,"
^XTV(8991,59,1,3,1,35,0)=" ;               AUPNLKUT."
^XTV(8991,59,1,3,1,36,0)=" ;  AUPIFNS(s) - Used to table all xref lookup hits stored by hit"
^XTV(8991,59,1,3,1,37,0)=" ;               sequence.  Used by AUPNLK, AUPNLK1, and AUPNLKUT."
^XTV(8991,59,1,3,1,38,0)=" ;  AUPCNT - Indicates # of hits stored in AUPIFNS(s).  Used by"
^XTV(8991,59,1,3,1,39,0)=" ;           AUPNLK, AUPNLK1, and AUPNLKUT."
^XTV(8991,59,1,3,1,40,0)=" ;  AUPNUM - Used to display AUPIFNS(s) list.  Used by AUPNLK, AUPNLK1"
^XTV(8991,59,1,3,1,41,0)=" ;           and AUPNLKUT."
^XTV(8991,59,1,3,1,42,0)=" ;  AUPSEL - Indicates patient from AUPIFNS(s) selected by user."
^XTV(8991,59,1,3,1,43,0)=" ;           Used by AUPNLK, AUPNLK1, and AUPNLKUT."
^XTV(8991,59,1,3,1,44,0)=" ;  AUPIFN - Patient DFN taken from xrefs by $O.  Used by AUPNLK,"
^XTV(8991,59,1,3,1,45,0)=" ;           AUPNLK1, and AUPNLKUT."
^XTV(8991,59,1,3,1,46,0)=" ;  AUPIDS(s) - Used to build list of identifiers.  Created by"
^XTV(8991,59,1,3,1,47,0)=" ;              AUPNLK2 but referenced by AUPNLK3."
^XTV(8991,59,1,3,1,48,0)=" ;  AUPD(s) - List of potential duplicates.  Created by AUPNLKD"
^XTV(8991,59,1,3,1,49,0)=" ;            but referenced by AUPNLK3."
^XTV(8991,59,1,3,1,50,0)=" ;"
^XTV(8991,59,1,3,1,51,0)="M ; MARKER FOR INSERTIONS"
^XTV(8991,59,1,"B",3070129.0833,1)=""
^XTV(8991,59,1,"B",3070129.0905,2)=""
^XTV(8991,59,1,"B",3070131.1703,3)=""
^XTV(8991,60,0)="AUPNLKZ"
^XTV(8991,60,1,0)="^8991.01^3^3"
^XTV(8991,60,1,1,0)="3070129.0833"
^XTV(8991,60,1,1,1,0)="^8991.11^27^27"
^XTV(8991,60,1,1,1,1,0)=""
^XTV(8991,60,1,1,1,1,"DEL")="AUPNLKZ ; IHS/CMI/LAB - SET AND RESET DUZ(2) ;1/29/07  08:33"
^XTV(8991,60,1,1,1,2,0)=""
^XTV(8991,60,1,1,1,2,"DEL")=" ;;PATIENT CARE ENCOUNTER;**167**;Aug 12, 1996"
^XTV(8991,60,1,1,1,3,"INS",0)="^8991.12^2^2"
^XTV(8991,60,1,1,1,3,"INS",1,0)="AUPNLKZ ; IHS/CMI/LAB - SET AND RESET DUZ(2) ;1/29/07  09:06"
^XTV(8991,60,1,1,1,3,"INS",2,0)=" ;;1.0;PATIENT CARE ENCOUNTER;**167**;Aug 12, 1996"
^XTV(8991,60,1,2,0)="3070129.0906"
^XTV(8991,60,1,2,1,0)="^8991.11^27^27"
^XTV(8991,60,1,2,1,1,0)=""
^XTV(8991,60,1,2,1,1,"DEL")="AUPNLKZ ; IHS/CMI/LAB - SET AND RESET DUZ(2) ;1/29/07  09:06"
^XTV(8991,60,1,2,1,2,0)=""
^XTV(8991,60,1,2,1,2,"DEL")=" ;;1.0;PATIENT CARE ENCOUNTER;**167**;Aug 12, 1996"
^XTV(8991,60,1,2,1,3,"INS",0)="^8991.12^2^2"
^XTV(8991,60,1,2,1,3,"INS",1,0)="AUPNLKZ ; IHS/CMI/LAB - SET AND RESET DUZ(2) ;1/31/07  17:03"
^XTV(8991,60,1,2,1,3,"INS",2,0)=" ;;1.0;PCE PATIENT CARE ENCOUNTER;**167**;Aug 12, 1996;Build 18"
^XTV(8991,60,1,3,0)="3070131.1703"
^XTV(8991,60,1,3,1,0)="^8991.11^27^27"
^XTV(8991,60,1,3,1,1,0)="AUPNLKZ ; IHS/CMI/LAB - SET AND RESET DUZ(2) ;1/31/07  17:03"
^XTV(8991,60,1,3,1,2,0)=" ;;1.0;PCE PATIENT CARE ENCOUNTER;**167**;Aug 12, 1996;Build 18"
^XTV(8991,60,1,3,1,3,0)=" ;"
^XTV(8991,60,1,3,1,4,0)=" ;  This routine is called to save DUZ(2) and set it to"
^XTV(8991,60,1,3,1,5,0)=" ;  zero, then restore DUZ(2) to its original value.  The"
^XTV(8991,60,1,3,1,6,0)=" ;  calls must be made to the two entry points and it makes"
^XTV(8991,60,1,3,1,7,0)=" ;  no sense to call RESET unless SET was previously called."
^XTV(8991,60,1,3,1,8,0)=" ;"
^XTV(8991,60,1,3,1,9,0)=" ;  If SET is called and DUZ(2) does not exists this"
^XTV(8991,60,1,3,1,10,0)=" ;  routine will abort."
^XTV(8991,60,1,3,1,11,0)=" ;"
^XTV(8991,60,1,3,1,12,0)=" Q  ; Invalid entry point"
^XTV(8991,60,1,3,1,13,0)=" ;"
^XTV(8991,60,1,3,1,14,0)="SET ;EP - SAVE DUZ(2) AND SET TO ZERO"
^XTV(8991,60,1,3,1,15,0)=" S:'($D(AUPNDUZ)#2) AUPNDUZ=0"
^XTV(8991,60,1,3,1,16,0)=" S AUPNDUZ=AUPNDUZ+1"
^XTV(8991,60,1,3,1,17,0)=" S AUPNDUZ(AUPNDUZ)=DUZ(2)"
^XTV(8991,60,1,3,1,18,0)=" S DUZ(2)=0"
^XTV(8991,60,1,3,1,19,0)=" Q"
^XTV(8991,60,1,3,1,20,0)=" ;"
^XTV(8991,60,1,3,1,21,0)="RESET ;EP - RESTORE DUZ(2)"
^XTV(8991,60,1,3,1,22,0)=" Q:'($D(AUPNDUZ)#2)"
^XTV(8991,60,1,3,1,23,0)=" S DUZ(2)=AUPNDUZ(AUPNDUZ)"
^XTV(8991,60,1,3,1,24,0)=" K AUPNDUZ(AUPNDUZ)"
^XTV(8991,60,1,3,1,25,0)=" S AUPNDUZ=AUPNDUZ-1"
^XTV(8991,60,1,3,1,26,0)=" K:'AUPNDUZ AUPNDUZ"
^XTV(8991,60,1,3,1,27,0)=" Q"
^XTV(8991,60,1,"B",3070129.0833,1)=""
^XTV(8991,60,1,"B",3070129.0906,2)=""
^XTV(8991,60,1,"B",3070131.1703,3)=""
^XTV(8991,61,0)="AUPNLK2B"
^XTV(8991,61,1,0)="^8991.01^1^1"
^XTV(8991,61,1,1,0)="3070129.0904"
^XTV(8991,61,1,1,1,0)="^8991.11^103^103"
^XTV(8991,61,1,1,1,1,0)="AUPNLK2B ; IHS/CMI/LAB - Broke up AUPNLK2 because of size ;1/29/07  09:04"
^XTV(8991,61,1,1,1,2,0)=" ;;1.0;PCE PATIENT CARE ENCOUNTER;**167**;Aug 12, 1996"
^XTV(8991,61,1,1,1,3,0)=" ;"
^XTV(8991,61,1,1,1,4,0)="TALK ; TALK TO OPERATOR"
^XTV(8991,61,1,1,1,5,0)=" D ASK ;                       Ask if want to add patient"
^XTV(8991,61,1,1,1,6,0)=" Q:AUPQF2"
^XTV(8991,61,1,1,1,7,0)=" D MIDDLE ;                    Ask for complete middle"
^XTV(8991,61,1,1,1,8,0)=" D NICKNM ;                    Check for nicknames"
^XTV(8991,61,1,1,1,9,0)=" D CHKID ;                     Get identifiers"
^XTV(8991,61,1,1,1,10,0)=" Q:AUPQF2"
^XTV(8991,61,1,1,1,11,0)=" D DUPECHK ;                   Check for dupes"
^XTV(8991,61,1,1,1,12,0)=" Q:AUPQF2"
^XTV(8991,61,1,1,1,13,0)=" W !!?3,""...adding new patient"""
^XTV(8991,61,1,1,1,14,0)=" Q"
^XTV(8991,61,1,1,1,15,0)=" ; - - - - - - - - - - - - - - - - - - - - - - - - - - - -"
^XTV(8991,61,1,1,1,16,0)=" ;"
^XTV(8991,61,1,1,1,17,0)="ASK ; ASK OPERATOR"
^XTV(8991,61,1,1,1,18,0)=" F AUPL=0:0 D ASKADD Q:%"
^XTV(8991,61,1,1,1,19,0)=" S:%'=1 AUPQF2=3"
^XTV(8991,61,1,1,1,20,0)=" Q"
^XTV(8991,61,1,1,1,21,0)=" ;"
^XTV(8991,61,1,1,1,22,0)="ASKADD ;"
^XTV(8991,61,1,1,1,23,0)=" S Y=+$P(^DPT(0),U,4)+1 W !?3,*7,""ARE YOU ADDING "",$S(AUPX'?.N:""'""_AUPX_""' AS "",1:""""),""A NEW PATIENT (THE "",Y,$S(Y#10=1&(Y#100-11):""ST"",Y#10=2&(Y#100-12):""ND"",Y#10=3&(Y#100-13):""RD"",1:""TH""),"")"""
^XTV(8991,61,1,1,1,24,0)=" S %=2 D YN^DICN I '% W !?6,""Enter 'YES' to add a new patient, or 'NO' not to."""
^XTV(8991,61,1,1,1,25,0)=" Q"
^XTV(8991,61,1,1,1,26,0)=" ; - - - - - - - - - - - - - - - - - - - - - - - - - - - -"
^XTV(8991,61,1,1,1,27,0)=" ;"
^XTV(8991,61,1,1,1,28,0)="MIDDLE ;"
^XTV(8991,61,1,1,1,29,0)=" S AUPNMM=$P($P(AUPX,"","",2),"" "",2)"
^XTV(8991,61,1,1,1,30,0)=" Q:$L(AUPNMM)>2"
^XTV(8991,61,1,1,1,31,0)=" I $L(AUPNMM)=2,$E(AUPNMM,2)'=""."" Q"
^XTV(8991,61,1,1,1,32,0)=" ; IHS/SD/EFG  AUPN*99.1*12  12/2/2003  FIX PROBLEM WITH MIDDLE"
^XTV(8991,61,1,1,1,33,0)=" ; OR NAME NOT POPULATING PATIENT FILES CORRECTLY"
^XTV(8991,61,1,1,1,34,0)=" ;W !!?3,""Enter complete middle name if known,"",!?5,""   or press <return> to add as entered: "" R X:DTIME"
^XTV(8991,61,1,1,1,35,0)=" ;I '$T!(X=""^"") Q"
^XTV(8991,61,1,1,1,36,0)=" ;S Y=AUPX,Z=$P(Y,"","",2),$P(Z,"" "",2)=X,$P(Y,"","",2)=Z,X=Y K Z"
^XTV(8991,61,1,1,1,37,0)=" ;D NAME^AUPNPED"
^XTV(8991,61,1,1,1,38,0)=" ;Q:'$D(X)"
^XTV(8991,61,1,1,1,39,0)=" ;S AUPX=X"
^XTV(8991,61,1,1,1,40,0)=" K DIR"
^XTV(8991,61,1,1,1,41,0)=" S DIR(0)=""FO^2:15"""
^XTV(8991,61,1,1,1,42,0)=" S DIR(""A"")=""Enter complete middle name if known or press <return> to add as entered: """
^XTV(8991,61,1,1,1,43,0)=" D ^DIR"
^XTV(8991,61,1,1,1,44,0)=" S:Y=""/.,""!(Y=""^^"") DFOUT="""""
^XTV(8991,61,1,1,1,45,0)=" Q:$D(DFOUT)!$D(DUOUT)!$D(DTOUT)"
^XTV(8991,61,1,1,1,46,0)=" I $G(X)'="""" S Y=AUPX,Z=$P(Y,"","",2),$P(Z,"" "",2)=X,$P(Y,"","",2)=Z,X=Y K Z"
^XTV(8991,61,1,1,1,47,0)=" I $G(X)="""" S X=AUPX"
^XTV(8991,61,1,1,1,48,0)=" D NAME^AUPNPED"
^XTV(8991,61,1,1,1,49,0)=" K DIR,DFOUT,DUOUT,X,Y"
^XTV(8991,61,1,1,1,50,0)=" ; END OF CODE CHANGES FOR AUPN*99.1*12"
^XTV(8991,61,1,1,1,51,0)=" Q"
^XTV(8991,61,1,1,1,52,0)=" ; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -"
^XTV(8991,61,1,1,1,53,0)=" ;"
^XTV(8991,61,1,1,1,54,0)="NICKNM ; CHECK FIRST & MIDDLE NAMES FOR NICK NAMES"
^XTV(8991,61,1,1,1,55,0)=" S AUPNML=$P(AUPX,"","",1),AUPNMF=$P($P(AUPX,"","",2),"" "",1),AUPNMM=$P($P(AUPX,"","",2),"" "",2),AUPNMX=$P(AUPX,"","",3)"
^XTV(8991,61,1,1,1,56,0)=" I AUPNMF'="""",$D(^APMM(99,""B"",AUPNMF)) S AUPNMCVN=1 F AUPNMCV=0:0 S AUPNMCV=$O(^APMM(99,""B"",AUPNMF,AUPNMCV)) Q:AUPNMCV=""""  D NICKNM2 Q:AUPNMCV="""""
^XTV(8991,61,1,1,1,57,0)=" I AUPNMM'="""",$D(^APMM(99,""B"",AUPNMM)) S AUPNMCVN=2 F AUPNMCV=0:0 S AUPNMCV=$O(^APMM(99,""B"",AUPNMM,AUPNMCV)) Q:AUPNMCV=""""  D NICKNM2 Q:AUPNMCV="""""
^XTV(8991,61,1,1,1,58,0)=" S AUPX=AUPNML_"",""_AUPNMF_$S(AUPNMM'="""":"" ""_AUPNMM,1:"""")_$S(AUPNMX'="""":"",""_AUPNMX,1:"""")"
^XTV(8991,61,1,1,1,59,0)=" K AUPNML,AUPNMF,AUPNMM,AUPNMCV,AUPNMCVN,AUPNMCVX,AUPNMX"
^XTV(8991,61,1,1,1,60,0)=" Q"
^XTV(8991,61,1,1,1,61,0)=" ;"
^XTV(8991,61,1,1,1,62,0)="NICKNM2 ; CHECK NICK NAMES"
^XTV(8991,61,1,1,1,63,0)=" S AUPNMCVX=$S(AUPNMCVN=1:AUPNMF,1:AUPNMM)"
^XTV(8991,61,1,1,1,64,0)=" Q:AUPNMCVX=$P(^APMM(99,AUPNMCV,0),U,1)"
^XTV(8991,61,1,1,1,65,0)=" W !,""     Do you want "",$S(AUPNMCVN=1:AUPNMF,1:AUPNMM),"" entered as "",$P(^APMM(99,AUPNMCV,0),U,1)"
^XTV(8991,61,1,1,1,66,0)=" S %=2 D YN^DICN"
^XTV(8991,61,1,1,1,67,0)=" S:%=1 @($S(AUPNMCVN=1:""AUPNMF"",1:""AUPNMM""))=$P(^APMM(99,AUPNMCV,0),U,1),AUPNMCV="""""
^XTV(8991,61,1,1,1,68,0)=" K %,%Y"
^XTV(8991,61,1,1,1,69,0)=" Q"
^XTV(8991,61,1,1,1,70,0)=" ; - - - - - - - - - - - - - - - - - - - - - - - - - - - - -"
^XTV(8991,61,1,1,1,71,0)=" ;"
^XTV(8991,61,1,1,1,72,0)="CHKID ; CHECK IDENTIFIERS"
^XTV(8991,61,1,1,1,73,0)=" Q:$D(DIC(""DR""))"
^XTV(8991,61,1,1,1,74,0)=" S AUPGID=""^.02^.03^.09^"""
^XTV(8991,61,1,1,1,75,0)=" F AUPID=.02,.03,.09 D CHKID1 Q:AUPQF2"
^XTV(8991,61,1,1,1,76,0)=" Q:AUPQF2"
^XTV(8991,61,1,1,1,77,0)=" F AUPID=0:0 S AUPID=$O(^DD(2,0,""ID"",AUPID)) Q:'AUPID!(AUPQF2)  I '$F(AUPGID,U_AUPID_U) S AUPLID="""",AUP(""DR"")=AUP(""DR"")_"";""_AUPID"
^XTV(8991,61,1,1,1,78,0)=" Q"
^XTV(8991,61,1,1,1,79,0)=" ;"
^XTV(8991,61,1,1,1,80,0)="CHKID1 ;"
^XTV(8991,61,1,1,1,81,0)=" S AUP(""DR"")=$S('$D(AUP(""DR"")):AUPID,1:AUP(""DR"")_"";""_AUPID) I $D(^DD(2,AUPID,0)) S AUPID0=^(0) D ASKID S:'$D(X) AUPQF2=4"
^XTV(8991,61,1,1,1,82,0)=" Q"
^XTV(8991,61,1,1,1,83,0)=" ;"
^XTV(8991,61,1,1,1,84,0)="ASKID W !?3,""PATIENT "",$P(AUPID0,U),"": "" R X:DTIME I '$T!(X?1""^"") W !?6,*7,""<'"",AUPX,""'> DELETED"" K X Q"
^XTV(8991,61,1,1,1,85,0)=" I X="""",AUPID=.09 S AUPIDS(AUPID)="""",AUP(""DR"")=AUP(""DR"")_""////""_X Q"
^XTV(8991,61,1,1,1,86,0)=" I X[""^"" W:$E(X)[""^"" !?6,*7,""Sorry, '^' not allowed!"" W "" ??"" G ASKID"
^XTV(8991,61,1,1,1,87,0)=" I X[""?""!(X="""") W:X="""" *7,"" ??"" D HLPID G ASKID"
^XTV(8991,61,1,1,1,88,0)=" I $P(AUPID0,U,2)[""S"" F I=1:1 S Y=$P($P(AUPID0,U,3),"";"",I) K:Y="""" X Q:Y=""""  I $P(Y,"":"",1)=X!($E($P(Y,"":"",2),1,$L(X))=X) S X=$P(Y,"":"",1),AUPSET=$P(Y,"":"",2) Q"
^XTV(8991,61,1,1,1,89,0)=" S (DA,D0)=0"
^XTV(8991,61,1,1,1,90,0)=" X $P(^DD(2,AUPID,0),U,5,99) I $D(X) W:$D(AUPSET) "" "",AUPSET S AUPIDS(AUPID)=X,AUP(""DR"")=AUP(""DR"")_""////""_X K AUPSET Q"
^XTV(8991,61,1,1,1,91,0)=" W:'$D(X)&($P(AUPID0,U,2)'[""D"") *7,"" ??"" D HLPID"
^XTV(8991,61,1,1,1,92,0)=" G ASKID"
^XTV(8991,61,1,1,1,93,0)=" ;"
^XTV(8991,61,1,1,1,94,0)="HLPID W:$D(^DD(2,AUPID,.1)) !?5,^(.1) W:$D(^DD(2,AUPID,3)) !?5,^(3) I $D(X),X[""?"" F I=0:0 S I=$O(^DD(2,AUPID,21,I)) Q:'I!(I>3&(X?1""?""))  I $D(^(I,0)) W !?5,^(0) I I>2,X?1""?"" W !?5,""..."""
^XTV(8991,61,1,1,1,95,0)=" W:$D(^DD(2,AUPID,4)) !?5,^(4) I $P(AUPID0,U,2)[""D"" S X=""?"",%DT=""E"" D ^%DT"
^XTV(8991,61,1,1,1,96,0)=" I $P(AUPID0,U,2)[""S"" W !?7,""CHOOSE FROM: "" F I=1:1 S Y=$P($P(AUPID0,U,3),"";"",I) Q:Y=""""  W !?7,$P(Y,"":"",1),?15,"" "",$P(Y,"":"",2)"
^XTV(8991,61,1,1,1,97,0)=" Q"
^XTV(8991,61,1,1,1,98,0)=" ; - - - - - - - - - - - - - - - - - - - - - - - - - - - -"
^XTV(8991,61,1,1,1,99,0)=" ;"
^XTV(8991,61,1,1,1,100,0)="DUPECHK ; CHECK FOR DUPLICATE PATIENTS"
^XTV(8991,61,1,1,1,101,0)=" Q:$D(DIC(""DR""))"
^XTV(8991,61,1,1,1,102,0)=" D ^AUPNLK3 S:AUPNLK3<0 AUPQF2=5 K AUPNLK3"
^XTV(8991,61,1,1,1,103,0)=" Q"
^XTV(8991,61,1,"B",3070129.0904,1)=""
^XTV(8991,62,0)="GMRCYP57"
^XTV(8991,62,1,0)="^8991.01^1^1"
^XTV(8991,62,1,1,0)="3071227.1007"
^XTV(8991,62,1,1,1,0)="^8991.11^77^77"
^XTV(8991,62,1,1,1,1,0)="GMRCYP57 ;BP/WAT - POST INSTALL FOR GMRC*3*57 ;12/27/07  10:07"
^XTV(8991,62,1,1,1,2,0)=" ;;3.0;CONSULT/REQUEST TRACKING;**57**;DEC 27, 1997;Build 10"
^XTV(8991,62,1,1,1,3,0)=" ;"
^XTV(8991,62,1,1,1,4,0)=" ;This patch creates a new entry into the Request Services file, #123.5."
^XTV(8991,62,1,1,1,5,0)=" ;This new entry supports the entering of IFCs originating from the VA's Suicide Prevention Hotline"
^XTV(8991,62,1,1,1,6,0)=" ;External References"
^XTV(8991,62,1,1,1,7,0)=" ;$$LKUP^XUAF4(): Institution Lookup, ICR # 2171"
^XTV(8991,62,1,1,1,8,0)=" ;BMES^XPDUTL(): Output a Message, ICR# 10141"
^XTV(8991,62,1,1,1,9,0)=" ;^DIC"
^XTV(8991,62,1,1,1,10,0)=" ;MIX^DIC1"
^XTV(8991,62,1,1,1,11,0)=" ;UPDATE^DIE"
^XTV(8991,62,1,1,1,12,0)=" ;^DIK"
^XTV(8991,62,1,1,1,13,0)=" ;SVC^GMRC101H"
^XTV(8991,62,1,1,1,14,0)=" ;MSG^XQOR"
^XTV(8991,62,1,1,1,15,0)=" ;****LOCAL VARIABLES****"
^XTV(8991,62,1,1,1,16,0)=" ;FDA - FileMan Data Array"
^XTV(8991,62,1,1,1,17,0)=" ;GMRCERR - array to hold any errors returned by UPDATE^DIE"
^XTV(8991,62,1,1,1,18,0)=" ;GMRCIEN - Internal Entry Number Array - used to return the IEN of the newly added service and pass that IEN to the second UPDATE^DIE call as part of the FDA(2) array"
^XTV(8991,62,1,1,1,19,0)=" N FDA,GMRC,ERR,GMRCIEN,STAIEN,ERRMSG"
^XTV(8991,62,1,1,1,20,0)=" S ERRMSG(1)=""INSTALL ABORTED - NO CHANGES WERE MADE TO YOUR SYSTEM."""
^XTV(8991,62,1,1,1,21,0)=" S ERRMSG(2)=""COULD NOT FIND """"UPSTATE NEW YORK HCS"""" IN INSTITUTION FILE"""
^XTV(8991,62,1,1,1,22,0)=" S ERRMSG(3)=""CONFIRM FILE ENTRY AND RE-INSTALL"""
^XTV(8991,62,1,1,1,23,0)=" S ERRMSG(4)=""IF STILL UNSUCCESSFUL, CONTACT VA NAT'L HELP DESK OR SUBMIT REMEDY TICKET"""
^XTV(8991,62,1,1,1,24,0)=" S STAIEN=$$LKUP^XUAF4(100) ;return IEN from INSTITUTION file for this station number; WV/EHR/VOE Old Station Number 528, New Station Number 100"
^XTV(8991,62,1,1,1,25,0)=" I 'STAIEN D BMES^XPDUTL(ERRMSG)"
^XTV(8991,62,1,1,1,26,0)=" Q:'STAIEN"
^XTV(8991,62,1,1,1,27,0)=" D ADDENTRY"
^XTV(8991,62,1,1,1,28,0)=" D AD2ALSVC"
^XTV(8991,62,1,1,1,29,0)=" D ORDUPDT"
^XTV(8991,62,1,1,1,30,0)=" Q"
^XTV(8991,62,1,1,1,31,0)="ADDENTRY ; add new service to 123.5"
^XTV(8991,62,1,1,1,32,0)=" S FDA(1,123.5,""+1,"",.01)=""SUICIDE HOTLINE"""
^XTV(8991,62,1,1,1,33,0)=" S FDA(1,123.5134,""+2,+1,"",.01)=STAIEN"
^XTV(8991,62,1,1,1,34,0)=" S FDA(1,123.5,""+1,"",2)=""2"""
^XTV(8991,62,1,1,1,35,0)=" D UPDATE^DIE("""",""FDA(1)"",""GMRCIEN"",""GMRCERR($J)"")"
^XTV(8991,62,1,1,1,36,0)=" Q"
^XTV(8991,62,1,1,1,37,0)="AD2ALSVC ;add new service as sub-serivce of All Services"
^XTV(8991,62,1,1,1,38,0)=" S FDA(2,123.5,""?1,"",.01)=""ALL SERVICES"""
^XTV(8991,62,1,1,1,39,0)=" S FDA(2,123.51,""+4,?1,"",.01)=$P(GMRCIEN(1),U,1)"
^XTV(8991,62,1,1,1,40,0)=" D UPDATE^DIE("""",""FDA(2)"",""GMRCIEN"",""GMRCERR($J)"")"
^XTV(8991,62,1,1,1,41,0)=" Q"
^XTV(8991,62,1,1,1,42,0)="ORDUPDT ;update orderable items file with new service entry"
^XTV(8991,62,1,1,1,43,0)=" ;GMRCSRVC - ien of new service, GMRCSSNM - name of new service"
^XTV(8991,62,1,1,1,44,0)=" N DIC,GMRCMSG,GMRCSRVC,GMRCSSNM,GMRCACT"
^XTV(8991,62,1,1,1,45,0)=" S DIC=""^GMR(123.5,"",DIC(0)=""B"",X=""SUICIDE HOTLINE"" D ^DIC Q:Y=-1"
^XTV(8991,62,1,1,1,46,0)=" S GMRCSRVC=$P(Y,U)"
^XTV(8991,62,1,1,1,47,0)=" S GMRCSSNM=$P(Y,U,2)"
^XTV(8991,62,1,1,1,48,0)=" S GMRCACT=""MUP"""
^XTV(8991,62,1,1,1,49,0)=" D SVC^GMRC101H(GMRCSRVC,GMRCSSNM,GMRCACT),MSG^XQOR(""GMRC ORDERABLE ITEM UPDATE"",.GMRCMSG)"
^XTV(8991,62,1,1,1,50,0)=" K X,Y"
^XTV(8991,62,1,1,1,51,0)=" Q"
^XTV(8991,62,1,1,1,52,0)="PRE ;clean up and old entries of SUICIDE CONSULTS from previous test versions"
^XTV(8991,62,1,1,1,53,0)=" N DIC,DIK,DA,SVCIEN,SBSVCIEN,SVCIENSH"
^XTV(8991,62,1,1,1,54,0)=" ;SVCIEN - IEN of ""ALL SERVICES"""
^XTV(8991,62,1,1,1,55,0)=" ;SBSVCIEN - IEN corresponding to SUICIDE HOTLINE entry in SUBSERVICE of ALL SERVICES"
^XTV(8991,62,1,1,1,56,0)=" ;SVCIENSH - IEN of 'SUICIDE HOTLINE"""
^XTV(8991,62,1,1,1,57,0)=" S DIC=""^GMR(123.5,"",DIC(0)=""B"",X=""ALL SERVICES"" D ^DIC"
^XTV(8991,62,1,1,1,58,0)=" Q:Y=-1  S SVCIEN=$P(Y,U) K X,Y"
^XTV(8991,62,1,1,1,59,0)=" ;now i have IEN for all services"
^XTV(8991,62,1,1,1,60,0)=" S DIC=""^GMR(123.5,1,10,"",DIC(0)="""",D=""AC"",X=""SUICIDE HOTLINE"" D MIX^DIC1"
^XTV(8991,62,1,1,1,61,0)=" ;1st piece is subservice ien, 2nd piece is top leve ien for suicide hotline"
^XTV(8991,62,1,1,1,62,0)=" Q:Y=-1"
^XTV(8991,62,1,1,1,63,0)=" S SBSVCIEN=$P(Y,U),SVCIENSH=$P(Y,U,2) K X,Y,D"
^XTV(8991,62,1,1,1,64,0)=" ;now i have ien for suicide subservice and ien for suicide top level entry"
^XTV(8991,62,1,1,1,65,0)=" ;remove suicide as a subservice of all services"
^XTV(8991,62,1,1,1,66,0)=" S DIK=""^GMR(123.5,""_SVCIEN_"",10,"",DA=SBSVCIEN,DA(1)=SVCIEN D ^DIK"
^XTV(8991,62,1,1,1,67,0)=" Q:Y=-1"
^XTV(8991,62,1,1,1,68,0)=" N GMRCMSG,GMRCSRVC,GMRCSSNM,GMRCACT"
^XTV(8991,62,1,1,1,69,0)=" S DIC=""^GMR(123.5,"",DIC(0)=""B"",X=""SUICIDE HOTLINE"" D ^DIC Q:Y=-1"
^XTV(8991,62,1,1,1,70,0)=" S GMRCSRVC=$P(Y,U)"
^XTV(8991,62,1,1,1,71,0)=" S GMRCSSNM=$P(Y,U,2)"
^XTV(8991,62,1,1,1,72,0)=" S GMRCACT=""MDC"""
^XTV(8991,62,1,1,1,73,0)=" D SVC^GMRC101H(GMRCSRVC,GMRCSSNM,GMRCACT),MSG^XQOR(""GMRC ORDERABLE ITEM UPDATE"",.GMRCMSG)"
^XTV(8991,62,1,1,1,74,0)=" ;remove suicide from 123.5"
^XTV(8991,62,1,1,1,75,0)=" S DIK=""^GMR(123.5,"",DA=SVCIENSH D ^DIK"
^XTV(8991,62,1,1,1,76,0)=" K X,Y"
^XTV(8991,62,1,1,1,77,0)=" Q"
^XTV(8991,62,1,"B",3071227.1007,1)=""
^XTV(8991,63,0)="TIUPR222"
^XTV(8991,63,1,0)="^8991.01^1^1"
^XTV(8991,63,1,1,0)="3071227.182"
^XTV(8991,63,1,1,1,0)="^8991.11^68^68"
^XTV(8991,63,1,1,1,1,0)="TIUPR222 ; SLC/AJB - TIU Form Letter Update;06Mar07 ;12/27/07  18:20"
^XTV(8991,63,1,1,1,2,0)=" ;;1.0;TEXT INTEGRATION UTILITIES;**222**;Jun 20, 1997"
^XTV(8991,63,1,1,1,3,0)=" Q"
^XTV(8991,63,1,1,1,4,0)="EN ;"
^XTV(8991,63,1,1,1,5,0)=" N TIUQUIT"
^XTV(8991,63,1,1,1,6,0)=" I $$PATCH^XPDUTL(""TIU*1.0*222"") D"
^XTV(8991,63,1,1,1,7,0)=" . F NAME=""FORM LETTERS"",""FORM LETTER EXAMPLE"" D"
^XTV(8991,63,1,1,1,8,0)=" . . I $$CHKTITLE(8925.1,NAME)>0 S TIUQUIT=1"
^XTV(8991,63,1,1,1,9,0)=" I +$G(TIUQUIT) W !!,""Titles have already been installed and will not be installed again."" Q"
^XTV(8991,63,1,1,1,10,0)=" I '$D(ZTQUEUED) X ^%ZOSF(""EON"") W $G(IOCUON),@IOF ;WVEHR/VOE IOCUON TO $G(IOCUON)"
^XTV(8991,63,1,1,1,11,0)=" I $$CHKTITLE(8925.1,""PROGRESS NOTES"")<0 G EXIT"
^XTV(8991,63,1,1,1,12,0)=" W !!,""Creating the new DOCUMENT CLASS """"FORM LETTERS"""" and"""
^XTV(8991,63,1,1,1,13,0)=" W !,""and the new TITLE """"FORM LETTER EXAMPLE"""" in FILE #8925.1"""
^XTV(8991,63,1,1,1,14,0)=" F NAME=""FORM LETTERS"",""FORM LETTER EXAMPLE"" D"
^XTV(8991,63,1,1,1,15,0)=" . I $$CHKTITLE(8925.1,NAME)>0 D"
^XTV(8991,63,1,1,1,16,0)=" . . W !!,""The entry ""_NAME_"" already exists in """
^XTV(8991,63,1,1,1,17,0)=" . . W !,""File #8925.1 and must be renamed or deleted """
^XTV(8991,63,1,1,1,18,0)=" . . W !,""before installation can continue."""
^XTV(8991,63,1,1,1,19,0)=" . . S XPDABORT=1"
^XTV(8991,63,1,1,1,20,0)=" I +$G(XPDABORT) G EXIT"
^XTV(8991,63,1,1,1,21,0)=" F NAME=""FORM LETTERS^DC^PROGRESS NOTES^Form Letters"",""FORM LETTER EXAMPLE^DOC^FORM LETTERS^Form Letter Example"" D"
^XTV(8991,63,1,1,1,22,0)=" . D CREATE($P(NAME,U),$P(NAME,U,2))"
^XTV(8991,63,1,1,1,23,0)=" . D ATTACH($$CHKTITLE(8925.1,$P(NAME,U)),$$CHKTITLE(8925.1,$P(NAME,U,3)),$P(NAME,U,4))"
^XTV(8991,63,1,1,1,24,0)=" . W !!,$P(NAME,U),"" created"""
^XTV(8991,63,1,1,1,25,0)=" W !!,""Done!"""
^XTV(8991,63,1,1,1,26,0)="EXIT D"
^XTV(8991,63,1,1,1,27,0)=" . N DIR,X,Y"
^XTV(8991,63,1,1,1,28,0)=" . S DIR(0)=""E"""
^XTV(8991,63,1,1,1,29,0)=" . W ! D ^DIR"
^XTV(8991,63,1,1,1,30,0)=" Q"
^XTV(8991,63,1,1,1,31,0)="CHKTITLE(FILE,NAME) ;"
^XTV(8991,63,1,1,1,32,0)=" N DIC,X,Y"
^XTV(8991,63,1,1,1,33,0)=" S DIC=FILE,DIC(0)=""X"""
^XTV(8991,63,1,1,1,34,0)=" S X=NAME"
^XTV(8991,63,1,1,1,35,0)=" D ^DIC"
^XTV(8991,63,1,1,1,36,0)=" Q +Y"
^XTV(8991,63,1,1,1,37,0)="ATTACH(KID,PARENT,NAME) ;"
^XTV(8991,63,1,1,1,38,0)=" N MSG,TIU,TIUIEN"
^XTV(8991,63,1,1,1,39,0)=" S TIU(8925.14,""+2,""_PARENT_"","",.01)=KID"
^XTV(8991,63,1,1,1,40,0)=" S TIU(8925.14,""+2,""_PARENT_"","",4)=NAME"
^XTV(8991,63,1,1,1,41,0)=" D UPDATE^DIE("""",""TIU"",""TIUIEN"",""MSG"")"
^XTV(8991,63,1,1,1,42,0)=" Q"
^XTV(8991,63,1,1,1,43,0)="CREATE(NAME,CLASS) ;"
^XTV(8991,63,1,1,1,44,0)=" N MSG,TIU,TIUIEN"
^XTV(8991,63,1,1,1,45,0)=" S TIU(8925.1,""+1,"",.01)=NAME"
^XTV(8991,63,1,1,1,46,0)=" S TIU(8925.1,""+1,"",.02)="""""
^XTV(8991,63,1,1,1,47,0)=" S TIU(8925.1,""+1,"",.03)=NAME"
^XTV(8991,63,1,1,1,48,0)=" S TIU(8925.1,""+1,"",.04)=CLASS"
^XTV(8991,63,1,1,1,49,0)=" S TIU(8925.1,""+1,"",.05)="""""
^XTV(8991,63,1,1,1,50,0)=" S TIU(8925.1,""+1,"",.06)=$$LU(8930,""CLINICAL COORDINATOR"",""X"")"
^XTV(8991,63,1,1,1,51,0)=" S TIU(8925.1,""+1,"",.07)=13"
^XTV(8991,63,1,1,1,52,0)=" S TIU(8925.1,""+1,"",3.02)=1"
^XTV(8991,63,1,1,1,53,0)=" S TIU(8925.1,""+1,"",6)=""D ENTRY^TIUFLP"""
^XTV(8991,63,1,1,1,54,0)=" S TIU(8925.1,""+1,"",99)=$H"
^XTV(8991,63,1,1,1,55,0)=" D UPDATE^DIE("""",""TIU"",""TIUIEN"",""MSG"")"
^XTV(8991,63,1,1,1,56,0)=" Q"
^XTV(8991,63,1,1,1,57,0)="MEMBEROF(TITLE,CLASS) ;"
^XTV(8991,63,1,1,1,58,0)=" N TIUY S TIUY=0"
^XTV(8991,63,1,1,1,59,0)=" S CLASS=+$$CLASS(CLASS) Q:+CLASS'>0 TIUY"
^XTV(8991,63,1,1,1,60,0)=" S TIUY=+$$ISA^TIULX(TITLE,CLASS)"
^XTV(8991,63,1,1,1,61,0)=" S:TITLE=CLASS TIUY=1"
^XTV(8991,63,1,1,1,62,0)=" Q TIUY"
^XTV(8991,63,1,1,1,63,0)="CLASS(CLNAME) ;"
^XTV(8991,63,1,1,1,64,0)=" N TIUY S TIUY=+$O(^TIU(8925.1,""B"",CLNAME,0))"
^XTV(8991,63,1,1,1,65,0)=" I +TIUY>0,$S($P($G(^TIU(8925.1,+TIUY,0)),U,4)=""CL"":0,$P($G(^(0)),U,4)=""DC"":0,1:1) S TIUY=0"
^XTV(8991,63,1,1,1,66,0)=" Q TIUY"
^XTV(8991,63,1,1,1,67,0)="LU(FILE,NAME,FLAGS,SCREEN,INDEXES) ;"
^XTV(8991,63,1,1,1,68,0)=" Q $$FIND1^DIC(FILE,"""",$G(FLAGS),NAME,$G(INDEXES),$G(SCREEN),""TIUERR"")"
^XTV(8991,63,1,"B",3071227.182,1)=""
^XTV(8991,"B","AUPNLK1",33)=""
^XTV(8991,"B","AUPNLK2",34)=""
^XTV(8991,"B","AUPNLK2B",61)=""
^XTV(8991,"B","AUPNLK3",57)=""
^XTV(8991,"B","AUPNLKD",58)=""
^XTV(8991,"B","AUPNLKDP",59)=""
^XTV(8991,"B","AUPNLKI",35)=""
^XTV(8991,"B","AUPNLKID",36)=""
^XTV(8991,"B","AUPNLKUT",37)=""
^XTV(8991,"B","AUPNLKZ",60)=""
^XTV(8991,"B","AUPNPAT",20)=""
^XTV(8991,"B","CJS",4)=""
^XTV(8991,"B","CJS2",7)=""
^XTV(8991,"B","DBAFOIA",38)=""
^XTV(8991,"B","DGLBPID",28)=""
^XTV(8991,"B","DGREG",13)=""
^XTV(8991,"B","DGREGAED",17)=""
^XTV(8991,"B","DGRP1",18)=""
^XTV(8991,"B","DGRPD",19)=""
^XTV(8991,"B","DGRPE",16)=""
^XTV(8991,"B","DGRPU",32)=""
^XTV(8991,"B","DGRPV",29)=""
^XTV(8991,"B","GMRCYP57",62)=""
^XTV(8991,"B","GMREPRE",2)=""
^XTV(8991,"B","HLOTLNK",52)=""
^XTV(8991,"B","IBDY303",5)=""
^XTV(8991,"B","LRX",53)=""
^XTV(8991,"B","MPIFAG1",23)=""
^XTV(8991,"B","MPIFAPI",25)=""
^XTV(8991,"B","MPIFQ0",14)=""
^XTV(8991,"B","ORWDX",54)=""
^XTV(8991,"B","ORWPT",42)=""
^XTV(8991,"B","ORWPT2",43)=""
^XTV(8991,"B","ORWPT3",44)=""
^XTV(8991,"B","PSOORNEW",11)=""
^XTV(8991,"B","PX1P167",27)=""
^XTV(8991,"B","PXRMAGE",51)=""
^XTV(8991,"B","PXRMETX",22)=""
^XTV(8991,"B","PXRMUTL",26)=""
^XTV(8991,"B","PXTTU1",21)=""
^XTV(8991,"B","RGWBSVR",3)=""
^XTV(8991,"B","RTP4",1)=""
^XTV(8991,"B","SDPFSS",45)=""
^XTV(8991,"B","SDVWAPP",46)=""
^XTV(8991,"B","SDVWHLEX",47)=""
^XTV(8991,"B","SDVWHLIN",48)=""
^XTV(8991,"B","SDVWMKPI",49)=""
^XTV(8991,"B","SDVWTEST",50)=""
^XTV(8991,"B","TEST",56)=""
^XTV(8991,"B","TIUPR222",63)=""
^XTV(8991,"B","VADPT1",55)=""
^XTV(8991,"B","VEPERI3",24)=""
^XTV(8991,"B","VEPERVER",12)=""
^XTV(8991,"B","XMRONT",8)=""
^XTV(8991,"B","XPDIL",15)=""
^XTV(8991,"B","XQOR",39)=""
^XTV(8991,"B","XQOR4",40)=""
^XTV(8991,"B","XUS",41)=""
^XTV(8991,"B","XYZ",9)=""
^XTV(8991,"B","ZOSVONT",30)=""
^XTV(8991,"B","ZTMB",6)=""
^XTV(8991,"B","ZTMGRSET",31)=""
^XTV(8991,"B","ZZ",10)=""
